"use strict";const Pe=require("obsidian"),me={openai:{label:"OpenAI",defaultProviderId:"openai",requireApiKey:!0,requireBaseUrl:!1,additionalSettings:[]},anthropic:{label:"Anthropic",defaultProviderId:"anthropic",requireApiKey:!0,requireBaseUrl:!1,additionalSettings:[]},gemini:{label:"Gemini",defaultProviderId:"gemini",requireApiKey:!0,requireBaseUrl:!1,additionalSettings:[]},groq:{label:"Groq",defaultProviderId:"groq",requireApiKey:!0,requireBaseUrl:!1,additionalSettings:[]},openrouter:{label:"OpenRouter",defaultProviderId:"openrouter",requireApiKey:!0,requireBaseUrl:!1,additionalSettings:[]},ollama:{label:"Ollama",defaultProviderId:"ollama",requireApiKey:!1,requireBaseUrl:!1,additionalSettings:[]},"lm-studio":{label:"LM Studio",defaultProviderId:"lm-studio",requireApiKey:!1,requireBaseUrl:!1,additionalSettings:[]},deepseek:{label:"DeepSeek",defaultProviderId:"deepseek",requireApiKey:!0,requireBaseUrl:!1,additionalSettings:[]},perplexity:{label:"Perplexity",defaultProviderId:"perplexity",requireApiKey:!0,requireBaseUrl:!1,additionalSettings:[]},mistral:{label:"Mistral",defaultProviderId:"mistral",requireApiKey:!0,requireBaseUrl:!1,additionalSettings:[]},morph:{label:"Morph",defaultProviderId:"morph",requireApiKey:!0,requireBaseUrl:!1,additionalSettings:[]},"azure-openai":{label:"Azure OpenAI",defaultProviderId:null,requireApiKey:!0,requireBaseUrl:!0,additionalSettings:[{label:"Deployment",key:"deployment",placeholder:"Enter your deployment name",type:"text",required:!0},{label:"API Version",key:"apiVersion",placeholder:"Enter your API version",type:"text",required:!0}]},"openai-compatible":{label:"OpenAI Compatible",defaultProviderId:null,requireApiKey:!1,requireBaseUrl:!0,additionalSettings:[{label:"No Stainless headers",key:"noStainless",type:"toggle",required:!1,description:"Enable this if you encounter CORS errors related to Stainless headers (x-stainless-os, etc.)"}]}},Yo=[{type:"openai",id:me.openai.defaultProviderId},{type:"anthropic",id:me.anthropic.defaultProviderId},{type:"gemini",id:me.gemini.defaultProviderId},{type:"deepseek",id:me.deepseek.defaultProviderId},{type:"openrouter",id:me.openrouter.defaultProviderId}],wl=[{providerType:"anthropic",providerId:me.anthropic.defaultProviderId,id:"anthropic/claude-sonnet-4.0",model:"claude-sonnet-4-0",enable:!1},{providerType:"anthropic",providerId:me.anthropic.defaultProviderId,id:"anthropic/claude-3.5-sonnet",model:"claude-3-5-sonnet-latest",enable:!1},{providerType:"anthropic",providerId:me.anthropic.defaultProviderId,id:"anthropic/claude-3.5-haiku",model:"claude-3-5-haiku-latest",enable:!1},{providerType:"openai",providerId:me.openai.defaultProviderId,id:"openai/gpt-4o",model:"gpt-4o",enable:!1},{providerType:"openai",providerId:me.openai.defaultProviderId,id:"openai/gpt-4o-mini",model:"gpt-4o-mini",enable:!1},{providerType:"openai",providerId:me.openai.defaultProviderId,id:"openai/o1-mini",model:"o1-mini",enable:!1,reasoning:{enabled:!0,reasoning_effort:"medium"}},{providerType:"gemini",providerId:me.gemini.defaultProviderId,id:"gemini/gemini-2.0-flash",model:"gemini-2.0-flash",enable:!1,thinking:{enabled:!0,thinking_budget:-1}},{providerType:"gemini",providerId:me.gemini.defaultProviderId,id:"gemini/gemini-1.5-pro",model:"gemini-1.5-pro",enable:!1},{providerType:"deepseek",providerId:me.deepseek.defaultProviderId,id:"deepseek/deepseek-chat",model:"deepseek-chat",enable:!1},{providerType:"deepseek",providerId:me.deepseek.defaultProviderId,id:"deepseek/deepseek-reasoner",model:"deepseek-reasoner",enable:!1}],We={providers:[...Yo],chatModels:[...wl],defaultChatModelId:"",systemPrompt:"",expandNestedRefs:!0,warnOnContextTrim:!0,debugLog:{enabled:!1,limit:50},quickActions:{ai:!0,user:!1,assistant:!1,system:!1,arrangeLayout:!0},nodeSize:{userWidth:400,userHeight:140,assistantWidth:400,assistantHeight:300}};async function i_(n){const e=await n.loadData();return o_(e)}async function r_(n,e){await n.saveData(e)}function o_(n){if(!n)return{...We};const e=a_(n.providers??[]),t=l_(n.chatModels??[]),s=n.defaultChatModelId&&t.some(l=>l.id===n.defaultChatModelId)?n.defaultChatModelId:t.find(l=>l.enable)?.id??t[0]?.id??"",i={enabled:n.debugLog?.enabled??We.debugLog.enabled,limit:n.debugLog?.limit??We.debugLog.limit},r={ai:n.quickActions?.ai??We.quickActions.ai,user:n.quickActions?.user??We.quickActions.user,assistant:n.quickActions?.assistant??We.quickActions.assistant,system:n.quickActions?.system??We.quickActions.system,arrangeLayout:n.quickActions?.arrangeLayout??We.quickActions.arrangeLayout},o={userWidth:n.nodeSize?.userWidth??We.nodeSize.userWidth,userHeight:n.nodeSize?.userHeight??We.nodeSize.userHeight,assistantWidth:n.nodeSize?.assistantWidth??We.nodeSize.assistantWidth,assistantHeight:n.nodeSize?.assistantHeight??We.nodeSize.assistantHeight};return{providers:e,chatModels:t,defaultChatModelId:s,systemPrompt:n.systemPrompt??We.systemPrompt,expandNestedRefs:n.expandNestedRefs??We.expandNestedRefs,warnOnContextTrim:n.warnOnContextTrim??We.warnOnContextTrim,debugLog:i,quickActions:r,nodeSize:o}}function a_(n){const e=[];for(const t of Yo){const s=n.find(i=>i.id===t.id);s?e.push({...t,...s}):e.push({...t})}for(const t of n)Yo.some(s=>s.id===t.id)||e.push(t);return e}function l_(n){const e=[];for(const t of wl){const s=n.find(i=>i.id===t.id);s?e.push({...t,...s}):e.push({...t})}for(const t of n)wl.some(s=>s.id===t.id)||e.push(t);return e}class El extends Pe.Plugin{async onload(){this.settings=await i_(this)}async saveSettings(){await r_(this,this.settings)}onunload(){console.log("unloading plugin")}}let vu=null;function u_(n){vu=n}function qr(){return vu}function c_(){vu=null}const Sl=!1;var wu=Array.isArray,d_=Array.prototype.indexOf,ga=Array.from,f_=Object.defineProperty,yi=Object.getOwnPropertyDescriptor,Uh=Object.getOwnPropertyDescriptors,h_=Object.prototype,p_=Array.prototype,Eu=Object.getPrototypeOf,qc=Object.isExtensible;function m_(n){for(var e=0;e<n.length;e++)n[e]()}function Fh(){var n,e,t=new Promise((s,i)=>{n=s,e=i});return{promise:t,resolve:n,reject:e}}const Ve=2,Su=4,Tu=8,g_=1<<24,$n=16,qn=32,Gs=64,ya=128,jt=512,Ye=1024,ht=2048,_n=4096,At=8192,Dn=16384,Cu=32768,Ci=65536,Bc=1<<17,$h=1<<18,xi=1<<19,y_=1<<20,kn=1<<25,Fs=32768,Tl=1<<21,Au=1<<22,is=1<<23,rs=Symbol("$state"),__=Symbol("legacy props"),v_=Symbol(""),fi=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function w_(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function E_(n){throw new Error("https://svelte.dev/e/effect_in_teardown")}function S_(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function T_(n){throw new Error("https://svelte.dev/e/effect_orphan")}function C_(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function A_(n){throw new Error("https://svelte.dev/e/props_invalid_value")}function b_(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function I_(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function R_(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function P_(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const x_=1,M_=2,qh=4,k_=8,N_=16,D_=1,L_=4,U_=8,F_=16,$_=1,q_=2,Ke=Symbol(),B_="http://www.w3.org/1999/xhtml";function G_(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function V_(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}function Bh(n){return n===this.v}function Gh(n,e){return n!=n?e==e:n!==e||n!==null&&typeof n=="object"||typeof n=="function"}function Vh(n){return!Gh(n,this.v)}let H_=!1,$t=null;function Ai(n){$t=n}function us(n,e=!1,t){$t={p:$t,i:!1,c:null,e:null,s:n,x:null,l:null}}function cs(n){var e=$t,t=e.e;if(t!==null){e.e=null;for(var s of t)rp(s)}return e.i=!0,$t=e.p,{}}function Hh(){return!0}let bs=[];function Oh(){var n=bs;bs=[],m_(n)}function Br(n){if(bs.length===0&&!Ar){var e=bs;queueMicrotask(()=>{e===bs&&Oh()})}bs.push(n)}function O_(){for(;bs.length>0;)Oh()}function Jh(n){var e=ue;if(e===null)return te.f|=is,n;if((e.f&Cu)===0){if((e.f&ya)===0)throw n;e.b.error(n)}else bi(n,e)}function bi(n,e){for(;e!==null;){if((e.f&ya)!==0)try{e.b.error(n);return}catch(t){n=t}e=e.parent}throw n}const io=new Set;let le=null,Uo=null,Lt=null,Nt=[],_a=null,Cl=!1,Ar=!1;class gn{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#s=0;#n=0;#l=null;#r=new Set;#i=new Set;skipped_effects=new Set;is_fork=!1;is_deferred(){return this.is_fork||this.#n>0}process(e){Nt=[],Uo=null,this.apply();var t={parent:null,effect:null,effects:[],render_effects:[]};for(const s of e)this.#o(s,t);this.is_fork||this.#c(),this.is_deferred()?(this.#a(t.effects),this.#a(t.render_effects)):(Uo=this,le=null,Gc(t.render_effects),Gc(t.effects),Uo=null,this.#l?.resolve()),Lt=null}#o(e,t){e.f^=Ye;for(var s=e.first;s!==null;){var i=s.f,r=(i&(qn|Gs))!==0,o=r&&(i&Ye)!==0,l=o||(i&At)!==0||this.skipped_effects.has(s);if((s.f&ya)!==0&&s.b?.is_pending()&&(t={parent:t,effect:s,effects:[],render_effects:[]}),!l&&s.fn!==null){r?s.f^=Ye:(i&Su)!==0?t.effects.push(s):Vr(s)&&((s.f&$n)!==0&&this.#r.add(s),kr(s));var d=s.first;if(d!==null){s=d;continue}}var c=s.parent;for(s=s.next;s===null&&c!==null;)c===t.effect&&(this.#a(t.effects),this.#a(t.render_effects),t=t.parent),s=c.next,c=c.parent}}#a(e){for(const t of e)(t.f&ht)!==0?this.#r.add(t):(t.f&_n)!==0&&this.#i.add(t),this.#u(t.deps),Qe(t,Ye)}#u(e){if(e!==null)for(const t of e)(t.f&Ve)===0||(t.f&Fs)===0||(t.f^=Fs,this.#u(t.deps))}capture(e,t){this.previous.has(e)||this.previous.set(e,t),(e.f&is)===0&&(this.current.set(e,e.v),Lt?.set(e,e.v))}activate(){le=this,this.apply()}deactivate(){le===this&&(le=null,Lt=null)}flush(){if(this.activate(),Nt.length>0){if(Wh(),le!==null&&le!==this)return}else this.#s===0&&this.process([]);this.deactivate()}discard(){for(const e of this.#t)e(this);this.#t.clear()}#c(){if(this.#n===0){for(const e of this.#e)e();this.#e.clear()}this.#s===0&&this.#d()}#d(){if(io.size>1){this.previous.clear();var e=Lt,t=!0,s={parent:null,effect:null,effects:[],render_effects:[]};for(const r of io){if(r===this){t=!1;continue}const o=[];for(const[d,c]of this.current){if(r.current.has(d))if(t&&c!==r.current.get(d))r.current.set(d,c);else continue;o.push(d)}if(o.length===0)continue;const l=[...r.current.keys()].filter(d=>!this.current.has(d));if(l.length>0){var i=Nt;Nt=[];const d=new Set,c=new Map;for(const f of o)zh(f,l,d,c);if(Nt.length>0){le=r,r.apply();for(const f of Nt)r.#o(f,s);r.deactivate()}Nt=i}}le=null,Lt=e}this.committed=!0,io.delete(this)}increment(e){this.#s+=1,e&&(this.#n+=1)}decrement(e){this.#s-=1,e&&(this.#n-=1),this.revive()}revive(){for(const e of this.#r)this.#i.delete(e),Qe(e,ht),$s(e);for(const e of this.#i)Qe(e,_n),$s(e);this.flush()}oncommit(e){this.#e.add(e)}ondiscard(e){this.#t.add(e)}settled(){return(this.#l??=Fh()).promise}static ensure(){if(le===null){const e=le=new gn;io.add(le),Ar||gn.enqueue(()=>{le===e&&e.flush()})}return le}static enqueue(e){Br(e)}apply(){}}function J_(n){var e=Ar;Ar=!0;try{for(var t;;){if(O_(),Nt.length===0&&(le?.flush(),Nt.length===0))return _a=null,t;Wh()}}finally{Ar=e}}function Wh(){var n=Ns;Cl=!0;var e=null;try{var t=0;for(Qo(!0);Nt.length>0;){var s=gn.ensure();if(t++>1e3){var i,r;W_()}s.process(Nt),os.clear()}}finally{Cl=!1,Qo(n),_a=null}}function W_(){try{C_()}catch(n){bi(n,_a)}}let xn=null;function Gc(n){var e=n.length;if(e!==0){for(var t=0;t<e;){var s=n[t++];if((s.f&(Dn|At))===0&&Vr(s)&&(xn=new Set,kr(s),s.deps===null&&s.first===null&&s.nodes===null&&(s.teardown===null&&s.ac===null?lp(s):s.fn=null),xn?.size>0)){os.clear();for(const i of xn){if((i.f&(Dn|At))!==0)continue;const r=[i];let o=i.parent;for(;o!==null;)xn.has(o)&&(xn.delete(o),r.push(o)),o=o.parent;for(let l=r.length-1;l>=0;l--){const d=r[l];(d.f&(Dn|At))===0&&kr(d)}}xn.clear()}}xn=null}}function zh(n,e,t,s){if(!t.has(n)&&(t.add(n),n.reactions!==null))for(const i of n.reactions){const r=i.f;(r&Ve)!==0?zh(i,e,t,s):(r&(Au|$n))!==0&&(r&ht)===0&&Kh(i,e,s)&&(Qe(i,ht),$s(i))}}function Kh(n,e,t){const s=t.get(n);if(s!==void 0)return s;if(n.deps!==null)for(const i of n.deps){if(e.includes(i))return!0;if((i.f&Ve)!==0&&Kh(i,e,t))return t.set(i,!0),!0}return t.set(n,!1),!1}function $s(n){for(var e=_a=n;e.parent!==null;){e=e.parent;var t=e.f;if(Cl&&e===ue&&(t&$n)!==0&&(t&$h)===0)return;if((t&(Gs|qn))!==0){if((t&Ye)===0)return;e.f^=Ye}}Nt.push(e)}function z_(n){let e=0,t=qs(0),s;return()=>{xr()&&(y(t),Ea(()=>(e===0&&(s=Mi(()=>n(()=>br(t)))),e+=1,()=>{Br(()=>{e-=1,e===0&&(s?.(),s=void 0,br(t))})})))}}var K_=Ci|xi|ya;function Y_(n,e,t){new X_(n,e,t)}class X_{parent;#e=!1;#t;#s=null;#n;#l;#r;#i=null;#o=null;#a=null;#u=null;#c=null;#d=0;#f=0;#p=!1;#h=null;#v=z_(()=>(this.#h=qs(this.#d),()=>{this.#h=null}));constructor(e,t,s){this.#t=e,this.#n=t,this.#l=s,this.parent=ue.b,this.#e=!!this.#n.pending,this.#r=Ru(()=>{ue.b=this;{var i=this.#y();try{this.#i=Dt(()=>s(i))}catch(r){this.error(r)}this.#f>0?this.#g():this.#e=!1}return()=>{this.#c?.remove()}},K_)}#w(){try{this.#i=Dt(()=>this.#l(this.#t))}catch(e){this.error(e)}this.#e=!1}#E(){const e=this.#n.pending;e&&(this.#o=Dt(()=>e(this.#t)),gn.enqueue(()=>{var t=this.#y();this.#i=this.#m(()=>(gn.ensure(),Dt(()=>this.#l(t)))),this.#f>0?this.#g():(ks(this.#o,()=>{this.#o=null}),this.#e=!1)}))}#y(){var e=this.#t;return this.#e&&(this.#c=as(),this.#t.before(this.#c),e=this.#c),e}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#m(e){var t=ue,s=te,i=$t;vn(this.#r),dt(this.#r),Ai(this.#r.ctx);try{return e()}catch(r){return Jh(r),null}finally{vn(t),dt(s),Ai(i)}}#g(){const e=this.#n.pending;this.#i!==null&&(this.#u=document.createDocumentFragment(),this.#u.append(this.#c),dp(this.#i,this.#u)),this.#o===null&&(this.#o=Dt(()=>e(this.#t)))}#_(e){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(e);return}this.#f+=e,this.#f===0&&(this.#e=!1,this.#o&&ks(this.#o,()=>{this.#o=null}),this.#u&&(this.#t.before(this.#u),this.#u=null))}update_pending_count(e){this.#_(e),this.#d+=e,this.#h&&Ii(this.#h,this.#d)}get_effect_pending(){return this.#v(),y(this.#h)}error(e){var t=this.#n.onerror;let s=this.#n.failed;if(this.#p||!t&&!s)throw e;this.#i&&(ft(this.#i),this.#i=null),this.#o&&(ft(this.#o),this.#o=null),this.#a&&(ft(this.#a),this.#a=null);var i=!1,r=!1;const o=()=>{if(i){V_();return}i=!0,r&&P_(),gn.ensure(),this.#d=0,this.#a!==null&&ks(this.#a,()=>{this.#a=null}),this.#e=this.has_pending_snippet(),this.#i=this.#m(()=>(this.#p=!1,Dt(()=>this.#l(this.#t)))),this.#f>0?this.#g():this.#e=!1};var l=te;try{dt(null),r=!0,t?.(e,o),r=!1}catch(d){bi(d,this.#r&&this.#r.parent)}finally{dt(l)}s&&Br(()=>{this.#a=this.#m(()=>{gn.ensure(),this.#p=!0;try{return Dt(()=>{s(this.#t,()=>e,()=>o)})}catch(d){return bi(d,this.#r.parent),null}finally{this.#p=!1}})})}}function Q_(n,e,t,s){const i=va;if(t.length===0&&n.length===0){s(e.map(i));return}var r=le,o=ue,l=Z_();function d(){Promise.all(t.map(c=>j_(c))).then(c=>{l();try{s([...e.map(i),...c])}catch(f){(o.f&Dn)===0&&bi(f,o)}r?.deactivate(),Xo()}).catch(c=>{bi(c,o)})}n.length>0?Promise.all(n).then(()=>{l();try{return d()}finally{r?.deactivate(),Xo()}}):d()}function Z_(){var n=ue,e=te,t=$t,s=le;return function(r=!0){vn(n),dt(e),Ai(t),r&&s?.activate()}}function Xo(){vn(null),dt(null),Ai(null)}function va(n){var e=Ve|ht,t=te!==null&&(te.f&Ve)!==0?te:null;return ue!==null&&(ue.f|=xi),{ctx:$t,deps:null,effects:null,equals:Bh,f:e,fn:n,reactions:null,rv:0,v:Ke,wv:0,parent:t??ue,ac:null}}function j_(n,e){let t=ue;t===null&&w_();var s=t.b,i=void 0,r=qs(Ke),o=!te,l=new Map;return fv(()=>{var d=Fh();i=d.promise;try{Promise.resolve(n()).then(d.resolve,d.reject).then(()=>{c===le&&c.committed&&c.deactivate(),Xo()})}catch(h){d.reject(h),Xo()}var c=le;if(o){var f=!s.is_pending();s.update_pending_count(1),c.increment(f),l.get(c)?.reject(fi),l.delete(c),l.set(c,d)}const p=(h,m=void 0)=>{if(c.activate(),m)m!==fi&&(r.f|=is,Ii(r,m));else{(r.f&is)!==0&&(r.f^=is),Ii(r,h);for(const[g,v]of l){if(l.delete(g),g===c)break;v.reject(fi)}}o&&(s.update_pending_count(-1),c.decrement(f))};d.promise.then(p,h=>p(null,h||"unknown"))}),Iu(()=>{for(const d of l.values())d.reject(fi)}),new Promise(d=>{function c(f){function p(){f===i?d(r):c(i)}f.then(p,p)}c(i)})}function Kt(n){const e=va(n);return fp(e),e}function Yh(n){const e=va(n);return e.equals=Vh,e}function Xh(n){var e=n.effects;if(e!==null){n.effects=null;for(var t=0;t<e.length;t+=1)ft(e[t])}}function ev(n){for(var e=n.parent;e!==null;){if((e.f&Ve)===0)return(e.f&Dn)===0?e:null;e=e.parent}return null}function bu(n){var e,t=ue;vn(ev(n));try{n.f&=~Fs,Xh(n),e=gp(n)}finally{vn(t)}return e}function Qh(n){var e=bu(n);if(n.equals(e)||(le?.is_fork||(n.v=e),n.wv=pp()),!Vs)if(Lt!==null)(xr()||le?.is_fork)&&Lt.set(n,e);else{var t=(n.f&jt)===0?_n:Ye;Qe(n,t)}}let Al=new Set;const os=new Map;let Zh=!1;function qs(n,e){var t={f:0,v:n,reactions:null,equals:Bh,rv:0,wv:0};return t}function ge(n,e){const t=qs(n);return fp(t),t}function tv(n,e=!1,t=!0){const s=qs(n);return e||(s.equals=Vh),s}function J(n,e,t=!1){te!==null&&(!yn||(te.f&Bc)!==0)&&Hh()&&(te.f&(Ve|$n|Au|Bc))!==0&&!Ln?.includes(n)&&R_();let s=t?Tt(e):e;return Ii(n,s)}function Ii(n,e){if(!n.equals(e)){var t=n.v;Vs?os.set(n,e):os.set(n,t),n.v=e;var s=gn.ensure();s.capture(n,t),(n.f&Ve)!==0&&((n.f&ht)!==0&&bu(n),Qe(n,(n.f&jt)!==0?Ye:_n)),n.wv=pp(),jh(n,ht),ue!==null&&(ue.f&Ye)!==0&&(ue.f&(qn|Gs))===0&&(Mt===null?mv([n]):Mt.push(n)),!s.is_fork&&Al.size>0&&!Zh&&nv()}return e}function nv(){Zh=!1;var n=Ns;Qo(!0);const e=Array.from(Al);try{for(const t of e)(t.f&Ye)!==0&&Qe(t,_n),Vr(t)&&kr(t)}finally{Qo(n)}Al.clear()}function br(n){J(n,n.v+1)}function jh(n,e){var t=n.reactions;if(t!==null)for(var s=t.length,i=0;i<s;i++){var r=t[i],o=r.f,l=(o&ht)===0;if(l&&Qe(r,e),(o&Ve)!==0){var d=r;Lt?.delete(d),(o&Fs)===0&&(o&jt&&(r.f|=Fs),jh(d,_n))}else l&&((o&$n)!==0&&xn!==null&&xn.add(r),$s(r))}}function Tt(n){if(typeof n!="object"||n===null||rs in n)return n;const e=Eu(n);if(e!==h_&&e!==p_)return n;var t=new Map,s=wu(n),i=ge(0),r=Ds,o=l=>{if(Ds===r)return l();var d=te,c=Ds;dt(null),Wc(r);var f=l();return dt(d),Wc(c),f};return s&&t.set("length",ge(n.length)),new Proxy(n,{defineProperty(l,d,c){(!("value"in c)||c.configurable===!1||c.enumerable===!1||c.writable===!1)&&b_();var f=t.get(d);return f===void 0?f=o(()=>{var p=ge(c.value);return t.set(d,p),p}):J(f,c.value,!0),!0},deleteProperty(l,d){var c=t.get(d);if(c===void 0){if(d in l){const f=o(()=>ge(Ke));t.set(d,f),br(i)}}else J(c,Ke),br(i);return!0},get(l,d,c){if(d===rs)return n;var f=t.get(d),p=d in l;if(f===void 0&&(!p||yi(l,d)?.writable)&&(f=o(()=>{var m=Tt(p?l[d]:Ke),g=ge(m);return g}),t.set(d,f)),f!==void 0){var h=y(f);return h===Ke?void 0:h}return Reflect.get(l,d,c)},getOwnPropertyDescriptor(l,d){var c=Reflect.getOwnPropertyDescriptor(l,d);if(c&&"value"in c){var f=t.get(d);f&&(c.value=y(f))}else if(c===void 0){var p=t.get(d),h=p?.v;if(p!==void 0&&h!==Ke)return{enumerable:!0,configurable:!0,value:h,writable:!0}}return c},has(l,d){if(d===rs)return!0;var c=t.get(d),f=c!==void 0&&c.v!==Ke||Reflect.has(l,d);if(c!==void 0||ue!==null&&(!f||yi(l,d)?.writable)){c===void 0&&(c=o(()=>{var h=f?Tt(l[d]):Ke,m=ge(h);return m}),t.set(d,c));var p=y(c);if(p===Ke)return!1}return f},set(l,d,c,f){var p=t.get(d),h=d in l;if(s&&d==="length")for(var m=c;m<p.v;m+=1){var g=t.get(m+"");g!==void 0?J(g,Ke):m in l&&(g=o(()=>ge(Ke)),t.set(m+"",g))}if(p===void 0)(!h||yi(l,d)?.writable)&&(p=o(()=>ge(void 0)),J(p,Tt(c)),t.set(d,p));else{h=p.v!==Ke;var v=o(()=>Tt(c));J(p,v)}var _=Reflect.getOwnPropertyDescriptor(l,d);if(_?.set&&_.set.call(f,c),!h){if(s&&typeof d=="string"){var w=t.get("length"),E=Number(d);Number.isInteger(E)&&E>=w.v&&J(w,E+1)}br(i)}return!0},ownKeys(l){y(i);var d=Reflect.ownKeys(l).filter(p=>{var h=t.get(p);return h===void 0||h.v!==Ke});for(var[c,f]of t)f.v!==Ke&&!(c in l)&&d.push(c);return d},setPrototypeOf(){I_()}})}function Vc(n){try{if(n!==null&&typeof n=="object"&&rs in n)return n[rs]}catch{}return n}function sv(n,e){return Object.is(Vc(n),Vc(e))}var Hc,ep,tp,np;function iv(){if(Hc===void 0){Hc=window,ep=/Firefox/.test(navigator.userAgent);var n=Element.prototype,e=Node.prototype,t=Text.prototype;tp=yi(e,"firstChild").get,np=yi(e,"nextSibling").get,qc(n)&&(n.__click=void 0,n.__className=void 0,n.__attributes=null,n.__style=void 0,n.__e=void 0),qc(t)&&(t.__t=void 0)}}function as(n=""){return document.createTextNode(n)}function Ri(n){return tp.call(n)}function Gr(n){return np.call(n)}function A(n,e){return Ri(n)}function ct(n,e=!1){{var t=Ri(n);return t instanceof Comment&&t.data===""?Gr(t):t}}function b(n,e=1,t=!1){let s=n;for(;e--;)s=Gr(s);return s}function rv(n){n.textContent=""}function sp(){return!1}let Oc=!1;function ov(){Oc||(Oc=!0,document.addEventListener("reset",n=>{Promise.resolve().then(()=>{if(!n.defaultPrevented)for(const e of n.target.elements)e.__on_r?.()})},{capture:!0}))}function wa(n){var e=te,t=ue;dt(null),vn(null);try{return n()}finally{dt(e),vn(t)}}function ip(n,e,t,s=t){n.addEventListener(e,()=>wa(t));const i=n.__on_r;i?n.__on_r=()=>{i(),s(!0)}:n.__on_r=()=>s(!0),ov()}function av(n){ue===null&&(te===null&&T_(),S_()),Vs&&E_()}function lv(n,e){var t=e.last;t===null?e.last=e.first=n:(t.next=n,n.prev=t,e.last=n)}function Bn(n,e,t){var s=ue;s!==null&&(s.f&At)!==0&&(n|=At);var i={ctx:$t,deps:null,nodes:null,f:n|ht|jt,first:null,fn:e,last:null,next:null,parent:s,b:s&&s.b,prev:null,teardown:null,wv:0,ac:null};if(t)try{kr(i),i.f|=Cu}catch(l){throw ft(i),l}else e!==null&&$s(i);var r=i;if(t&&r.deps===null&&r.teardown===null&&r.nodes===null&&r.first===r.last&&(r.f&xi)===0&&(r=r.first,(n&$n)!==0&&(n&Ci)!==0&&r!==null&&(r.f|=Ci)),r!==null&&(r.parent=s,s!==null&&lv(r,s),te!==null&&(te.f&Ve)!==0&&(n&Gs)===0)){var o=te;(o.effects??=[]).push(r)}return i}function xr(){return te!==null&&!yn}function Iu(n){const e=Bn(Tu,null,!1);return Qe(e,Ye),e.teardown=n,e}function uv(n){av();var e=ue.f,t=!te&&(e&qn)!==0&&(e&Cu)===0;if(t){var s=$t;(s.e??=[]).push(n)}else return rp(n)}function rp(n){return Bn(Su|y_,n,!1)}function cv(n){gn.ensure();const e=Bn(Gs|xi,n,!0);return(t={})=>new Promise(s=>{t.outro?ks(e,()=>{ft(e),s(void 0)}):(ft(e),s(void 0))})}function dv(n){return Bn(Su,n,!1)}function fv(n){return Bn(Au|xi,n,!0)}function Ea(n,e=0){return Bn(Tu|e,n,!0)}function j(n,e=[],t=[],s=[]){Q_(s,e,t,i=>{Bn(Tu,()=>n(...i.map(y)),!0)})}function Ru(n,e=0){var t=Bn($n|e,n,!0);return t}function Dt(n){return Bn(qn|xi,n,!0)}function op(n){var e=n.teardown;if(e!==null){const t=Vs,s=te;Jc(!0),dt(null);try{e.call(null)}finally{Jc(t),dt(s)}}}function ap(n,e=!1){var t=n.first;for(n.first=n.last=null;t!==null;){const i=t.ac;i!==null&&wa(()=>{i.abort(fi)});var s=t.next;(t.f&Gs)!==0?t.parent=null:ft(t,e),t=s}}function hv(n){for(var e=n.first;e!==null;){var t=e.next;(e.f&qn)===0&&ft(e),e=t}}function ft(n,e=!0){var t=!1;(e||(n.f&$h)!==0)&&n.nodes!==null&&n.nodes.end!==null&&(pv(n.nodes.start,n.nodes.end),t=!0),ap(n,e&&!t),Zo(n,0),Qe(n,Dn);var s=n.nodes&&n.nodes.t;if(s!==null)for(const r of s)r.stop();op(n);var i=n.parent;i!==null&&i.first!==null&&lp(n),n.next=n.prev=n.teardown=n.ctx=n.deps=n.fn=n.nodes=n.ac=null}function pv(n,e){for(;n!==null;){var t=n===e?null:Gr(n);n.remove(),n=t}}function lp(n){var e=n.parent,t=n.prev,s=n.next;t!==null&&(t.next=s),s!==null&&(s.prev=t),e!==null&&(e.first===n&&(e.first=s),e.last===n&&(e.last=t))}function ks(n,e,t=!0){var s=[];up(n,s,!0);var i=()=>{t&&ft(n),e&&e()},r=s.length;if(r>0){var o=()=>--r||i();for(var l of s)l.out(o)}else i()}function up(n,e,t){if((n.f&At)===0){n.f^=At;var s=n.nodes&&n.nodes.t;if(s!==null)for(const l of s)(l.is_global||t)&&e.push(l);for(var i=n.first;i!==null;){var r=i.next,o=(i.f&Ci)!==0||(i.f&qn)!==0&&(n.f&$n)!==0;up(i,e,o?t:!1),i=r}}}function Pu(n){cp(n,!0)}function cp(n,e){if((n.f&At)!==0){n.f^=At,(n.f&Ye)===0&&(Qe(n,ht),$s(n));for(var t=n.first;t!==null;){var s=t.next,i=(t.f&Ci)!==0||(t.f&qn)!==0;cp(t,i?e:!1),t=s}var r=n.nodes&&n.nodes.t;if(r!==null)for(const o of r)(o.is_global||e)&&o.in()}}function dp(n,e){if(n.nodes)for(var t=n.nodes.start,s=n.nodes.end;t!==null;){var i=t===s?null:Gr(t);e.append(t),t=i}}let Ns=!1;function Qo(n){Ns=n}let Vs=!1;function Jc(n){Vs=n}let te=null,yn=!1;function dt(n){te=n}let ue=null;function vn(n){ue=n}let Ln=null;function fp(n){te!==null&&(Ln===null?Ln=[n]:Ln.push(n))}let st=null,Et=0,Mt=null;function mv(n){Mt=n}let hp=1,Mr=0,Ds=Mr;function Wc(n){Ds=n}function pp(){return++hp}function Vr(n){var e=n.f;if((e&ht)!==0)return!0;if(e&Ve&&(n.f&=~Fs),(e&_n)!==0){var t=n.deps;if(t!==null)for(var s=t.length,i=0;i<s;i++){var r=t[i];if(Vr(r)&&Qh(r),r.wv>n.wv)return!0}(e&jt)!==0&&Lt===null&&Qe(n,Ye)}return!1}function mp(n,e,t=!0){var s=n.reactions;if(s!==null&&!Ln?.includes(n))for(var i=0;i<s.length;i++){var r=s[i];(r.f&Ve)!==0?mp(r,e,!1):e===r&&(t?Qe(r,ht):(r.f&Ye)!==0&&Qe(r,_n),$s(r))}}function gp(n){var e=st,t=Et,s=Mt,i=te,r=Ln,o=$t,l=yn,d=Ds,c=n.f;st=null,Et=0,Mt=null,te=(c&(qn|Gs))===0?n:null,Ln=null,Ai(n.ctx),yn=!1,Ds=++Mr,n.ac!==null&&(wa(()=>{n.ac.abort(fi)}),n.ac=null);try{n.f|=Tl;var f=n.fn,p=f(),h=n.deps;if(st!==null){var m;if(Zo(n,Et),h!==null&&Et>0)for(h.length=Et+st.length,m=0;m<st.length;m++)h[Et+m]=st[m];else n.deps=h=st;if(xr()&&(n.f&jt)!==0)for(m=Et;m<h.length;m++)(h[m].reactions??=[]).push(n)}else h!==null&&Et<h.length&&(Zo(n,Et),h.length=Et);if(Hh()&&Mt!==null&&!yn&&h!==null&&(n.f&(Ve|_n|ht))===0)for(m=0;m<Mt.length;m++)mp(Mt[m],n);return i!==null&&i!==n&&(Mr++,Mt!==null&&(s===null?s=Mt:s.push(...Mt))),(n.f&is)!==0&&(n.f^=is),p}catch(g){return Jh(g)}finally{n.f^=Tl,st=e,Et=t,Mt=s,te=i,Ln=r,Ai(o),yn=l,Ds=d}}function gv(n,e){let t=e.reactions;if(t!==null){var s=d_.call(t,n);if(s!==-1){var i=t.length-1;i===0?t=e.reactions=null:(t[s]=t[i],t.pop())}}t===null&&(e.f&Ve)!==0&&(st===null||!st.includes(e))&&(Qe(e,_n),(e.f&jt)!==0&&(e.f^=jt,e.f&=~Fs),Xh(e),Zo(e,0))}function Zo(n,e){var t=n.deps;if(t!==null)for(var s=e;s<t.length;s++)gv(n,t[s])}function kr(n){var e=n.f;if((e&Dn)===0){Qe(n,Ye);var t=ue,s=Ns;ue=n,Ns=!0;try{(e&($n|g_))!==0?hv(n):ap(n),op(n);var i=gp(n);n.teardown=typeof i=="function"?i:null,n.wv=hp;var r;Sl&&H_&&(n.f&ht)!==0&&n.deps}finally{Ns=s,ue=t}}}async function yv(){await Promise.resolve(),J_()}function y(n){var e=n.f,t=(e&Ve)!==0;if(te!==null&&!yn){var s=ue!==null&&(ue.f&Dn)!==0;if(!s&&!Ln?.includes(n)){var i=te.deps;if((te.f&Tl)!==0)n.rv<Mr&&(n.rv=Mr,st===null&&i!==null&&i[Et]===n?Et++:st===null?st=[n]:st.includes(n)||st.push(n));else{(te.deps??=[]).push(n);var r=n.reactions;r===null?n.reactions=[te]:r.includes(te)||r.push(te)}}}if(Vs){if(os.has(n))return os.get(n);if(t){var o=n,l=o.v;return((o.f&Ye)===0&&o.reactions!==null||_p(o))&&(l=bu(o)),os.set(o,l),l}}else t&&(!Lt?.has(n)||le?.is_fork&&!xr())&&(o=n,Vr(o)&&Qh(o),Ns&&xr()&&(o.f&jt)===0&&yp(o));if(Lt?.has(n))return Lt.get(n);if((n.f&is)!==0)throw n.v;return n.v}function yp(n){if(n.deps!==null){n.f^=jt;for(const e of n.deps)(e.reactions??=[]).push(n),(e.f&Ve)!==0&&(e.f&jt)===0&&yp(e)}}function _p(n){if(n.v===Ke)return!0;if(n.deps===null)return!1;for(const e of n.deps)if(os.has(e)||(e.f&Ve)!==0&&_p(e))return!0;return!1}function Mi(n){var e=yn;try{return yn=!0,n()}finally{yn=e}}const _v=-7169;function Qe(n,e){n.f=n.f&_v|e}function vv(n){if(!(typeof n!="object"||!n||n instanceof EventTarget)){if(rs in n)bl(n);else if(!Array.isArray(n))for(let e in n){const t=n[e];typeof t=="object"&&t&&rs in t&&bl(t)}}}function bl(n,e=new Set){if(typeof n=="object"&&n!==null&&!(n instanceof EventTarget)&&!e.has(n)){e.add(n),n instanceof Date&&n.getTime();for(let s in n)try{bl(n[s],e)}catch{}const t=Eu(n);if(t!==Object.prototype&&t!==Array.prototype&&t!==Map.prototype&&t!==Set.prototype&&t!==Date.prototype){const s=Uh(t);for(let i in s){const r=s[i].get;if(r)try{r.call(n)}catch{}}}}}const wv=["touchstart","touchmove"];function Ev(n){return wv.includes(n)}const vp=new Set,Il=new Set;function Sv(n,e,t,s={}){function i(r){if(s.capture||dr.call(e,r),!r.cancelBubble)return wa(()=>t?.call(this,r))}return n.startsWith("pointer")||n.startsWith("touch")||n==="wheel"?Br(()=>{e.addEventListener(n,i,s)}):e.addEventListener(n,i,s),i}function Yn(n,e,t,s,i){var r={capture:s,passive:i},o=Sv(n,e,t,r);(e===document.body||e===window||e===document||e instanceof HTMLMediaElement)&&Iu(()=>{e.removeEventListener(n,o,r)})}function Hs(n){for(var e=0;e<n.length;e++)vp.add(n[e]);for(var t of Il)t(n)}let zc=null;function dr(n){var e=this,t=e.ownerDocument,s=n.type,i=n.composedPath?.()||[],r=i[0]||n.target;zc=n;var o=0,l=zc===n&&n.__root;if(l){var d=i.indexOf(l);if(d!==-1&&(e===document||e===window)){n.__root=e;return}var c=i.indexOf(e);if(c===-1)return;d<=c&&(o=d)}if(r=i[o]||n.target,r!==e){f_(n,"currentTarget",{configurable:!0,get(){return r||t}});var f=te,p=ue;dt(null),vn(null);try{for(var h,m=[];r!==null;){var g=r.assignedSlot||r.parentNode||r.host||null;try{var v=r["__"+s];v!=null&&(!r.disabled||n.target===r)&&v.call(r,n)}catch(_){h?m.push(_):h=_}if(n.cancelBubble||g===e||g===null)break;r=g}if(h){for(let _ of m)queueMicrotask(()=>{throw _});throw h}}finally{n.__root=e,delete n.currentTarget,dt(f),vn(p)}}}function wp(n){var e=document.createElement("template");return e.innerHTML=n.replaceAll("<!>","<!---->"),e.content}function jo(n,e){var t=ue;t.nodes===null&&(t.nodes={start:n,end:e,a:null,t:null})}function q(n,e){var t=(e&$_)!==0,s=(e&q_)!==0,i,r=!n.startsWith("<!>");return()=>{i===void 0&&(i=wp(r?n:"<!>"+n),t||(i=Ri(i)));var o=s||ep?document.importNode(i,!0):i.cloneNode(!0);if(t){var l=Ri(o),d=o.lastChild;jo(l,d)}else jo(o,o);return o}}function Tv(n,e,t="svg"){var s=!n.startsWith("<!>"),i=`<${t}>${s?n:"<!>"+n}</${t}>`,r;return()=>{if(!r){var o=wp(i),l=Ri(o);r=Ri(l)}var d=r.cloneNode(!0);return jo(d,d),d}}function En(n,e){return Tv(n,e,"svg")}function Is(){var n=document.createDocumentFragment(),e=document.createComment(""),t=as();return n.append(e,t),jo(e,t),n}function D(n,e){n!==null&&n.before(e)}function _e(n,e){var t=e==null?"":typeof e=="object"?e+"":e;t!==(n.__t??=n.nodeValue)&&(n.__t=t,n.nodeValue=t+"")}function Cv(n,e){return Av(n,e)}const ei=new Map;function Av(n,{target:e,anchor:t,props:s={},events:i,context:r,intro:o=!0}){iv();var l=new Set,d=p=>{for(var h=0;h<p.length;h++){var m=p[h];if(!l.has(m)){l.add(m);var g=Ev(m);e.addEventListener(m,dr,{passive:g});var v=ei.get(m);v===void 0?(document.addEventListener(m,dr,{passive:g}),ei.set(m,1)):ei.set(m,v+1)}}};d(ga(vp)),Il.add(d);var c=void 0,f=cv(()=>{var p=t??e.appendChild(as());return Y_(p,{pending:()=>{}},h=>{if(r){us({});var m=$t;m.c=r}i&&(s.$$events=i),c=n(h,s)||{},r&&cs()}),()=>{for(var h of l){e.removeEventListener(h,dr);var m=ei.get(h);--m===0?(document.removeEventListener(h,dr),ei.delete(h)):ei.set(h,m)}Il.delete(d),p!==t&&p.parentNode?.removeChild(p)}});return Rl.set(c,f),c}let Rl=new WeakMap;function Kc(n,e){const t=Rl.get(n);return t?(Rl.delete(n),t(e)):Promise.resolve()}class bv{anchor;#e=new Map;#t=new Map;#s=new Map;#n=new Set;#l=!0;constructor(e,t=!0){this.anchor=e,this.#l=t}#r=()=>{var e=le;if(this.#e.has(e)){var t=this.#e.get(e),s=this.#t.get(t);if(s)Pu(s),this.#n.delete(t);else{var i=this.#s.get(t);i&&(this.#t.set(t,i.effect),this.#s.delete(t),i.fragment.lastChild.remove(),this.anchor.before(i.fragment),s=i.effect)}for(const[r,o]of this.#e){if(this.#e.delete(r),r===e)break;const l=this.#s.get(o);l&&(ft(l.effect),this.#s.delete(o))}for(const[r,o]of this.#t){if(r===t||this.#n.has(r))continue;const l=()=>{if(Array.from(this.#e.values()).includes(r)){var c=document.createDocumentFragment();dp(o,c),c.append(as()),this.#s.set(r,{effect:o,fragment:c})}else ft(o);this.#n.delete(r),this.#t.delete(r)};this.#l||!s?(this.#n.add(r),ks(o,l,!1)):l()}}};#i=e=>{this.#e.delete(e);const t=Array.from(this.#e.values());for(const[s,i]of this.#s)t.includes(s)||(ft(i.effect),this.#s.delete(s))};ensure(e,t){var s=le,i=sp();if(t&&!this.#t.has(e)&&!this.#s.has(e))if(i){var r=document.createDocumentFragment(),o=as();r.append(o),this.#s.set(e,{effect:Dt(()=>t(o)),fragment:r})}else this.#t.set(e,Dt(()=>t(this.anchor)));if(this.#e.set(s,e),i){for(const[l,d]of this.#t)l===e?s.skipped_effects.delete(d):s.skipped_effects.add(d);for(const[l,d]of this.#s)l===e?s.skipped_effects.delete(d.effect):s.skipped_effects.add(d.effect);s.oncommit(this.#r),s.ondiscard(this.#i)}else this.#r()}}function z(n,e,t=!1){var s=new bv(n),i=t?Ci:0;function r(o,l){s.ensure(o,l)}Ru(()=>{var o=!1;e((l,d=!0)=>{o=!0,r(d,l)}),o||r(!1,null)},i)}function Ls(n,e){return e}function Iv(n,e,t){for(var s=[],i=e.length,r,o=e.length,l=0;l<i;l++){let p=e[l];ks(p,()=>{if(r){if(r.pending.delete(p),r.done.add(p),r.pending.size===0){var h=n.outrogroups;Pl(ga(r.done)),h.delete(r),h.size===0&&(n.outrogroups=null)}}else o-=1},!1)}if(o===0){var d=s.length===0&&t!==null;if(d){var c=t,f=c.parentNode;rv(f),f.append(c),n.items.clear()}Pl(e,!d)}else r={pending:new Set(e),done:new Set},(n.outrogroups??=new Set).add(r)}function Pl(n,e=!0){for(var t=0;t<n.length;t++)ft(n[t],e)}var Yc;function Ct(n,e,t,s,i,r=null){var o=n,l=new Map,d=(e&qh)!==0;if(d){var c=n;o=c.appendChild(as())}var f=null,p=Yh(()=>{var w=t();return wu(w)?w:w==null?[]:ga(w)}),h,m=!0;function g(){_.fallback=f,Rv(_,h,o,e,s),f!==null&&(h.length===0?(f.f&kn)===0?Pu(f):(f.f^=kn,fr(f,null,o)):ks(f,()=>{f=null}))}var v=Ru(()=>{h=y(p);for(var w=h.length,E=new Set,S=le,T=sp(),R=0;R<w;R+=1){var M=h[R],x=s(M,R),k=m?null:l.get(x);k?(k.v&&Ii(k.v,M),k.i&&Ii(k.i,R),T&&S.skipped_effects.delete(k.e)):(k=Pv(l,m?o:Yc??=as(),M,x,R,i,e,t),m||(k.e.f|=kn),l.set(x,k)),E.add(x)}if(w===0&&r&&!f&&(m?f=Dt(()=>r(o)):(f=Dt(()=>r(Yc??=as())),f.f|=kn)),!m)if(T){for(const[I,N]of l)E.has(I)||S.skipped_effects.add(N.e);S.oncommit(g),S.ondiscard(()=>{})}else g();y(p)}),_={effect:v,items:l,outrogroups:null,fallback:f};m=!1}function Rv(n,e,t,s,i){var r=(s&k_)!==0,o=e.length,l=n.items,d=n.effect.first,c,f=null,p,h=[],m=[],g,v,_,w;if(r)for(w=0;w<o;w+=1)g=e[w],v=i(g,w),_=l.get(v).e,(_.f&kn)===0&&(_.nodes?.a?.measure(),(p??=new Set).add(_));for(w=0;w<o;w+=1){if(g=e[w],v=i(g,w),_=l.get(v).e,n.outrogroups!==null)for(const N of n.outrogroups)N.pending.delete(_),N.done.delete(_);if((_.f&kn)!==0)if(_.f^=kn,_===d)fr(_,null,t);else{var E=f?f.next:d;_===n.effect.last&&(n.effect.last=_.prev),_.prev&&(_.prev.next=_.next),_.next&&(_.next.prev=_.prev),Xn(n,f,_),Xn(n,_,E),fr(_,E,t),f=_,h=[],m=[],d=f.next;continue}if((_.f&At)!==0&&(Pu(_),r&&(_.nodes?.a?.unfix(),(p??=new Set).delete(_))),_!==d){if(c!==void 0&&c.has(_)){if(h.length<m.length){var S=m[0],T;f=S.prev;var R=h[0],M=h[h.length-1];for(T=0;T<h.length;T+=1)fr(h[T],S,t);for(T=0;T<m.length;T+=1)c.delete(m[T]);Xn(n,R.prev,M.next),Xn(n,f,R),Xn(n,M,S),d=S,f=M,w-=1,h=[],m=[]}else c.delete(_),fr(_,d,t),Xn(n,_.prev,_.next),Xn(n,_,f===null?n.effect.first:f.next),Xn(n,f,_),f=_;continue}for(h=[],m=[];d!==null&&d!==_;)(c??=new Set).add(d),m.push(d),d=d.next;if(d===null)continue}(_.f&kn)===0&&h.push(_),f=_,d=_.next}if(n.outrogroups!==null){for(const N of n.outrogroups)N.pending.size===0&&(Pl(ga(N.done)),n.outrogroups?.delete(N));n.outrogroups.size===0&&(n.outrogroups=null)}if(d!==null||c!==void 0){var x=[];if(c!==void 0)for(_ of c)(_.f&At)===0&&x.push(_);for(;d!==null;)(d.f&At)===0&&d!==n.fallback&&x.push(d),d=d.next;var k=x.length;if(k>0){var I=(s&qh)!==0&&o===0?t:null;if(r){for(w=0;w<k;w+=1)x[w].nodes?.a?.measure();for(w=0;w<k;w+=1)x[w].nodes?.a?.fix()}Iv(n,x,I)}}r&&Br(()=>{if(p!==void 0)for(_ of p)_.nodes?.a?.apply()})}function Pv(n,e,t,s,i,r,o,l){var d=(o&x_)!==0?(o&N_)===0?tv(t,!1,!1):qs(t):null,c=(o&M_)!==0?qs(i):null;return{v:d,i:c,e:Dt(()=>(r(e,d??t,c??i,l),()=>{n.delete(s)}))}}function fr(n,e,t){if(n.nodes)for(var s=n.nodes.start,i=n.nodes.end,r=e&&(e.f&kn)===0?e.nodes.start:t;s!==null;){var o=Gr(s);if(r.before(s),s===i)return;s=o}}function Xn(n,e,t){e===null?n.effect.first=t:e.next=t,t===null?n.effect.last=e:t.prev=e}function Xc(n,e,t,s,i){var r=e.$$slots?.[t],o=!1;r===!0&&(r=e[t==="default"?"children":t],o=!0),r===void 0||r(n,o?()=>s:s)}function Wi(n,e,t){dv(()=>{var s=Mi(()=>e(n,t?.())||{});if(t&&s?.update){var i=!1,r={};Ea(()=>{var o=t();vv(o),i&&Gh(r,o)&&(r=o,s.update(o))}),i=!0}if(s?.destroy)return()=>s.destroy()})}const Qc=[...` 	
\r\f¬†\v\uFEFF`];function xv(n,e,t){var s=n==null?"":""+n;if(e&&(s=s?s+" "+e:e),t){for(var i in t)if(t[i])s=s?s+" "+i:i;else if(s.length)for(var r=i.length,o=0;(o=s.indexOf(i,o))>=0;){var l=o+r;(o===0||Qc.includes(s[o-1]))&&(l===s.length||Qc.includes(s[l]))?s=(o===0?"":s.substring(0,o))+s.substring(l+1):o=l}}return s===""?null:s}function Mv(n,e){return n==null?null:String(n)}function fn(n,e,t,s,i,r){var o=n.__className;if(o!==t||o===void 0){var l=xv(t,s,r);l==null?n.removeAttribute("class"):n.className=l,n.__className=t}else if(r&&i!==r)for(var d in r){var c=!!r[d];(i==null||c!==!!i[d])&&n.classList.toggle(d,c)}return r}function xl(n,e,t,s){var i=n.__style;if(i!==e){var r=Mv(e);r==null?n.removeAttribute("style"):n.style.cssText=r,n.__style=e}return s}function _i(n,e,t=!1){if(n.multiple){if(e==null)return;if(!wu(e))return G_();for(var s of n.options)s.selected=e.includes(Zc(s));return}for(s of n.options){var i=Zc(s);if(sv(i,e)){s.selected=!0;return}}(!t||e!==void 0)&&(n.selectedIndex=-1)}function Ir(n){var e=new MutationObserver(()=>{_i(n,n.__value)});e.observe(n,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Iu(()=>{e.disconnect()})}function Zc(n){return"__value"in n?n.__value:n.value}const kv=Symbol("is custom element"),Nv=Symbol("is html");function kt(n,e){var t=xu(n);t.value===(t.value=e??void 0)||n.value===e&&(e!==0||n.nodeName!=="PROGRESS")||(n.value=e??"")}function Dv(n,e){var t=xu(n);t.checked!==(t.checked=e??void 0)&&(n.checked=e)}function mn(n,e,t,s){var i=xu(n);i[e]!==(i[e]=t)&&(e==="loading"&&(n[v_]=t),t==null?n.removeAttribute(e):typeof t!="string"&&Lv(n).includes(e)?n[e]=t:n.setAttribute(e,t))}function xu(n){return n.__attributes??={[kv]:n.nodeName.includes("-"),[Nv]:n.namespaceURI===B_}}var jc=new Map;function Lv(n){var e=n.getAttribute("is")||n.nodeName,t=jc.get(e);if(t)return t;jc.set(e,t=[]);for(var s,i=n,r=Element.prototype;r!==i;){s=Uh(i);for(var o in s)s[o].set&&t.push(o);i=Eu(i)}return t}function Rs(n,e,t=e){var s=new WeakSet;ip(n,"input",async i=>{var r=i?n.defaultValue:n.value;if(r=Ka(n)?Ya(r):r,t(r),le!==null&&s.add(le),await yv(),r!==(r=e())){var o=n.selectionStart,l=n.selectionEnd,d=n.value.length;if(n.value=r??"",l!==null){var c=n.value.length;o===l&&l===d&&c>d?(n.selectionStart=c,n.selectionEnd=c):(n.selectionStart=o,n.selectionEnd=Math.min(l,c))}}}),Mi(e)==null&&n.value&&(t(Ka(n)?Ya(n.value):n.value),le!==null&&s.add(le)),Ea(()=>{var i=e();if(n===document.activeElement){var r=Uo??le;if(s.has(r))return}Ka(n)&&i===Ya(n.value)||n.type==="date"&&!i&&!n.value||i!==n.value&&(n.value=i??"")})}function Uv(n,e,t=e){ip(n,"change",s=>{var i=s?n.defaultChecked:n.checked;t(i)}),Mi(e)==null&&t(n.checked),Ea(()=>{var s=e();n.checked=!!s})}function Ka(n){var e=n.type;return e==="number"||e==="range"}function Ya(n){return n===""?null:+n}let ro=!1;function Fv(n){var e=ro;try{return ro=!1,[n(),ro]}finally{ro=e}}function Nr(n,e,t,s){var i=(t&U_)!==0,r=(t&F_)!==0,o=s,l=!0,d=()=>(l&&(l=!1,o=r?Mi(s):s),o),c;if(i){var f=rs in n||__ in n;c=yi(n,e)?.set??(f&&e in n?E=>n[e]=E:void 0)}var p,h=!1;i?[p,h]=Fv(()=>n[e]):p=n[e],p===void 0&&s!==void 0&&(p=d(),c&&(A_(),c(p)));var m;if(m=()=>{var E=n[e];return E===void 0?d():(l=!0,E)},(t&L_)===0)return m;if(c){var g=n.$$legacy;return(function(E,S){return arguments.length>0?((!S||g||h)&&c(S?m():E),E):m()})}var v=!1,_=((t&D_)!==0?va:Yh)(()=>(v=!1,m()));i&&y(_);var w=ue;return(function(E,S){if(arguments.length>0){const T=S?y(_):i?Tt(E):E;return J(_,T),v=!0,o!==void 0&&(o=T),E}return Vs&&v||(w.f&Dn)!==0?_.v:y(_)})}const $v="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add($v);var Mu=(n=>(n.Role="role",n.Model="model",n))(Mu||{});const ed="vibe-canvas-badge-container",td="vibe-canvas-bottom-badge-container",qv="canvas-badges";function ea(n){const e=n?.contentEl??null,t=n.nodeEl;if(!e)return null;let s=e.querySelector(`.${ed}`);return s||(s=document.createElement("div"),s.className=ed,s.setAttribute("aria-label",qv),e.prepend(s),t.classList.add("cai-badge-container")),s}function Xa(n){const e=n?.contentEl??null;if(!e)return null;let t=e.querySelector(`.${td}`);return t||(t=document.createElement("div"),t.className=td,t.setAttribute("aria-label","canvas-bottom-badges"),e.appendChild(t)),t}function Fo(n,e){const t=ea(n);return t?e.shouldShow(n)?e.createOrUpdateBadge(t,n):(e.removeBadge(t),null):null}function Bv(n,e){const t=ea(n);t&&(e.forEach(s=>{s.shouldShow(n)?s.createOrUpdateBadge(t,n):s.removeBadge(t)}),t.children.length===0&&t.remove())}function nd(n,e){n?.nodes&&n.nodes.forEach(t=>{Bv(t,e)})}const Qa="vibe-canvas-role-badge",Za="badge-type";class Gv{constructor(){this.type=Mu.Role}shouldShow(e){return Un(e)!==null}createOrUpdateBadge(e,t){const s=Un(t);if(!s)return null;let i=e.querySelector(`.${Qa}[data-${Za}="${this.type}"]`);return i||(i=document.createElement("div"),i.className=Qa,i.setAttribute(`data-${Za}`,this.type),i.setAttribute("aria-label","canvas-role"),e.appendChild(i)),i.textContent=this.getRoleBadgeText(s),i}removeBadge(e){e.querySelector(`.${Qa}[data-${Za}="${this.type}"]`)?.remove()}getRoleBadgeText(e){switch(e){case"user":return"üë§ user";case"assistant":return"ü§ñ assistant";case"system":return"üñ•Ô∏è system";default:return""}}}function Ep(){return new Gv}const _s="vibe-canvas-model-badge",Vv="badge-type";class Hv{constructor(){this.type=Mu.Model}get plugin(){return wn.getPlugin()}shouldShow(e){const t=Un(e);return t==="user"?!0:t==="assistant"?rd(e)!==null:!1}createOrUpdateBadge(e,t){const s=Un(t);if(s!=="user"&&s!=="assistant")return null;const i=s==="user",r=i?Xa(t):ea(t);if(!r)return null;const o=i?this.resolveUserModel(t):rd(t);if(!i&&!o)return null;i?ea(t)?.querySelector(`.${_s}`)?.remove():Xa(t)?.querySelector(`.${_s}`)?.remove();let l=r.querySelector(`.${_s}`);l||(l=this.createBadgeElement(r,i));const d=i?"‚öôÔ∏è":"‚ú®";return l.textContent=o?`${d} ${o}`:`${d} ÈÄâÊã©Ê®°Âûã`,i&&!l.hasAttribute("data-bound")&&(l.setAttribute("data-bound","true"),l.addEventListener("click",c=>{c.stopPropagation(),this.openModelSelector(l,t)})),l}removeBadge(e){e.querySelector(`.${_s}`)?.remove();const t=e.parentElement;t&&(e.classList.contains("vibe-canvas-badge-container")?t.querySelector(".vibe-canvas-bottom-badge-container")?.querySelector(`.${_s}`)?.remove():e.classList.contains("vibe-canvas-bottom-badge-container")&&t.querySelector(".vibe-canvas-badge-container")?.querySelector(`.${_s}`)?.remove())}resolveUserModel(e){const t=Ml(e);if(t)return t;const s=this.getCanvasLastModel(e);return s?(e.unknownData||(e.unknownData={}),e.unknownData._cai_user_model=s,s):this.plugin?.settings.defaultChatModelId??null}getCanvasLastModel(e){const t=e.canvas;return!t||typeof t.getData!="function"?null:t.getData()._cai_lastUserModel??null}createBadgeElement(e,t){const s=document.createElement("div");return s.className=_s,s.setAttribute(`data-${Vv}`,this.type),t&&(s.classList.add("clickable"),s.setAttribute("title","ÁÇπÂáªÈÄâÊã©Ê®°Âûã")),e.appendChild(s),s}openModelSelector(e,t){document.querySelector(".vibe-canvas-model-dropdown")?.remove();const s=this.plugin.settings.chatModels.filter(c=>c.enable);if(s.length===0){new Pe.Notice("Ê≤°ÊúâÂèØÁî®ÁöÑÊ®°ÂûãÔºåËØ∑Âú®ËÆæÁΩÆ‰∏≠ÂêØÁî®Ëá≥Â∞ë‰∏Ä‰∏™Ê®°Âûã");return}const i=Ml(t),r=t.canvas,o=document.createElement("div");o.className="vibe-canvas-model-dropdown",s.forEach(c=>{const f=document.createElement("div");f.className="vibe-canvas-model-dropdown-item",c.id===i&&f.classList.add("selected"),f.textContent=`${c.model}Ôºà${c.id}Ôºâ`,f.addEventListener("click",p=>{p.stopPropagation(),iw(t,c.id,r);const h=Xa(t);h&&this.createOrUpdateBadge(h,t),o.remove()}),o.appendChild(f)}),document.body.appendChild(o);const l=e.getBoundingClientRect();Object.assign(o.style,{position:"fixed",top:`${l.bottom+4}px`,left:`${l.left}px`,zIndex:"10000"});const d=c=>{!o.contains(c.target)&&c.target!==e&&(o.remove(),document.removeEventListener("click",d))};setTimeout(()=>document.addEventListener("click",d),0)}}function Ov(){return new Hv}const Jv=Ep();function Wv(n){return n?n.from!==void 0&&n.to!==void 0:!1}function zv(n){let e="";do e=`edge-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;while(n.some(t=>t.id===e));return e}function Kv(n){if(!n)return"";if(typeof n.text=="string")return n.text;if(typeof n.getText=="function"){const e=n.getText.call(n);if(typeof e=="string")return e}return""}function sd(n,e,t){n&&(typeof n.setText=="function"?n.setText(e):n.text=e,t?.requestFrame?.(),t?.requestSave?.())}function id(n,e,t=!1){if(!n.trim())return e;const s=n.split(`
`).map(o=>`> ${o}`).join(`
`),r=`${t?"> [!note]- Thinking":"> [!note] Thinking"}
${s}`;return e.trim()?`${r}

${e}`:r}function Yv(n,e,t){if(!n||!e||typeof n.createTextNode!="function")return{node:null,fromSide:"right",toSide:"left"};const s=t.assistantWidth,i=t.assistantHeight,r=Zv(n,e,s,i);return{node:n.createTextNode({pos:r.pos,size:{width:s,height:i},position:"center",text:"",save:!0,focus:!0})??null,fromSide:r.fromSide,toSide:r.toSide}}function Xv(n,e){const t=n.edgeTo?.get?.(e);if(!t||t.size===0)return null;const s=t.values().next().value;if(!s)return null;const i=s.to?.side;return i==="top"?"bottom":"right"}function Qv(n,e){const t=n.edgeFrom?.get?.(e);if(!t||t.size===0)return[];const s=[];for(const i of t){const r=i.to?.node;r&&s.push(r)}return s}function Zv(n,e,t,s){const o=e.x??0,l=e.y??0,d=e.width??t,c=e.height??s,f=Xv(n,e),p=Qv(n,e);let h,m,g,v;return f==="bottom"?(g="bottom",v="top",m=l+c+100+s/2,p.length===0?h=o+d/2:h=Math.max(...p.map(w=>(w.x??0)+(w.width??t)))+50+t/2):(g="right",v="left",h=o+d+100+t/2,p.length===0?m=l+c/2:m=Math.max(...p.map(w=>(w.y??0)+(w.height??s)))+50+s/2),{pos:{x:h,y:m},fromSide:g,toSide:v}}function jv(n,e,t,s="right",i="left"){if(!n||!e||!t||typeof n.getData!="function")return;const r=n.getData();if(!r)return;const o=Array.isArray(r.edges)?r.edges:[],l={id:zv(o),fromNode:e.id,toNode:t.id,fromSide:s,toSide:i,toEnd:"arrow"};r.edges.push(l),n.setData(r),n.requestFrame?.()}function ew(n){const e=n?.unknownData?._cai_role;return e==="user"||e==="assistant"||e==="system"?e:"user"}function tw(n,e,t,s){n.unknownData||(n.unknownData={}),n.unknownData._cai_role=e,s&&(e==="user"?(n.width<s.userWidth&&(n.width=s.userWidth),n.height<s.userHeight&&(n.height=s.userHeight)):e==="assistant"&&(n.width<s.assistantWidth&&(n.width=s.assistantWidth),n.height<s.assistantHeight&&(n.height=s.assistantHeight))),Fo(n,Jv),n.render(),t?.requestSave?.()}function Un(n){const e=n?.unknownData?._cai_role;return e==="user"||e==="assistant"||e==="system"?e:null}function nw(n){return n==="assistant"?"Ê†áËÆ∞‰∏∫Âä©Êâã":n==="system"?"Ê†áËÆ∞‰∏∫Á≥ªÁªüÊèêÁ§∫":"Ê†áËÆ∞‰∏∫Áî®Êà∑"}function sw(n,e,t){n.unknownData||(n.unknownData={}),n.unknownData._cai_model=e,n.render(),t?.requestSave?.()}function rd(n){const e=n?.unknownData?._cai_model;return typeof e=="string"&&e.length>0?e:null}function iw(n,e,t){n.unknownData||(n.unknownData={}),n.unknownData._cai_user_model=e,t&&typeof t.getData=="function"&&rw(t,e),n.render(),t?.requestSave?.()}function Ml(n){const e=n?.unknownData?._cai_user_model;return typeof e=="string"&&e.length>0?e:null}function rw(n,e){if(!n||typeof n.getData!="function"||typeof n.setData!="function")return;const t=n.getData();t._cai_lastUserModel=e,n.setData(t)}const kl=[{id:"ai",icon:"sparkles",tooltip:"AI ÊèêÈóÆ"},{id:"user",icon:"user",tooltip:"Ê†áËÆ∞‰∏∫Áî®Êà∑",isRole:!0},{id:"assistant",icon:"bot",tooltip:"Ê†áËÆ∞‰∏∫Âä©Êâã",isRole:!0},{id:"system",icon:"monitor",tooltip:"Ê†áËÆ∞‰∏∫Á≥ªÁªüÊèêÁ§∫",isRole:!0},{id:"arrangeLayout",icon:"network",tooltip:"Êï¥ÁêÜÂ∏ÉÂ±Ä"}];function ow(n,e){return n.isRole&&e?nw(e):n.tooltip}var aw=q('<button class="mock-btn svelte-g54mgz"></button>'),lw=q('<button class="mock-grid-btn svelte-g54mgz"></button>'),uw=q('<div class="mock-dropdown svelte-g54mgz"><div class="mock-grid-label svelte-g54mgz">Êõ¥Â§öÊìç‰Ωú</div> <div class="mock-grid svelte-g54mgz"></div></div>'),cw=q('<button><div class="qa-item-icon svelte-g54mgz"></div> <div class="qa-item-info svelte-g54mgz"><div class="qa-item-label svelte-g54mgz"> </div></div> <div class="qa-item-toggle svelte-g54mgz"><div class="toggle-icon"></div></div></button>'),dw=q('<div class="qa-container svelte-g54mgz"><div class="qa-preview-section"><div class="qa-section-header svelte-g54mgz"><span class="qa-title svelte-g54mgz">È¢ÑËßà (Preview)</span> <span class="qa-subtitle svelte-g54mgz">Ê®°ÊãüÈÄâ‰∏≠Âç°ÁâáÊó∂ÁöÑËèúÂçïÊ†è</span></div> <div class="canvas-mock svelte-g54mgz"><div class="mock-node svelte-g54mgz"><div class="mock-menu-bar svelte-g54mgz"><!> <div class="mock-divider svelte-g54mgz"></div> <div class="mock-more-container svelte-g54mgz"><button class="mock-btn mock-more-btn svelte-g54mgz" title="Êõ¥Â§ö"></button> <!></div></div> <div class="mock-content svelte-g54mgz"><div class="mock-line svelte-g54mgz" style="width: 80%"></div> <div class="mock-line svelte-g54mgz" style="width: 60%"></div> <div class="mock-line svelte-g54mgz" style="width: 90%"></div></div></div></div></div> <div class="qa-config-section"><div class="qa-section-header svelte-g54mgz"><span class="qa-title svelte-g54mgz">ÈÖçÁΩÆ (Config)</span> <span class="qa-subtitle svelte-g54mgz">ÁÇπÂáªÂàáÊç¢ÊòæÁ§∫‰ΩçÁΩÆ</span></div> <div class="qa-list svelte-g54mgz"></div></div></div>');function fw(n,e){us(e,!0);const t=kl.map(w=>({id:w.id,icon:w.icon,label:w.tooltip}));function s(w){e.onChange({...e.value,[w]:!e.value[w]})}function i(w,E){return Pe.setIcon(w,E),{update(S){w.empty(),Pe.setIcon(w,S)}}}var r=dw(),o=A(r),l=b(A(o),2),d=A(l),c=A(d),f=A(c);Ct(f,17,()=>t,Ls,(w,E)=>{var S=Is(),T=ct(S);{var R=M=>{var x=aw();Wi(x,(k,I)=>i?.(k,I),()=>y(E).icon),j(()=>mn(x,"title",y(E).label)),D(M,x)};z(T,M=>{e.value[y(E).id]&&M(R)})}D(w,S)});var p=b(f,4),h=A(p);Wi(h,(w,E)=>i?.(w,E),()=>"lucide-more-horizontal");var m=b(h,2);{var g=w=>{var E=uw(),S=b(A(E),2);Ct(S,21,()=>t,Ls,(T,R)=>{var M=Is(),x=ct(M);{var k=I=>{var N=lw();Wi(N,(F,oe)=>i?.(F,oe),()=>y(R).icon),j(()=>mn(N,"title",y(R).label)),D(I,N)};z(x,I=>{e.value[y(R).id]||I(k)})}D(T,M)}),D(w,E)};z(m,w=>{t.some(E=>!e.value[E.id])&&w(g)})}var v=b(o,2),_=b(A(v),2);Ct(_,21,()=>t,Ls,(w,E)=>{var S=cw();S.__click=()=>s(y(E).id);var T=A(S);Wi(T,(N,F)=>i?.(N,F),()=>y(E).icon);var R=b(T,2),M=A(R),x=A(M),k=b(R,2),I=A(k);Wi(I,(N,F)=>i?.(N,F),()=>e.value[y(E).id]?"eye":"eye-off"),j(()=>{fn(S,1,`qa-config-item ${e.value[y(E).id]?"is-primary":"is-secondary"}`,"svelte-g54mgz"),_e(x,y(E).label)}),D(w,S)}),D(n,r),cs()}Hs(["click"]);var hw=q('<div class="ns-preview-wrapper svelte-wrwebx"><div class="ns-header svelte-wrwebx"><div class="ns-title-group"><span class="ns-main-title svelte-wrwebx">Â∏ÉÂ±ÄÈ¢ÑËßà</span> <span class="ns-desc svelte-wrwebx">‰∫§‰∫íÂºèË∞ÉÊï¥ËäÇÁÇπÁöÑÈªòËÆ§ÂÆΩÈ´ò (È¢ÑËßàÊØî‰æã 50%)</span></div></div> <div class="canvas-container svelte-wrwebx"><div class="canvas-bg svelte-wrwebx"></div> <div class="canvas-content svelte-wrwebx"><div class="mock-node user-node svelte-wrwebx"><div class="node-header svelte-wrwebx"><span class="node-icon svelte-wrwebx">üë§</span> <span class="node-type svelte-wrwebx">User Node</span></div> <div class="node-body svelte-wrwebx"><div class="dim-badge svelte-wrwebx"> </div></div> <div class="handle h-right svelte-wrwebx"></div> <div class="handle h-bottom svelte-wrwebx"></div> <div class="handle h-corner svelte-wrwebx"></div></div> <div class="mock-node assistant-node svelte-wrwebx"><div class="node-header svelte-wrwebx"><span class="node-icon svelte-wrwebx">ü§ñ</span> <span class="node-type svelte-wrwebx">Assistant Node</span></div> <div class="node-body svelte-wrwebx"><div class="dim-badge svelte-wrwebx"> </div> <div class="mock-text svelte-wrwebx"></div> <div class="mock-text short svelte-wrwebx"></div></div> <div class="handle h-right svelte-wrwebx"></div> <div class="handle h-bottom svelte-wrwebx"></div> <div class="handle h-corner svelte-wrwebx"></div></div></div></div></div>');function pw(n,e){us(e,!0);const t=.5;let s=ge(null);function i(k,I,N){k.preventDefault(),k.stopPropagation();const F=I==="user"?e.value.userWidth:e.value.assistantWidth,oe=I==="user"?e.value.userHeight:e.value.assistantHeight;J(s,{node:I,handle:N,startX:k.clientX,startY:k.clientY,startWidth:F,startHeight:oe},!0)}function r(k){if(!y(s))return;const I=(k.clientX-y(s).startX)/t,N=(k.clientY-y(s).startY)/t;let F=y(s).startWidth,oe=y(s).startHeight;(y(s).handle==="right"||y(s).handle==="corner")&&(F=Math.max(50,y(s).startWidth+I)),(y(s).handle==="bottom"||y(s).handle==="corner")&&(oe=Math.max(50,y(s).startHeight+N));const Z={...e.value};y(s).node==="user"?(Z.userWidth=Math.round(F),Z.userHeight=Math.round(oe)):(Z.assistantWidth=Math.round(F),Z.assistantHeight=Math.round(oe)),e.onChange(Z)}function o(){J(s,null)}uv(()=>{if(y(s))return window.addEventListener("mousemove",r),window.addEventListener("mouseup",o),()=>{window.removeEventListener("mousemove",r),window.removeEventListener("mouseup",o)}});var l=hw(),d=b(A(l),2),c=b(A(d),2),f=A(c),p=b(A(f),2),h=A(p),m=A(h),g=b(p,2);g.__mousedown=k=>i(k,"user","right");var v=b(g,2);v.__mousedown=k=>i(k,"user","bottom");var _=b(v,2);_.__mousedown=k=>i(k,"user","corner");var w=b(f,2),E=b(A(w),2),S=A(E),T=A(S),R=b(E,2);R.__mousedown=k=>i(k,"assistant","right");var M=b(R,2);M.__mousedown=k=>i(k,"assistant","bottom");var x=b(M,2);x.__mousedown=k=>i(k,"assistant","corner"),j(()=>{xl(f,`width: ${e.value.userWidth*t}px; height: ${e.value.userHeight*t}px;`),_e(m,`${e.value.userWidth??""} √ó ${e.value.userHeight??""}`),xl(w,`width: ${e.value.assistantWidth*t}px; height: ${e.value.assistantHeight*t}px;`),_e(T,`${e.value.assistantWidth??""} √ó ${e.value.assistantHeight??""}`)}),D(n,l),cs()}Hs(["mousedown"]);var mw=q('<div class="modal-overlay svelte-133dbco" role="dialog" aria-modal="true"><div class="modal-container svelte-133dbco"><div class="modal-header svelte-133dbco"><h2 class="svelte-133dbco"> </h2> <button class="close-btn svelte-133dbco" aria-label="ÂÖ≥Èó≠"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div> <div class="modal-body svelte-133dbco"><!></div> <div class="modal-footer svelte-133dbco"><!></div></div></div>');function Sp(n,e){us(e,!0);const t=Nr(e,"maxWidth",3,"520px");var s=mw();s.__click=m=>{m.target===m.currentTarget&&e.onClose()};var i=A(s),r=A(i),o=A(r),l=A(o),d=b(o,2);d.__click=function(...m){e.onClose?.apply(this,m)};var c=b(r,2),f=A(c);Xc(f,e,"default",{});var p=b(c,2),h=A(p);Xc(h,e,"footer",{}),j(()=>{xl(i,`max-width: ${t()??""};`),_e(l,e.title)}),D(n,s),cs()}Hs(["click"]);var gw=q('<div role="switch" tabindex="0"><input type="checkbox" tabindex="-1" aria-hidden="true" class="svelte-1p2wgij"/></div>');function Ps(n,e){us(e,!0);let t=Nr(e,"checked",15);function s(){t(!t()),e.onchange?.(t())}function i(d){(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),s())}var r=gw();let o;r.__click=s,r.__keydown=i;var l=A(r);j(()=>{o=fn(r,1,"checkbox-container svelte-1p2wgij",null,o,{"is-enabled":t()}),mn(r,"aria-checked",t())}),Uv(l,t),D(n,r),cs()}Hs(["click","keydown"]);var yw=q("<option> </option>"),_w=q('<div class="form-field svelte-nm2hyy"><label for="reasoning-effort" class="svelte-nm2hyy">Reasoning Effort</label> <select id="reasoning-effort" class="svelte-nm2hyy"><option>Low</option><option>Medium</option><option>High</option></select></div>'),vw=q('<div class="form-field inline toggle-field svelte-nm2hyy"><label class="svelte-nm2hyy">Reasoning Ê®°Âºè</label> <!></div> <!>',1),ww=q('<div class="form-field svelte-nm2hyy"><label for="thinking-budget" class="svelte-nm2hyy">Budget Tokens</label> <input id="thinking-budget" type="number" min="1000" max="100000" class="svelte-nm2hyy"/> <div class="field-hint svelte-nm2hyy">Êé®ËçêÂÄºÔºö8000-16000</div></div>'),Ew=q('<div class="form-field svelte-nm2hyy"><label for="thinking-budget" class="svelte-nm2hyy">Thinking Budget</label> <input id="thinking-budget" type="number" min="-1" max="100000" class="svelte-nm2hyy"/> <div class="field-hint svelte-nm2hyy">0=ÂÖ≥Èó≠, -1=Âä®ÊÄÅ</div></div>'),Sw=q('<div class="form-field inline toggle-field svelte-nm2hyy"><label class="svelte-nm2hyy">Thinking Ê®°Âºè</label> <!></div> <!>',1),Tw=q('<div class="form-field svelte-nm2hyy"><label for="search-context" class="svelte-nm2hyy">ÊêúÁ¥¢‰∏ä‰∏ãÊñáÂ§ßÂ∞è</label> <input id="search-context" type="text" placeholder="‰æãÂ¶Ç: medium" class="svelte-nm2hyy"/></div>'),Cw=q('<div class="form-field svelte-nm2hyy"><label for="tool-type" class="svelte-nm2hyy">Â∑•ÂÖ∑Á±ªÂûã</label> <select id="tool-type" class="svelte-nm2hyy"><option>None</option><option>Gemini</option></select></div>'),Aw=q('<section class="form-section svelte-nm2hyy"><h3 class="svelte-nm2hyy">‰æõÂ∫îÂïÜÁâπÂÆöÈÖçÁΩÆ</h3> <!> <!> <!> <!></section>'),bw=q('<div class="param-row svelte-nm2hyy"><input type="text" placeholder="ÂèÇÊï∞Âêç" class="svelte-nm2hyy"/> <input type="text" placeholder="ÂèÇÊï∞ÂÄº" class="svelte-nm2hyy"/> <button type="button" class="remove-param-btn svelte-nm2hyy" aria-label="Âà†Èô§ÂèÇÊï∞"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div>'),Iw=q('<div class="error-item svelte-nm2hyy"> </div>'),Rw=q('<div class="error-list svelte-nm2hyy"></div>'),Pw=q('<div class="form-content svelte-nm2hyy"><section class="form-section svelte-nm2hyy"><h3 class="svelte-nm2hyy">Âü∫Êú¨‰ø°ÊÅØ</h3> <div class="form-field svelte-nm2hyy"><label for="model-id" class="svelte-nm2hyy">Ê®°Âûã ID</label> <input id="model-id" type="text" placeholder="‰æãÂ¶Ç: openai/gpt-4o-custom" class="svelte-nm2hyy"/> <div class="field-hint svelte-nm2hyy">ÂîØ‰∏ÄÊ†áËØÜÁ¨¶Ôºå‰øùÂ≠òÂêé‰ªçÂèØ‰øÆÊîπ</div></div> <div class="form-field svelte-nm2hyy"><label for="model-model" class="svelte-nm2hyy">Ê®°ÂûãÂêçÁß∞</label> <input id="model-model" type="text" placeholder="‰æãÂ¶Ç: gpt-4o" class="svelte-nm2hyy"/> <div class="field-hint svelte-nm2hyy">API Ë∞ÉÁî®‰ΩøÁî®ÁöÑÊ®°ÂûãÊ†áËØÜÔºå‰πüÊòØ UI ‰∏≠Â±ïÁ§∫ÁöÑÂêçÁß∞</div></div> <div class="form-field svelte-nm2hyy"><label for="model-provider" class="svelte-nm2hyy">‰æõÂ∫îÂïÜ</label> <select id="model-provider" class="svelte-nm2hyy"></select></div> <div class="form-field inline toggle-field svelte-nm2hyy"><label for="model-enable" class="svelte-nm2hyy">ÂêØÁî®</label> <!></div></section> <!> <section class="form-section svelte-nm2hyy"><h3 class="svelte-nm2hyy">Ëá™ÂÆö‰πâÂèÇÊï∞</h3> <div class="field-hint svelte-nm2hyy" style="margin-bottom: 12px;">Ê∑ªÂä†Ëá™ÂÆö‰πâ API ÂèÇÊï∞ÔºåÂ¶Ç temperature„ÄÅmax_tokens Á≠â</div> <div class="custom-params svelte-nm2hyy"><!> <button type="button" class="add-param-btn svelte-nm2hyy">+ Ê∑ªÂä†ÂèÇÊï∞</button></div></section> <!></div>'),xw=q('<button type="button" class="delete-btn svelte-nm2hyy">Âà†Èô§Ê®°Âûã</button>'),Mw=q('<div slot="footer" class="modal-footer-content svelte-nm2hyy"><!> <div class="footer-actions svelte-nm2hyy"><button type="button" class="cancel-btn svelte-nm2hyy">ÂèñÊ∂à</button> <button type="button" class="save-btn svelte-nm2hyy"> </button></div></div>');function kw(n,e){us(e,!0);const t=Nr(e,"isNew",3,!1);let s=Tt(JSON.parse(JSON.stringify(e.model))),i=ge(Tt(s.customParameters?[...s.customParameters]:[]));const r=Object.fromEntries(Object.entries(me).map(([w,E])=>[w,E.label])),o=Kt(l);function l(){const w=[];return s.model.trim()||w.push("Ê®°ÂûãÂêçÁß∞‰∏çËÉΩ‰∏∫Á©∫"),s.providerId||w.push("ÂøÖÈ°ªÈÄâÊã©‰æõÂ∫îÂïÜ"),s.id.trim()||w.push("Ê®°Âûã ID ‰∏çËÉΩ‰∏∫Á©∫"),w}function d(){y(o).length>0||(s.customParameters=y(i).filter(w=>w.key.trim()),e.onSave(s))}function c(){e.onDelete&&e.onDelete(s.id)}function f(){J(i,[...y(i),{key:"",value:""}],!0)}function p(w){J(i,y(i).filter((E,S)=>S!==w),!0)}function h(w){const E=e.providers.find(S=>S.id===w);E&&(s.providerId=w,s.providerType=E.type)}function m(){const w=s.providerType;return w==="openai"||w==="openrouter"||w==="openai-compatible"}function g(){const w=s.providerType;return w==="anthropic"||w==="gemini"||w==="openrouter"||w==="openai-compatible"}function v(){return s.providerType==="perplexity"}function _(){return s.providerType==="gemini"||s.providerType==="openai-compatible"}{let w=Kt(()=>t()?"Ê∑ªÂä†Ê®°Âûã":"ÁºñËæëÊ®°Âûã");Sp(n,{get title(){return y(w)},get onClose(){return e.onClose},children:(E,S)=>{var T=Pw(),R=A(T),M=b(A(R),2),x=b(A(M),2),k=b(M,2),I=b(A(k),2),N=b(k,2),F=b(A(N),2);F.__change=ce=>h(ce.currentTarget.value),Ct(F,21,()=>e.providers,ce=>ce.id,(ce,ie)=>{var be=yw(),rt=A(be),he={};j(()=>{_e(rt,`${r[y(ie).type]??y(ie).type??""} (${y(ie).id??""})`),he!==(he=y(ie).id)&&(be.value=(be.__value=y(ie).id)??"")}),D(ce,be)});var oe;Ir(F);var Z=b(N,2),X=b(A(Z),2);Ps(X,{get checked(){return s.enable},set checked(ce){s.enable=ce}});var fe=b(R,2);{var ae=ce=>{var ie=Aw(),be=b(A(ie),2);{var rt=Me=>{var Te=vw(),Re=ct(Te),at=b(A(Re),2);{let je=Kt(()=>s.reasoning?.enabled??!1);Ps(at,{get checked(){return y(je)},onchange:Gt=>{s.reasoning||(s.reasoning={enabled:!1}),s.reasoning.enabled=Gt}})}var Jn=b(Re,2);{var Sn=je=>{var Gt=_w(),on=b(A(Gt),2);on.__change=P=>{s.reasoning||(s.reasoning={enabled:!0}),s.reasoning.reasoning_effort=P.currentTarget.value};var Wn=A(on);Wn.value=Wn.__value="low";var ps=b(Wn);ps.value=ps.__value="medium";var Vt=b(ps);Vt.value=Vt.__value="high";var an;Ir(on),j(()=>{an!==(an=s.reasoning?.reasoning_effort??"medium")&&(on.value=(on.__value=s.reasoning?.reasoning_effort??"medium")??"",_i(on,s.reasoning?.reasoning_effort??"medium"))}),D(je,Gt)};z(Jn,je=>{s.reasoning?.enabled&&je(Sn)})}D(Me,Te)};z(be,Me=>{m()&&Me(rt)})}var he=b(be,2);{var Ie=Me=>{var Te=Sw(),Re=ct(Te),at=b(A(Re),2);{let je=Kt(()=>s.thinking?.enabled??!1);Ps(at,{get checked(){return y(je)},onchange:Gt=>{s.thinking||(s.thinking={enabled:!1,budget_tokens:1e4,thinking_budget:-1}),s.thinking.enabled=Gt}})}var Jn=b(Re,2);{var Sn=je=>{var Gt=Is(),on=ct(Gt);{var Wn=Vt=>{var an=ww(),P=b(A(an),2);P.__input=U=>{const V=Number.parseInt(U.currentTarget.value,10);Number.isNaN(V)||(s.thinking.budget_tokens=V)},j(()=>kt(P,s.thinking?.budget_tokens??1e4)),D(Vt,an)},ps=Vt=>{var an=Ew(),P=b(A(an),2);P.__input=U=>{const V=Number.parseInt(U.currentTarget.value,10);Number.isNaN(V)||(s.thinking.thinking_budget=V)},j(()=>kt(P,s.thinking?.thinking_budget??-1)),D(Vt,an)};z(on,Vt=>{s.providerType==="anthropic"?Vt(Wn):Vt(ps,!1)})}D(je,Gt)};z(Jn,je=>{s.thinking?.enabled&&je(Sn)})}D(Me,Te)};z(he,Me=>{g()&&Me(Ie)})}var ot=b(he,2);{var rn=Me=>{var Te=Tw(),Re=b(A(Te),2);Re.__input=at=>{s.web_search_options||(s.web_search_options={}),s.web_search_options.search_context_size=at.currentTarget.value},j(()=>kt(Re,s.web_search_options?.search_context_size??"")),D(Me,Te)};z(ot,Me=>{v()&&Me(rn)})}var qi=b(ot,2);{var Bi=Me=>{var Te=Cw(),Re=b(A(Te),2);Re.__change=je=>{s.toolType=je.currentTarget.value};var at=A(Re);at.value=at.__value="none";var Jn=b(at);Jn.value=Jn.__value="gemini";var Sn;Ir(Re),j(()=>{Sn!==(Sn=s.toolType??"none")&&(Re.value=(Re.__value=s.toolType??"none")??"",_i(Re,s.toolType??"none"))}),D(Me,Te)};z(qi,Me=>{_()&&Me(Bi)})}D(ce,ie)};z(fe,ce=>{(m()||g()||v()||_())&&ce(ae)})}var Se=b(fe,2),se=b(A(Se),4),Ze=A(se);Ct(Ze,17,()=>y(i),Ls,(ce,ie,be)=>{var rt=bw(),he=A(rt),Ie=b(he,2),ot=b(Ie,2);ot.__click=()=>p(be),Rs(he,()=>y(ie).key,rn=>y(ie).key=rn),Rs(Ie,()=>y(ie).value,rn=>y(ie).value=rn),D(ce,rt)});var Bt=b(Ze,2);Bt.__click=f;var Hn=b(Se,2);{var On=ce=>{var ie=Rw();Ct(ie,21,()=>y(o),Ls,(be,rt)=>{var he=Iw(),Ie=A(he);j(()=>_e(Ie,y(rt))),D(be,he)}),D(ce,ie)};z(Hn,ce=>{y(o).length>0&&ce(On)})}j(()=>{oe!==(oe=s.providerId)&&(F.value=(F.__value=s.providerId)??"",_i(F,s.providerId))}),Rs(x,()=>s.id,ce=>s.id=ce),Rs(I,()=>s.model,ce=>s.model=ce),D(E,T)},$$slots:{default:!0,footer:(E,S)=>{var T=Mw(),R=A(T);{var M=F=>{var oe=xw();oe.__click=c,D(F,oe)};z(R,F=>{!t()&&e.onDelete&&F(M)})}var x=b(R,2),k=A(x);k.__click=function(...F){e.onClose?.apply(this,F)};var I=b(k,2);I.__click=d;var N=A(I);j(()=>{I.disabled=y(o).length>0,_e(N,t()?"Ê∑ªÂä†":"‰øùÂ≠ò")}),D(E,T)}}})}cs()}Hs(["change","input","click"]);var Nw=q("<option> </option>"),Dw=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>'),Lw=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7.18 0 12 7 12 7a13.16 13.16 0 0 1-1.67 2.68"></path><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"></path><line x1="2" x2="22" y1="2" y2="22"></line></svg>'),Uw=q('<div class="form-field svelte-10cv0rv"><label for="api-key" class="svelte-10cv0rv"> </label> <div class="api-key-wrapper svelte-10cv0rv"><input id="api-key" placeholder="ËæìÂÖ• API ÂØÜÈí•..." class="svelte-10cv0rv"/> <button type="button" class="toggle-visibility-btn svelte-10cv0rv"><!></button></div></div>'),Fw=q('<div class="form-field svelte-10cv0rv"><label for="base-url" class="svelte-10cv0rv"> </label> <input id="base-url" type="text" placeholder="‰æãÂ¶Ç: https://api.example.com/v1" class="svelte-10cv0rv"/></div>'),$w=q('<span class="optional svelte-10cv0rv">(ÂèØÈÄâ)</span>'),qw=q('<div class="field-hint svelte-10cv0rv"> </div>'),Bw=q('<div role="button" tabindex="0"><input type="checkbox" class="svelte-10cv0rv"/></div> <!>',1),Gw=q('<input type="text" class="svelte-10cv0rv"/>'),Vw=q('<div class="form-field svelte-10cv0rv"><label class="svelte-10cv0rv"> <!></label> <!></div>'),Hw=q('<div class="additional-settings svelte-10cv0rv"><h3 class="svelte-10cv0rv">È¢ùÂ§ñËÆæÁΩÆ</h3> <!></div>'),Ow=q('<div class="error-item svelte-10cv0rv"> </div>'),Jw=q('<div class="error-list svelte-10cv0rv"></div>'),Ww=q('<div class="form-content svelte-10cv0rv"><div class="form-field svelte-10cv0rv"><label for="provider-type" class="svelte-10cv0rv">‰æõÂ∫îÂïÜÁ±ªÂûã</label> <select id="provider-type" class="svelte-10cv0rv"></select></div> <div class="form-field svelte-10cv0rv"><label for="provider-id" class="svelte-10cv0rv">‰æõÂ∫îÂïÜ ID</label> <input id="provider-id" type="text" placeholder="‰æãÂ¶Ç: my-openai, azure-prod" class="svelte-10cv0rv"/> <div class="field-hint svelte-10cv0rv">ÂîØ‰∏ÄÊ†áËØÜÁ¨¶ÔºåÁî®‰∫éÂÖ≥ËÅîÊ®°Âûã</div></div> <!> <!> <!> <!></div>'),zw=q('<div slot="footer"><button type="button" class="cancel-btn svelte-10cv0rv">ÂèñÊ∂à</button> <button type="button" class="save-btn svelte-10cv0rv">Ê∑ªÂä†</button></div>');function Kw(n,e){us(e,!0);const t=Object.keys(me);let s=ge("openai-compatible"),i=ge(""),r=ge(""),o=ge(""),l=ge(Tt({}));const d=Kt(()=>me[y(s)]);let c=ge(!1);const f=Kt(p);function p(){const g=[];y(i).trim()?e.existingProviderIds.includes(y(i).trim())&&g.push("‰æõÂ∫îÂïÜ ID Â∑≤Â≠òÂú®"):g.push("‰æõÂ∫îÂïÜ ID ‰∏çËÉΩ‰∏∫Á©∫"),y(d).requireApiKey&&!y(r).trim()&&g.push("API Key ‰∏çËÉΩ‰∏∫Á©∫"),y(d).requireBaseUrl&&!y(o).trim()&&g.push("Base URL ‰∏çËÉΩ‰∏∫Á©∫");for(const v of y(d).additionalSettings)v.required&&!y(l)[v.key]?.trim()&&g.push(`${v.label} ‰∏çËÉΩ‰∏∫Á©∫`);return g}function h(){if(y(f).length>0)return;const g={type:y(s),id:y(i).trim(),apiKey:y(r).trim()||void 0,baseUrl:y(o).trim()||void 0,additionalSettings:Object.keys(y(l)).length>0?y(l):void 0};e.onSave(g)}function m(g){J(s,g,!0),J(l,{},!0),me[g].defaultProviderId===null?J(i,`${g}-1`):J(i,`${g}-custom`)}Sp(n,{title:"Ê∑ªÂä†‰æõÂ∫îÂïÜ",get onClose(){return e.onClose},maxWidth:"480px",children:(g,v)=>{var _=Ww(),w=A(_),E=b(A(w),2);E.__change=X=>m(X.currentTarget.value),Ct(E,20,()=>t,X=>X,(X,fe)=>{var ae=Nw(),Se=A(ae),se={};j(()=>{_e(Se,me[fe].label),se!==(se=fe)&&(ae.value=(ae.__value=fe)??"")}),D(X,ae)});var S;Ir(E);var T=b(w,2),R=b(A(T),2),M=b(T,2);{var x=X=>{var fe=Uw(),ae=A(fe),Se=A(ae),se=b(ae,2),Ze=A(se),Bt=b(Ze,2);Bt.__click=()=>J(c,!y(c));var Hn=A(Bt);{var On=ie=>{var be=Dw();D(ie,be)},ce=ie=>{var be=Lw();D(ie,be)};z(Hn,ie=>{y(c)?ie(On):ie(ce,!1)})}j(()=>{_e(Se,`API Key ${y(d).requireApiKey?"":"(ÂèØÈÄâ)"}`),mn(Ze,"type",y(c)?"text":"password"),mn(Bt,"aria-label",y(c)?"ÈöêËóè":"ÊòæÁ§∫")}),Rs(Ze,()=>y(r),ie=>J(r,ie)),D(X,fe)};z(M,X=>{(y(d).requireApiKey||y(s)==="openai-compatible")&&X(x)})}var k=b(M,2);{var I=X=>{var fe=Fw(),ae=A(fe),Se=A(ae),se=b(ae,2);j(()=>_e(Se,`Base URL ${y(d).requireBaseUrl?"":"(ÂèØÈÄâ)"}`)),Rs(se,()=>y(o),Ze=>J(o,Ze)),D(X,fe)};z(k,X=>{(y(d).requireBaseUrl||y(s)==="openai-compatible")&&X(I)})}var N=b(k,2);{var F=X=>{var fe=Hw(),ae=b(A(fe),2);Ct(ae,17,()=>y(d).additionalSettings,Se=>Se.key,(Se,se)=>{var Ze=Vw(),Bt=A(Ze),Hn=A(Bt),On=b(Hn);{var ce=he=>{var Ie=$w();D(he,Ie)};z(On,he=>{y(se).required||he(ce)})}var ie=b(Bt,2);{var be=he=>{var Ie=Bw(),ot=ct(Ie);let rn;ot.__click=()=>{y(l)[y(se).key]=y(l)[y(se).key]==="true"?"false":"true"},ot.__keydown=Te=>{(Te.key==="Enter"||Te.key===" ")&&(Te.preventDefault(),y(l)[y(se).key]=y(l)[y(se).key]==="true"?"false":"true")};var qi=A(ot),Bi=b(ot,2);{var Me=Te=>{var Re=qw(),at=A(Re);j(()=>_e(at,y(se).description)),D(Te,Re)};z(Bi,Te=>{y(se).description&&Te(Me)})}j(()=>{rn=fn(ot,1,"checkbox-container svelte-10cv0rv",null,rn,{"is-enabled":y(l)[y(se).key]==="true"}),Dv(qi,y(l)[y(se).key]==="true")}),D(he,Ie)},rt=he=>{var Ie=Gw();Ie.__input=ot=>{y(l)[y(se).key]=ot.currentTarget.value},j(()=>{mn(Ie,"id",`setting-${y(se).key}`),kt(Ie,y(l)[y(se).key]??""),mn(Ie,"placeholder",y(se).placeholder??"")}),D(he,Ie)};z(ie,he=>{y(se).type==="toggle"?he(be):he(rt,!1)})}j(()=>{mn(Bt,"for",`setting-${y(se).key}`),_e(Hn,`${y(se).label??""} `)}),D(Se,Ze)}),D(X,fe)};z(N,X=>{y(d).additionalSettings.length>0&&X(F)})}var oe=b(N,2);{var Z=X=>{var fe=Jw();Ct(fe,21,()=>y(f),Ls,(ae,Se)=>{var se=Ow(),Ze=A(se);j(()=>_e(Ze,y(Se))),D(ae,se)}),D(X,fe)};z(oe,X=>{y(f).length>0&&X(Z)})}j(()=>{S!==(S=y(s))&&(E.value=(E.__value=y(s))??"",_i(E,y(s)))}),Rs(R,()=>y(i),X=>J(i,X)),D(g,_)},$$slots:{default:!0,footer:(g,v)=>{var _=zw(),w=A(_);w.__click=function(...S){e.onClose?.apply(this,S)};var E=b(w,2);E.__click=h,j(()=>E.disabled=y(f).length>0),D(g,_)}}}),cs()}Hs(["change","click","keydown","input"]);var Yw=q('<span class="status-ok svelte-1y8kcgz"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg> Ê†°È™åÈÄöËøá</span>'),Xw=q('<span class="status-warn svelte-1y8kcgz"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> </span>'),Qw=q("<option>ÊöÇÊó†ÂèØÁî®Ê®°Âûã</option>"),Zw=q("<option> </option>"),jw=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>'),eE=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>'),tE=q('<span class="api-set svelte-1y8kcgz">API Â∑≤ÈÖçÁΩÆ</span>'),nE=q('<span class="api-optional svelte-1y8kcgz">Êó†ÈúÄ API</span>'),sE=q('<span class="api-missing svelte-1y8kcgz">Êú™ÈÖçÁΩÆ</span>'),iE=q('<span class="default-badge svelte-1y8kcgz">ÂÜÖÁΩÆ</span>'),rE=q('<button class="icon-btn delete-btn svelte-1y8kcgz" title="Âà†Èô§‰æõÂ∫îÂïÜ"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button>'),oE=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>'),aE=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7.18 0 12 7 12 7a13.16 13.16 0 0 1-1.67 2.68"></path><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"></path><line x1="2" x2="22" y1="2" y2="22"></line></svg>'),lE=q('<div class="field-group svelte-1y8kcgz"><label class="svelte-1y8kcgz"> </label> <div class="api-key-input-wrapper svelte-1y8kcgz"><input placeholder="ËæìÂÖ• API ÂØÜÈí•..." class="svelte-1y8kcgz"/> <button type="button" class="password-toggle-btn svelte-1y8kcgz"><!></button></div></div>'),uE=q('<div class="field-group svelte-1y8kcgz"><label class="svelte-1y8kcgz"> </label> <input type="text" placeholder="Ëá™ÂÆö‰πâ API Âú∞ÂùÄ..." class="svelte-1y8kcgz"/></div>'),cE=q('<div class="no-models svelte-1y8kcgz">ÊöÇÊó†Ê®°ÂûãÔºåÁÇπÂáª‰∏äÊñπÊåâÈíÆÊ∑ªÂä†</div>'),dE=q('<span class="model-badge svelte-1y8kcgz">Reasoning</span>'),fE=q('<span class="model-badge svelte-1y8kcgz">Thinking</span>'),hE=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="spinning svelte-1y8kcgz"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg>'),pE=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>'),mE=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>'),gE=En('<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>'),yE=q('<div><div class="model-info svelte-1y8kcgz"><div class="model-name svelte-1y8kcgz"> </div> <div class="model-meta svelte-1y8kcgz"><span class="model-id svelte-1y8kcgz"> </span> <!> <!></div></div> <div class="model-actions svelte-1y8kcgz"><button class="icon-btn delete-btn svelte-1y8kcgz" title="Âà†Èô§Ê®°Âûã"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button> <button title="ÊµãËØïÊ®°Âûã"><!></button> <button class="icon-btn edit-btn svelte-1y8kcgz" title="ÁºñËæëÊ®°Âûã"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"></path></svg></button> <!></div></div>'),_E=q('<div class="models-list svelte-1y8kcgz"></div>'),vE=q('<div class="provider-content svelte-1y8kcgz"><div class="provider-fields svelte-1y8kcgz"><!> <!></div> <div class="provider-models svelte-1y8kcgz"><div class="models-header svelte-1y8kcgz"><span class="models-title svelte-1y8kcgz">Ê®°ÂûãÂàóË°®</span> <button class="add-model-btn svelte-1y8kcgz"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg> Ê∑ªÂä†Ê®°Âûã</button></div> <!></div></div>'),wE=q('<div><button type="button" class="provider-header-btn svelte-1y8kcgz"><span class="expand-icon svelte-1y8kcgz"><!></span> <div class="provider-info svelte-1y8kcgz"><span class="provider-label svelte-1y8kcgz"> </span> <span class="provider-id svelte-1y8kcgz"> </span></div> <span class="provider-api-status svelte-1y8kcgz"><!></span> <span class="model-count svelte-1y8kcgz"> </span> <div class="provider-header-actions svelte-1y8kcgz"><!></div></button> <!></div>'),EE=q('<section class="settings-group svelte-1y8kcgz"><div class="setting-item svelte-1y8kcgz"><div class="setting-item-info svelte-1y8kcgz"><div class="setting-item-name svelte-1y8kcgz">ÈªòËÆ§ËÅäÂ§©Ê®°Âûã</div> <div class="setting-item-description svelte-1y8kcgz">ËØ∑ÈÄâÊã©‰∏Ä‰∏™Â∑≤ÂêØÁî®ÁöÑÊ®°Âûã‰Ωú‰∏∫ÈªòËÆ§Ê®°Âûã„ÄÇÂÜÖÁΩÆÊ®°ÂûãÈªòËÆ§ÂÖ≥Èó≠ÔºåÊ∑ªÂä†ÊàñÂêØÁî®ÂêéÊâçËÉΩ‰ΩøÁî®„ÄÇ</div></div> <div class="setting-item-control svelte-1y8kcgz"><select><!></select></div></div> <div class="setting-item vertical svelte-1y8kcgz"><div class="setting-item-info svelte-1y8kcgz"><div class="setting-item-name svelte-1y8kcgz">ÂÖ®Â±ÄÁ≥ªÁªüÊèêÁ§∫</div> <div class="setting-item-description svelte-1y8kcgz">ÊâÄÊúâÂØπËØùÈÉΩ‰ºöÊê∫Â∏¶ÁöÑÁ≥ªÁªüÁ∫ßÊåá‰ª§ÔºàSystem PromptÔºâ„ÄÇ</div></div> <div class="setting-item-control full-width svelte-1y8kcgz"><div class="textarea-wrapper svelte-1y8kcgz"><textarea rows="4" class="svelte-1y8kcgz"></textarea> <div class="counter svelte-1y8kcgz"> </div></div></div></div></section> <section class="settings-group svelte-1y8kcgz"><div class="section-header svelte-1y8kcgz"><h3 class="section-title svelte-1y8kcgz">‰æõÂ∫îÂïÜÈÖçÁΩÆ</h3> <button class="add-btn svelte-1y8kcgz"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg> Ê∑ªÂä†‰æõÂ∫îÂïÜ</button></div> <div class="setting-item-description svelte-1y8kcgz" style="margin-bottom: 16px;">ÁÇπÂáª‰æõÂ∫îÂïÜÂç°ÁâáÂ±ïÂºÄÈÖçÁΩÆÂíåÊ®°ÂûãÂàóË°®„ÄÇ</div> <div class="providers-list svelte-1y8kcgz"></div></section>',1),SE=q('<section class="settings-group svelte-1y8kcgz"><h3 class="section-title svelte-1y8kcgz">ÈÄöÁî®Ë°å‰∏∫</h3> <div class="setting-item svelte-1y8kcgz"><div class="setting-item-info svelte-1y8kcgz"><div class="setting-item-name svelte-1y8kcgz">Â±ïÂºÄÂµåÂ•óÂºïÁî®</div> <div class="setting-item-description svelte-1y8kcgz">ÂºÄÂêØÂêéÔºåÁõ∏ÂÖ≥ÂëΩ‰ª§ÈªòËÆ§Ëá™Âä®Â±ïÂºÄ [[ÂºïÁî®]] ÁöÑÂÜÖÂÆπ„ÄÇ</div></div> <div class="setting-item-control svelte-1y8kcgz"><!></div></div> <div class="setting-item svelte-1y8kcgz"><div class="setting-item-info svelte-1y8kcgz"><div class="setting-item-name svelte-1y8kcgz">‰∏ä‰∏ãÊñáÊà™Êñ≠ÊèêÈÜí</div> <div class="setting-item-description svelte-1y8kcgz">ÂΩì‰∏ä‰∏ãÊñáË∂ÖËøáÊ®°ÂûãÈôêÂà∂Ë¢´Ë£ÅÂâ™Êó∂ÔºåÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ„ÄÇ</div></div> <div class="setting-item-control svelte-1y8kcgz"><!></div></div></section> <section class="settings-group svelte-1y8kcgz"><h3 class="section-title svelte-1y8kcgz">Canvas Âø´Êç∑Âä®‰ΩúÊ†è</h3> <div class="setting-item-description svelte-1y8kcgz" style="margin-bottom: 12px;">ÈÄâÊã©Áõ¥Êé•ÊòæÁ§∫Âú®Âç°Áâá‰∏äÊñπËèúÂçïÊ†èÁöÑÊåâÈíÆ„ÄÇÊú™ÈÄâ‰∏≠ÁöÑÊåâÈíÆÂ∞ÜÊî∂Á∫≥Ëá≥"Êõ¥Â§öÊìç‰Ωú"ËèúÂçï‰∏≠„ÄÇ</div> <!></section> <section class="settings-group svelte-1y8kcgz"><h3 class="section-title svelte-1y8kcgz">ËäÇÁÇπÂ∞∫ÂØ∏ÈÖçÁΩÆ</h3> <div class="setting-item-description svelte-1y8kcgz" style="margin-bottom: 12px;">ÈÖçÁΩÆ Canvas ËäÇÁÇπÁöÑÈªòËÆ§Â∞∫ÂØ∏„ÄÇÂèØ‰ª•ÈÄöËøáÈ¢ÑËßàÂå∫ÂüüÊãñÊãΩË∞ÉÊï¥„ÄÇ</div> <!> <div class="node-size-grid svelte-1y8kcgz"><div class="ns-group svelte-1y8kcgz"><h4 class="ns-group-title svelte-1y8kcgz">User ÈªòËÆ§Â∞∫ÂØ∏</h4> <div class="ns-row svelte-1y8kcgz"><div class="input-group svelte-1y8kcgz"><label for="u-width" class="svelte-1y8kcgz">ÂÆΩÂ∫¶</label> <input id="u-width" type="number" class="svelte-1y8kcgz"/></div> <div class="input-group svelte-1y8kcgz"><label for="u-height" class="svelte-1y8kcgz">È´òÂ∫¶</label> <input id="u-height" type="number" class="svelte-1y8kcgz"/></div></div></div> <div class="ns-group svelte-1y8kcgz"><h4 class="ns-group-title svelte-1y8kcgz">Assistant ÈªòËÆ§Â∞∫ÂØ∏</h4> <div class="ns-row svelte-1y8kcgz"><div class="input-group svelte-1y8kcgz"><label for="a-width" class="svelte-1y8kcgz">ÂÆΩÂ∫¶</label> <input id="a-width" type="number" class="svelte-1y8kcgz"/></div> <div class="input-group svelte-1y8kcgz"><label for="a-height" class="svelte-1y8kcgz">È´òÂ∫¶</label> <input id="a-height" type="number" class="svelte-1y8kcgz"/></div></div></div></div></section>',1),TE=q('<div class="setting-item svelte-1y8kcgz"><div class="setting-item-info svelte-1y8kcgz"><div class="setting-item-name svelte-1y8kcgz">Êó•ÂøóÁïôÂ≠òÊù°Êï∞</div> <div class="setting-item-description svelte-1y8kcgz">ÊúÄÂ§ö‰øùÁïôÂ§öÂ∞ëÊù°ÂéÜÂè≤ËÆ∞ÂΩïÔºà1-200Ôºâ„ÄÇ</div></div> <div class="setting-item-control svelte-1y8kcgz"><input type="number" min="1" max="200" class="svelte-1y8kcgz"/></div></div> <div class="setting-item svelte-1y8kcgz"><div class="setting-item-info svelte-1y8kcgz"><div class="setting-item-name svelte-1y8kcgz">Êó•ÂøóÊìç‰Ωú</div></div> <div class="setting-item-control svelte-1y8kcgz"><button>Êü•ÁúãÊó•Âøó</button> <button style="margin-left: 8px;">Ê∏ÖÁ©∫</button></div></div>',1),CE=q('<section class="settings-group svelte-1y8kcgz"><div class="setting-item svelte-1y8kcgz"><div class="setting-item-info svelte-1y8kcgz"><div class="setting-item-name svelte-1y8kcgz">ÂêØÁî®Ë∞ÉËØïÊó•Âøó</div> <div class="setting-item-description svelte-1y8kcgz">ËÆ∞ÂΩïÊúÄËøëÁöÑ‰∫§‰∫íÊëòË¶ÅÔºåÁî®‰∫éÊéíÊü•ÈóÆÈ¢ò„ÄÇ</div></div> <div class="setting-item-control svelte-1y8kcgz"><!></div></div> <!></section>'),AE=q("<li> </li>"),bE=q('<section class="settings-group error-panel svelte-1y8kcgz"><h3 class="error-title svelte-1y8kcgz">ÈÖçÁΩÆÊ†°È™åÈîôËØØ</h3> <ul class="svelte-1y8kcgz"></ul></section>'),IE=q('<div class="caret-settings svelte-1y8kcgz"><header class="settings-nav svelte-1y8kcgz"><div class="tabs svelte-1y8kcgz"><button>‰æõÂ∫îÂïÜ & Ê®°Âûã</button> <button>‰∫§‰∫í‰∏éË°å‰∏∫</button> <button>Ë∞ÉËØï‰∏éÊó•Âøó</button></div> <div class="header-actions svelte-1y8kcgz"><!></div></header> <div class="settings-container"><!> <!> <!> <!></div></div> <!> <!>',1);function RE(n,e){us(e,!0);function t(){}function s(P){return{providers:P.providers.map(U=>({...U})),chatModels:P.chatModels.map(U=>({...U})),defaultChatModelId:P.defaultChatModelId,systemPrompt:P.systemPrompt,expandNestedRefs:P.expandNestedRefs,warnOnContextTrim:P.warnOnContextTrim,debugLog:{...P.debugLog},quickActions:{...P.quickActions},nodeSize:{...P.nodeSize}}}const i=Nr(e,"initialSettings",3,We),r=Nr(e,"onChange",3,t);let o=ge("providers-models"),l=ge(Tt(new Set));function d(P){const U=new Set(y(l));U.has(P)?U.delete(P):U.add(P),J(l,U,!0)}let c=ge(Tt(Mi(()=>s(i()))));const f=Kt(()=>Hn(y(c)));let p=ge(Tt({})),h=ge(Tt({})),m=ge(!1),g=ge(!1),v=ge(null),_=ge(null),w=ge(!1),E=null;function S(){E&&clearTimeout(E),E=setTimeout(async()=>{y(f).length===0&&await r()(s(y(c))),E=null},500)}async function T(){await r()(s(y(c)))}const R=Kt(()=>y(c).chatModels.filter(P=>P.enable)),M=Object.fromEntries(Object.entries(me).map(([P,U])=>[P,U.label])),x=Yo.map(P=>P.id);function k(P){return x.includes(P)}function I(P){const U=s(y(c));P(U),J(c,U,!0)}function N(P,U,V){I(K=>{const Ue=K.providers.find(re=>re.id===P);Ue&&(Ue[U]=V)})}function F(P){y(h)[P]=!y(h)[P],J(h,{...y(h)},!0)}async function oe(P){if(!e.plugin?.aiService){new Pe.Notice("AI ÊúçÂä°Êú™ÂàùÂßãÂåñ");return}y(p)[P]="loading",J(p,{...y(p)},!0);try{const U=await e.plugin.aiService.testModel(P);y(p)[P]=U.success?"success":"error",J(p,{...y(p)},!0),new Pe.Notice(U.message,U.success?3e3:5e3)}catch(U){y(p)[P]="error",J(p,{...y(p)},!0),new Pe.Notice(`ÊµãËØïÂ§±Ë¥•Ôºö${U instanceof Error?U.message:"Êú™Áü•ÈîôËØØ"}`)}}function Z(P){J(v,JSON.parse(JSON.stringify(P)),!0),J(_,P.id,!0),J(w,!1),J(m,!0)}function X(P){const U=P?y(c).providers.find(V=>V.id===P):y(c).providers[0];J(v,{providerType:U?.type??"openai",providerId:U?.id??"openai",id:"",model:"",name:"",enable:!0},!0),J(_,null),J(w,!0),J(m,!0)}function fe(P){const U=y(_)??P.id;if(I(V=>{if(y(w))V.chatModels.push(P),!V.defaultChatModelId&&P.enable&&(V.defaultChatModelId=P.id);else{const K=V.chatModels.findIndex(Ue=>Ue.id===U);K!==-1&&(V.chatModels[K]=P),(V.defaultChatModelId===U||!V.defaultChatModelId&&P.enable)&&(V.defaultChatModelId=P.id)}}),!y(w)&&U!==P.id&&y(p)[U]){const{[U]:V,...K}=y(p);J(p,{...K,[P.id]:V},!0)}Se(),T()}function ae(P,U){const V=y(_)??P;!U?.skipConfirm&&!confirm("Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Ê®°ÂûãÂêóÔºü")||(I(K=>{const Ue=K.chatModels.findIndex(re=>re.id===V);if(Ue!==-1&&K.chatModels.splice(Ue,1),K.defaultChatModelId===V){const re=K.chatModels.find(et=>et.enable);K.defaultChatModelId=re?.id??K.chatModels[0]?.id??""}else if(!K.defaultChatModelId&&K.chatModels.length>0){const re=K.chatModels.find(et=>et.enable)?.id??K.chatModels[0]?.id??"";K.defaultChatModelId=re}}),Se(),T())}function Se(){J(m,!1),J(v,null),J(_,null),J(w,!1)}function se(){J(g,!0)}function Ze(P){I(U=>{U.providers.push(P)}),J(g,!1),T()}function Bt(P){const U=y(c).chatModels.filter(K=>K.providerId===P);let V="Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™‰æõÂ∫îÂïÜÂêóÔºü";U.length>0&&(V=`Ê≠§‰æõÂ∫îÂïÜ‰∏ãÊúâ ${U.length} ‰∏™Ê®°ÂûãÔºåÂà†Èô§ÂêéÂ∞Ü‰∏ÄÂπ∂ÁßªÈô§„ÄÇÁ°ÆÂÆöË¶ÅÁªßÁª≠ÂêóÔºü`),confirm(V)&&(I(K=>{K.chatModels=K.chatModels.filter(re=>re.providerId!==P);const Ue=K.providers.findIndex(re=>re.id===P);if(Ue!==-1&&K.providers.splice(Ue,1),K.defaultChatModelId&&!K.chatModels.some(re=>re.id===K.defaultChatModelId)){const re=K.chatModels.find(et=>et.enable);K.defaultChatModelId=re?.id??K.chatModels[0]?.id??""}}),T())}function Hn(P){const U=[];P.providers.length===0&&U.push("Ëá≥Â∞ëÈúÄË¶Å‰∏Ä‰∏™‰æõÂ∫îÂïÜÈÖçÁΩÆ„ÄÇ"),P.chatModels.length===0&&U.push("Ëá≥Â∞ëÈúÄË¶Å‰∏Ä‰∏™Ê®°ÂûãÈÖçÁΩÆ„ÄÇ"),P.defaultChatModelId&&!P.chatModels.some(K=>K.id===P.defaultChatModelId)&&U.push("ÈªòËÆ§Ê®°ÂûãÊú™ÊåáÂêëÂ∑≤Â≠òÂú®ÁöÑÊ®°Âûã„ÄÇ"),P.systemPrompt.length>4e3&&U.push("ÂÖ®Â±ÄÁ≥ªÁªüÊèêÁ§∫ÈïøÂ∫¶Ë∂ÖÂá∫ 4000 ÈôêÂà∂„ÄÇ"),(!Number.isInteger(P.debugLog.limit)||P.debugLog.limit<1||P.debugLog.limit>200)&&U.push("Ë∞ÉËØïÊó•ÂøóÁïôÂ≠ò‰∏äÈôêÈúÄÂú® 1-200 ‰πãÈó¥„ÄÇ");const{nodeSize:V}=P;return(!Number.isInteger(V.userWidth)||V.userWidth<50||V.userWidth>2e3)&&U.push("User ËäÇÁÇπÂÆΩÂ∫¶ÈúÄÂú® 50-2000 ‰πãÈó¥„ÄÇ"),(!Number.isInteger(V.userHeight)||V.userHeight<50||V.userHeight>2e3)&&U.push("User ËäÇÁÇπÈ´òÂ∫¶ÈúÄÂú® 50-2000 ‰πãÈó¥„ÄÇ"),(!Number.isInteger(V.assistantWidth)||V.assistantWidth<50||V.assistantWidth>2e3)&&U.push("Assistant ËäÇÁÇπÂÆΩÂ∫¶ÈúÄÂú® 50-2000 ‰πãÈó¥„ÄÇ"),(!Number.isInteger(V.assistantHeight)||V.assistantHeight<50||V.assistantHeight>2e3)&&U.push("Assistant ËäÇÁÇπÈ´òÂ∫¶ÈúÄÂú® 50-2000 ‰πãÈó¥„ÄÇ"),U}var On=IE(),ce=ct(On),ie=A(ce),be=A(ie),rt=A(be);rt.__click=()=>J(o,"providers-models");var he=b(rt,2);he.__click=()=>J(o,"behavior");var Ie=b(he,2);Ie.__click=()=>J(o,"debug");var ot=b(be,2),rn=A(ot);{var qi=P=>{var U=Yw();D(P,U)},Bi=P=>{var U=Xw(),V=b(A(U));j(()=>_e(V,` ${y(f).length??""} ‰∏™ÈîôËØØ`)),D(P,U)};z(rn,P=>{y(f).length===0?P(qi):P(Bi,!1)})}var Me=b(ie,2),Te=A(Me);{var Re=P=>{var U=EE(),V=ct(U),K=A(V),Ue=b(A(K),2),re=A(Ue);re.__change=async He=>{const Q=He.currentTarget.value;I(Ot=>{Ot.defaultChatModelId=Q}),await T()};let et;var Ht=A(re);{var Js=He=>{var Q=Qw();Q.value=Q.__value="",D(He,Q)},ms=He=>{var Q=Is(),Ot=ct(Q);Ct(Ot,17,()=>y(R),Cn=>Cn.id,(Cn,Rt)=>{var ve=Zw(),Ce=A(ve),mt={};j(()=>{_e(Ce,`${y(Rt).model??""} (${y(Rt).providerId??""})`),mt!==(mt=y(Rt).id)&&(ve.value=(ve.__value=y(Rt).id)??"")}),D(Cn,ve)}),D(He,Q)};z(Ht,He=>{y(R).length===0?He(Js):He(ms,!1)})}var Ws;Ir(re);var gs=b(K,2),zs=b(A(gs),2),Gi=A(zs),ln=A(Gi);ln.__input=He=>I(Q=>Q.systemPrompt=He.currentTarget.value);var Vi=b(ln,2),Tn=A(Vi),ys=b(V,2),jr=A(ys),Hi=b(A(jr),2);Hi.__click=se;var Oa=b(jr,4);Ct(Oa,21,()=>y(c).providers,He=>He.id,(He,Q)=>{const Ot=Kt(()=>y(l).has(y(Q).id)),Cn=Kt(()=>y(c).chatModels.filter(pe=>pe.providerId===y(Q).id));var Rt=wE();let ve;var Ce=A(Rt);Ce.__click=()=>d(y(Q).id);var mt=A(Ce),Sy=A(mt);{var Ty=pe=>{var Oe=jw();D(pe,Oe)},Cy=pe=>{var Oe=eE();D(pe,Oe)};z(Sy,pe=>{y(Ot)?pe(Ty):pe(Cy,!1)})}var Mc=b(mt,2),kc=A(Mc),Ay=A(kc),by=b(kc,2),Iy=A(by),Nc=b(Mc,2),Ry=A(Nc);{var Py=pe=>{var Oe=tE();D(pe,Oe)},xy=pe=>{var Oe=Is(),Ks=ct(Oe);{var eo=zn=>{var Oi=nE();D(zn,Oi)},Ja=zn=>{var Oi=sE();D(zn,Oi)};z(Ks,zn=>{me[y(Q).type]?.requireApiKey?zn(Ja,!1):zn(eo)},!0)}D(pe,Oe)};z(Ry,pe=>{y(Q).apiKey?pe(Py):pe(xy,!1)})}var Dc=b(Nc,2),My=A(Dc),ky=b(Dc,2),Ny=A(ky);{var Dy=pe=>{var Oe=iE();D(pe,Oe)},Ly=pe=>{var Oe=rE();Oe.__click=Ks=>{Ks.stopPropagation(),Bt(y(Q).id)},D(pe,Oe)};z(Ny,pe=>{k(y(Q).id)?pe(Dy):pe(Ly,!1)})}var Uy=b(Ce,2);{var Fy=pe=>{var Oe=vE(),Ks=A(Oe),eo=A(Ks);{var Ja=lt=>{var un=lE(),An=A(un),Ae=A(An),Ys=b(An,2),Jt=A(Ys);Jt.__input=cn=>N(y(Q).id,"apiKey",cn.currentTarget.value.trim());var Xs=b(Jt,2);Xs.__click=()=>F(y(Q).id);var to=A(Xs);{var no=cn=>{var Qs=oE();D(cn,Qs)},Wa=cn=>{var Qs=aE();D(cn,Qs)};z(to,cn=>{y(h)[y(Q).id]?cn(no):cn(Wa,!1)})}j(()=>{_e(Ae,`API Key ${me[y(Q).type]?.requireApiKey?"":"(ÂèØÈÄâ)"}`),mn(Jt,"type",y(h)[y(Q).id]?"text":"password"),kt(Jt,y(Q).apiKey??""),mn(Xs,"title",y(h)[y(Q).id]?"ÈöêËóè":"ÊòæÁ§∫")}),Yn("blur",Jt,S),D(lt,un)};z(eo,lt=>{(me[y(Q).type]?.requireApiKey||y(Q).type==="openai-compatible")&&lt(Ja)})}var zn=b(eo,2);{var Oi=lt=>{var un=uE(),An=A(un),Ae=A(An),Ys=b(An,2);Ys.__input=Jt=>N(y(Q).id,"baseUrl",Jt.currentTarget.value.trim()),j(()=>{_e(Ae,`Base URL ${me[y(Q).type]?.requireBaseUrl?"(ÂøÖÂ°´)":"(ÂèØÈÄâ)"}`),kt(Ys,y(Q).baseUrl??"")}),Yn("blur",Ys,S),D(lt,un)};z(zn,lt=>{(me[y(Q).type]?.requireBaseUrl||y(Q).type==="openai-compatible"||y(Q).baseUrl)&&lt(Oi)})}var $y=b(Ks,2),Lc=A($y),qy=b(A(Lc),2);qy.__click=()=>X(y(Q).id);var By=b(Lc,2);{var Gy=lt=>{var un=cE();D(lt,un)},Vy=lt=>{var un=_E();Ct(un,21,()=>y(Cn),An=>An.id,(An,Ae,Ys)=>{var Jt=yE();let Xs;var to=A(Jt),no=A(to),Wa=A(no),cn=b(no,2),Qs=A(cn),Hy=A(Qs),Uc=b(Qs,2);{var Oy=Je=>{var Kn=dE();D(Je,Kn)};z(Uc,Je=>{y(Ae).reasoning?.enabled&&Je(Oy)})}var Jy=b(Uc,2);{var Wy=Je=>{var Kn=fE();D(Je,Kn)};z(Jy,Je=>{y(Ae).thinking?.enabled&&Je(Wy)})}var zy=b(to,2),Fc=A(zy);Fc.__click=()=>ae(y(Ae).id,{skipConfirm:!0});var Ji=b(Fc,2);Ji.__click=()=>oe(y(Ae).id);var Ky=A(Ji);{var Yy=Je=>{var Kn=hE();D(Je,Kn)},Xy=Je=>{var Kn=Is(),Zy=ct(Kn);{var jy=Zs=>{var so=pE();D(Zs,so)},e_=Zs=>{var so=Is(),t_=ct(so);{var n_=js=>{var za=mE();D(js,za)},s_=js=>{var za=gE();D(js,za)};z(t_,js=>{y(p)[y(Ae).id]==="error"?js(n_):js(s_,!1)},!0)}D(Zs,so)};z(Zy,Zs=>{y(p)[y(Ae).id]==="success"?Zs(jy):Zs(e_,!1)},!0)}D(Je,Kn)};z(Ky,Je=>{y(p)[y(Ae).id]==="loading"?Je(Yy):Je(Xy,!1)})}var $c=b(Ji,2);$c.__click=()=>Z(y(Ae));var Qy=b($c,2);Ps(Qy,{onchange:T,get checked(){return y(Ae).enable},set checked(Je){y(Ae).enable=Je}}),j(()=>{Xs=fn(Jt,1,"model-item svelte-1y8kcgz",null,Xs,{disabled:!y(Ae).enable}),_e(Wa,y(Ae).model),_e(Hy,y(Ae).model),fn(Ji,1,`icon-btn test-btn ${y(p)[y(Ae).id]==="loading"?"loading":""} ${y(p)[y(Ae).id]==="success"?"success":""} ${y(p)[y(Ae).id]==="error"?"error":""}`,"svelte-1y8kcgz"),Ji.disabled=y(p)[y(Ae).id]==="loading"}),D(An,Jt)}),D(lt,un)};z(By,lt=>{y(Cn).length===0?lt(Gy):lt(Vy,!1)})}D(pe,Oe)};z(Uy,pe=>{y(Ot)&&pe(Fy)})}j(()=>{ve=fn(Rt,1,"provider-card svelte-1y8kcgz",null,ve,{expanded:y(Ot)}),_e(Ay,y(Q).id),_e(Iy,`(${M[y(Q).type]??y(Q).type??""})`),_e(My,`${y(Cn).length??""} ‰∏™Ê®°Âûã`)}),D(He,Rt)}),j(()=>{re.disabled=y(R).length===0,et=fn(re,1,"svelte-1y8kcgz",null,et,{invalid:y(R).length>0&&!y(c).defaultChatModelId}),Ws!==(Ws=y(c).defaultChatModelId)&&(re.value=(re.__value=y(c).defaultChatModelId)??"",_i(re,y(c).defaultChatModelId)),kt(ln,y(c).systemPrompt),_e(Tn,`${y(c).systemPrompt.length??""}/4000`)}),Yn("blur",ln,S),D(P,U)};z(Te,P=>{y(o)==="providers-models"&&P(Re)})}var at=b(Te,2);{var Jn=P=>{var U=SE(),V=ct(U),K=b(A(V),2),Ue=b(A(K),2),re=A(Ue);Ps(re,{onchange:T,get checked(){return y(c).expandNestedRefs},set checked(ve){y(c).expandNestedRefs=ve}});var et=b(K,2),Ht=b(A(et),2),Js=A(Ht);Ps(Js,{onchange:T,get checked(){return y(c).warnOnContextTrim},set checked(ve){y(c).warnOnContextTrim=ve}});var ms=b(V,2),Ws=b(A(ms),4);fw(Ws,{get value(){return y(c).quickActions},onChange:async ve=>{I(Ce=>{Ce.quickActions=ve}),await T()}});var gs=b(ms,2),zs=b(A(gs),4);pw(zs,{get value(){return y(c).nodeSize},onChange:async ve=>{I(Ce=>{Ce.nodeSize=ve}),await T()}});var Gi=b(zs,2),ln=A(Gi),Vi=b(A(ln),2),Tn=A(Vi),ys=b(A(Tn),2);ys.__input=ve=>{const Ce=Number.parseInt(ve.currentTarget.value,10);Number.isNaN(Ce)||I(mt=>{mt.nodeSize.userWidth=Ce})};var jr=b(Tn,2),Hi=b(A(jr),2);Hi.__input=ve=>{const Ce=Number.parseInt(ve.currentTarget.value,10);Number.isNaN(Ce)||I(mt=>{mt.nodeSize.userHeight=Ce})};var Oa=b(ln,2),He=b(A(Oa),2),Q=A(He),Ot=b(A(Q),2);Ot.__input=ve=>{const Ce=Number.parseInt(ve.currentTarget.value,10);Number.isNaN(Ce)||I(mt=>{mt.nodeSize.assistantWidth=Ce})};var Cn=b(Q,2),Rt=b(A(Cn),2);Rt.__input=ve=>{const Ce=Number.parseInt(ve.currentTarget.value,10);Number.isNaN(Ce)||I(mt=>{mt.nodeSize.assistantHeight=Ce})},j(()=>{kt(ys,y(c).nodeSize.userWidth),kt(Hi,y(c).nodeSize.userHeight),kt(Ot,y(c).nodeSize.assistantWidth),kt(Rt,y(c).nodeSize.assistantHeight)}),Yn("blur",ys,S),Yn("blur",Hi,S),Yn("blur",Ot,S),Yn("blur",Rt,S),D(P,U)};z(at,P=>{y(o)==="behavior"&&P(Jn)})}var Sn=b(at,2);{var je=P=>{var U=CE(),V=A(U),K=b(A(V),2),Ue=A(K);Ps(Ue,{onchange:T,get checked(){return y(c).debugLog.enabled},set checked(Ht){y(c).debugLog.enabled=Ht}});var re=b(V,2);{var et=Ht=>{var Js=TE(),ms=ct(Js),Ws=b(A(ms),2),gs=A(Ws);gs.__input=Tn=>I(ys=>ys.debugLog.limit=Number.parseInt(Tn.currentTarget.value,10)||0);var zs=b(ms,2),Gi=b(A(zs),2),ln=A(Gi);ln.__click=async()=>{const Tn=e.plugin?.debugLogger?.getEntries()??[];new Pe.Notice(Tn.length===0?"ÊöÇÊó†Êó•Âøó":Tn.join(`
`),5e3)};var Vi=b(ln,2);Vi.__click=async()=>{await e.plugin?.debugLogger?.clear(),new Pe.Notice("Êó•ÂøóÂ∑≤Ê∏ÖÁ©∫")},j(()=>kt(gs,y(c).debugLog.limit)),Yn("blur",gs,S),D(Ht,Js)};z(re,Ht=>{y(c).debugLog.enabled&&Ht(et)})}D(P,U)};z(Sn,P=>{y(o)==="debug"&&P(je)})}var Gt=b(Sn,2);{var on=P=>{var U=bE(),V=b(A(U),2);Ct(V,21,()=>y(f),Ls,(K,Ue,re)=>{var et=AE(),Ht=A(et);j(()=>_e(Ht,`${re+1}. ${y(Ue)??""}`)),D(K,et)}),D(P,U)};z(Gt,P=>{y(f).length>0&&P(on)})}var Wn=b(ce,2);{var ps=P=>{kw(P,{get model(){return y(v)},get providers(){return y(c).providers},get isNew(){return y(w)},onSave:fe,onDelete:ae,onClose:Se})};z(Wn,P=>{y(m)&&y(v)&&P(ps)})}var Vt=b(Wn,2);{var an=P=>{{let U=Kt(()=>y(c).providers.map(V=>V.id));Kw(P,{get existingProviderIds(){return y(U)},onSave:Ze,onClose:()=>J(g,!1)})}};z(Vt,P=>{y(g)&&P(an)})}j(()=>{fn(rt,1,`tab ${y(o)==="providers-models"?"active":""}`,"svelte-1y8kcgz"),fn(he,1,`tab ${y(o)==="behavior"?"active":""}`,"svelte-1y8kcgz"),fn(Ie,1,`tab ${y(o)==="debug"?"active":""}`,"svelte-1y8kcgz")}),D(n,On),cs()}Hs(["click","change","input"]);class PE extends Pe.PluginSettingTab{get plugin(){return El.getPlugin()}constructor(){super(qr(),El.getPlugin())}display(){const{containerEl:e}=this;e.empty(),this.component&&(Kc(this.component),this.component=void 0),this.component=Cv(RE,{target:e,props:{initialSettings:this.plugin.settings,plugin:this.plugin,onChange:async t=>{this.plugin.settings=t,await this.plugin.saveSettings()}}})}hide(){this.component&&(Kc(this.component),this.component=void 0)}}class bt{constructor(e){this.provider=e}applyCustomModelParameters(e,t){const s=Array.isArray(e.customParameters)?e.customParameters:[];if(s.length===0)return t;const i={...t};for(const r of s){const o=typeof r?.key=="string"?r.key.trim():"";if(!o)continue;const l=typeof r?.value=="string"?r.value:"";i[o]=xE(l)}return i}}function xE(n){const e=n.trim();if(e.length===0)return n;try{return JSON.parse(e)}catch(t){return console.error(t),n}}class en extends Error{constructor(e,t){super(e),this.rawError=t,this.name="LLMAPIKeyNotSetException"}}class Nn extends Error{constructor(e,t){super(e),this.rawError=t,this.name="LLMAPIKeyInvalidException"}}class Nl extends Error{constructor(e,t){super(e),this.rawError=t,this.name="LLMBaseUrlNotSetException"}}class ME extends Error{constructor(e,t){super(e),this.rawError=t,this.name="LLMModelNotFoundException"}}class kE extends Error{constructor(e,t){super(e),this.rawError=t,this.name="LLMProviderNotFoundException"}}function $(n,e,t,s,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}function C(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)}let Tp=function(){const{crypto:n}=globalThis;if(n?.randomUUID)return Tp=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^t()&15>>+s/4).toString(16))};function Dr(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const Dl=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class Y extends Error{}let It=class Ll extends Y{constructor(e,t,s,i){super(`${Ll.makeMessage(e,t,s)}`),this.status=e,this.headers=i,this.requestID=i?.get("request-id"),this.error=t}static makeMessage(e,t,s){const i=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,s,i){if(!e||!i)return new Sa({message:s,cause:Dl(t)});const r=t;return e===400?new Ap(e,r,s,i):e===401?new bp(e,r,s,i):e===403?new Ip(e,r,s,i):e===404?new Rp(e,r,s,i):e===409?new Pp(e,r,s,i):e===422?new xp(e,r,s,i):e===429?new Mp(e,r,s,i):e>=500?new kp(e,r,s,i):new Ll(e,r,s,i)}},Yt=class extends It{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Sa=class extends It{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},Cp=class extends Sa{constructor({message:e}={}){super({message:e??"Request timed out."})}},Ap=class extends It{},bp=class extends It{},Ip=class extends It{},Rp=class extends It{},Pp=class extends It{},xp=class extends It{},Mp=class extends It{},kp=class extends It{};const NE=/^[a-z][a-z0-9+.-]*:/i,DE=n=>NE.test(n);let Ul=n=>(Ul=Array.isArray,Ul(n)),od=Ul;function Fl(n){return typeof n!="object"?{}:n??{}}function LE(n){if(!n)return!0;for(const e in n)return!1;return!0}function UE(n,e){return Object.prototype.hasOwnProperty.call(n,e)}const FE=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Y(`${n} must be an integer`);if(e<0)throw new Y(`${n} must be a positive integer`);return e},Np=n=>{try{return JSON.parse(n)}catch{return}},$E=n=>new Promise(e=>setTimeout(e,n)),ai="0.71.2",qE=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function BE(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const GE=()=>{const n=BE();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ai,"X-Stainless-OS":ld(Deno.build.os),"X-Stainless-Arch":ad(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ai,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ai,"X-Stainless-OS":ld(globalThis.process.platform??"unknown"),"X-Stainless-Arch":ad(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=VE();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ai,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ai,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function VE(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const i=s[1]||0,r=s[2]||0,o=s[3]||0;return{browser:e,version:`${i}.${r}.${o}`}}}return null}const ad=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",ld=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let ud;const HE=()=>ud??(ud=GE());function OE(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function Dp(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function Lp(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return Dp({start(){},async pull(t){const{done:s,value:i}=await e.next();s?t.close():t.enqueue(i)},async cancel(){await e.return?.()}})}function ku(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function JE(n){if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await n[Symbol.asyncIterator]().return?.();return}const e=n.getReader(),t=e.cancel();e.releaseLock(),await t}const WE=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function zE(n){let e=0;for(const i of n)e+=i.length;const t=new Uint8Array(e);let s=0;for(const i of n)t.set(i,s),s+=i.length;return t}let cd;function Nu(n){let e;return(cd??(e=new globalThis.TextEncoder,cd=e.encode.bind(e)))(n)}let dd;function fd(n){let e;return(dd??(e=new globalThis.TextDecoder,dd=e.decode.bind(e)))(n)}var _t,vt;let Hr=class{constructor(){_t.set(this,void 0),vt.set(this,void 0),$(this,_t,new Uint8Array),$(this,vt,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Nu(e):e;$(this,_t,zE([C(this,_t,"f"),t]));const s=[];let i;for(;(i=KE(C(this,_t,"f"),C(this,vt,"f")))!=null;){if(i.carriage&&C(this,vt,"f")==null){$(this,vt,i.index);continue}if(C(this,vt,"f")!=null&&(i.index!==C(this,vt,"f")+1||i.carriage)){s.push(fd(C(this,_t,"f").subarray(0,C(this,vt,"f")-1))),$(this,_t,C(this,_t,"f").subarray(C(this,vt,"f"))),$(this,vt,null);continue}const r=C(this,vt,"f")!==null?i.preceding-1:i.preceding,o=fd(C(this,_t,"f").subarray(0,r));s.push(o),$(this,_t,C(this,_t,"f").subarray(i.index)),$(this,vt,null)}return s}flush(){return C(this,_t,"f").length?this.decode(`
`):[]}};_t=new WeakMap,vt=new WeakMap;Hr.NEWLINE_CHARS=new Set([`
`,"\r"]);Hr.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function KE(n,e){for(let i=e??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function YE(n){for(let s=0;s<n.length-1;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}const ta={off:0,error:200,warn:300,info:400,debug:500},hd=(n,e,t)=>{if(n){if(UE(ta,n))return n;tt(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(ta))}`)}};function hr(){}function oo(n,e,t){return!e||ta[n]>ta[t]?hr:e[n].bind(e)}const XE={error:hr,warn:hr,info:hr,debug:hr};let pd=new WeakMap;function tt(n){const e=n.logger,t=n.logLevel??"off";if(!e)return XE;const s=pd.get(e);if(s&&s[0]===t)return s[1];const i={error:oo("error",e,t),warn:oo("warn",e,t),info:oo("info",e,t),debug:oo("debug",e,t)};return pd.set(e,[t,i]),i}const Ts=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);var zi;let Lr=class pr{constructor(e,t,s){this.iterator=e,zi.set(this,void 0),this.controller=t,$(this,zi,s)}static fromSSEResponse(e,t,s){let i=!1;const r=s?tt(s):console;async function*o(){if(i)throw new Y("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let l=!1;try{for await(const d of QE(e,t)){if(d.event==="completion")try{yield JSON.parse(d.data)}catch(c){throw r.error("Could not parse message into JSON:",d.data),r.error("From chunk:",d.raw),c}if(d.event==="message_start"||d.event==="message_delta"||d.event==="message_stop"||d.event==="content_block_start"||d.event==="content_block_delta"||d.event==="content_block_stop")try{yield JSON.parse(d.data)}catch(c){throw r.error("Could not parse message into JSON:",d.data),r.error("From chunk:",d.raw),c}if(d.event!=="ping"&&d.event==="error")throw new It(void 0,Np(d.data)??d.data,void 0,e.headers)}l=!0}catch(d){if(Dr(d))return;throw d}finally{l||t.abort()}}return new pr(o,t,s)}static fromReadableStream(e,t,s){let i=!1;async function*r(){const l=new Hr,d=ku(e);for await(const c of d)for(const f of l.decode(c))yield f;for(const c of l.flush())yield c}async function*o(){if(i)throw new Y("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let l=!1;try{for await(const d of r())l||d&&(yield JSON.parse(d));l=!0}catch(d){if(Dr(d))return;throw d}finally{l||t.abort()}}return new pr(o,t,s)}[(zi=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),i=r=>({next:()=>{if(r.length===0){const o=s.next();e.push(o),t.push(o)}return r.shift()}});return[new pr(()=>i(e),this.controller,C(this,zi,"f")),new pr(()=>i(t),this.controller,C(this,zi,"f"))]}toReadableStream(){const e=this;let t;return Dp({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:r}=await t.next();if(r)return s.close();const o=Nu(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){await t.return?.()}})}};async function*QE(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Y("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Y("Attempted to iterate over a response with no body");const t=new jE,s=new Hr,i=ku(n.body);for await(const r of ZE(i))for(const o of s.decode(r)){const l=t.decode(o);l&&(yield l)}for(const r of s.flush()){const o=t.decode(r);o&&(yield o)}}async function*ZE(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?Nu(t):t;let i=new Uint8Array(e.length+s.length);i.set(e),i.set(s,e.length),e=i;let r;for(;(r=YE(e))!==-1;)yield e.slice(0,r),e=e.slice(r)}e.length>0&&(yield e)}let jE=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,i]=eS(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}};function eS(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function Up(n,e){const{response:t,requestLogID:s,retryOfRequestLogID:i,startTime:r}=e,o=await(async()=>{if(e.options.stream)return tt(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):Lr.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const d=t.headers.get("content-type")?.split(";")[0]?.trim();if(d?.includes("application/json")||d?.endsWith("+json")){const p=await t.json();return Fp(p,t)}return await t.text()})();return tt(n).debug(`[${s}] response parsed`,Ts({retryOfRequestLogID:i,url:t.url,status:t.status,body:o,durationMs:Date.now()-r})),o}function Fp(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var mr;let $p=class qp extends Promise{constructor(e,t,s=Up){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=s,mr.set(this,void 0),$(this,mr,e)}_thenUnwrap(e){return new qp(C(this,mr,"f"),this.responsePromise,async(t,s)=>Fp(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(C(this,mr,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};mr=new WeakMap;var ao;let Bp=class{constructor(e,t,s,i){ao.set(this,void 0),$(this,ao,e),this.options=i,this.response=t,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new Y("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await C(this,ao,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(ao=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},tS=class extends $p{constructor(e,t,s){super(e,t,async(i,r)=>new s(i,r.response,await Up(i,r),r.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}},Or=class extends Bp{constructor(e,t,s,i){super(e,t,s,i),this.data=s.data||[],this.has_more=s.has_more||!1,this.first_id=s.first_id||null,this.last_id=s.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){if(this.options.query?.before_id){const t=this.first_id;return t?{...this.options,query:{...Fl(this.options.query),before_id:t}}:null}const e=this.last_id;return e?{...this.options,query:{...Fl(this.options.query),after_id:e}}:null}};class Gp extends Bp{constructor(e,t,s,i){super(e,t,s,i),this.data=s.data||[],this.has_more=s.has_more||!1,this.next_page=s.next_page||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){const e=this.next_page;return e?{...this.options,query:{...Fl(this.options.query),page:e}}:null}}const Vp=()=>{if(typeof File>"u"){const{process:n}=globalThis,e=typeof n?.versions?.node=="string"&&parseInt(n.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function vi(n,e,t){return Vp(),new File(n,e??"unknown_file",t)}function $o(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const Hp=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Du=async(n,e)=>({...n,body:await sS(n.body,e)}),md=new WeakMap;function nS(n){const e=typeof n=="function"?n:n.fetch,t=md.get(e);if(t)return t;const s=(async()=>{try{const i="Response"in e?e.Response:(await e("data:,")).constructor,r=new FormData;return r.toString()!==await new i(r).text()}catch{return!0}})();return md.set(e,s),s}const sS=async(n,e)=>{if(!await nS(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(n||{}).map(([s,i])=>$l(t,s,i))),t},iS=n=>n instanceof Blob&&"name"in n,$l=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response){let s={};const i=t.headers.get("Content-Type");i&&(s={type:i}),n.append(e,vi([await t.blob()],$o(t),s))}else if(Hp(t))n.append(e,vi([await new Response(Lp(t)).blob()],$o(t)));else if(iS(t))n.append(e,vi([t],$o(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(s=>$l(n,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,i])=>$l(n,`${e}[${s}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},Op=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",rS=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Op(n),oS=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function aS(n,e,t){if(Vp(),n=await n,e||(e=$o(n)),rS(n))return n instanceof File&&e==null&&t==null?n:vi([await n.arrayBuffer()],e??n.name,{type:n.type,lastModified:n.lastModified,...t});if(oS(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),vi(await ql(i),e,t)}const s=await ql(n);if(!t?.type){const i=s.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof i=="string"&&(t={...t,type:i})}return vi(s,e,t)}async function ql(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Op(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(Hp(n))for await(const t of n)e.push(...await ql(t));else{const t=n?.constructor?.name;throw new Error(`Unexpected data type: ${typeof n}${t?`; constructor: ${t}`:""}${lS(n)}`)}return e}function lS(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}let tn=class{constructor(e){this._client=e}};const Jp=Symbol.for("brand.privateNullableHeaders");function*uS(n){if(!n)return;if(Jp in n){const{values:s,nulls:i}=n;yield*s.entries();for(const r of i)yield[r,null];return}let e=!1,t;n instanceof Headers?t=n.entries():od(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let s of t){const i=s[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const r=od(s[1])?s[1]:[s[1]];let o=!1;for(const l of r)l!==void 0&&(e&&!o&&(o=!0,yield[i,null]),yield[i,l])}}const ee=n=>{const e=new Headers,t=new Set;for(const s of n){const i=new Set;for(const[r,o]of uS(s)){const l=r.toLowerCase();i.has(l)||(e.delete(r),i.add(l)),o===null?(e.delete(r),t.add(l)):(e.append(r,o),t.delete(l))}}return{[Jp]:!0,values:e,nulls:t}};function Wp(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const gd=Object.freeze(Object.create(null)),cS=(n=Wp)=>function(t,...s){if(t.length===1)return t[0];let i=!1;const r=[],o=t.reduce((f,p,h)=>{/[?#]/.test(p)&&(i=!0);const m=s[h];let g=(i?encodeURIComponent:n)(""+m);return h!==s.length&&(m==null||typeof m=="object"&&m.toString===Object.getPrototypeOf(Object.getPrototypeOf(m.hasOwnProperty??gd)??gd)?.toString)&&(g=m+"",r.push({start:f.length+p.length,length:g.length,error:`Value of type ${Object.prototype.toString.call(m).slice(8,-1)} is not a valid path parameter`})),f+p+(h===s.length?"":g)},""),l=o.split(/[?#]/,1)[0],d=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=d.exec(l))!==null;)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((f,p)=>f.start-p.start),r.length>0){let f=0;const p=r.reduce((h,m)=>{const g=" ".repeat(m.start-f),v="^".repeat(m.length);return f=m.start+m.length,h+g+v},"");throw new Y(`Path parameters result in path with invalid segments:
${r.map(h=>h.error).join(`
`)}
${o}
${p}`)}return o},Ge=cS(Wp);let zp=class extends tn{list(e={},t){const{betas:s,...i}=e??{};return this._client.getAPIList("/v1/files",Or,{query:i,...t,headers:ee([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])})}delete(e,t={},s){const{betas:i}=t??{};return this._client.delete(Ge`/v1/files/${e}`,{...s,headers:ee([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString()},s?.headers])})}download(e,t={},s){const{betas:i}=t??{};return this._client.get(Ge`/v1/files/${e}/content`,{...s,headers:ee([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},s){const{betas:i}=t??{};return this._client.get(Ge`/v1/files/${e}`,{...s,headers:ee([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString()},s?.headers])})}upload(e,t){const{betas:s,...i}=e;return this._client.post("/v1/files",Du({body:i,...t,headers:ee([{"anthropic-beta":[...s??[],"files-api-2025-04-14"].toString()},t?.headers])},this._client))}},Kp=class extends tn{retrieve(e,t={},s){const{betas:i}=t??{};return this._client.get(Ge`/v1/models/${e}?beta=true`,{...s,headers:ee([{...i?.toString()!=null?{"anthropic-beta":i?.toString()}:void 0},s?.headers])})}list(e={},t){const{betas:s,...i}=e??{};return this._client.getAPIList("/v1/models?beta=true",Or,{query:i,...t,headers:ee([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}};const Yp={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192,"claude-opus-4-1-20250805":8192,"anthropic.claude-opus-4-1-20250805-v1:0":8192,"claude-opus-4-1@20250805":8192};function yd(n,e,t){return!e||!("parse"in(e.output_format??{}))?{...n,content:n.content.map(s=>{if(s.type==="text"){const i=Object.defineProperty({...s},"parsed_output",{value:null,enumerable:!1});return Object.defineProperty(i,"parsed",{get(){return t.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),null},enumerable:!1})}return s}),parsed_output:null}:Xp(n,e,t)}function Xp(n,e,t){let s=null;const i=n.content.map(r=>{if(r.type==="text"){const o=dS(e,r.text);s===null&&(s=o);const l=Object.defineProperty({...r},"parsed_output",{value:o,enumerable:!1});return Object.defineProperty(l,"parsed",{get(){return t.logger.warn("The `parsed` property on `text` blocks is deprecated, please use `parsed_output` instead."),o},enumerable:!1})}return r});return{...n,content:i,parsed_output:s}}function dS(n,e){if(n.output_format?.type!=="json_schema")return null;try{return"parse"in n.output_format?n.output_format.parse(e):JSON.parse(e)}catch(t){throw new Y(`Failed to parse structured output: ${t}`)}}const fS=n=>{let e=0,t=[];for(;e<n.length;){let s=n[e];if(s==="\\"){e++;continue}if(s==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(s==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(s==="["){t.push({type:"paren",value:"["}),e++;continue}if(s==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(s===":"){t.push({type:"separator",value:":"}),e++;continue}if(s===","){t.push({type:"delimiter",value:","}),e++;continue}if(s==='"'){let l="",d=!1;for(s=n[++e];s!=='"';){if(e===n.length){d=!0;break}if(s==="\\"){if(e++,e===n.length){d=!0;break}l+=s+n[e],s=n[++e]}else l+=s,s=n[++e]}s=n[++e],d||t.push({type:"string",value:l});continue}if(s&&/\s/.test(s)){e++;continue}let r=/[0-9]/;if(s&&r.test(s)||s==="-"||s==="."){let l="";for(s==="-"&&(l+=s,s=n[++e]);s&&r.test(s)||s===".";)l+=s,s=n[++e];t.push({type:"number",value:l});continue}let o=/[a-z]/i;if(s&&o.test(s)){let l="";for(;s&&o.test(s)&&e!==n.length;)l+=s,s=n[++e];if(l=="true"||l=="false"||l==="null")t.push({type:"name",value:l});else{e++;continue}continue}e++}return t},li=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),li(n);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),li(n);case"string":let s=n[n.length-2];if(s?.type==="delimiter")return n=n.slice(0,n.length-1),li(n);if(s?.type==="brace"&&s.value==="{")return n=n.slice(0,n.length-1),li(n);break;case"delimiter":return n=n.slice(0,n.length-1),li(n)}return n},hS=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},pS=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},Qp=n=>JSON.parse(pS(hS(li(fS(n)))));var Pt,Qn,ti,Ki,lo,Yi,Xi,uo,Qi,bn,Zi,co,fo,vs,ho,po,ji,ja,_d,mo,el,tl,nl,vd;const wd="__json_buf";function Ed(n){return n.type==="tool_use"||n.type==="server_tool_use"||n.type==="mcp_tool_use"}class na{constructor(e,t){Pt.add(this),this.messages=[],this.receivedMessages=[],Qn.set(this,void 0),ti.set(this,null),this.controller=new AbortController,Ki.set(this,void 0),lo.set(this,()=>{}),Yi.set(this,()=>{}),Xi.set(this,void 0),uo.set(this,()=>{}),Qi.set(this,()=>{}),bn.set(this,{}),Zi.set(this,!1),co.set(this,!1),fo.set(this,!1),vs.set(this,!1),ho.set(this,void 0),po.set(this,void 0),ji.set(this,void 0),mo.set(this,s=>{if($(this,co,!0),Dr(s)&&(s=new Yt),s instanceof Yt)return $(this,fo,!0),this._emit("abort",s);if(s instanceof Y)return this._emit("error",s);if(s instanceof Error){const i=new Y(s.message);return i.cause=s,this._emit("error",i)}return this._emit("error",new Y(String(s)))}),$(this,Ki,new Promise((s,i)=>{$(this,lo,s,"f"),$(this,Yi,i,"f")})),$(this,Xi,new Promise((s,i)=>{$(this,uo,s,"f"),$(this,Qi,i,"f")})),C(this,Ki,"f").catch(()=>{}),C(this,Xi,"f").catch(()=>{}),$(this,ti,e),$(this,ji,t?.logger??console)}get response(){return C(this,ho,"f")}get request_id(){return C(this,po,"f")}async withResponse(){$(this,vs,!0);const e=await C(this,Ki,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new na(null);return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s,{logger:i}={}){const r=new na(t,{logger:i});for(const o of t.messages)r._addMessageParam(o);return $(r,ti,{...t,stream:!0}),r._run(()=>r._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),r}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},C(this,mo,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){const i=s?.signal;let r;i&&(i.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),i.addEventListener("abort",r));try{C(this,Pt,"m",el).call(this);const{response:o,data:l}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();this._connected(o);for await(const d of l)C(this,Pt,"m",tl).call(this,d);if(l.controller.signal?.aborted)throw new Yt;C(this,Pt,"m",nl).call(this)}finally{i&&r&&i.removeEventListener("abort",r)}}_connected(e){this.ended||($(this,ho,e),$(this,po,e?.headers.get("request-id")),C(this,lo,"f").call(this,e),this._emit("connect"))}get ended(){return C(this,Zi,"f")}get errored(){return C(this,co,"f")}get aborted(){return C(this,fo,"f")}abort(){this.controller.abort()}on(e,t){return(C(this,bn,"f")[e]||(C(this,bn,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=C(this,bn,"f")[e];if(!s)return this;const i=s.findIndex(r=>r.listener===t);return i>=0&&s.splice(i,1),this}once(e,t){return(C(this,bn,"f")[e]||(C(this,bn,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{$(this,vs,!0),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){$(this,vs,!0),await C(this,Xi,"f")}get currentMessage(){return C(this,Qn,"f")}async finalMessage(){return await this.done(),C(this,Pt,"m",ja).call(this)}async finalText(){return await this.done(),C(this,Pt,"m",_d).call(this)}_emit(e,...t){if(C(this,Zi,"f"))return;e==="end"&&($(this,Zi,!0),C(this,uo,"f").call(this));const s=C(this,bn,"f")[e];if(s&&(C(this,bn,"f")[e]=s.filter(i=>!i.once),s.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!C(this,vs,"f")&&!s?.length&&Promise.reject(i),C(this,Yi,"f").call(this,i),C(this,Qi,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!C(this,vs,"f")&&!s?.length&&Promise.reject(i),C(this,Yi,"f").call(this,i),C(this,Qi,"f").call(this,i),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",C(this,Pt,"m",ja).call(this))}async _fromReadableStream(e,t){const s=t?.signal;let i;s&&(s.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),s.addEventListener("abort",i));try{C(this,Pt,"m",el).call(this),this._connected(null);const r=Lr.fromReadableStream(e,this.controller);for await(const o of r)C(this,Pt,"m",tl).call(this,o);if(r.controller.signal?.aborted)throw new Yt;C(this,Pt,"m",nl).call(this)}finally{s&&i&&s.removeEventListener("abort",i)}}[(Qn=new WeakMap,ti=new WeakMap,Ki=new WeakMap,lo=new WeakMap,Yi=new WeakMap,Xi=new WeakMap,uo=new WeakMap,Qi=new WeakMap,bn=new WeakMap,Zi=new WeakMap,co=new WeakMap,fo=new WeakMap,vs=new WeakMap,ho=new WeakMap,po=new WeakMap,ji=new WeakMap,mo=new WeakMap,Pt=new WeakSet,ja=function(){if(this.receivedMessages.length===0)throw new Y("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},_d=function(){if(this.receivedMessages.length===0)throw new Y("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(s=>s.type==="text").map(s=>s.text);if(t.length===0)throw new Y("stream ended without producing a content block with type=text");return t.join(" ")},el=function(){this.ended||$(this,Qn,void 0)},tl=function(t){if(this.ended)return;const s=C(this,Pt,"m",vd).call(this,t);switch(this._emit("streamEvent",t,s),t.type){case"content_block_delta":{const i=s.content.at(-1);switch(t.delta.type){case"text_delta":{i.type==="text"&&this._emit("text",t.delta.text,i.text||"");break}case"citations_delta":{i.type==="text"&&this._emit("citation",t.delta.citation,i.citations??[]);break}case"input_json_delta":{Ed(i)&&i.input&&this._emit("inputJson",t.delta.partial_json,i.input);break}case"thinking_delta":{i.type==="thinking"&&this._emit("thinking",t.delta.thinking,i.thinking);break}case"signature_delta":{i.type==="thinking"&&this._emit("signature",i.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(s),this._addMessage(yd(s,C(this,ti,"f"),{logger:C(this,ji,"f")}),!0);break}case"content_block_stop":{this._emit("contentBlock",s.content.at(-1));break}case"message_start":{$(this,Qn,s);break}}},nl=function(){if(this.ended)throw new Y("stream has ended, this shouldn't happen");const t=C(this,Qn,"f");if(!t)throw new Y("request ended without sending any chunks");return $(this,Qn,void 0),yd(t,C(this,ti,"f"),{logger:C(this,ji,"f")})},vd=function(t){let s=C(this,Qn,"f");if(t.type==="message_start"){if(s)throw new Y(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!s)throw new Y(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return s;case"message_delta":return s.container=t.delta.container,s.stop_reason=t.delta.stop_reason,s.stop_sequence=t.delta.stop_sequence,s.usage.output_tokens=t.usage.output_tokens,s.context_management=t.context_management,t.usage.input_tokens!=null&&(s.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(s.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(s.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(s.usage.server_tool_use=t.usage.server_tool_use),s;case"content_block_start":return s.content.push(t.content_block),s;case"content_block_delta":{const i=s.content.at(t.index);switch(t.delta.type){case"text_delta":{i?.type==="text"&&(s.content[t.index]={...i,text:(i.text||"")+t.delta.text});break}case"citations_delta":{i?.type==="text"&&(s.content[t.index]={...i,citations:[...i.citations??[],t.delta.citation]});break}case"input_json_delta":{if(i&&Ed(i)){let r=i[wd]||"";r+=t.delta.partial_json;const o={...i};if(Object.defineProperty(o,wd,{value:r,enumerable:!1,writable:!0}),r)try{o.input=Qp(r)}catch(l){const d=new Y(`Unable to parse tool parameter JSON from model. Please retry your request or adjust your prompt. Error: ${l}. JSON: ${r}`);C(this,mo,"f").call(this,d)}s.content[t.index]=o}break}case"thinking_delta":{i?.type==="thinking"&&(s.content[t.index]={...i,thinking:i.thinking+t.delta.thinking});break}case"signature_delta":{i?.type==="thinking"&&(s.content[t.index]={...i,signature:t.delta.signature});break}default:t.delta}return s}case"content_block_stop":return s}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",i=>{const r=t.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),this.on("error",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,o)=>t.push({resolve:r,reject:o})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Lr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const mS=1e5,gS=`You have been working on the task described above but have not yet completed it. Write a continuation summary that will allow you (or another instance of yourself) to resume work efficiently in a future context window where the conversation history will be replaced with this summary. Your summary should be structured, concise, and actionable. Include:
1. Task Overview
The user's core request and success criteria
Any clarifications or constraints they specified
2. Current State
What has been completed so far
Files created, modified, or analyzed (with paths if relevant)
Key outputs or artifacts produced
3. Important Discoveries
Technical constraints or requirements uncovered
Decisions made and their rationale
Errors encountered and how they were resolved
What approaches were tried that didn't work (and why)
4. Next Steps
Specific actions needed to complete the task
Any blockers or open questions to resolve
Priority order if multiple steps remain
5. Context to Preserve
User preferences or style requirements
Domain-specific details that aren't obvious
Any promises made to the user
Be concise but complete‚Äîerr on the side of including information that would prevent duplicate work or repeated mistakes. Write in a way that enables immediate resumption of the task.
Wrap your summary in <summary></summary> tags.`;var er,ni,ws,Ne,tr,gt,Mn,Zn,nr,Sd,Bl;function Td(){let n,e;return{promise:new Promise((s,i)=>{n=s,e=i}),resolve:n,reject:e}}class Zp{constructor(e,t,s){er.add(this),this.client=e,ni.set(this,!1),ws.set(this,!1),Ne.set(this,void 0),tr.set(this,void 0),gt.set(this,void 0),Mn.set(this,void 0),Zn.set(this,void 0),nr.set(this,0),$(this,Ne,{params:{...t,messages:structuredClone(t.messages)}}),$(this,tr,{...s,headers:ee([{"x-stainless-helper":"BetaToolRunner"},s?.headers])}),$(this,Zn,Td())}async*[(ni=new WeakMap,ws=new WeakMap,Ne=new WeakMap,tr=new WeakMap,gt=new WeakMap,Mn=new WeakMap,Zn=new WeakMap,nr=new WeakMap,er=new WeakSet,Sd=async function(){const t=C(this,Ne,"f").params.compactionControl;if(!t||!t.enabled)return!1;let s=0;if(C(this,gt,"f")!==void 0)try{const c=await C(this,gt,"f");s=c.usage.input_tokens+(c.usage.cache_creation_input_tokens??0)+(c.usage.cache_read_input_tokens??0)+c.usage.output_tokens}catch{return!1}const i=t.contextTokenThreshold??mS;if(s<i)return!1;const r=t.model??C(this,Ne,"f").params.model,o=t.summaryPrompt??gS,l=C(this,Ne,"f").params.messages;if(l[l.length-1].role==="assistant"){const c=l[l.length-1];if(Array.isArray(c.content)){const f=c.content.filter(p=>p.type!=="tool_use");f.length===0?l.pop():c.content=f}}const d=await this.client.beta.messages.create({model:r,messages:[...l,{role:"user",content:[{type:"text",text:o}]}],max_tokens:C(this,Ne,"f").params.max_tokens},{headers:{"x-stainless-helper":"compaction"}});if(d.content[0]?.type!=="text")throw new Y("Expected text response for compaction");return C(this,Ne,"f").params.messages=[{role:"user",content:d.content}],!0},Symbol.asyncIterator)](){var e;if(C(this,ni,"f"))throw new Y("Cannot iterate over a consumed stream");$(this,ni,!0),$(this,ws,!0),$(this,Mn,void 0);try{for(;;){let t;try{if(C(this,Ne,"f").params.max_iterations&&C(this,nr,"f")>=C(this,Ne,"f").params.max_iterations)break;$(this,ws,!1,"f"),$(this,Mn,void 0,"f"),$(this,nr,(e=C(this,nr,"f"),e++,e),"f"),$(this,gt,void 0,"f");const{max_iterations:s,compactionControl:i,...r}=C(this,Ne,"f").params;if(r.stream?(t=this.client.beta.messages.stream({...r},C(this,tr,"f")),$(this,gt,t.finalMessage(),"f"),C(this,gt,"f").catch(()=>{}),yield t):($(this,gt,this.client.beta.messages.create({...r,stream:!1},C(this,tr,"f")),"f"),yield C(this,gt,"f")),!await C(this,er,"m",Sd).call(this)){if(!C(this,ws,"f")){const{role:d,content:c}=await C(this,gt,"f");C(this,Ne,"f").params.messages.push({role:d,content:c})}const l=await C(this,er,"m",Bl).call(this,C(this,Ne,"f").params.messages.at(-1));if(l)C(this,Ne,"f").params.messages.push(l);else if(!C(this,ws,"f"))break}}finally{t&&t.abort()}}if(!C(this,gt,"f"))throw new Y("ToolRunner concluded without a message from the server");C(this,Zn,"f").resolve(await C(this,gt,"f"))}catch(t){throw $(this,ni,!1),C(this,Zn,"f").promise.catch(()=>{}),C(this,Zn,"f").reject(t),$(this,Zn,Td()),t}}setMessagesParams(e){typeof e=="function"?C(this,Ne,"f").params=e(C(this,Ne,"f").params):C(this,Ne,"f").params=e,$(this,ws,!0),$(this,Mn,void 0)}async generateToolResponse(){const e=await C(this,gt,"f")??this.params.messages.at(-1);return e?C(this,er,"m",Bl).call(this,e):null}done(){return C(this,Zn,"f").promise}async runUntilDone(){if(!C(this,ni,"f"))for await(const e of this);return this.done()}get params(){return C(this,Ne,"f").params}pushMessages(...e){this.setMessagesParams(t=>({...t,messages:[...t.messages,...e]}))}then(e,t){return this.runUntilDone().then(e,t)}}Bl=async function(e){return C(this,Mn,"f")!==void 0?C(this,Mn,"f"):($(this,Mn,yS(C(this,Ne,"f").params,e)),C(this,Mn,"f"))};async function yS(n,e=n.messages.at(-1)){if(!e||e.role!=="assistant"||!e.content||typeof e.content=="string")return null;const t=e.content.filter(i=>i.type==="tool_use");return t.length===0?null:{role:"user",content:await Promise.all(t.map(async i=>{const r=n.tools.find(o=>("name"in o?o.name:o.mcp_server_name)===i.name);if(!r||!("run"in r))return{type:"tool_result",tool_use_id:i.id,content:`Error: Tool '${i.name}' not found`,is_error:!0};try{let o=i.input;"parse"in r&&r.parse&&(o=r.parse(o));const l=await r.run(o);return{type:"tool_result",tool_use_id:i.id,content:l}}catch(o){return{type:"tool_result",tool_use_id:i.id,content:`Error: ${o instanceof Error?o.message:String(o)}`,is_error:!0}}}))}}class Ta{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new Hr;for await(const t of this.iterator)for(const s of e.decode(t))yield JSON.parse(s);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Y("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Y("Attempted to iterate over a response with no body");return new Ta(ku(e.body),t)}}let jp=class extends tn{create(e,t){const{betas:s,...i}=e;return this._client.post("/v1/messages/batches?beta=true",{body:i,...t,headers:ee([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}retrieve(e,t={},s){const{betas:i}=t??{};return this._client.get(Ge`/v1/messages/batches/${e}?beta=true`,{...s,headers:ee([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},s?.headers])})}list(e={},t){const{betas:s,...i}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",Or,{query:i,...t,headers:ee([{"anthropic-beta":[...s??[],"message-batches-2024-09-24"].toString()},t?.headers])})}delete(e,t={},s){const{betas:i}=t??{};return this._client.delete(Ge`/v1/messages/batches/${e}?beta=true`,{...s,headers:ee([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},s?.headers])})}cancel(e,t={},s){const{betas:i}=t??{};return this._client.post(Ge`/v1/messages/batches/${e}/cancel?beta=true`,{...s,headers:ee([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},s?.headers])})}async results(e,t={},s){const i=await this.retrieve(e);if(!i.results_url)throw new Y(`No batch \`results_url\`; Has it finished processing? ${i.processing_status} - ${i.id}`);const{betas:r}=t??{};return this._client.get(i.results_url,{...s,headers:ee([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},s?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((o,l)=>Ta.fromResponse(l.response,l.controller))}};const Cd={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};let Ca=class extends tn{constructor(){super(...arguments),this.batches=new jp(this._client)}create(e,t){const{betas:s,...i}=e;i.model in Cd&&console.warn(`The model '${i.model}' is deprecated and will reach end-of-life on ${Cd[i.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let r=this._client._options.timeout;if(!i.stream&&r==null){const o=Yp[i.model]??void 0;r=this._client.calculateNonstreamingTimeout(i.max_tokens,o)}return this._client.post("/v1/messages?beta=true",{body:i,timeout:r??6e5,...t,headers:ee([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}parse(e,t){return t={...t,headers:ee([{"anthropic-beta":[...e.betas??[],"structured-outputs-2025-11-13"].toString()},t?.headers])},this.create(e,t).then(s=>Xp(s,e,{logger:this._client.logger??console}))}stream(e,t){return na.createMessage(this,e,t)}countTokens(e,t){const{betas:s,...i}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:i,...t,headers:ee([{"anthropic-beta":[...s??[],"token-counting-2024-11-01"].toString()},t?.headers])})}toolRunner(e,t){return new Zp(this._client,e,t)}};Ca.Batches=jp;Ca.BetaToolRunner=Zp;class em extends tn{create(e,t={},s){const{betas:i,...r}=t??{};return this._client.post(Ge`/v1/skills/${e}/versions?beta=true`,Du({body:r,...s,headers:ee([{"anthropic-beta":[...i??[],"skills-2025-10-02"].toString()},s?.headers])},this._client))}retrieve(e,t,s){const{skill_id:i,betas:r}=t;return this._client.get(Ge`/v1/skills/${i}/versions/${e}?beta=true`,{...s,headers:ee([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e,t={},s){const{betas:i,...r}=t??{};return this._client.getAPIList(Ge`/v1/skills/${e}/versions?beta=true`,Gp,{query:r,...s,headers:ee([{"anthropic-beta":[...i??[],"skills-2025-10-02"].toString()},s?.headers])})}delete(e,t,s){const{skill_id:i,betas:r}=t;return this._client.delete(Ge`/v1/skills/${i}/versions/${e}?beta=true`,{...s,headers:ee([{"anthropic-beta":[...r??[],"skills-2025-10-02"].toString()},s?.headers])})}}class Lu extends tn{constructor(){super(...arguments),this.versions=new em(this._client)}create(e={},t){const{betas:s,...i}=e??{};return this._client.post("/v1/skills?beta=true",Du({body:i,...t,headers:ee([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])},this._client))}retrieve(e,t={},s){const{betas:i}=t??{};return this._client.get(Ge`/v1/skills/${e}?beta=true`,{...s,headers:ee([{"anthropic-beta":[...i??[],"skills-2025-10-02"].toString()},s?.headers])})}list(e={},t){const{betas:s,...i}=e??{};return this._client.getAPIList("/v1/skills?beta=true",Gp,{query:i,...t,headers:ee([{"anthropic-beta":[...s??[],"skills-2025-10-02"].toString()},t?.headers])})}delete(e,t={},s){const{betas:i}=t??{};return this._client.delete(Ge`/v1/skills/${e}?beta=true`,{...s,headers:ee([{"anthropic-beta":[...i??[],"skills-2025-10-02"].toString()},s?.headers])})}}Lu.Versions=em;let ki=class extends tn{constructor(){super(...arguments),this.models=new Kp(this._client),this.messages=new Ca(this._client),this.files=new zp(this._client),this.skills=new Lu(this._client)}};ki.Models=Kp;ki.Messages=Ca;ki.Files=zp;ki.Skills=Lu;let tm=class extends tn{create(e,t){const{betas:s,...i}=e;return this._client.post("/v1/complete",{body:i,timeout:this._client._options.timeout??6e5,...t,headers:ee([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers]),stream:e.stream??!1})}};var xt,jn,sr,go,ir,rr,yo,or,In,ar,_o,vo,Es,wo,Eo,sl,Ad,il,rl,ol,al,bd;const Id="__json_buf";function Rd(n){return n.type==="tool_use"||n.type==="server_tool_use"}class sa{constructor(){xt.add(this),this.messages=[],this.receivedMessages=[],jn.set(this,void 0),this.controller=new AbortController,sr.set(this,void 0),go.set(this,()=>{}),ir.set(this,()=>{}),rr.set(this,void 0),yo.set(this,()=>{}),or.set(this,()=>{}),In.set(this,{}),ar.set(this,!1),_o.set(this,!1),vo.set(this,!1),Es.set(this,!1),wo.set(this,void 0),Eo.set(this,void 0),il.set(this,e=>{if($(this,_o,!0),Dr(e)&&(e=new Yt),e instanceof Yt)return $(this,vo,!0),this._emit("abort",e);if(e instanceof Y)return this._emit("error",e);if(e instanceof Error){const t=new Y(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Y(String(e)))}),$(this,sr,new Promise((e,t)=>{$(this,go,e,"f"),$(this,ir,t,"f")})),$(this,rr,new Promise((e,t)=>{$(this,yo,e,"f"),$(this,or,t,"f")})),C(this,sr,"f").catch(()=>{}),C(this,rr,"f").catch(()=>{})}get response(){return C(this,wo,"f")}get request_id(){return C(this,Eo,"f")}async withResponse(){$(this,Es,!0);const e=await C(this,sr,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new sa;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,s){const i=new sa;for(const r of t.messages)i._addMessageParam(r);return i._run(()=>i._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},C(this,il,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){const i=s?.signal;let r;i&&(i.aborted&&this.controller.abort(),r=this.controller.abort.bind(this.controller),i.addEventListener("abort",r));try{C(this,xt,"m",rl).call(this);const{response:o,data:l}=await e.create({...t,stream:!0},{...s,signal:this.controller.signal}).withResponse();this._connected(o);for await(const d of l)C(this,xt,"m",ol).call(this,d);if(l.controller.signal?.aborted)throw new Yt;C(this,xt,"m",al).call(this)}finally{i&&r&&i.removeEventListener("abort",r)}}_connected(e){this.ended||($(this,wo,e),$(this,Eo,e?.headers.get("request-id")),C(this,go,"f").call(this,e),this._emit("connect"))}get ended(){return C(this,ar,"f")}get errored(){return C(this,_o,"f")}get aborted(){return C(this,vo,"f")}abort(){this.controller.abort()}on(e,t){return(C(this,In,"f")[e]||(C(this,In,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=C(this,In,"f")[e];if(!s)return this;const i=s.findIndex(r=>r.listener===t);return i>=0&&s.splice(i,1),this}once(e,t){return(C(this,In,"f")[e]||(C(this,In,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{$(this,Es,!0),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){$(this,Es,!0),await C(this,rr,"f")}get currentMessage(){return C(this,jn,"f")}async finalMessage(){return await this.done(),C(this,xt,"m",sl).call(this)}async finalText(){return await this.done(),C(this,xt,"m",Ad).call(this)}_emit(e,...t){if(C(this,ar,"f"))return;e==="end"&&($(this,ar,!0),C(this,yo,"f").call(this));const s=C(this,In,"f")[e];if(s&&(C(this,In,"f")[e]=s.filter(i=>!i.once),s.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!C(this,Es,"f")&&!s?.length&&Promise.reject(i),C(this,ir,"f").call(this,i),C(this,or,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!C(this,Es,"f")&&!s?.length&&Promise.reject(i),C(this,ir,"f").call(this,i),C(this,or,"f").call(this,i),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",C(this,xt,"m",sl).call(this))}async _fromReadableStream(e,t){const s=t?.signal;let i;s&&(s.aborted&&this.controller.abort(),i=this.controller.abort.bind(this.controller),s.addEventListener("abort",i));try{C(this,xt,"m",rl).call(this),this._connected(null);const r=Lr.fromReadableStream(e,this.controller);for await(const o of r)C(this,xt,"m",ol).call(this,o);if(r.controller.signal?.aborted)throw new Yt;C(this,xt,"m",al).call(this)}finally{s&&i&&s.removeEventListener("abort",i)}}[(jn=new WeakMap,sr=new WeakMap,go=new WeakMap,ir=new WeakMap,rr=new WeakMap,yo=new WeakMap,or=new WeakMap,In=new WeakMap,ar=new WeakMap,_o=new WeakMap,vo=new WeakMap,Es=new WeakMap,wo=new WeakMap,Eo=new WeakMap,il=new WeakMap,xt=new WeakSet,sl=function(){if(this.receivedMessages.length===0)throw new Y("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},Ad=function(){if(this.receivedMessages.length===0)throw new Y("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(s=>s.type==="text").map(s=>s.text);if(t.length===0)throw new Y("stream ended without producing a content block with type=text");return t.join(" ")},rl=function(){this.ended||$(this,jn,void 0)},ol=function(t){if(this.ended)return;const s=C(this,xt,"m",bd).call(this,t);switch(this._emit("streamEvent",t,s),t.type){case"content_block_delta":{const i=s.content.at(-1);switch(t.delta.type){case"text_delta":{i.type==="text"&&this._emit("text",t.delta.text,i.text||"");break}case"citations_delta":{i.type==="text"&&this._emit("citation",t.delta.citation,i.citations??[]);break}case"input_json_delta":{Rd(i)&&i.input&&this._emit("inputJson",t.delta.partial_json,i.input);break}case"thinking_delta":{i.type==="thinking"&&this._emit("thinking",t.delta.thinking,i.thinking);break}case"signature_delta":{i.type==="thinking"&&this._emit("signature",i.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(s),this._addMessage(s,!0);break}case"content_block_stop":{this._emit("contentBlock",s.content.at(-1));break}case"message_start":{$(this,jn,s);break}}},al=function(){if(this.ended)throw new Y("stream has ended, this shouldn't happen");const t=C(this,jn,"f");if(!t)throw new Y("request ended without sending any chunks");return $(this,jn,void 0),t},bd=function(t){let s=C(this,jn,"f");if(t.type==="message_start"){if(s)throw new Y(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!s)throw new Y(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return s;case"message_delta":return s.stop_reason=t.delta.stop_reason,s.stop_sequence=t.delta.stop_sequence,s.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(s.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(s.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(s.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(s.usage.server_tool_use=t.usage.server_tool_use),s;case"content_block_start":return s.content.push({...t.content_block}),s;case"content_block_delta":{const i=s.content.at(t.index);switch(t.delta.type){case"text_delta":{i?.type==="text"&&(s.content[t.index]={...i,text:(i.text||"")+t.delta.text});break}case"citations_delta":{i?.type==="text"&&(s.content[t.index]={...i,citations:[...i.citations??[],t.delta.citation]});break}case"input_json_delta":{if(i&&Rd(i)){let r=i[Id]||"";r+=t.delta.partial_json;const o={...i};Object.defineProperty(o,Id,{value:r,enumerable:!1,writable:!0}),r&&(o.input=Qp(r)),s.content[t.index]=o}break}case"thinking_delta":{i?.type==="thinking"&&(s.content[t.index]={...i,thinking:i.thinking+t.delta.thinking});break}case"signature_delta":{i?.type==="thinking"&&(s.content[t.index]={...i,signature:t.delta.signature});break}default:t.delta}return s}case"content_block_stop":return s}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",i=>{const r=t.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),this.on("error",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,o)=>t.push({resolve:r,reject:o})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Lr(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}let nm=class extends tn{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(Ge`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",Or,{query:e,...t})}delete(e,t){return this._client.delete(Ge`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(Ge`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const s=await this.retrieve(e);if(!s.results_url)throw new Y(`No batch \`results_url\`; Has it finished processing? ${s.processing_status} - ${s.id}`);return this._client.get(s.results_url,{...t,headers:ee([{Accept:"application/binary"},t?.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((i,r)=>Ta.fromResponse(r.response,r.controller))}},Uu=class extends tn{constructor(){super(...arguments),this.batches=new nm(this._client)}create(e,t){e.model in Pd&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Pd[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let s=this._client._options.timeout;if(!e.stream&&s==null){const i=Yp[e.model]??void 0;s=this._client.calculateNonstreamingTimeout(e.max_tokens,i)}return this._client.post("/v1/messages",{body:e,timeout:s??6e5,...t,stream:e.stream??!1})}stream(e,t){return sa.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}};const Pd={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-3-opus-20240229":"January 5th, 2026","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025","claude-3-7-sonnet-latest":"February 19th, 2026","claude-3-7-sonnet-20250219":"February 19th, 2026"};Uu.Batches=nm;let sm=class extends tn{retrieve(e,t={},s){const{betas:i}=t??{};return this._client.get(Ge`/v1/models/${e}`,{...s,headers:ee([{...i?.toString()!=null?{"anthropic-beta":i?.toString()}:void 0},s?.headers])})}list(e={},t){const{betas:s,...i}=e??{};return this._client.getAPIList("/v1/models",Or,{query:i,...t,headers:ee([{...s?.toString()!=null?{"anthropic-beta":s?.toString()}:void 0},t?.headers])})}};const So=n=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[n]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(n)?.trim()};var Gl,Fu,qo,im;const _S="\\n\\nHuman:",vS="\\n\\nAssistant:";class xe{constructor({baseURL:e=So("ANTHROPIC_BASE_URL"),apiKey:t=So("ANTHROPIC_API_KEY")??null,authToken:s=So("ANTHROPIC_AUTH_TOKEN")??null,...i}={}){Gl.add(this),qo.set(this,void 0);const r={apiKey:t,authToken:s,...i,baseURL:e||"https://api.anthropic.com"};if(!r.dangerouslyAllowBrowser&&qE())throw new Y(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=r.baseURL,this.timeout=r.timeout??Fu.DEFAULT_TIMEOUT,this.logger=r.logger??console;const o="warn";this.logLevel=o,this.logLevel=hd(r.logLevel,"ClientOptions.logLevel",this)??hd(So("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??o,this.fetchOptions=r.fetchOptions,this.maxRetries=r.maxRetries??2,this.fetch=r.fetch??OE(),$(this,qo,WE),this._options=r,this.apiKey=typeof t=="string"?t:null,this.authToken=s}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.get("x-api-key")||e.get("authorization"))&&!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}async authHeaders(e){return ee([await this.apiKeyAuth(e),await this.bearerAuth(e)])}async apiKeyAuth(e){if(this.apiKey!=null)return ee([{"X-Api-Key":this.apiKey}])}async bearerAuth(e){if(this.authToken!=null)return ee([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new Y(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${ai}`}defaultIdempotencyKey(){return`stainless-node-retry-${Tp()}`}makeStatusError(e,t,s,i){return It.generate(e,t,s,i)}buildURL(e,t,s){const i=!C(this,Gl,"m",im).call(this)&&s||this.baseURL,r=DE(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return LE(o)||(t={...o,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new Y("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(i=>({method:e,path:t,...i})))}request(e,t=null){return new $p(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){const i=await e,r=i.maxRetries??this.maxRetries;t==null&&(t=r),await this.prepareOptions(i);const{req:o,url:l,timeout:d}=await this.buildRequest(i,{retryCount:r-t});await this.prepareRequest(o,{url:l,options:i});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),f=s===void 0?"":`, retryOf: ${s}`,p=Date.now();if(tt(this).debug(`[${c}] sending request`,Ts({retryOfRequestLogID:s,method:i.method,url:l,options:i,headers:o.headers})),i.signal?.aborted)throw new Yt;const h=new AbortController,m=await this.fetchWithTimeout(l,o,d,h).catch(Dl),g=Date.now();if(m instanceof globalThis.Error){const w=`retrying, ${t} attempts remaining`;if(i.signal?.aborted)throw new Yt;const E=Dr(m)||/timed? ?out/i.test(String(m)+("cause"in m?String(m.cause):""));if(t)return tt(this).info(`[${c}] connection ${E?"timed out":"failed"} - ${w}`),tt(this).debug(`[${c}] connection ${E?"timed out":"failed"} (${w})`,Ts({retryOfRequestLogID:s,url:l,durationMs:g-p,message:m.message})),this.retryRequest(i,t,s??c);throw tt(this).info(`[${c}] connection ${E?"timed out":"failed"} - error; no more retries left`),tt(this).debug(`[${c}] connection ${E?"timed out":"failed"} (error; no more retries left)`,Ts({retryOfRequestLogID:s,url:l,durationMs:g-p,message:m.message})),E?new Cp:new Sa({cause:m})}const v=[...m.headers.entries()].filter(([w])=>w==="request-id").map(([w,E])=>", "+w+": "+JSON.stringify(E)).join(""),_=`[${c}${f}${v}] ${o.method} ${l} ${m.ok?"succeeded":"failed"} with status ${m.status} in ${g-p}ms`;if(!m.ok){const w=await this.shouldRetry(m);if(t&&w){const x=`retrying, ${t} attempts remaining`;return await JE(m.body),tt(this).info(`${_} - ${x}`),tt(this).debug(`[${c}] response error (${x})`,Ts({retryOfRequestLogID:s,url:m.url,status:m.status,headers:m.headers,durationMs:g-p})),this.retryRequest(i,t,s??c,m.headers)}const E=w?"error; no more retries left":"error; not retryable";tt(this).info(`${_} - ${E}`);const S=await m.text().catch(x=>Dl(x).message),T=Np(S),R=T?void 0:S;throw tt(this).debug(`[${c}] response error (${E})`,Ts({retryOfRequestLogID:s,url:m.url,status:m.status,headers:m.headers,message:R,durationMs:Date.now()-p})),this.makeStatusError(m.status,T,R,m.headers)}return tt(this).info(_),tt(this).debug(`[${c}] response start`,Ts({retryOfRequestLogID:s,url:m.url,status:m.status,headers:m.headers,durationMs:g-p})),{response:m,options:i,controller:h,requestLogID:c,retryOfRequestLogID:s,startTime:p}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){const s=this.makeRequest(t,null,void 0);return new tS(this,s,e)}async fetchWithTimeout(e,t,s,i){const{signal:r,method:o,...l}=t||{};r&&r.addEventListener("abort",()=>i.abort());const d=setTimeout(()=>i.abort(),s),c=globalThis.ReadableStream&&l.body instanceof globalThis.ReadableStream||typeof l.body=="object"&&l.body!==null&&Symbol.asyncIterator in l.body,f={signal:i.signal,...c?{duplex:"half"}:{},method:"GET",...l};o&&(f.method=o.toUpperCase());try{return await this.fetch.call(void 0,e,f)}finally{clearTimeout(d)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s,i){let r;const o=i?.get("retry-after-ms");if(o){const d=parseFloat(o);Number.isNaN(d)||(r=d)}const l=i?.get("retry-after");if(l&&!r){const d=parseFloat(l);Number.isNaN(d)?r=Date.parse(l)-Date.now():r=d*1e3}if(!(r&&0<=r&&r<60*1e3)){const d=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,d)}return await $E(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e,o=Math.min(.5*Math.pow(2,r),8),l=1-Math.random()*.25;return o*l*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new Y("Streaming is required for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}async buildRequest(e,{retryCount:t=0}={}){const s={...e},{method:i,path:r,query:o,defaultBaseURL:l}=s,d=this.buildURL(r,o,l);"timeout"in s&&FE("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const{bodyHeaders:c,body:f}=this.buildBody({options:s}),p=await this.buildHeaders({options:e,method:i,bodyHeaders:c,retryCount:t});return{req:{method:i,headers:p,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&f instanceof globalThis.ReadableStream&&{duplex:"half"},...f&&{body:f},...this.fetchOptions??{},...s.fetchOptions??{}},url:d,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:i}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const o=ee([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...HE(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(o),o.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=ee([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Lp(e)}:C(this,qo,"f").call(this,{body:e,headers:s})}}Fu=xe,qo=new WeakMap,Gl=new WeakSet,im=function(){return this.baseURL!=="https://api.anthropic.com"};xe.Anthropic=Fu;xe.HUMAN_PROMPT=_S;xe.AI_PROMPT=vS;xe.DEFAULT_TIMEOUT=6e5;xe.AnthropicError=Y;xe.APIError=It;xe.APIConnectionError=Sa;xe.APIConnectionTimeoutError=Cp;xe.APIUserAbortError=Yt;xe.NotFoundError=Rp;xe.ConflictError=Pp;xe.RateLimitError=Mp;xe.BadRequestError=Ap;xe.AuthenticationError=bp;xe.InternalServerError=kp;xe.PermissionDeniedError=Ip;xe.UnprocessableEntityError=xp;xe.toFile=aS;class Us extends xe{constructor(){super(...arguments),this.completions=new tm(this),this.messages=new Uu(this),this.models=new sm(this),this.beta=new ki(this)}}Us.Completions=tm;Us.Messages=Uu;Us.Models=sm;Us.Beta=ki;function rm(n){const e=n.match(/^data:([^;]+);base64,(.+)/);if(!e)throw new Error("Invalid image data URL format");const[,t,s]=e;return{mimeType:t,base64Data:s}}const Fe=class Fe extends bt{constructor(e){super(e),this.client=new Us({apiKey:e.apiKey,baseURL:e.baseUrl?e.baseUrl.replace(/\/+$/,""):void 0,dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="anthropic")throw new Error("Model is not a Anthropic model");if(!this.client.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);const i=Fe.validateSystemMessages(t.messages);try{const r={model:t.model,messages:t.messages.map(d=>Fe.parseRequestMessage(d)).filter(d=>d!==null),system:i,thinking:e.thinking?.enabled?{type:"enabled",budget_tokens:e.thinking.budget_tokens}:void 0,tools:t.tools?.map(d=>Fe.parseRequestTool(d)),tool_choice:t.tool_choice?Fe.parseRequestToolChoice(t.tool_choice):void 0,max_tokens:t.max_tokens??(e.thinking?.enabled?e.thinking?.budget_tokens+Fe.DEFAULT_MAX_TOKENS:Fe.DEFAULT_MAX_TOKENS),temperature:t.temperature,top_p:t.top_p},o=this.applyCustomModelParameters(e,{...r}),l=await this.client.messages.create(o,{signal:s?.signal});return Fe.parseNonStreamingResponse(l)}catch(r){throw r instanceof Us.AuthenticationError?r.message.includes("CORS requests are not allowed for this Organization")?new Nn(`Provider ${this.provider.id} is experiencing a CORS issue. This is a known issue with new individual Anthropic accounts.

To resolve this issue:

1. Go to https://console.anthropic.com/settings/organization
2. Create a new organization
3. Your API key should work properly after creating an organization`,r):new Nn(`Provider ${this.provider.id} API key is invalid. Please update it in settings menu.`,r):r}}async streamResponse(e,t,s){if(e.providerType!=="anthropic")throw new Error("Model is not a Anthropic model");if(!this.client.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);const i=Fe.validateSystemMessages(t.messages);try{const r={model:t.model,messages:t.messages.map(d=>Fe.parseRequestMessage(d)).filter(d=>d!==null),system:i,thinking:e.thinking?.enabled?{type:"enabled",budget_tokens:e.thinking.budget_tokens}:void 0,tools:t.tools?.map(d=>Fe.parseRequestTool(d)),tool_choice:t.tool_choice?Fe.parseRequestToolChoice(t.tool_choice):void 0,max_tokens:t.max_tokens??(e.thinking?.enabled?e.thinking?.budget_tokens+Fe.DEFAULT_MAX_TOKENS:Fe.DEFAULT_MAX_TOKENS),temperature:t.temperature,top_p:t.top_p,stream:!0},o=this.applyCustomModelParameters(e,{...r}),l=await this.client.messages.create(o,{signal:s?.signal,stream:!0});return this.streamResponseGenerator(l)}catch(r){throw r instanceof Us.AuthenticationError?r.message.includes("CORS requests are not allowed for this Organization")?new Nn(`Provider ${this.provider.id} is experiencing a CORS issue. This is a known issue with new individual Anthropic accounts.

To resolve this issue:

1. Go to https://console.anthropic.com/settings/organization
2. Create a new organization
3. Your API key should work properly after creating an organization`,r):new Nn(`Provider ${this.provider.id} API key is invalid. Please update it in settings menu.`,r):r}}async*streamResponseGenerator(e){let t="",s="",i={prompt_tokens:0,completion_tokens:0,total_tokens:0};for await(const r of e)if(r.type==="message_start")t=r.message.id,s=r.message.model,i={prompt_tokens:r.message.usage.input_tokens,completion_tokens:r.message.usage.output_tokens,total_tokens:r.message.usage.input_tokens+r.message.usage.output_tokens};else if(r.type==="content_block_start"||r.type==="content_block_delta"){const o=Fe.parseStreamingResponseChunk(r,t,s);o!==null&&(yield o)}else r.type==="message_delta"&&(i={prompt_tokens:i.prompt_tokens,completion_tokens:i.completion_tokens+r.usage.output_tokens,total_tokens:i.total_tokens+r.usage.output_tokens});yield{id:t,choices:[],object:"chat.completion.chunk",model:s,usage:i}}static parseRequestMessage(e){switch(e.role){case"user":return Array.isArray(e.content)?{role:"user",content:e.content.map(s=>{switch(s.type){case"text":return{type:"text",text:s.text};case"image_url":{const{mimeType:i,base64Data:r}=rm(s.image_url.url);return Fe.validateImageType(i),{type:"image",source:{data:r,media_type:i,type:"base64"}}}}})}:{role:"user",content:e.content};case"assistant":{const t=e.tool_calls?.map(i=>{const r=(()=>{if(i.arguments&&i.arguments.length>0)try{return JSON.parse(i.arguments)}catch(o){return console.error(o),{}}return{}})();return{type:"tool_use",id:i.id,name:i.name,input:r}}),s=[...e.content.trim()===""?[]:[{type:"text",text:e.content}],...t||[]];return s.length===0?null:{role:"assistant",content:s}}case"system":return null;case"tool":return{role:"user",content:[{type:"tool_result",tool_use_id:e.tool_call.id,content:e.content}]}}}static parseNonStreamingResponse(e){const t=e.content.filter(r=>r.type==="text").map(r=>r.text).join(""),s=e.content.filter(r=>r.type==="thinking").map(r=>r.thinking).join("")||void 0,i=e.content.filter(r=>r.type==="tool_use").map(r=>({id:r.id,type:"function",function:{name:r.name,arguments:JSON.stringify(r.input)}}));return{id:e.id,choices:[{finish_reason:e.stop_reason,message:{content:t,reasoning:s,tool_calls:i.length>0?i:void 0,role:e.role}}],model:e.model,object:"chat.completion",usage:{prompt_tokens:e.usage.input_tokens,completion_tokens:e.usage.output_tokens,total_tokens:e.usage.input_tokens+e.usage.output_tokens}}}static parseStreamingResponseChunk(e,t,s){if(e.type!=="content_block_start"&&e.type!=="content_block_delta")throw new Error("Unsupported chunk type");if(e.type==="content_block_start"&&e.content_block.type==="tool_use")return{id:t,choices:[{finish_reason:null,delta:{tool_calls:[{index:e.index,id:e.content_block.id,type:"function",function:{name:e.content_block.name}}]}}],object:"chat.completion.chunk",model:s};if(e.type==="content_block_delta"){if(e.delta.type==="text_delta")return{id:t,choices:[{finish_reason:null,delta:{content:e.delta.text}}],object:"chat.completion.chunk",model:s};if(e.delta.type==="thinking_delta")return{id:t,choices:[{finish_reason:null,delta:{reasoning:e.delta.thinking}}],object:"chat.completion.chunk",model:s};if(e.delta.type==="input_json_delta")return{id:t,choices:[{finish_reason:null,delta:{tool_calls:[{index:e.index,function:{arguments:e.delta.partial_json}}]}}],object:"chat.completion.chunk",model:s}}return null}static validateSystemMessages(e){const t=e.filter(i=>i.role==="system");if(t.length>1)throw new Error("Anthropic does not support more than one system message");const s=t.length>0?t[0].content:void 0;if(s&&typeof s!="string")throw new Error("Anthropic only supports string content for system messages");return s}static validateImageType(e){const t=["image/jpeg","image/png","image/gif","image/webp"];if(!t.includes(e))throw new Error(`Anthropic does not support image type ${e}. Supported types: ${t.join(", ")}`)}static parseRequestTool(e){return{name:e.function.name,input_schema:{...e.function.parameters,type:"object"},description:e.function.description}}static parseRequestToolChoice(e){if(e==="none")return{type:"none"};if(e==="auto")return{type:"auto"};if(e==="required")return{type:"any"};if(typeof e=="object"&&e.type==="function")return{type:"tool",name:e.function.name};throw new Error(`Unsupported tool choice: ${JSON.stringify(e)}`)}};Fe.DEFAULT_MAX_TOKENS=8192;let Vl=Fe;const Hl="RFC3986",Ol={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:n=>String(n)},wS="RFC1738",ES=Array.isArray,dn=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),ll=1024,SS=(n,e,t,s,i)=>{if(n.length===0)return n;let r=n;if(typeof n=="symbol"?r=Symbol.prototype.toString.call(n):typeof n!="string"&&(r=String(n)),t==="iso-8859-1")return escape(r).replace(/%u[0-9a-f]{4}/gi,function(l){return"%26%23"+parseInt(l.slice(2),16)+"%3B"});let o="";for(let l=0;l<r.length;l+=ll){const d=r.length>=ll?r.slice(l,l+ll):r,c=[];for(let f=0;f<d.length;++f){let p=d.charCodeAt(f);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||i===wS&&(p===40||p===41)){c[c.length]=d.charAt(f);continue}if(p<128){c[c.length]=dn[p];continue}if(p<2048){c[c.length]=dn[192|p>>6]+dn[128|p&63];continue}if(p<55296||p>=57344){c[c.length]=dn[224|p>>12]+dn[128|p>>6&63]+dn[128|p&63];continue}f+=1,p=65536+((p&1023)<<10|d.charCodeAt(f)&1023),c[c.length]=dn[240|p>>18]+dn[128|p>>12&63]+dn[128|p>>6&63]+dn[128|p&63]}o+=c.join("")}return o};function TS(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function xd(n,e){if(ES(n)){const t=[];for(let s=0;s<n.length;s+=1)t.push(e(n[s]));return t}return e(n)}const CS=Object.prototype.hasOwnProperty,om={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},hn=Array.isArray,AS=Array.prototype.push,am=function(n,e){AS.apply(n,hn(e)?e:[e])},bS=Date.prototype.toISOString,De={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:SS,encodeValuesOnly:!1,format:Hl,formatter:Ol[Hl],indices:!1,serializeDate(n){return bS.call(n)},skipNulls:!1,strictNullHandling:!1};function IS(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const ul={};function lm(n,e,t,s,i,r,o,l,d,c,f,p,h,m,g,v,_,w){let E=n,S=w,T=0,R=!1;for(;(S=S.get(ul))!==void 0&&!R;){const N=S.get(n);if(T+=1,typeof N<"u"){if(N===T)throw new RangeError("Cyclic object value");R=!0}typeof S.get(ul)>"u"&&(T=0)}if(typeof c=="function"?E=c(e,E):E instanceof Date?E=h?.(E):t==="comma"&&hn(E)&&(E=xd(E,function(N){return N instanceof Date?h?.(N):N})),E===null){if(r)return d&&!v?d(e,De.encoder,_,"key",m):e;E=""}if(IS(E)||TS(E)){if(d){const N=v?e:d(e,De.encoder,_,"key",m);return[g?.(N)+"="+g?.(d(E,De.encoder,_,"value",m))]}return[g?.(e)+"="+g?.(String(E))]}const M=[];if(typeof E>"u")return M;let x;if(t==="comma"&&hn(E))v&&d&&(E=xd(E,d)),x=[{value:E.length>0?E.join(",")||null:void 0}];else if(hn(c))x=c;else{const N=Object.keys(E);x=f?N.sort(f):N}const k=l?String(e).replace(/\./g,"%2E"):String(e),I=s&&hn(E)&&E.length===1?k+"[]":k;if(i&&hn(E)&&E.length===0)return I+"[]";for(let N=0;N<x.length;++N){const F=x[N],oe=typeof F=="object"&&typeof F.value<"u"?F.value:E[F];if(o&&oe===null)continue;const Z=p&&l?F.replace(/\./g,"%2E"):F,X=hn(E)?typeof t=="function"?t(I,Z):I:I+(p?"."+Z:"["+Z+"]");w.set(n,T);const fe=new WeakMap;fe.set(ul,w),am(M,lm(oe,X,t,s,i,r,o,l,t==="comma"&&v&&hn(E)?null:d,c,f,p,h,m,g,v,_,fe))}return M}function RS(n=De){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||De.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=Hl;if(typeof n.format<"u"){if(!CS.call(Ol,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const s=Ol[t];let i=De.filter;(typeof n.filter=="function"||hn(n.filter))&&(i=n.filter);let r;if(n.arrayFormat&&n.arrayFormat in om?r=n.arrayFormat:"indices"in n?r=n.indices?"indices":"repeat":r=De.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const o=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:De.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:De.addQueryPrefix,allowDots:o,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:De.allowEmptyArrays,arrayFormat:r,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:De.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?De.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:De.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:De.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:De.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:De.encodeValuesOnly,filter:i,format:t,formatter:s,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:De.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:De.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:De.strictNullHandling}}function PS(n,e={}){let t=n;const s=RS(e);let i,r;typeof s.filter=="function"?(r=s.filter,t=r("",t)):hn(s.filter)&&(r=s.filter,i=r);const o=[];if(typeof t!="object"||t===null)return"";const l=om[s.arrayFormat],d=l==="comma"&&s.commaRoundTrip;i||(i=Object.keys(t)),s.sort&&i.sort(s.sort);const c=new WeakMap;for(let h=0;h<i.length;++h){const m=i[h];s.skipNulls&&t[m]===null||am(o,lm(t[m],m,l,d,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,c))}const f=o.join(s.delimiter);let p=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),f.length>0?p+f:""}const ui="4.104.0";let Md=!1,Rr,um,cm,Jl,dm,fm,hm,pm,mm;function xS(n,e={auto:!1}){if(Md)throw new Error(`you must \`import 'openai/shims/${n.kind}'\` before importing anything else from openai`);if(Rr)throw new Error(`can't \`import 'openai/shims/${n.kind}'\` after \`import 'openai/shims/${Rr}'\``);Md=e.auto,Rr=n.kind,um=n.fetch,cm=n.FormData,Jl=n.File,dm=n.ReadableStream,fm=n.getMultipartRequestOptions,hm=n.getDefaultAgent,pm=n.fileFromPath,mm=n.isFsReadStream}class MS{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}function kS({manuallyImported:n}={}){const e=n?"You may need to use polyfills":"Add one of these imports before your first `import ‚Ä¶ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,s,i,r;try{t=fetch,s=Request,i=Response,r=Headers}catch(o){throw new Error(`this environment is missing the following Web Fetch API type: ${o.message}. ${e}`)}return{kind:"web",fetch:t,Request:s,Response:i,Headers:r,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:async(o,l)=>({...l,body:new MS(o)}),getDefaultAgent:o=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:o=>!1}}const gm=()=>{Rr||xS(kS(),{auto:!0})};gm();class G extends Error{}let pt=class Wl extends G{constructor(e,t,s,i){super(`${Wl.makeMessage(e,t,s)}`),this.status=e,this.headers=i,this.request_id=i?.["x-request-id"],this.error=t;const r=t;this.code=r?.code,this.param=r?.param,this.type=r?.type}static makeMessage(e,t,s){const i=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,s,i){if(!e||!i)return new Aa({message:s,cause:Kl(t)});const r=t?.error;return e===400?new ym(e,r,s,i):e===401?new _m(e,r,s,i):e===403?new vm(e,r,s,i):e===404?new wm(e,r,s,i):e===409?new Em(e,r,s,i):e===422?new Sm(e,r,s,i):e===429?new Tm(e,r,s,i):e>=500?new Cm(e,r,s,i):new Wl(e,r,s,i)}},Ut=class extends pt{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Aa=class extends pt{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},$u=class extends Aa{constructor({message:e}={}){super({message:e??"Request timed out."})}},ym=class extends pt{},_m=class extends pt{},vm=class extends pt{},wm=class extends pt{},Em=class extends pt{},Sm=class extends pt{},Tm=class extends pt{},Cm=class extends pt{};class Am extends G{constructor(){super("Could not parse response content as the length limit was reached")}}class bm extends G{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var To=function(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},Ss=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},wt;let ba=class{constructor(){wt.set(this,void 0),this.buffer=new Uint8Array,To(this,wt,null,"f")}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?new TextEncoder().encode(e):e;let s=new Uint8Array(this.buffer.length+t.length);s.set(this.buffer),s.set(t,this.buffer.length),this.buffer=s;const i=[];let r;for(;(r=NS(this.buffer,Ss(this,wt,"f")))!=null;){if(r.carriage&&Ss(this,wt,"f")==null){To(this,wt,r.index,"f");continue}if(Ss(this,wt,"f")!=null&&(r.index!==Ss(this,wt,"f")+1||r.carriage)){i.push(this.decodeText(this.buffer.slice(0,Ss(this,wt,"f")-1))),this.buffer=this.buffer.slice(Ss(this,wt,"f")),To(this,wt,null,"f");continue}const o=Ss(this,wt,"f")!==null?r.preceding-1:r.preceding,l=this.decodeText(this.buffer.slice(0,o));i.push(l),this.buffer=this.buffer.slice(r.index),To(this,wt,null,"f")}return i}decodeText(e){if(e==null)return"";if(typeof e=="string")return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new G(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new G(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new G("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}};wt=new WeakMap;ba.NEWLINE_CHARS=new Set([`
`,"\r"]);ba.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function NS(n,e){for(let i=e??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function DS(n){for(let s=0;s<n.length-1;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}function Im(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}let Ur=class gr{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;async function*i(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let r=!1;try{for await(const o of LS(e,t))if(!r){if(o.data.startsWith("[DONE]")){r=!0;continue}if(o.event===null||o.event.startsWith("response.")||o.event.startsWith("transcript.")){let l;try{l=JSON.parse(o.data)}catch(d){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),d}if(l&&l.error)throw new pt(void 0,l.error,void 0,Um(e.headers));yield l}else{let l;try{l=JSON.parse(o.data)}catch(d){throw console.error("Could not parse message into JSON:",o.data),console.error("From chunk:",o.raw),d}if(o.event=="error")throw new pt(void 0,l.error,l.message,void 0);yield{event:o.event,data:l}}}r=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{r||t.abort()}}return new gr(i,t)}static fromReadableStream(e,t){let s=!1;async function*i(){const o=new ba,l=Im(e);for await(const d of l)for(const c of o.decode(d))yield c;for(const d of o.flush())yield d}async function*r(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(const l of i())o||l&&(yield JSON.parse(l));o=!0}catch(l){if(l instanceof Error&&l.name==="AbortError")return;throw l}finally{o||t.abort()}}return new gr(r,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),i=r=>({next:()=>{if(r.length===0){const o=s.next();e.push(o),t.push(o)}return r.shift()}});return[new gr(()=>i(e),this.controller),new gr(()=>i(t),this.controller)]}toReadableStream(){const e=this;let t;const s=new TextEncoder;return new dm({async start(){t=e[Symbol.asyncIterator]()},async pull(i){try{const{value:r,done:o}=await t.next();if(o)return i.close();const l=s.encode(JSON.stringify(r)+`
`);i.enqueue(l)}catch(r){i.error(r)}},async cancel(){await t.return?.()}})}};async function*LS(n,e){if(!n.body)throw e.abort(),new G("Attempted to iterate over a response with no body");const t=new FS,s=new ba,i=Im(n.body);for await(const r of US(i))for(const o of s.decode(r)){const l=t.decode(o);l&&(yield l)}for(const r of s.flush()){const o=t.decode(r);o&&(yield o)}}async function*US(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let i=new Uint8Array(e.length+s.length);i.set(e),i.set(s,e.length),e=i;let r;for(;(r=DS(e))!==-1;)yield e.slice(0,r),e=e.slice(r)}e.length>0&&(yield e)}let FS=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,i]=$S(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}};function $S(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}const Rm=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function",Pm=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Ia(n),Ia=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",qS=n=>Pm(n)||Rm(n)||mm(n);async function xm(n,e,t){if(n=await n,Pm(n))return n;if(Rm(n)){const i=await n.blob();e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()??"unknown_file");const r=Ia(i)?[await i.arrayBuffer()]:[i];return new Jl(r,e,t)}const s=await BS(n);if(e||(e=VS(n)??"unknown_file"),!t?.type){const i=s[0]?.type;typeof i=="string"&&(t={...t,type:i})}return new Jl(s,e,t)}async function BS(n){let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Ia(n))e.push(await n.arrayBuffer());else if(HS(n))for await(const t of n)e.push(t);else throw new Error(`Unexpected data type: ${typeof n}; constructor: ${n?.constructor?.name}; props: ${GS(n)}`);return e}function GS(n){return`[${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}function VS(n){return cl(n.name)||cl(n.filename)||cl(n.path)?.split(/[\\/]/).pop()}const cl=n=>{if(typeof n=="string")return n;if(typeof Buffer<"u"&&n instanceof Buffer)return String(n)},HS=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",kd=n=>n&&typeof n=="object"&&n.body&&n[Symbol.toStringTag]==="MultipartBody",Bs=async n=>{const e=await OS(n.body);return fm(e,n)},OS=async n=>{const e=new cm;return await Promise.all(Object.entries(n||{}).map(([t,s])=>zl(e,t,s))),e},zl=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(qS(t)){const s=await xm(t);n.append(e,s)}else if(Array.isArray(t))await Promise.all(t.map(s=>zl(n,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,i])=>zl(n,`${e}[${s}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}};var JS=function(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},WS=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Co;gm();async function Mm(n){const{response:e}=n;if(n.options.stream)return ls("response",e.status,e.url,e.headers,e.body),n.options.__streamClass?n.options.__streamClass.fromSSEResponse(e,n.controller):Ur.fromSSEResponse(e,n.controller);if(e.status===204)return null;if(n.options.__binaryResponse)return e;const s=e.headers.get("content-type")?.split(";")[0]?.trim();if(s?.includes("application/json")||s?.endsWith("+json")){const o=await e.json();return ls("response",e.status,e.url,e.headers,o),km(o,e)}const r=await e.text();return ls("response",e.status,e.url,e.headers,r),r}function km(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}let Nm=class Dm extends Promise{constructor(e,t=Mm){super(s=>{s(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new Dm(this.responsePromise,async t=>km(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};class zS{constructor({baseURL:e,maxRetries:t=2,timeout:s=6e5,httpAgent:i,fetch:r}){this.baseURL=e,this.maxRetries=dl("maxRetries",t),this.timeout=dl("timeout",s),this.httpAgent=i,this.fetch=r??um}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ZS(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${nT()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(async i=>{const r=i&&Ia(i?.body)?new DataView(await i.body.arrayBuffer()):i?.body instanceof DataView?i.body:i?.body instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i?.body)?new DataView(i.body.buffer):i?.body;return{method:e,path:t,...i,body:r}}))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if(typeof e=="string"){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const s={...e},{method:i,path:r,query:o,headers:l={}}=s,d=ArrayBuffer.isView(s.body)||s.__binaryRequest&&typeof s.body=="string"?s.body:kd(s.body)?s.body.body:s.body?JSON.stringify(s.body,null,2):null,c=this.calculateContentLength(d),f=this.buildURL(r,o);"timeout"in s&&dl("timeout",s.timeout),s.timeout=s.timeout??this.timeout;const p=s.httpAgent??this.httpAgent??hm(f),h=s.timeout+1e3;typeof p?.options?.timeout=="number"&&h>(p.options.timeout??0)&&(p.options.timeout=h),this.idempotencyHeader&&i!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),l[this.idempotencyHeader]=e.idempotencyKey);const m=this.buildHeaders({options:s,headers:l,contentLength:c,retryCount:t});return{req:{method:i,...d&&{body:d},headers:m,...p&&{agent:p},signal:s.signal??null},url:f,timeout:s.timeout}}buildHeaders({options:e,headers:t,contentLength:s,retryCount:i}){const r={};s&&(r["content-length"]=s);const o=this.defaultHeaders(e);return Ud(r,o),Ud(r,t),kd(e.body)&&Rr!=="node"&&delete r["content-type"],Ao(o,"x-stainless-retry-count")===void 0&&Ao(t,"x-stainless-retry-count")===void 0&&(r["x-stainless-retry-count"]=String(i)),Ao(o,"x-stainless-timeout")===void 0&&Ao(t,"x-stainless-timeout")===void 0&&e.timeout&&(r["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(r,t),r}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,s,i){return pt.generate(e,t,s,i)}request(e,t=null){return new Nm(this.makeRequest(e,t))}async makeRequest(e,t){const s=await e,i=s.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(s);const{req:r,url:o,timeout:l}=this.buildRequest(s,{retryCount:i-t});if(await this.prepareRequest(r,{url:o,options:s}),ls("request",o,s,r.headers),s.signal?.aborted)throw new Ut;const d=new AbortController,c=await this.fetchWithTimeout(o,r,l,d).catch(Kl);if(c instanceof Error){if(s.signal?.aborted)throw new Ut;if(t)return this.retryRequest(s,t);throw c.name==="AbortError"?new $u:new Aa({cause:c})}const f=Um(c.headers);if(!c.ok){if(t&&this.shouldRetry(c)){const _=`retrying, ${t} attempts remaining`;return ls(`response (error; ${_})`,c.status,o,f),this.retryRequest(s,t,f)}const p=await c.text().catch(_=>Kl(_).message),h=jS(p),m=h?void 0:p;throw ls(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,f,m),this.makeStatusError(c.status,h,m,f)}return{response:c,options:s,controller:d}}requestAPIList(e,t){const s=this.makeRequest(t,null);return new KS(this,s,e)}buildURL(e,t){const s=tT(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return Fm(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new G(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,s,i){const{signal:r,...o}=t||{};r&&r.addEventListener("abort",()=>i.abort());const l=setTimeout(()=>i.abort(),s),d={signal:i.signal,...o};return d.method&&(d.method=d.method.toUpperCase()),this.fetch.call(void 0,e,d).finally(()=>{clearTimeout(l)})}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s){let i;const r=s?.["retry-after-ms"];if(r){const l=parseFloat(r);Number.isNaN(l)||(i=l)}const o=s?.["retry-after"];if(o&&!i){const l=parseFloat(o);Number.isNaN(l)?i=Date.parse(o)-Date.now():i=l*1e3}if(!(i&&0<=i&&i<60*1e3)){const l=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,l)}return await Jr(i),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e,o=Math.min(.5*Math.pow(2,r),8),l=1-Math.random()*.25;return o*l*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ui}`}}class Lm{constructor(e,t,s,i){Co.set(this,void 0),JS(this,Co,e,"f"),this.options=i,this.response=t,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new G("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&typeof t.query=="object")t.query={...t.query,...e.params};else if("url"in e){const s=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[i,r]of s)e.url.searchParams.set(i,r);t.query=void 0,t.path=e.url.toString()}return await WS(this,Co,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Co=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class KS extends Nm{constructor(e,t,s){super(t,async i=>new s(e,i.response,await Mm(i),i.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}const Um=n=>new Proxy(Object.fromEntries(n.entries()),{get(e,t){const s=t.toString();return e[s.toLowerCase()]||e[s]}}),YS={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Ee=n=>typeof n=="object"&&n!==null&&!Fm(n)&&Object.keys(n).every(e=>$m(YS,e)),XS=()=>{if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ui,"X-Stainless-OS":Dd(Deno.build.os),"X-Stainless-Arch":Nd(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ui,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ui,"X-Stainless-OS":Dd(process.platform),"X-Stainless-Arch":Nd(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const n=QS();return n?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ui,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${n.browser}`,"X-Stainless-Runtime-Version":n.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ui,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function QS(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const i=s[1]||0,r=s[2]||0,o=s[3]||0;return{browser:e,version:`${i}.${r}.${o}`}}}return null}const Nd=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Dd=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Ld;const ZS=()=>Ld??(Ld=XS()),jS=n=>{try{return JSON.parse(n)}catch{return}},eT=/^[a-z][a-z0-9+.-]*:/i,tT=n=>eT.test(n),Jr=n=>new Promise(e=>setTimeout(e,n)),dl=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new G(`${n} must be an integer`);if(e<0)throw new G(`${n} must be a positive integer`);return e},Kl=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null)try{return new Error(JSON.stringify(n))}catch{}return new Error(n)},xs=n=>{if(typeof process<"u")return process.env?.[n]?.trim()??void 0;if(typeof Deno<"u")return Deno.env?.get?.(n)?.trim()};function Fm(n){if(!n)return!0;for(const e in n)return!1;return!0}function $m(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ud(n,e){for(const t in e){if(!$m(e,t))continue;const s=t.toLowerCase();if(!s)continue;const i=e[t];i===null?delete n[s]:i!==void 0&&(n[s]=i)}}const Fd=new Set(["authorization","api-key"]);function ls(n,...e){if(typeof process<"u"&&process?.env?.DEBUG==="true"){const t=e.map(s=>{if(!s)return s;if(s.headers){const r={...s,headers:{...s.headers}};for(const o in s.headers)Fd.has(o.toLowerCase())&&(r.headers[o]="REDACTED");return r}let i=null;for(const r in s)Fd.has(r.toLowerCase())&&(i??(i={...s}),i[r]="REDACTED");return i??s});console.log(`OpenAI:DEBUG:${n}`,...t)}}const nT=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)}),sT=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",iT=n=>typeof n?.get=="function",Ao=(n,e)=>{const t=e.toLowerCase();if(iT(n)){const s=e[0]?.toUpperCase()+e.substring(1).replace(/([^\w])(\w)/g,(i,r,o)=>r+o.toUpperCase());for(const i of[e,t,e.toUpperCase(),s]){const r=n.get(i);if(r)return r}}for(const[s,i]of Object.entries(n))if(s.toLowerCase()===t)return Array.isArray(i)?(i.length<=1||console.warn(`Received ${i.length} entries for the ${e} header, using the first entry.`),i[0]):i},rT=n=>{if(typeof Buffer<"u"){const e=Buffer.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(n),t=e.length,s=new Uint8Array(t);for(let i=0;i<t;i++)s[i]=e.charCodeAt(i);return Array.from(new Float32Array(s.buffer))}};function Bo(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}class Ra extends Lm{constructor(e,t,s,i){super(e,t,s,i),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class Le extends Lm{constructor(e,t,s,i){super(e,t,s,i),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}let O=class{constructor(e){this._client=e}},qm=class extends O{list(e,t={},s){return Ee(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,oT,{query:t,...s})}},Pa=class extends O{constructor(){super(...arguments),this.messages=new qm(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return Ee(e)?this.list({},e):this._client.getAPIList("/chat/completions",xa,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}};class xa extends Le{}class oT extends Le{}Pa.ChatCompletionsPage=xa;Pa.Messages=qm;let Ma=class extends O{constructor(){super(...arguments),this.completions=new Pa(this._client)}};Ma.Completions=Pa;Ma.ChatCompletionsPage=xa;class Bm extends O{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class Gm extends O{create(e,t){return this._client.post("/audio/transcriptions",Bs({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class Vm extends O{create(e,t){return this._client.post("/audio/translations",Bs({body:e,...t,__metadata:{model:e.model}}))}}class Wr extends O{constructor(){super(...arguments),this.transcriptions=new Gm(this._client),this.translations=new Vm(this._client),this.speech=new Bm(this._client)}}Wr.Transcriptions=Gm;Wr.Translations=Vm;Wr.Speech=Bm;let qu=class extends O{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return Ee(e)?this.list({},e):this._client.getAPIList("/batches",Bu,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}};class Bu extends Le{}qu.BatchesPage=Bu;var Wt=function(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},we=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},Yl,Go,Vo,yr,_r,Ho,vr,Pn,wr,ia,ra,ci,Hm;class Gu{constructor(){Yl.add(this),this.controller=new AbortController,Go.set(this,void 0),Vo.set(this,()=>{}),yr.set(this,()=>{}),_r.set(this,void 0),Ho.set(this,()=>{}),vr.set(this,()=>{}),Pn.set(this,{}),wr.set(this,!1),ia.set(this,!1),ra.set(this,!1),ci.set(this,!1),Wt(this,Go,new Promise((e,t)=>{Wt(this,Vo,e,"f"),Wt(this,yr,t,"f")}),"f"),Wt(this,_r,new Promise((e,t)=>{Wt(this,Ho,e,"f"),Wt(this,vr,t,"f")}),"f"),we(this,Go,"f").catch(()=>{}),we(this,_r,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},we(this,Yl,"m",Hm).bind(this))},0)}_connected(){this.ended||(we(this,Vo,"f").call(this),this._emit("connect"))}get ended(){return we(this,wr,"f")}get errored(){return we(this,ia,"f")}get aborted(){return we(this,ra,"f")}abort(){this.controller.abort()}on(e,t){return(we(this,Pn,"f")[e]||(we(this,Pn,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=we(this,Pn,"f")[e];if(!s)return this;const i=s.findIndex(r=>r.listener===t);return i>=0&&s.splice(i,1),this}once(e,t){return(we(this,Pn,"f")[e]||(we(this,Pn,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{Wt(this,ci,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){Wt(this,ci,!0,"f"),await we(this,_r,"f")}_emit(e,...t){if(we(this,wr,"f"))return;e==="end"&&(Wt(this,wr,!0,"f"),we(this,Ho,"f").call(this));const s=we(this,Pn,"f")[e];if(s&&(we(this,Pn,"f")[e]=s.filter(i=>!i.once),s.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!we(this,ci,"f")&&!s?.length&&Promise.reject(i),we(this,yr,"f").call(this,i),we(this,vr,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!we(this,ci,"f")&&!s?.length&&Promise.reject(i),we(this,yr,"f").call(this,i),we(this,vr,"f").call(this,i),this._emit("end")}}_emitFinal(){}}Go=new WeakMap,Vo=new WeakMap,yr=new WeakMap,_r=new WeakMap,Ho=new WeakMap,vr=new WeakMap,Pn=new WeakMap,wr=new WeakMap,ia=new WeakMap,ra=new WeakMap,ci=new WeakMap,Yl=new WeakSet,Hm=function(e){if(Wt(this,ia,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Ut),e instanceof Ut)return Wt(this,ra,!0,"f"),this._emit("abort",e);if(e instanceof G)return this._emit("error",e);if(e instanceof Error){const t=new G(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new G(String(e)))};var B=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},yt=function(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},Be,Xl,pn,Oo,zt,Ms,hi,As,oa,St,Jo,Wo,Pr,Er,Sr,$d,qd,Bd,Gd,Vd,Hd,Od;class Xt extends Gu{constructor(){super(...arguments),Be.add(this),Xl.set(this,[]),pn.set(this,{}),Oo.set(this,{}),zt.set(this,void 0),Ms.set(this,void 0),hi.set(this,void 0),As.set(this,void 0),oa.set(this,void 0),St.set(this,void 0),Jo.set(this,void 0),Wo.set(this,void 0),Pr.set(this,void 0)}[(Xl=new WeakMap,pn=new WeakMap,Oo=new WeakMap,zt=new WeakMap,Ms=new WeakMap,hi=new WeakMap,As=new WeakMap,oa=new WeakMap,St=new WeakMap,Jo=new WeakMap,Wo=new WeakMap,Pr=new WeakMap,Be=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",i=>{const r=t.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),this.on("error",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,o)=>t.push({resolve:r,reject:o})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Xt;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Ur.fromReadableStream(e,this.controller);for await(const r of i)B(this,Be,"m",Er).call(this,r);if(i.controller.signal?.aborted)throw new Ut;return this._addRun(B(this,Be,"m",Sr).call(this))}toReadableStream(){return new Ur(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,i,r){const o=new Xt;return o._run(()=>o._runToolAssistantStream(e,t,s,i,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(e,t,s,i,r){const o=r?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));const l={...i,stream:!0},d=await e.submitToolOutputs(t,s,l,{...r,signal:this.controller.signal});this._connected();for await(const c of d)B(this,Be,"m",Er).call(this,c);if(d.controller.signal?.aborted)throw new Ut;return this._addRun(B(this,Be,"m",Sr).call(this))}static createThreadAssistantStream(e,t,s){const i=new Xt;return i._run(()=>i._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,t,s,i){const r=new Xt;return r._run(()=>r._runAssistantStream(e,t,s,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return B(this,Jo,"f")}currentRun(){return B(this,Wo,"f")}currentMessageSnapshot(){return B(this,zt,"f")}currentRunStepSnapshot(){return B(this,Pr,"f")}async finalRunSteps(){return await this.done(),Object.values(B(this,pn,"f"))}async finalMessages(){return await this.done(),Object.values(B(this,Oo,"f"))}async finalRun(){if(await this.done(),!B(this,Ms,"f"))throw Error("Final run was not received.");return B(this,Ms,"f")}async _createThreadAssistantStream(e,t,s){const i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const r={...t,stream:!0},o=await e.createAndRun(r,{...s,signal:this.controller.signal});this._connected();for await(const l of o)B(this,Be,"m",Er).call(this,l);if(o.controller.signal?.aborted)throw new Ut;return this._addRun(B(this,Be,"m",Sr).call(this))}async _createAssistantStream(e,t,s,i){const r=i?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));const o={...s,stream:!0},l=await e.create(t,o,{...i,signal:this.controller.signal});this._connected();for await(const d of l)B(this,Be,"m",Er).call(this,d);if(l.controller.signal?.aborted)throw new Ut;return this._addRun(B(this,Be,"m",Sr).call(this))}static accumulateDelta(e,t){for(const[s,i]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=i;continue}let r=e[s];if(r==null){e[s]=i;continue}if(s==="index"||s==="type"){e[s]=i;continue}if(typeof r=="string"&&typeof i=="string")r+=i;else if(typeof r=="number"&&typeof i=="number")r+=i;else if(Bo(r)&&Bo(i))r=this.accumulateDelta(r,i);else if(Array.isArray(r)&&Array.isArray(i)){if(r.every(o=>typeof o=="string"||typeof o=="number")){r.push(...i);continue}for(const o of i){if(!Bo(o))throw new Error(`Expected array delta entry to be an object but got: ${o}`);const l=o.index;if(l==null)throw console.error(o),new Error("Expected array delta entry to have an `index` property");if(typeof l!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${l}`);const d=r[l];d==null?r.push(o):r[l]=this.accumulateDelta(d,o)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${i}, accValue: ${r}`);e[s]=r}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,i){return await this._createAssistantStream(t,e,s,i)}async _runToolAssistantStream(e,t,s,i,r){return await this._createToolAssistantStream(s,e,t,i,r)}}Er=function(e){if(!this.ended)switch(yt(this,Jo,e,"f"),B(this,Be,"m",Bd).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":B(this,Be,"m",Od).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":B(this,Be,"m",qd).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":B(this,Be,"m",$d).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Sr=function(){if(this.ended)throw new G("stream has ended, this shouldn't happen");if(!B(this,Ms,"f"))throw Error("Final run has not been received");return B(this,Ms,"f")},$d=function(e){const[t,s]=B(this,Be,"m",Vd).call(this,e,B(this,zt,"f"));yt(this,zt,t,"f"),B(this,Oo,"f")[t.id]=t;for(const i of s){const r=t.content[i.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let r=i.text,o=t.content[i.index];if(o&&o.type=="text")this._emit("textDelta",r,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=B(this,hi,"f")){if(B(this,As,"f"))switch(B(this,As,"f").type){case"text":this._emit("textDone",B(this,As,"f").text,B(this,zt,"f"));break;case"image_file":this._emit("imageFileDone",B(this,As,"f").image_file,B(this,zt,"f"));break}yt(this,hi,i.index,"f")}yt(this,As,t.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(B(this,hi,"f")!==void 0){const i=e.data.content[B(this,hi,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,B(this,zt,"f"));break;case"text":this._emit("textDone",i.text,B(this,zt,"f"));break}}B(this,zt,"f")&&this._emit("messageDone",e.data),yt(this,zt,void 0,"f")}},qd=function(e){const t=B(this,Be,"m",Gd).call(this,e);switch(yt(this,Pr,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const r of s.step_details.tool_calls)r.index==B(this,oa,"f")?this._emit("toolCallDelta",r,t.step_details.tool_calls[r.index]):(B(this,St,"f")&&this._emit("toolCallDone",B(this,St,"f")),yt(this,oa,r.index,"f"),yt(this,St,t.step_details.tool_calls[r.index],"f"),B(this,St,"f")&&this._emit("toolCallCreated",B(this,St,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":yt(this,Pr,void 0,"f"),e.data.step_details.type=="tool_calls"&&B(this,St,"f")&&(this._emit("toolCallDone",B(this,St,"f")),yt(this,St,void 0,"f")),this._emit("runStepDone",e.data,t);break}},Bd=function(e){B(this,Xl,"f").push(e),this._emit("event",e)},Gd=function(e){switch(e.event){case"thread.run.step.created":return B(this,pn,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=B(this,pn,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const i=Xt.accumulateDelta(t,s.delta);B(this,pn,"f")[e.data.id]=i}return B(this,pn,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":B(this,pn,"f")[e.data.id]=e.data;break}if(B(this,pn,"f")[e.data.id])return B(this,pn,"f")[e.data.id];throw new Error("No snapshot available")},Vd=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const r of i.delta.content)if(r.index in t.content){let o=t.content[r.index];t.content[r.index]=B(this,Be,"m",Hd).call(this,r,o)}else t.content[r.index]=r,s.push(r);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Hd=function(e,t){return Xt.accumulateDelta(t,e)},Od=function(e){switch(yt(this,Wo,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":yt(this,Ms,e.data,"f"),B(this,St,"f")&&(this._emit("toolCallDone",B(this,St,"f")),yt(this,St,void 0,"f"));break}};class Vu extends O{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/assistants/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return Ee(e)?this.list({},e):this._client.getAPIList("/assistants",Hu,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class Hu extends Le{}Vu.AssistantsPage=Hu;function Jd(n){return typeof n.parse=="function"}const wi=n=>n?.role==="assistant",Om=n=>n?.role==="function",Jm=n=>n?.role==="tool";function Ou(n){return n?.$brand==="auto-parseable-response-format"}function zr(n){return n?.$brand==="auto-parseable-tool"}function aT(n,e){return!e||!Wm(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Ju(n,e)}function Ju(n,e){const t=n.choices.map(s=>{if(s.finish_reason==="length")throw new Am;if(s.finish_reason==="content_filter")throw new bm;return{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:s.message.tool_calls?.map(i=>uT(e,i))??void 0}:void 0,parsed:s.message.content&&!s.message.refusal?lT(e,s.message.content):null}}});return{...n,choices:t}}function lT(n,e){return n.response_format?.type!=="json_schema"?null:n.response_format?.type==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function uT(n,e){const t=n.tools?.find(s=>s.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:zr(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function cT(n,e){if(!n)return!1;const t=n.tools?.find(s=>s.function?.name===e.function.name);return zr(t)||t?.function.strict||!1}function Wm(n){return Ou(n.response_format)?!0:n.tools?.some(e=>zr(e)||e.type==="function"&&e.function.strict===!0)??!1}function dT(n){for(const e of n??[]){if(e.type!=="function")throw new G(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new G(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var ut=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},ze,Ql,aa,Zl,jl,eu,zm,tu;const Wd=10;class Km extends Gu{constructor(){super(...arguments),ze.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(Om(e)||Jm(e))&&e.content)this._emit("functionCallResult",e.content);else if(wi(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(wi(e)&&e.tool_calls)for(const s of e.tool_calls)s.type==="function"&&this._emit("functionCall",s.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new G("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),ut(this,ze,"m",Ql).call(this)}async finalMessage(){return await this.done(),ut(this,ze,"m",aa).call(this)}async finalFunctionCall(){return await this.done(),ut(this,ze,"m",Zl).call(this)}async finalFunctionCallResult(){return await this.done(),ut(this,ze,"m",jl).call(this)}async totalUsage(){return await this.done(),ut(this,ze,"m",eu).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=ut(this,ze,"m",aa).call(this);t&&this._emit("finalMessage",t);const s=ut(this,ze,"m",Ql).call(this);s&&this._emit("finalContent",s);const i=ut(this,ze,"m",Zl).call(this);i&&this._emit("finalFunctionCall",i);const r=ut(this,ze,"m",jl).call(this);r!=null&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some(o=>o.usage)&&this._emit("totalUsage",ut(this,ze,"m",eu).call(this))}async _createChatCompletion(e,t,s){const i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),ut(this,ze,"m",zm).call(this,t);const r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(Ju(r,t))}async _runChatCompletion(e,t,s){for(const i of t.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,t,s)}async _runFunctions(e,t,s){const i="function",{function_call:r="auto",stream:o,...l}=t,d=typeof r!="string"&&r?.name,{maxChatCompletions:c=Wd}=s||{},f={};for(const h of t.functions)f[h.name||h.function.name]=h;const p=t.functions.map(h=>({name:h.name||h.function.name,parameters:h.parameters,description:h.description}));for(const h of t.messages)this._addMessage(h,!1);for(let h=0;h<c;++h){const g=(await this._createChatCompletion(e,{...l,function_call:r,functions:p,messages:[...this.messages]},s)).choices[0]?.message;if(!g)throw new G("missing message in ChatCompletion response");if(!g.function_call)return;const{name:v,arguments:_}=g.function_call,w=f[v];if(w){if(d&&d!==v){const R=`Invalid function_call: ${JSON.stringify(v)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:i,name:v,content:R});continue}}else{const R=`Invalid function_call: ${JSON.stringify(v)}. Available options are: ${p.map(M=>JSON.stringify(M.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:v,content:R});continue}let E;try{E=Jd(w)?await w.parse(_):_}catch(R){this._addMessage({role:i,name:v,content:R instanceof Error?R.message:String(R)});continue}const S=await w.function(E,this),T=ut(this,ze,"m",tu).call(this,S);if(this._addMessage({role:i,name:v,content:T}),d)return}}async _runTools(e,t,s){const i="tool",{tool_choice:r="auto",stream:o,...l}=t,d=typeof r!="string"&&r?.function?.name,{maxChatCompletions:c=Wd}=s||{},f=t.tools.map(m=>{if(zr(m)){if(!m.$callback)throw new G("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:m.$callback,name:m.function.name,description:m.function.description||"",parameters:m.function.parameters,parse:m.$parseRaw,strict:!0}}}return m}),p={};for(const m of f)m.type==="function"&&(p[m.function.name||m.function.function.name]=m.function);const h="tools"in t?f.map(m=>m.type==="function"?{type:"function",function:{name:m.function.name||m.function.function.name,parameters:m.function.parameters,description:m.function.description,strict:m.function.strict}}:m):void 0;for(const m of t.messages)this._addMessage(m,!1);for(let m=0;m<c;++m){const v=(await this._createChatCompletion(e,{...l,tool_choice:r,tools:h,messages:[...this.messages]},s)).choices[0]?.message;if(!v)throw new G("missing message in ChatCompletion response");if(!v.tool_calls?.length)return;for(const _ of v.tool_calls){if(_.type!=="function")continue;const w=_.id,{name:E,arguments:S}=_.function,T=p[E];if(T){if(d&&d!==E){const k=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(d)} requested. Please try again`;this._addMessage({role:i,tool_call_id:w,content:k});continue}}else{const k=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${Object.keys(p).map(I=>JSON.stringify(I)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:w,content:k});continue}let R;try{R=Jd(T)?await T.parse(S):S}catch(k){const I=k instanceof Error?k.message:String(k);this._addMessage({role:i,tool_call_id:w,content:I});continue}const M=await T.function(R,this),x=ut(this,ze,"m",tu).call(this,M);if(this._addMessage({role:i,tool_call_id:w,content:x}),d)return}}}}ze=new WeakSet,Ql=function(){return ut(this,ze,"m",aa).call(this).content??null},aa=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(wi(t)){const{function_call:s,...i}=t,r={...i,content:t.content??null,refusal:t.refusal??null};return s&&(r.function_call=s),r}}throw new G("stream ended without producing a ChatCompletionMessage with role=assistant")},Zl=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(wi(t)&&t?.function_call)return t.function_call;if(wi(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},jl=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Om(t)&&t.content!=null||Jm(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(s=>s.role==="assistant"&&s.tool_calls?.some(i=>i.type==="function"&&i.id===t.tool_call_id)))return t.content}},eu=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},zm=function(e){if(e.n!=null&&e.n>1)throw new G("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},tu=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class Fr extends Km{static runFunctions(e,t,s){const i=new Fr,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,t,r)),i}static runTools(e,t,s){const i=new Fr,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,r)),i}_addMessage(e,t=!0){super._addMessage(e,t),wi(e)&&e.content&&this._emit("content",e.content)}}const Ym=1,Xm=2,Qm=4,Zm=8,jm=16,eg=32,tg=64,ng=128,sg=256,ig=ng|sg,rg=jm|eg|ig|tg,og=Ym|Xm|rg,ag=Qm|Zm,fT=og|ag,$e={STR:Ym,NUM:Xm,ARR:Qm,OBJ:Zm,NULL:jm,BOOL:eg,NAN:tg,INFINITY:ng,MINUS_INFINITY:sg,INF:ig,SPECIAL:rg,ATOM:og,COLLECTION:ag,ALL:fT};class hT extends Error{}class pT extends Error{}function mT(n,e=$e.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return gT(n.trim(),e)}const gT=(n,e)=>{const t=n.length;let s=0;const i=h=>{throw new hT(`${h} at position ${s}`)},r=h=>{throw new pT(`${h} at position ${s}`)},o=()=>(p(),s>=t&&i("Unexpected end of input"),n[s]==='"'?l():n[s]==="{"?d():n[s]==="["?c():n.substring(s,s+4)==="null"||$e.NULL&e&&t-s<4&&"null".startsWith(n.substring(s))?(s+=4,null):n.substring(s,s+4)==="true"||$e.BOOL&e&&t-s<4&&"true".startsWith(n.substring(s))?(s+=4,!0):n.substring(s,s+5)==="false"||$e.BOOL&e&&t-s<5&&"false".startsWith(n.substring(s))?(s+=5,!1):n.substring(s,s+8)==="Infinity"||$e.INFINITY&e&&t-s<8&&"Infinity".startsWith(n.substring(s))?(s+=8,1/0):n.substring(s,s+9)==="-Infinity"||$e.MINUS_INFINITY&e&&1<t-s&&t-s<9&&"-Infinity".startsWith(n.substring(s))?(s+=9,-1/0):n.substring(s,s+3)==="NaN"||$e.NAN&e&&t-s<3&&"NaN".startsWith(n.substring(s))?(s+=3,NaN):f()),l=()=>{const h=s;let m=!1;for(s++;s<t&&(n[s]!=='"'||m&&n[s-1]==="\\");)m=n[s]==="\\"?!m:!1,s++;if(n.charAt(s)=='"')try{return JSON.parse(n.substring(h,++s-Number(m)))}catch(g){r(String(g))}else if($e.STR&e)try{return JSON.parse(n.substring(h,s-Number(m))+'"')}catch{return JSON.parse(n.substring(h,n.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},d=()=>{s++,p();const h={};try{for(;n[s]!=="}";){if(p(),s>=t&&$e.OBJ&e)return h;const m=l();p(),s++;try{const g=o();Object.defineProperty(h,m,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if($e.OBJ&e)return h;throw g}p(),n[s]===","&&s++}}catch{if($e.OBJ&e)return h;i("Expected '}' at end of object")}return s++,h},c=()=>{s++;const h=[];try{for(;n[s]!=="]";)h.push(o()),p(),n[s]===","&&s++}catch{if($e.ARR&e)return h;i("Expected ']' at end of array")}return s++,h},f=()=>{if(s===0){n==="-"&&$e.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n)}catch(m){if($e.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}r(String(m))}}const h=s;for(n[s]==="-"&&s++;n[s]&&!",]}".includes(n[s]);)s++;s==t&&!($e.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(n.substring(h,s))}catch{n.substring(h,s)==="-"&&$e.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n.substring(h,n.lastIndexOf("e")))}catch(g){r(String(g))}}},p=()=>{for(;s<t&&` 
\r	`.includes(n[s]);)s++};return o()},zd=n=>mT(n,$e.ALL^$e.NUM);var si=function(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},de=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},ke,Rn,ii,es,fl,bo,hl,pl,ml,Io,gl,Kd;class $r extends Km{constructor(e){super(),ke.add(this),Rn.set(this,void 0),ii.set(this,void 0),es.set(this,void 0),si(this,Rn,e,"f"),si(this,ii,[],"f")}get currentChatCompletionSnapshot(){return de(this,es,"f")}static fromReadableStream(e){const t=new $r(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){const i=new $r(t);return i._run(()=>i._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,t,s){super._createChatCompletion;const i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),de(this,ke,"m",fl).call(this);const r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const o of r)de(this,ke,"m",hl).call(this,o);if(r.controller.signal?.aborted)throw new Ut;return this._addChatCompletion(de(this,ke,"m",Io).call(this))}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),de(this,ke,"m",fl).call(this),this._connected();const i=Ur.fromReadableStream(e,this.controller);let r;for await(const o of i)r&&r!==o.id&&this._addChatCompletion(de(this,ke,"m",Io).call(this)),de(this,ke,"m",hl).call(this,o),r=o.id;if(i.controller.signal?.aborted)throw new Ut;return this._addChatCompletion(de(this,ke,"m",Io).call(this))}[(Rn=new WeakMap,ii=new WeakMap,es=new WeakMap,ke=new WeakSet,fl=function(){this.ended||si(this,es,void 0,"f")},bo=function(t){let s=de(this,ii,"f")[t.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},de(this,ii,"f")[t.index]=s,s)},hl=function(t){if(this.ended)return;const s=de(this,ke,"m",Kd).call(this,t);this._emit("chunk",t,s);for(const i of t.choices){const r=s.choices[i.index];i.delta.content!=null&&r.message?.role==="assistant"&&r.message?.content&&(this._emit("content",i.delta.content,r.message.content),this._emit("content.delta",{delta:i.delta.content,snapshot:r.message.content,parsed:r.message.parsed})),i.delta.refusal!=null&&r.message?.role==="assistant"&&r.message?.refusal&&this._emit("refusal.delta",{delta:i.delta.refusal,snapshot:r.message.refusal}),i.logprobs?.content!=null&&r.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:i.logprobs?.content,snapshot:r.logprobs?.content??[]}),i.logprobs?.refusal!=null&&r.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:i.logprobs?.refusal,snapshot:r.logprobs?.refusal??[]});const o=de(this,ke,"m",bo).call(this,r);r.finish_reason&&(de(this,ke,"m",ml).call(this,r),o.current_tool_call_index!=null&&de(this,ke,"m",pl).call(this,r,o.current_tool_call_index));for(const l of i.delta.tool_calls??[])o.current_tool_call_index!==l.index&&(de(this,ke,"m",ml).call(this,r),o.current_tool_call_index!=null&&de(this,ke,"m",pl).call(this,r,o.current_tool_call_index)),o.current_tool_call_index=l.index;for(const l of i.delta.tool_calls??[]){const d=r.message.tool_calls?.[l.index];d?.type&&(d?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:d.function?.name,index:l.index,arguments:d.function.arguments,parsed_arguments:d.function.parsed_arguments,arguments_delta:l.function?.arguments??""}):(d?.type,void 0))}}},pl=function(t,s){if(de(this,ke,"m",bo).call(this,t).done_tool_calls.has(s))return;const r=t.message.tool_calls?.[s];if(!r)throw new Error("no tool call snapshot");if(!r.type)throw new Error("tool call snapshot missing `type`");if(r.type==="function"){const o=de(this,Rn,"f")?.tools?.find(l=>l.type==="function"&&l.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:s,arguments:r.function.arguments,parsed_arguments:zr(o)?o.$parseRaw(r.function.arguments):o?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},ml=function(t){const s=de(this,ke,"m",bo).call(this,t);if(t.message.content&&!s.content_done){s.content_done=!0;const i=de(this,ke,"m",gl).call(this);this._emit("content.done",{content:t.message.content,parsed:i?i.$parseRaw(t.message.content):null})}t.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Io=function(){if(this.ended)throw new G("stream has ended, this shouldn't happen");const t=de(this,es,"f");if(!t)throw new G("request ended without sending any chunks");return si(this,es,void 0,"f"),si(this,ii,[],"f"),yT(t,de(this,Rn,"f"))},gl=function(){const t=de(this,Rn,"f")?.response_format;return Ou(t)?t:null},Kd=function(t){var s,i,r,o;let l=de(this,es,"f");const{choices:d,...c}=t;l?Object.assign(l,c):l=si(this,es,{...c,choices:[]},"f");for(const{delta:f,finish_reason:p,index:h,logprobs:m=null,...g}of t.choices){let v=l.choices[h];if(v||(v=l.choices[h]={finish_reason:p,index:h,message:{},logprobs:m,...g}),m)if(!v.logprobs)v.logprobs=Object.assign({},m);else{const{content:M,refusal:x,...k}=m;Object.assign(v.logprobs,k),M&&((s=v.logprobs).content??(s.content=[]),v.logprobs.content.push(...M)),x&&((i=v.logprobs).refusal??(i.refusal=[]),v.logprobs.refusal.push(...x))}if(p&&(v.finish_reason=p,de(this,Rn,"f")&&Wm(de(this,Rn,"f")))){if(p==="length")throw new Am;if(p==="content_filter")throw new bm}if(Object.assign(v,g),!f)continue;const{content:_,refusal:w,function_call:E,role:S,tool_calls:T,...R}=f;if(Object.assign(v.message,R),w&&(v.message.refusal=(v.message.refusal||"")+w),S&&(v.message.role=S),E&&(v.message.function_call?(E.name&&(v.message.function_call.name=E.name),E.arguments&&((r=v.message.function_call).arguments??(r.arguments=""),v.message.function_call.arguments+=E.arguments)):v.message.function_call=E),_&&(v.message.content=(v.message.content||"")+_,!v.message.refusal&&de(this,ke,"m",gl).call(this)&&(v.message.parsed=zd(v.message.content))),T){v.message.tool_calls||(v.message.tool_calls=[]);for(const{index:M,id:x,type:k,function:I,...N}of T){const F=(o=v.message.tool_calls)[M]??(o[M]={});Object.assign(F,N),x&&(F.id=x),k&&(F.type=k),I&&(F.function??(F.function={name:I.name??"",arguments:""})),I?.name&&(F.function.name=I.name),I?.arguments&&(F.function.arguments+=I.arguments,cT(de(this,Rn,"f"),F)&&(F.function.parsed_arguments=zd(F.function.arguments)))}}}return l},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",i=>{const r=t.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),this.on("error",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,o)=>t.push({resolve:r,reject:o})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ur(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function yT(n,e){const{id:t,choices:s,created:i,model:r,system_fingerprint:o,...l}=n,d={...l,id:t,choices:s.map(({message:c,finish_reason:f,index:p,logprobs:h,...m})=>{if(!f)throw new G(`missing finish_reason for choice ${p}`);const{content:g=null,function_call:v,tool_calls:_,...w}=c,E=c.role;if(!E)throw new G(`missing role for choice ${p}`);if(v){const{arguments:S,name:T}=v;if(S==null)throw new G(`missing function_call.arguments for choice ${p}`);if(!T)throw new G(`missing function_call.name for choice ${p}`);return{...m,message:{content:g,function_call:{arguments:S,name:T},role:E,refusal:c.refusal??null},finish_reason:f,index:p,logprobs:h}}return _?{...m,index:p,finish_reason:f,logprobs:h,message:{...w,role:E,content:g,refusal:c.refusal??null,tool_calls:_.map((S,T)=>{const{function:R,type:M,id:x,...k}=S,{arguments:I,name:N,...F}=R||{};if(x==null)throw new G(`missing choices[${p}].tool_calls[${T}].id
${Ro(n)}`);if(M==null)throw new G(`missing choices[${p}].tool_calls[${T}].type
${Ro(n)}`);if(N==null)throw new G(`missing choices[${p}].tool_calls[${T}].function.name
${Ro(n)}`);if(I==null)throw new G(`missing choices[${p}].tool_calls[${T}].function.arguments
${Ro(n)}`);return{...k,id:x,type:M,function:{...F,name:N,arguments:I}}})}}:{...m,message:{...w,content:g,role:E,refusal:c.refusal??null},finish_reason:f,index:p,logprobs:h}}),created:i,model:r,object:"chat.completion",...o?{system_fingerprint:o}:{}};return aT(d,e)}function Ro(n){return JSON.stringify(n)}class Ei extends $r{static fromReadableStream(e){const t=new Ei(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,s){const i=new Ei(null),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(e,t,r)),i}static runTools(e,t,s){const i=new Ei(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,r)),i}}let lg=class extends O{parse(e,t){return dT(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(s=>Ju(s,e))}runFunctions(e,t){return e.stream?Ei.runFunctions(this._client,e,t):Fr.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Ei.runTools(this._client,e,t):Fr.runTools(this._client,e,t)}stream(e,t){return $r.createChatCompletion(this._client,e,t)}},nu=class extends O{constructor(){super(...arguments),this.completions=new lg(this._client)}};(function(n){n.Completions=lg})(nu||(nu={}));class ug extends O{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class cg extends O{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class ka extends O{constructor(){super(...arguments),this.sessions=new ug(this._client),this.transcriptionSessions=new cg(this._client)}}ka.Sessions=ug;ka.TranscriptionSessions=cg;class Wu extends O{create(e,t,s){return this._client.post(`/threads/${e}/messages`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,i){return this._client.post(`/threads/${e}/messages/${t}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,t={},s){return Ee(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,zu,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class zu extends Le{}Wu.MessagesPage=zu;class Ku extends O{retrieve(e,t,s,i={},r){return Ee(i)?this.retrieve(e,t,s,{},i):this._client.get(`/threads/${e}/runs/${t}/steps/${s}`,{query:i,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t,s={},i){return Ee(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,Yu,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}}class Yu extends Le{}Ku.RunStepsPage=Yu;let Kr=class extends O{constructor(){super(...arguments),this.steps=new Ku(this._client)}create(e,t,s){const{include:i,...r}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:i},body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:t.stream??!1})}retrieve(e,t,s){return this._client.get(`/threads/${e}/runs/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,i){return this._client.post(`/threads/${e}/runs/${t}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,t={},s){return Ee(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,Xu,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const i=await this.create(e,t,s);return await this.poll(e,i.id,s)}createAndStream(e,t,s){return Xt.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){const i={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:o}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...i}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(s?.pollIntervalMs)l=s.pollIntervalMs;else{const d=o.headers.get("openai-poll-after-ms");if(d){const c=parseInt(d);isNaN(c)||(l=c)}}await Jr(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return Xt.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s,i){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,t,s,i){const r=await this.submitToolOutputs(e,t,s,i);return await this.poll(e,r.id,i)}submitToolOutputsStream(e,t,s,i){return Xt.createToolAssistantStream(e,t,this._client.beta.threads.runs,s,i)}};class Xu extends Le{}Kr.RunsPage=Xu;Kr.Steps=Ku;Kr.RunStepsPage=Yu;class Ni extends O{constructor(){super(...arguments),this.runs=new Kr(this._client),this.messages=new Wu(this._client)}create(e={},t){return Ee(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/threads/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.thread_id,s.id,t)}createAndRunStream(e,t){return Xt.createThreadAssistantStream(e,this._client.beta.threads,t)}}Ni.Runs=Kr;Ni.RunsPage=Xu;Ni.Messages=Wu;Ni.MessagesPage=zu;class Di extends O{constructor(){super(...arguments),this.realtime=new ka(this._client),this.chat=new nu(this._client),this.assistants=new Vu(this._client),this.threads=new Ni(this._client)}}Di.Realtime=ka;Di.Assistants=Vu;Di.AssistantsPage=Hu;Di.Threads=Ni;class dg extends O{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class fg extends O{retrieve(e,t,s){return this._client.get(`/containers/${e}/files/${t}/content`,{...s,headers:{Accept:"application/binary",...s?.headers},__binaryResponse:!0})}}let Na=class extends O{constructor(){super(...arguments),this.content=new fg(this._client)}create(e,t,s){return this._client.post(`/containers/${e}/files`,Bs({body:t,...s}))}retrieve(e,t,s){return this._client.get(`/containers/${e}/files/${t}`,s)}list(e,t={},s){return Ee(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,Qu,{query:t,...s})}del(e,t,s){return this._client.delete(`/containers/${e}/files/${t}`,{...s,headers:{Accept:"*/*",...s?.headers}})}};class Qu extends Le{}Na.FileListResponsesPage=Qu;Na.Content=fg;class Yr extends O{constructor(){super(...arguments),this.files=new Na(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return Ee(e)?this.list({},e):this._client.getAPIList("/containers",Zu,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class Zu extends Le{}Yr.ContainerListResponsesPage=Zu;Yr.Files=Na;Yr.FileListResponsesPage=Qu;class hg extends O{create(e,t){const s=!!e.encoding_format;let i=s?e.encoding_format:"base64";s&&ls("Request","User defined encoding_format:",e.encoding_format);const r=this._client.post("/embeddings",{body:{...e,encoding_format:i},...t});return s?r:(ls("response","Decoding base64 embeddings to float32 array"),r._thenUnwrap(o=>(o&&o.data&&o.data.forEach(l=>{const d=l.embedding;l.embedding=rT(d)}),o)))}}class ju extends O{retrieve(e,t,s,i){return this._client.get(`/evals/${e}/runs/${t}/output_items/${s}`,i)}list(e,t,s={},i){return Ee(s)?this.list(e,t,{},s):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,ec,{query:s,...i})}}class ec extends Le{}ju.OutputItemListResponsesPage=ec;class Xr extends O{constructor(){super(...arguments),this.outputItems=new ju(this._client)}create(e,t,s){return this._client.post(`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){return this._client.get(`/evals/${e}/runs/${t}`,s)}list(e,t={},s){return Ee(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,tc,{query:t,...s})}del(e,t,s){return this._client.delete(`/evals/${e}/runs/${t}`,s)}cancel(e,t,s){return this._client.post(`/evals/${e}/runs/${t}`,s)}}class tc extends Le{}Xr.RunListResponsesPage=tc;Xr.OutputItems=ju;Xr.OutputItemListResponsesPage=ec;class Qr extends O{constructor(){super(...arguments),this.runs=new Xr(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,s){return this._client.post(`/evals/${e}`,{body:t,...s})}list(e={},t){return Ee(e)?this.list({},e):this._client.getAPIList("/evals",nc,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class nc extends Le{}Qr.EvalListResponsesPage=nc;Qr.Runs=Xr;Qr.RunListResponsesPage=tc;let sc=class extends O{create(e,t){return this._client.post("/files",Bs({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return Ee(e)?this.list({},e):this._client.getAPIList("/files",ic,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=1800*1e3}={}){const i=new Set(["processed","error","deleted"]),r=Date.now();let o=await this.retrieve(e);for(;!o.status||!i.has(o.status);)if(await Jr(t),o=await this.retrieve(e),Date.now()-r>s)throw new $u({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return o}};class ic extends Le{}sc.FileObjectsPage=ic;class pg extends O{}let mg=class extends O{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class rc extends O{constructor(){super(...arguments),this.graders=new mg(this._client)}}rc.Graders=mg;class oc extends O{create(e,t,s){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,ac,{body:t,method:"post",...s})}retrieve(e,t={},s){return Ee(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}del(e,t,s){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,s)}}class ac extends Ra{}oc.PermissionCreateResponsesPage=ac;let Da=class extends O{constructor(){super(...arguments),this.permissions=new oc(this._client)}};Da.Permissions=oc;Da.PermissionCreateResponsesPage=ac;class lc extends O{list(e,t={},s){return Ee(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,uc,{query:t,...s})}}class uc extends Le{}lc.FineTuningJobCheckpointsPage=uc;class Li extends O{constructor(){super(...arguments),this.checkpoints=new lc(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return Ee(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",cc,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return Ee(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,dc,{query:t,...s})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class cc extends Le{}class dc extends Le{}Li.FineTuningJobsPage=cc;Li.FineTuningJobEventsPage=dc;Li.Checkpoints=lc;Li.FineTuningJobCheckpointsPage=uc;class ds extends O{constructor(){super(...arguments),this.methods=new pg(this._client),this.jobs=new Li(this._client),this.checkpoints=new Da(this._client),this.alpha=new rc(this._client)}}ds.Methods=pg;ds.Jobs=Li;ds.FineTuningJobsPage=cc;ds.FineTuningJobEventsPage=dc;ds.Checkpoints=Da;ds.Alpha=rc;class gg extends O{}class fc extends O{constructor(){super(...arguments),this.graderModels=new gg(this._client)}}fc.GraderModels=gg;class yg extends O{createVariation(e,t){return this._client.post("/images/variations",Bs({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",Bs({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let hc=class extends O{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",pc,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}};class pc extends Ra{}hc.ModelsPage=pc;class _g extends O{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function _T(n,e){return!e||!wT(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(s=>({...s,parsed:null}))}:t)}:vg(n,e)}function vg(n,e){const t=n.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:TT(e,i)};if(i.type==="message"){const r=i.content.map(o=>o.type==="output_text"?{...o,parsed:vT(e,o.text)}:o);return{...i,content:r}}return i}),s=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||wg(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(const i of s.output)if(i.type==="message"){for(const r of i.content)if(r.type==="output_text"&&r.parsed!==null)return r.parsed}return null}}),s}function vT(n,e){return n.text?.format?.type!=="json_schema"?null:"$parseRaw"in n.text?.format?(n.text?.format).$parseRaw(e):JSON.parse(e)}function wT(n){return!!Ou(n.text?.format)}function ET(n){return n?.$brand==="auto-parseable-tool"}function ST(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function TT(n,e){const t=ST(n.tools??[],e.name);return{...e,...e,parsed_arguments:ET(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function wg(n){const e=[];for(const t of n.output)if(t.type==="message")for(const s of t.content)s.type==="output_text"&&e.push(s.text);n.output_text=e.join("")}class Eg extends O{list(e,t={},s){return Ee(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,AT,{query:t,...s})}}var ri=function(n,e,t,s,i){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},ts=function(n,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!s:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(n):s?s.value:e.get(n)},oi,Po,ns,xo,Yd,Xd,Qd,Zd;class mc extends Gu{constructor(e){super(),oi.add(this),Po.set(this,void 0),ns.set(this,void 0),xo.set(this,void 0),ri(this,Po,e,"f")}static createResponse(e,t,s){const i=new mc(t);return i._run(()=>i._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,t,s){const i=s?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),ts(this,oi,"m",Yd).call(this);let r,o=null;"response_id"in t?(r=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),o=t.starting_after??null):r=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(const l of r)ts(this,oi,"m",Xd).call(this,l,o);if(r.controller.signal?.aborted)throw new Ut;return ts(this,oi,"m",Qd).call(this)}[(Po=new WeakMap,ns=new WeakMap,xo=new WeakMap,oi=new WeakSet,Yd=function(){this.ended||ri(this,ns,void 0,"f")},Xd=function(t,s){if(this.ended)return;const i=(o,l)=>{(s==null||l.sequence_number>s)&&this._emit(o,l)},r=ts(this,oi,"m",Zd).call(this,t);switch(i("event",t),t.type){case"response.output_text.delta":{const o=r.output[t.output_index];if(!o)throw new G(`missing output at index ${t.output_index}`);if(o.type==="message"){const l=o.content[t.content_index];if(!l)throw new G(`missing content at index ${t.content_index}`);if(l.type!=="output_text")throw new G(`expected content to be 'output_text', got ${l.type}`);i("response.output_text.delta",{...t,snapshot:l.text})}break}case"response.function_call_arguments.delta":{const o=r.output[t.output_index];if(!o)throw new G(`missing output at index ${t.output_index}`);o.type==="function_call"&&i("response.function_call_arguments.delta",{...t,snapshot:o.arguments});break}default:i(t.type,t);break}},Qd=function(){if(this.ended)throw new G("stream has ended, this shouldn't happen");const t=ts(this,ns,"f");if(!t)throw new G("request ended without sending any events");ri(this,ns,void 0,"f");const s=CT(t,ts(this,Po,"f"));return ri(this,xo,s,"f"),s},Zd=function(t){let s=ts(this,ns,"f");if(!s){if(t.type!=="response.created")throw new G(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return s=ri(this,ns,t.response,"f"),s}switch(t.type){case"response.output_item.added":{s.output.push(t.item);break}case"response.content_part.added":{const i=s.output[t.output_index];if(!i)throw new G(`missing output at index ${t.output_index}`);i.type==="message"&&i.content.push(t.part);break}case"response.output_text.delta":{const i=s.output[t.output_index];if(!i)throw new G(`missing output at index ${t.output_index}`);if(i.type==="message"){const r=i.content[t.content_index];if(!r)throw new G(`missing content at index ${t.content_index}`);if(r.type!=="output_text")throw new G(`expected content to be 'output_text', got ${r.type}`);r.text+=t.delta}break}case"response.function_call_arguments.delta":{const i=s.output[t.output_index];if(!i)throw new G(`missing output at index ${t.output_index}`);i.type==="function_call"&&(i.arguments+=t.delta);break}case"response.completed":{ri(this,ns,t.response,"f");break}}return s},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",i=>{const r=t.shift();r?r.resolve(i):e.push(i)}),this.on("end",()=>{s=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),this.on("error",i=>{s=!0;for(const r of t)r.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((r,o)=>t.push({resolve:r,reject:o})).then(r=>r?{value:r,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=ts(this,xo,"f");if(!e)throw new G("stream ended without producing a ChatCompletion");return e}}function CT(n,e){return _T(n,e)}class gc extends O{constructor(){super(...arguments),this.inputItems=new Eg(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&wg(s),s))}retrieve(e,t={},s){return this._client.get(`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(s=>vg(s,e))}stream(e,t){return mc.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class AT extends Le{}gc.InputItems=Eg;class Sg extends O{create(e,t,s){return this._client.post(`/uploads/${e}/parts`,Bs({body:t,...s}))}}class yc extends O{constructor(){super(...arguments),this.parts=new Sg(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(`/uploads/${e}/complete`,{body:t,...s})}}yc.Parts=Sg;const bT=async n=>{const e=await Promise.allSettled(n),t=e.filter(i=>i.status==="rejected");if(t.length){for(const i of t)console.error(i.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const s=[];for(const i of e)i.status==="fulfilled"&&s.push(i.value);return s};let La=class extends O{create(e,t,s){return this._client.post(`/vector_stores/${e}/files`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,i){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}list(e,t={},s){return Ee(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,Ua,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const i=await this.create(e,t,s);return await this.poll(e,i.id,s)}async poll(e,t,s){const i={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const r=await this.retrieve(e,t,{...s,headers:i}).withResponse(),o=r.data;switch(o.status){case"in_progress":let l=5e3;if(s?.pollIntervalMs)l=s.pollIntervalMs;else{const d=r.response.headers.get("openai-poll-after-ms");if(d){const c=parseInt(d);isNaN(c)||(l=c)}}await Jr(l);break;case"failed":case"completed":return o}}}async upload(e,t,s){const i=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:i.id},s)}async uploadAndPoll(e,t,s){const i=await this.upload(e,t,s);return await this.poll(e,i.id,s)}content(e,t,s){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,_c,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}};class Ua extends Le{}class _c extends Ra{}La.VectorStoreFilesPage=Ua;La.FileContentResponsesPage=_c;class Tg extends O{create(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const i=await this.create(e,t);return await this.poll(e,i.id,s)}listFiles(e,t,s={},i){return Ee(s)?this.listFiles(e,t,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,Ua,{query:s,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}async poll(e,t,s){const i={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:o}=await this.retrieve(e,t,{...s,headers:i}).withResponse();switch(r.status){case"in_progress":let l=5e3;if(s?.pollIntervalMs)l=s.pollIntervalMs;else{const d=o.headers.get("openai-poll-after-ms");if(d){const c=parseInt(d);isNaN(c)||(l=c)}}await Jr(l);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},i){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=i?.maxConcurrency??5,o=Math.min(r,t.length),l=this._client,d=t.values(),c=[...s];async function f(h){for(let m of h){const g=await l.files.create({file:m,purpose:"assistants"},i);c.push(g.id)}}const p=Array(o).fill(d).map(f);return await bT(p),await this.createAndPoll(e,{file_ids:c})}}class fs extends O{constructor(){super(...arguments),this.files=new La(this._client),this.fileBatches=new Tg(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/vector_stores/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return Ee(e)?this.list({},e):this._client.getAPIList("/vector_stores",vc,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,s){return this._client.getAPIList(`/vector_stores/${e}/search`,wc,{body:t,method:"post",...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class vc extends Le{}class wc extends Ra{}fs.VectorStoresPage=vc;fs.VectorStoreSearchResponsesPage=wc;fs.Files=La;fs.VectorStoreFilesPage=Ua;fs.FileContentResponsesPage=_c;fs.FileBatches=Tg;var Cg;class H extends zS{constructor({baseURL:e=xs("OPENAI_BASE_URL"),apiKey:t=xs("OPENAI_API_KEY"),organization:s=xs("OPENAI_ORG_ID")??null,project:i=xs("OPENAI_PROJECT_ID")??null,...r}={}){if(t===void 0)throw new G("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:s,project:i,...r,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&sT())throw new G(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new dg(this),this.chat=new Ma(this),this.embeddings=new hg(this),this.files=new sc(this),this.images=new yg(this),this.audio=new Wr(this),this.moderations=new _g(this),this.models=new hc(this),this.fineTuning=new ds(this),this.graders=new fc(this),this.vectorStores=new fs(this),this.beta=new Di(this),this.batches=new qu(this),this.uploads=new yc(this),this.responses=new gc(this),this.evals=new Qr(this),this.containers=new Yr(this),this._options=o,this.apiKey=t,this.organization=s,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return PS(e,{arrayFormat:"brackets"})}}Cg=H;H.OpenAI=Cg;H.DEFAULT_TIMEOUT=6e5;H.OpenAIError=G;H.APIError=pt;H.APIConnectionError=Aa;H.APIConnectionTimeoutError=$u;H.APIUserAbortError=Ut;H.NotFoundError=wm;H.ConflictError=Em;H.RateLimitError=Tm;H.BadRequestError=ym;H.AuthenticationError=_m;H.InternalServerError=Cm;H.PermissionDeniedError=vm;H.UnprocessableEntityError=Sm;H.toFile=xm;H.fileFromPath=pm;H.Completions=dg;H.Chat=Ma;H.ChatCompletionsPage=xa;H.Embeddings=hg;H.Files=sc;H.FileObjectsPage=ic;H.Images=yg;H.Audio=Wr;H.Moderations=_g;H.Models=hc;H.ModelsPage=pc;H.FineTuning=ds;H.Graders=fc;H.VectorStores=fs;H.VectorStoresPage=vc;H.VectorStoreSearchResponsesPage=wc;H.Beta=Di;H.Batches=qu;H.BatchesPage=Bu;H.Uploads=yc;H.Responses=gc;H.Evals=Qr;H.EvalListResponsesPage=nc;H.Containers=Yr;H.ContainerListResponsesPage=Zu;class IT extends H{constructor({baseURL:e=xs("OPENAI_BASE_URL"),apiKey:t=xs("AZURE_OPENAI_API_KEY"),apiVersion:s=xs("OPENAI_API_VERSION"),endpoint:i,deployment:r,azureADTokenProvider:o,dangerouslyAllowBrowser:l,...d}={}){if(!s)throw new G("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if(typeof o=="function"&&(l=!0),!o&&!t)throw new G("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(o&&t)throw new G("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(t??(t=jd),d.defaultQuery={...d.defaultQuery,"api-version":s},e){if(i)throw new G("baseURL and endpoint are mutually exclusive")}else{if(i||(i=process.env.AZURE_OPENAI_ENDPOINT),!i)throw new G("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");e=`${i}/openai`}super({apiKey:t,baseURL:e,...d,...l!==void 0?{dangerouslyAllowBrowser:l}:{}}),this.apiVersion="",this._azureADTokenProvider=o,this.apiVersion=s,this.deploymentName=r}buildRequest(e,t={}){if(RT.has(e.path)&&e.method==="post"&&e.body!==void 0){if(!Bo(e.body))throw new Error("Expected request body to be an object");const s=this.deploymentName||e.body.model||e.__metadata?.model;s!==void 0&&!this.baseURL.includes("/deployments")&&(e.path=`/deployments/${s}${e.path}`)}return super.buildRequest(e,t)}async _getAzureADToken(){if(typeof this._azureADTokenProvider=="function"){const e=await this._azureADTokenProvider();if(!e||typeof e!="string")throw new G(`Expected 'azureADTokenProvider' argument to return a string but it returned ${e}`);return e}}authHeaders(e){return{}}async prepareOptions(e){if(e.headers?.["api-key"])return super.prepareOptions(e);const t=await this._getAzureADToken();if(e.headers??(e.headers={}),t)e.headers.Authorization=`Bearer ${t}`;else if(this.apiKey!==jd)e.headers["api-key"]=this.apiKey;else throw new G("Unable to handle auth");return super.prepareOptions(e)}}const RT=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/images/edits"]),jd="<Missing Key>";function lr(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function ef(n){if(typeof n=="object"&&n!==null&&"reasoning_content"in n){const e=n.reasoning_content;if(typeof e=="string")return e}}class nn{async generateResponse(e,t,s){const i=await e.chat.completions.create(this.buildChatCompletionCreateParams({request:t,stream:!1}),{signal:s?.signal});return this.parseNonStreamingResponse(i)}async streamResponse(e,t,s){const i=await e.chat.completions.create(this.buildChatCompletionCreateParams({request:t,stream:!0}),{signal:s?.signal});return this.streamResponseGenerator(i)}async*streamResponseGenerator(e){for await(const t of e)yield this.parseStreamingResponseChunk(t)}buildChatCompletionCreateParams({request:e,stream:t}){if(t){const i={model:e.model,tools:e.tools,tool_choice:e.tool_choice,reasoning_effort:e.reasoning_effort,web_search_options:e.web_search_options,messages:e.messages.map(r=>this.parseRequestMessage(r)),max_tokens:e.max_tokens,temperature:e.temperature,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty,logit_bias:e.logit_bias,prediction:e.prediction,stream:!0,stream_options:{include_usage:!0}};return this.attachVendorExtensions(i,e)}const s={model:e.model,tools:e.tools,tool_choice:e.tool_choice,reasoning_effort:e.reasoning_effort,web_search_options:e.web_search_options,messages:e.messages.map(i=>this.parseRequestMessage(i)),max_tokens:e.max_tokens,temperature:e.temperature,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty,logit_bias:e.logit_bias,prediction:e.prediction};return this.attachVendorExtensions(s,e)}attachVendorExtensions(e,t){const s=e;lr(t,"thinking")&&t.thinking&&typeof t.thinking=="object"&&(s.thinking=t.thinking);const i=lr(t,"thinking_config")&&t.thinking_config&&typeof t.thinking_config=="object"&&t.thinking_config||lr(t,"thinkingConfig")&&t.thinkingConfig&&typeof t.thinkingConfig=="object"&&t.thinkingConfig;if(i&&(s.thinking_config=i),lr(t,"extra_body")&&t.extra_body&&typeof t.extra_body=="object"){const{tools:r,...o}=t.extra_body;Array.isArray(r)&&(s.tools=r,lr(s,"tool_choice")&&delete s.tool_choice),Object.keys(o).length>0&&(s.extra_body=o)}return e}parseRequestMessage(e){switch(e.role){case"user":return{role:"user",content:Array.isArray(e.content)?e.content.map(s=>{switch(s.type){case"text":return{type:"text",text:s.text};case"image_url":return{type:"image_url",image_url:s.image_url}}}):e.content};case"assistant":{if(Array.isArray(e.content))throw new Error("Assistant message should be a string");return{role:"assistant",content:e.content,tool_calls:e.tool_calls?.map(t=>({id:t.id,function:{arguments:t.arguments??"{}",name:t.name},type:"function"}))}}case"system":{if(Array.isArray(e.content))throw new Error("System message should be a string");return{role:"system",content:e.content}}case"tool":return{role:"tool",content:e.content,tool_call_id:e.tool_call.id}}}parseNonStreamingResponse(e){return{id:e.id,choices:e.choices.map(t=>({finish_reason:t.finish_reason,message:{content:t.message.content,reasoning:ef(t.message),role:t.message.role,tool_calls:t.message.tool_calls}})),created:e.created,model:e.model,object:"chat.completion",system_fingerprint:e.system_fingerprint,usage:e.usage}}parseStreamingResponseChunk(e){return{id:e.id,choices:e.choices.map(t=>({finish_reason:t.finish_reason??null,delta:{content:t.delta.content??null,reasoning:ef(t.delta),role:t.delta.role,tool_calls:t.delta.tool_calls}})),created:e.created,model:e.model,object:"chat.completion.chunk",system_fingerprint:e.system_fingerprint,usage:e.usage??void 0}}}class PT extends bt{constructor(e){super(e),this.adapter=new nn,this.client=new IT({apiKey:e.apiKey??"",endpoint:e.baseUrl??"",apiVersion:e.additionalSettings.apiVersion,deployment:e.additionalSettings.deployment,dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="azure-openai")throw new Error("Model is not an Azure OpenAI model");const i=this.applyCustomModelParameters(e,t);return this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="azure-openai")throw new Error("Model is not an Azure OpenAI model");const i=this.applyCustomModelParameters(e,t);return this.adapter.streamResponse(this.client,i,s)}}function xT(n,e){const t=typeof n=="string"?[{type:"text",text:n}]:n,s=typeof e=="string"?[{type:"text",text:e}]:e,i=[...t,...s].filter(r=>!(r.type==="text"&&r.text.trim().length===0));return i.every(r=>r.type==="text")?i.map(r=>r.text).join(`

`):i}function Pi(n){const e=[],t=n.filter(i=>i.role==="system"),s=n.filter(i=>i.role!=="system");if(t.length>0){const i=t.map(r=>typeof r.content=="string"?r.content:"").filter(r=>r.trim().length>0).join(`

`);i.trim().length>0&&e.push({role:"system",content:i})}for(const i of s){const r=e[e.length-1];r&&r.role===i.role?r.content=xT(r.content,i.content):e.push(i)}return e}class MT extends nn{parseNonStreamingResponse(e){return{id:e.id,choices:e.choices.map(t=>({finish_reason:t.finish_reason,message:{content:t.message.content,reasoning:t.message.reasoning_content,role:t.message.role,tool_calls:t.message.tool_calls}})),created:e.created,model:e.model,object:"chat.completion",system_fingerprint:e.system_fingerprint,usage:e.usage}}parseStreamingResponseChunk(e){return{id:e.id,choices:e.choices.map(t=>({finish_reason:t.finish_reason??null,delta:{content:t.delta.content??null,reasoning:t.delta.reasoning_content,role:t.delta.role,tool_calls:t.delta.tool_calls}})),created:e.created,model:e.model,object:"chat.completion.chunk",system_fingerprint:e.system_fingerprint,usage:e.usage??void 0}}}class kT extends bt{constructor(e){super(e),this.adapter=new MT,this.client=new H({apiKey:e.apiKey??"",baseURL:e.baseUrl?e.baseUrl.replace(/\/+$/,""):"https://api.deepseek.com",dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="deepseek")throw new Error("Model is not a DeepSeek model");if(!this.client.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);let i={...t,messages:Pi(t.messages)};return i=this.applyCustomModelParameters(e,i),this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="deepseek")throw new Error("Model is not a DeepSeek model");if(!this.client.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);let i={...t,messages:Pi(t.messages)};return i=this.applyCustomModelParameters(e,i),this.adapter.streamResponse(this.client,i,s)}}let NT,DT;function LT(){return{geminiUrl:NT,vertexUrl:DT}}function UT(n,e,t,s){var i,r;if(!n?.baseUrl){const o=LT();return e?(i=o.vertexUrl)!==null&&i!==void 0?i:t:(r=o.geminiUrl)!==null&&r!==void 0?r:s}return n.baseUrl}class Gn{}function L(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(s,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const r=e[i];return r!=null?String(r):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function u(n,e,t){for(let r=0;r<e.length-1;r++){const o=e[r];if(o.endsWith("[]")){const l=o.slice(0,-2);if(!(l in n))if(Array.isArray(t))n[l]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${o}`);if(Array.isArray(n[l])){const d=n[l];if(Array.isArray(t))for(let c=0;c<d.length;c++){const f=d[c];u(f,e.slice(r+1),t[c])}else for(const c of d)u(c,e.slice(r+1),t)}return}else if(o.endsWith("[0]")){const l=o.slice(0,-3);l in n||(n[l]=[{}]);const d=n[l];u(d[0],e.slice(r+1),t);return}(!n[o]||typeof n[o]!="object")&&(n[o]={}),n=n[o]}const s=e[e.length-1],i=n[s];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${s}`)}else s==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[s]=t}function a(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let s=0;s<e.length;s++){if(typeof n!="object"||n===null)return t;const i=e[s];if(i.endsWith("[]")){const r=i.slice(0,-2);if(r in n){const o=n[r];return Array.isArray(o)?o.map(l=>a(l,e.slice(s+1),t)):t}else return t}else n=n[i]}return n}catch(s){if(s instanceof TypeError)return t;throw s}}function FT(n,e){for(const[t,s]of Object.entries(e)){const i=t.split("."),r=s.split("."),o=new Set;let l=-1;for(let d=0;d<i.length;d++)if(i[d]==="*"){l=d;break}if(l!==-1&&r.length>l)for(let d=l;d<r.length;d++){const c=r[d];c!=="*"&&!c.endsWith("[]")&&!c.endsWith("[0]")&&o.add(c)}su(n,i,r,0,o)}}function su(n,e,t,s,i){if(s>=e.length||typeof n!="object"||n===null)return;const r=e[s];if(r.endsWith("[]")){const o=r.slice(0,-2),l=n;if(o in l&&Array.isArray(l[o]))for(const d of l[o])su(d,e,t,s+1,i)}else if(r==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const o=n,l=Object.keys(o).filter(c=>!c.startsWith("_")&&!i.has(c)),d={};for(const c of l)d[c]=o[c];for(const[c,f]of Object.entries(d)){const p=[];for(const h of t.slice(s))h==="*"?p.push(c):p.push(h);u(o,p,f)}for(const c of l)delete o[c]}}else{const o=n;r in o&&su(o[r],e,t,s+1,i)}}function Ec(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function $T(n){const e={},t=a(n,["operationName"]);t!=null&&u(e,["operationName"],t);const s=a(n,["resourceName"]);return s!=null&&u(e,["_url","resourceName"],s),e}function qT(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["metadata"]);s!=null&&u(e,["metadata"],s);const i=a(n,["done"]);i!=null&&u(e,["done"],i);const r=a(n,["error"]);r!=null&&u(e,["error"],r);const o=a(n,["response","generateVideoResponse"]);return o!=null&&u(e,["response"],GT(o)),e}function BT(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["metadata"]);s!=null&&u(e,["metadata"],s);const i=a(n,["done"]);i!=null&&u(e,["done"],i);const r=a(n,["error"]);r!=null&&u(e,["error"],r);const o=a(n,["response"]);return o!=null&&u(e,["response"],VT(o)),e}function GT(n){const e={},t=a(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>HT(o))),u(e,["generatedVideos"],r)}const s=a(n,["raiMediaFilteredCount"]);s!=null&&u(e,["raiMediaFilteredCount"],s);const i=a(n,["raiMediaFilteredReasons"]);return i!=null&&u(e,["raiMediaFilteredReasons"],i),e}function VT(n){const e={},t=a(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>OT(o))),u(e,["generatedVideos"],r)}const s=a(n,["raiMediaFilteredCount"]);s!=null&&u(e,["raiMediaFilteredCount"],s);const i=a(n,["raiMediaFilteredReasons"]);return i!=null&&u(e,["raiMediaFilteredReasons"],i),e}function HT(n){const e={},t=a(n,["video"]);return t!=null&&u(e,["video"],XT(t)),e}function OT(n){const e={},t=a(n,["_self"]);return t!=null&&u(e,["video"],QT(t)),e}function JT(n){const e={},t=a(n,["operationName"]);return t!=null&&u(e,["_url","operationName"],t),e}function WT(n){const e={},t=a(n,["operationName"]);return t!=null&&u(e,["_url","operationName"],t),e}function zT(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["metadata"]);s!=null&&u(e,["metadata"],s);const i=a(n,["done"]);i!=null&&u(e,["done"],i);const r=a(n,["error"]);r!=null&&u(e,["error"],r);const o=a(n,["response"]);return o!=null&&u(e,["response"],KT(o)),e}function KT(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["parent"]);s!=null&&u(e,["parent"],s);const i=a(n,["documentName"]);return i!=null&&u(e,["documentName"],i),e}function Ag(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["metadata"]);s!=null&&u(e,["metadata"],s);const i=a(n,["done"]);i!=null&&u(e,["done"],i);const r=a(n,["error"]);r!=null&&u(e,["error"],r);const o=a(n,["response"]);return o!=null&&u(e,["response"],YT(o)),e}function YT(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["parent"]);s!=null&&u(e,["parent"],s);const i=a(n,["documentName"]);return i!=null&&u(e,["documentName"],i),e}function XT(n){const e={},t=a(n,["uri"]);t!=null&&u(e,["uri"],t);const s=a(n,["encodedVideo"]);s!=null&&u(e,["videoBytes"],Ec(s));const i=a(n,["encoding"]);return i!=null&&u(e,["mimeType"],i),e}function QT(n){const e={},t=a(n,["gcsUri"]);t!=null&&u(e,["uri"],t);const s=a(n,["bytesBase64Encoded"]);s!=null&&u(e,["videoBytes"],Ec(s));const i=a(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}var tf;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(tf||(tf={}));var nf;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(nf||(nf={}));var sf;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(sf||(sf={}));var ss;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(ss||(ss={}));var rf;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(rf||(rf={}));var of;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(of||(of={}));var af;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(af||(af={}));var lf;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(lf||(lf={}));var uf;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(uf||(uf={}));var cf;(function(n){n.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH",n.MINIMAL="MINIMAL"})(cf||(cf={}));var df;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(df||(df={}));var ff;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(ff||(ff={}));var hf;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(hf||(hf={}));var pf;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE",n.IMAGE_RECITATION="IMAGE_RECITATION",n.IMAGE_OTHER="IMAGE_OTHER"})(pf||(pf={}));var mf;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(mf||(mf={}));var gf;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(gf||(gf={}));var yf;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(yf||(yf={}));var _f;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(_f||(_f={}));var vf;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(vf||(vf={}));var la;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(la||(la={}));var wf;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(wf||(wf={}));var Ef;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(Ef||(Ef={}));var Sf;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(Sf||(Sf={}));var iu;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(iu||(iu={}));var Tf;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(Tf||(Tf={}));var Cf;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",n.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(Cf||(Cf={}));var Af;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(Af||(Af={}));var bf;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(bf||(bf={}));var If;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(If||(If={}));var Rf;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(Rf||(Rf={}));var Pf;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(Pf||(Pf={}));var xf;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(xf||(xf={}));var Mf;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(Mf||(Mf={}));var kf;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(kf||(kf={}));var Nf;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Nf||(Nf={}));var Df;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Df||(Df={}));var Lf;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Lf||(Lf={}));var Uf;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Uf||(Uf={}));var Ff;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(Ff||(Ff={}));var $f;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})($f||($f={}));var qf;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(qf||(qf={}));var Bf;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(Bf||(Bf={}));var Gf;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Gf||(Gf={}));var Vf;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(Vf||(Vf={}));var Hf;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(Hf||(Hf={}));var Of;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(Of||(Of={}));var Jf;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Jf||(Jf={}));var Wf;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(Wf||(Wf={}));var zf;(function(n){n.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",n.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",n.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(zf||(zf={}));var Kf;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Kf||(Kf={}));var Yf;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Yf||(Yf={}));var Xf;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(Xf||(Xf={}));var Qf;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Qf||(Qf={}));var Zf;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Zf||(Zf={}));var jf;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(jf||(jf={}));var pi;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(pi||(pi={}));class ru{constructor(e){const t={};for(const s of e.headers.entries())t[s[0]]=s[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class ur{get text(){var e,t,s,i,r,o,l,d;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",f=!1;const p=[];for(const h of(d=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)!==null&&d!==void 0?d:[]){for(const[m,g]of Object.entries(h))m!=="text"&&m!=="thought"&&m!=="thoughtSignature"&&(g!==null||g!==void 0)&&p.push(m);if(typeof h.text=="string"){if(typeof h.thought=="boolean"&&h.thought)continue;f=!0,c+=h.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),f?c:void 0}get data(){var e,t,s,i,r,o,l,d;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const f=[];for(const p of(d=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)!==null&&d!==void 0?d:[]){for(const[h,m]of Object.entries(p))h!=="inlineData"&&(m!==null||m!==void 0)&&f.push(h);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return f.length>0&&console.warn(`there are non-data parts ${f} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,s,i,r,o,l,d;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(d=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)===null||d===void 0?void 0:d.filter(f=>f.functionCall).map(f=>f.functionCall).filter(f=>f!==void 0);if(c?.length!==0)return c}get executableCode(){var e,t,s,i,r,o,l,d,c;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const f=(d=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)===null||d===void 0?void 0:d.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if(f?.length!==0)return(c=f?.[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,s,i,r,o,l,d,c;if(((i=(s=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||s===void 0?void 0:s.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const f=(d=(l=(o=(r=this.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content)===null||l===void 0?void 0:l.parts)===null||d===void 0?void 0:d.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if(f?.length!==0)return(c=f?.[0])===null||c===void 0?void 0:c.output}}class eh{}class th{}class ZT{}class jT{}class eC{}class tC{}class nh{}class sh{}class ih{}class nC{}class ua{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new ua;let i;const r=e;return t?i=BT(r):i=qT(r),Object.assign(s,i),s}}class rh{}class oh{}class ah{}class lh{}class sC{}class iC{}class rC{}class Sc{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new Sc,r=zT(e);return Object.assign(s,r),s}}class oC{}class aC{}class lC{}class uh{}class uC{get text(){var e,t,s;let i="",r=!1;const o=[];for(const l of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[d,c]of Object.entries(l))d!=="text"&&d!=="thought"&&c!==null&&o.push(d);if(typeof l.text=="string"){if(typeof l.thought=="boolean"&&l.thought)continue;r=!0,i+=l.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),r?i:void 0}get data(){var e,t,s;let i="";const r=[];for(const o of(s=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&s!==void 0?s:[]){for(const[l,d]of Object.entries(o))l!=="inlineData"&&d!==null&&r.push(l);o.inlineData&&typeof o.inlineData.data=="string"&&(i+=atob(o.inlineData.data))}return r.length>0&&console.warn(`there are non-data parts ${r} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class cC{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class Tc{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const s=new Tc,r=Ag(e);return Object.assign(s,r),s}}function ne(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function bg(n,e){const t=ne(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function Ig(n){return Array.isArray(n)?n.map(e=>ca(e)):[ca(n)]}function ca(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function Rg(n){const e=ca(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function Pg(n){const e=ca(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function ch(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function xg(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>ch(e)):[ch(n)]}function ou(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function dh(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function fh(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function Xe(n){if(n==null)throw new Error("ContentUnion is required");return ou(n)?n:{role:"user",parts:xg(n)}}function Cc(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const s=Xe(t);return s.parts&&s.parts.length>0&&s.parts[0].text!==void 0?[s.parts[0].text]:[]});if(n.isVertexAI()){const t=Xe(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>Xe(t)):[Xe(e)]}function Ft(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(dh(n)||fh(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[Xe(n)]}const e=[],t=[],s=ou(n[0]);for(const i of n){const r=ou(i);if(r!=s)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(r)e.push(i);else{if(dh(i)||fh(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return s||e.push({role:"user",parts:xg(t)}),e}function dC(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(s=>s!=="null");if(t.length===1)e.type=Object.values(ss).includes(t[0].toUpperCase())?t[0].toUpperCase():ss.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const s of t)e.anyOf.push({type:Object.values(ss).includes(s.toUpperCase())?s.toUpperCase():ss.TYPE_UNSPECIFIED})}}function Si(n){const e={},t=["items"],s=["anyOf"],i=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const r=n.anyOf;r!=null&&r.length==2&&(r[0].type==="null"?(e.nullable=!0,n=r[1]):r[1].type==="null"&&(e.nullable=!0,n=r[0])),n.type instanceof Array&&dC(n.type,e);for(const[o,l]of Object.entries(n))if(l!=null)if(o=="type"){if(l==="null")throw new Error("type: null can not be the only possible type for the field.");if(l instanceof Array)continue;e.type=Object.values(ss).includes(l.toUpperCase())?l.toUpperCase():ss.TYPE_UNSPECIFIED}else if(t.includes(o))e[o]=Si(l);else if(s.includes(o)){const d=[];for(const c of l){if(c.type=="null"){e.nullable=!0;continue}d.push(Si(c))}e[o]=d}else if(i.includes(o)){const d={};for(const[c,f]of Object.entries(l))d[c]=Si(f);e[o]=d}else{if(o==="additionalProperties")continue;e[o]=l}return e}function Ac(n){return Si(n)}function bc(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Ic(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Ui(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Si(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Si(e.response));return n}function Fi(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function fC(n,e,t,s=1){const i=!e.startsWith(`${t}/`)&&e.split("/").length===s;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function Vn(n,e){if(typeof e!="string")throw new Error("name must be a string");return fC(n,e,"cachedContents")}function Mg(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function hs(n){return Ec(n)}function hC(n){return n!=null&&typeof n=="object"&&"name"in n}function pC(n){return n!=null&&typeof n=="object"&&"video"in n}function mC(n){return n!=null&&typeof n=="object"&&"uri"in n}function kg(n){var e;let t;if(hC(n)&&(t=n.name),!(mC(n)&&(t=n.uri,t===void 0))&&!(pC(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Ng(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function Dg(n){for(const e of["models","tunedModels","publisherModels"])if(gC(n,e))return n[e];return[]}function gC(n,e){return n!==null&&typeof n=="object"&&e in n}function yC(n,e={}){const t=n,s={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(s.responseJsonSchema=t.outputSchema),e.behavior&&(s.behavior=e.behavior),{functionDeclarations:[s]}}function _C(n,e={}){const t=[],s=new Set;for(const i of n){const r=i.name;if(s.has(r))throw new Error(`Duplicate function name ${r} found in MCP tools. Please ensure function names are unique.`);s.add(r);const o=yC(i,e);o.functionDeclarations&&t.push(...o.functionDeclarations)}return{functionDeclarations:t}}function Lg(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const s=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,i=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(i>0||s!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(s>0||i!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function vC(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Ug(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const i=t.inlinedResponses;if(!Array.isArray(i)||i.length===0)return n;let r=!1;for(const o of i){if(typeof o!="object"||o===null)continue;const d=o.response;if(typeof d!="object"||d===null)continue;if(d.embedding!==void 0){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function $i(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function Fg(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function wC(n){const e={},t=a(n,["responsesFile"]);t!=null&&u(e,["fileName"],t);const s=a(n,["inlinedResponses","inlinedResponses"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>e0(o))),u(e,["inlinedResponses"],r)}const i=a(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),u(e,["inlinedEmbedContentResponses"],r)}return e}function EC(n){const e={},t=a(n,["predictionsFormat"]);t!=null&&u(e,["format"],t);const s=a(n,["gcsDestination","outputUriPrefix"]);s!=null&&u(e,["gcsUri"],s);const i=a(n,["bigqueryDestination","outputUri"]);return i!=null&&u(e,["bigqueryUri"],i),e}function SC(n){const e={},t=a(n,["format"]);t!=null&&u(e,["predictionsFormat"],t);const s=a(n,["gcsUri"]);s!=null&&u(e,["gcsDestination","outputUriPrefix"],s);const i=a(n,["bigqueryUri"]);if(i!=null&&u(e,["bigqueryDestination","outputUri"],i),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(a(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function zo(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["metadata","displayName"]);s!=null&&u(e,["displayName"],s);const i=a(n,["metadata","state"]);i!=null&&u(e,["state"],Fg(i));const r=a(n,["metadata","createTime"]);r!=null&&u(e,["createTime"],r);const o=a(n,["metadata","endTime"]);o!=null&&u(e,["endTime"],o);const l=a(n,["metadata","updateTime"]);l!=null&&u(e,["updateTime"],l);const d=a(n,["metadata","model"]);d!=null&&u(e,["model"],d);const c=a(n,["metadata","output"]);return c!=null&&u(e,["dest"],wC(Ug(c))),e}function au(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["displayName"]);s!=null&&u(e,["displayName"],s);const i=a(n,["state"]);i!=null&&u(e,["state"],Fg(i));const r=a(n,["error"]);r!=null&&u(e,["error"],r);const o=a(n,["createTime"]);o!=null&&u(e,["createTime"],o);const l=a(n,["startTime"]);l!=null&&u(e,["startTime"],l);const d=a(n,["endTime"]);d!=null&&u(e,["endTime"],d);const c=a(n,["updateTime"]);c!=null&&u(e,["updateTime"],c);const f=a(n,["model"]);f!=null&&u(e,["model"],f);const p=a(n,["inputConfig"]);p!=null&&u(e,["src"],TC(p));const h=a(n,["outputConfig"]);h!=null&&u(e,["dest"],EC(Ug(h)));const m=a(n,["completionStats"]);return m!=null&&u(e,["completionStats"],m),e}function TC(n){const e={},t=a(n,["instancesFormat"]);t!=null&&u(e,["format"],t);const s=a(n,["gcsSource","uris"]);s!=null&&u(e,["gcsUri"],s);const i=a(n,["bigquerySource","inputUri"]);return i!=null&&u(e,["bigqueryUri"],i),e}function CC(n,e){const t={};if(a(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(a(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const s=a(e,["fileName"]);s!=null&&u(t,["fileName"],s);const i=a(e,["inlinedRequests"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>jC(n,o))),u(t,["requests","requests"],r)}return t}function AC(n){const e={},t=a(n,["format"]);t!=null&&u(e,["instancesFormat"],t);const s=a(n,["gcsUri"]);s!=null&&u(e,["gcsSource","uris"],s);const i=a(n,["bigqueryUri"]);if(i!=null&&u(e,["bigquerySource","inputUri"],i),a(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(a(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function bC(n){const e={},t=a(n,["data"]);if(t!=null&&u(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function IC(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],$i(n,s)),t}function RC(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],$i(n,s)),t}function PC(n){const e={},t=a(n,["content"]);t!=null&&u(e,["content"],t);const s=a(n,["citationMetadata"]);s!=null&&u(e,["citationMetadata"],xC(s));const i=a(n,["tokenCount"]);i!=null&&u(e,["tokenCount"],i);const r=a(n,["finishReason"]);r!=null&&u(e,["finishReason"],r);const o=a(n,["avgLogprobs"]);o!=null&&u(e,["avgLogprobs"],o);const l=a(n,["groundingMetadata"]);l!=null&&u(e,["groundingMetadata"],l);const d=a(n,["index"]);d!=null&&u(e,["index"],d);const c=a(n,["logprobsResult"]);c!=null&&u(e,["logprobsResult"],c);const f=a(n,["safetyRatings"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>m)),u(e,["safetyRatings"],h)}const p=a(n,["urlContextMetadata"]);return p!=null&&u(e,["urlContextMetadata"],p),e}function xC(n){const e={},t=a(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>i)),u(e,["citations"],s)}return e}function $g(n){const e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>a0(r))),u(e,["parts"],i)}const s=a(n,["role"]);return s!=null&&u(e,["role"],s),e}function MC(n,e){const t={},s=a(n,["displayName"]);if(e!==void 0&&s!=null&&u(e,["batch","displayName"],s),a(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function kC(n,e){const t={},s=a(n,["displayName"]);e!==void 0&&s!=null&&u(e,["displayName"],s);const i=a(n,["dest"]);return e!==void 0&&i!=null&&u(e,["outputConfig"],SC(vC(i))),t}function hh(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["src"]);i!=null&&u(t,["batch","inputConfig"],CC(n,Lg(n,i)));const r=a(e,["config"]);return r!=null&&MC(r,t),t}function NC(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["model"],ne(n,s));const i=a(e,["src"]);i!=null&&u(t,["inputConfig"],AC(Lg(n,i)));const r=a(e,["config"]);return r!=null&&kC(r,t),t}function DC(n,e){const t={},s=a(n,["displayName"]);return e!==void 0&&s!=null&&u(e,["batch","displayName"],s),t}function LC(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["src"]);i!=null&&u(t,["batch","inputConfig"],VC(n,i));const r=a(e,["config"]);return r!=null&&DC(r,t),t}function UC(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],$i(n,s)),t}function FC(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],$i(n,s)),t}function $C(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["name"]);s!=null&&u(e,["name"],s);const i=a(n,["done"]);i!=null&&u(e,["done"],i);const r=a(n,["error"]);return r!=null&&u(e,["error"],r),e}function qC(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["name"]);s!=null&&u(e,["name"],s);const i=a(n,["done"]);i!=null&&u(e,["done"],i);const r=a(n,["error"]);return r!=null&&u(e,["error"],r),e}function BC(n,e){const t={},s=a(e,["contents"]);if(s!=null){let r=Cc(n,s);Array.isArray(r)&&(r=r.map(o=>o)),u(t,["requests[]","request","content"],r)}const i=a(e,["config"]);return i!=null&&(u(t,["_self"],GC(i,t)),FT(t,{"requests[].*":"requests[].request.*"})),t}function GC(n,e){const t={},s=a(n,["taskType"]);e!==void 0&&s!=null&&u(e,["requests[]","taskType"],s);const i=a(n,["title"]);e!==void 0&&i!=null&&u(e,["requests[]","title"],i);const r=a(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&u(e,["requests[]","outputDimensionality"],r),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function VC(n,e){const t={},s=a(e,["fileName"]);s!=null&&u(t,["file_name"],s);const i=a(e,["inlinedRequests"]);return i!=null&&u(t,["requests"],BC(n,i)),t}function HC(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function OC(n){const e={},t=a(n,["id"]);t!=null&&u(e,["id"],t);const s=a(n,["args"]);s!=null&&u(e,["args"],s);const i=a(n,["name"]);if(i!=null&&u(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function JC(n){const e={},t=a(n,["mode"]);t!=null&&u(e,["mode"],t);const s=a(n,["allowedFunctionNames"]);if(s!=null&&u(e,["allowedFunctionNames"],s),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function WC(n,e,t){const s={},i=a(e,["systemInstruction"]);t!==void 0&&i!=null&&u(t,["systemInstruction"],$g(Xe(i)));const r=a(e,["temperature"]);r!=null&&u(s,["temperature"],r);const o=a(e,["topP"]);o!=null&&u(s,["topP"],o);const l=a(e,["topK"]);l!=null&&u(s,["topK"],l);const d=a(e,["candidateCount"]);d!=null&&u(s,["candidateCount"],d);const c=a(e,["maxOutputTokens"]);c!=null&&u(s,["maxOutputTokens"],c);const f=a(e,["stopSequences"]);f!=null&&u(s,["stopSequences"],f);const p=a(e,["responseLogprobs"]);p!=null&&u(s,["responseLogprobs"],p);const h=a(e,["logprobs"]);h!=null&&u(s,["logprobs"],h);const m=a(e,["presencePenalty"]);m!=null&&u(s,["presencePenalty"],m);const g=a(e,["frequencyPenalty"]);g!=null&&u(s,["frequencyPenalty"],g);const v=a(e,["seed"]);v!=null&&u(s,["seed"],v);const _=a(e,["responseMimeType"]);_!=null&&u(s,["responseMimeType"],_);const w=a(e,["responseSchema"]);w!=null&&u(s,["responseSchema"],Ac(w));const E=a(e,["responseJsonSchema"]);if(E!=null&&u(s,["responseJsonSchema"],E),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=a(e,["safetySettings"]);if(t!==void 0&&S!=null){let Z=S;Array.isArray(Z)&&(Z=Z.map(X=>l0(X))),u(t,["safetySettings"],Z)}const T=a(e,["tools"]);if(t!==void 0&&T!=null){let Z=Fi(T);Array.isArray(Z)&&(Z=Z.map(X=>c0(Ui(X)))),u(t,["tools"],Z)}const R=a(e,["toolConfig"]);if(t!==void 0&&R!=null&&u(t,["toolConfig"],u0(R)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const M=a(e,["cachedContent"]);t!==void 0&&M!=null&&u(t,["cachedContent"],Vn(n,M));const x=a(e,["responseModalities"]);x!=null&&u(s,["responseModalities"],x);const k=a(e,["mediaResolution"]);k!=null&&u(s,["mediaResolution"],k);const I=a(e,["speechConfig"]);if(I!=null&&u(s,["speechConfig"],bc(I)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const N=a(e,["thinkingConfig"]);N!=null&&u(s,["thinkingConfig"],N);const F=a(e,["imageConfig"]);F!=null&&u(s,["imageConfig"],ZC(F));const oe=a(e,["enableEnhancedCivicAnswers"]);return oe!=null&&u(s,["enableEnhancedCivicAnswers"],oe),s}function zC(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["candidates"]);if(s!=null){let d=s;Array.isArray(d)&&(d=d.map(c=>PC(c))),u(e,["candidates"],d)}const i=a(n,["modelVersion"]);i!=null&&u(e,["modelVersion"],i);const r=a(n,["promptFeedback"]);r!=null&&u(e,["promptFeedback"],r);const o=a(n,["responseId"]);o!=null&&u(e,["responseId"],o);const l=a(n,["usageMetadata"]);return l!=null&&u(e,["usageMetadata"],l),e}function KC(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],$i(n,s)),t}function YC(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],$i(n,s)),t}function XC(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&u(e,["enableWidget"],t),e}function QC(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],t),e}function ZC(n){const e={},t=a(n,["aspectRatio"]);t!=null&&u(e,["aspectRatio"],t);const s=a(n,["imageSize"]);if(s!=null&&u(e,["imageSize"],s),a(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(a(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function jC(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["request","model"],ne(n,s));const i=a(e,["contents"]);if(i!=null){let l=Ft(i);Array.isArray(l)&&(l=l.map(d=>$g(d))),u(t,["request","contents"],l)}const r=a(e,["metadata"]);r!=null&&u(t,["metadata"],r);const o=a(e,["config"]);return o!=null&&u(t,["request","generationConfig"],WC(n,o,a(t,["request"],{}))),t}function e0(n){const e={},t=a(n,["response"]);t!=null&&u(e,["response"],zC(t));const s=a(n,["error"]);return s!=null&&u(e,["error"],s),e}function t0(n,e){const t={},s=a(n,["pageSize"]);e!==void 0&&s!=null&&u(e,["_query","pageSize"],s);const i=a(n,["pageToken"]);if(e!==void 0&&i!=null&&u(e,["_query","pageToken"],i),a(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function n0(n,e){const t={},s=a(n,["pageSize"]);e!==void 0&&s!=null&&u(e,["_query","pageSize"],s);const i=a(n,["pageToken"]);e!==void 0&&i!=null&&u(e,["_query","pageToken"],i);const r=a(n,["filter"]);return e!==void 0&&r!=null&&u(e,["_query","filter"],r),t}function s0(n){const e={},t=a(n,["config"]);return t!=null&&t0(t,e),e}function i0(n){const e={},t=a(n,["config"]);return t!=null&&n0(t,e),e}function r0(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["nextPageToken"]);s!=null&&u(e,["nextPageToken"],s);const i=a(n,["operations"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>zo(o))),u(e,["batchJobs"],r)}return e}function o0(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["nextPageToken"]);s!=null&&u(e,["nextPageToken"],s);const i=a(n,["batchPredictionJobs"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>au(o))),u(e,["batchJobs"],r)}return e}function a0(n){const e={},t=a(n,["mediaResolution"]);t!=null&&u(e,["mediaResolution"],t);const s=a(n,["codeExecutionResult"]);s!=null&&u(e,["codeExecutionResult"],s);const i=a(n,["executableCode"]);i!=null&&u(e,["executableCode"],i);const r=a(n,["fileData"]);r!=null&&u(e,["fileData"],HC(r));const o=a(n,["functionCall"]);o!=null&&u(e,["functionCall"],OC(o));const l=a(n,["functionResponse"]);l!=null&&u(e,["functionResponse"],l);const d=a(n,["inlineData"]);d!=null&&u(e,["inlineData"],bC(d));const c=a(n,["text"]);c!=null&&u(e,["text"],c);const f=a(n,["thought"]);f!=null&&u(e,["thought"],f);const p=a(n,["thoughtSignature"]);p!=null&&u(e,["thoughtSignature"],p);const h=a(n,["videoMetadata"]);return h!=null&&u(e,["videoMetadata"],h),e}function l0(n){const e={},t=a(n,["category"]);if(t!=null&&u(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=a(n,["threshold"]);return s!=null&&u(e,["threshold"],s),e}function u0(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&u(e,["functionCallingConfig"],JC(t));const s=a(n,["retrievalConfig"]);return s!=null&&u(e,["retrievalConfig"],s),e}function c0(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),u(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=a(n,["googleSearchRetrieval"]);s!=null&&u(e,["googleSearchRetrieval"],s);const i=a(n,["computerUse"]);i!=null&&u(e,["computerUse"],i);const r=a(n,["fileSearch"]);r!=null&&u(e,["fileSearch"],r);const o=a(n,["codeExecution"]);if(o!=null&&u(e,["codeExecution"],o),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=a(n,["googleMaps"]);l!=null&&u(e,["googleMaps"],XC(l));const d=a(n,["googleSearch"]);d!=null&&u(e,["googleSearch"],QC(d));const c=a(n,["urlContext"]);return c!=null&&u(e,["urlContext"],c),e}var Fn;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(Fn||(Fn={}));class Os{constructor(e,t,s,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,s,i)}init(e,t,s){var i,r;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let o={config:{}};!s||Object.keys(s).length===0?o={config:{}}:typeof s=="object"?o=Object.assign({},s):o=s,o.config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=(r=(i=o.config)===null||i===void 0?void 0:i.pageSize)!==null&&r!==void 0?r:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}class d0 extends Gn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Os(Fn.PAGED_ITEM_BATCH_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){const t=hh(this.apiClient,e),s=t._url,i=L("{model}:batchGenerateContent",s),l=t.batch.inputConfig.requests,d=l.requests,c=[];for(const f of d){const p=Object.assign({},f);if(p.systemInstruction){const h=p.systemInstruction;delete p.systemInstruction;const m=p.request;m.systemInstruction=h,p.request=m}c.push(p)}return l.requests=c,delete t.config,delete t._url,delete t._query,{path:i,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const s=t?Object.assign({},t):{},i=Date.now().toString();if(s.displayName||(s.displayName=`genaiBatchJob_${i}`),s.dest===void 0){const r=this.getGcsUri(e),o=this.getBigqueryUri(e);if(r)r.endsWith(".jsonl")?s.dest=`${r.slice(0,-6)}/dest`:s.dest=`${r}_dest_${i}`;else if(o)s.dest=`${o}_dest_${i}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return s}async createInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=NC(this.apiClient,e);return l=L("batchPredictionJobs",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>au(f))}else{const c=hh(this.apiClient,e);return l=L("{model}:batchGenerateContent",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>zo(f))}}async createEmbeddingsInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=LC(this.apiClient,e);return r=L("{model}:asyncBatchEmbedContent",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>zo(d))}}async get(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=YC(this.apiClient,e);return l=L("batchPredictionJobs/{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>au(f))}else{const c=KC(this.apiClient,e);return l=L("batches/{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>zo(f))}}async cancel(e){var t,s,i,r;let o="",l={};if(this.apiClient.isVertexAI()){const d=RC(this.apiClient,e);o=L("batchPredictionJobs/{name}:cancel",d._url),l=d._query,delete d._url,delete d._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}else{const d=IC(this.apiClient,e);o=L("batches/{name}:cancel",d._url),l=d._query,delete d._url,delete d._query,await this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal})}}async listInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=i0(e);return l=L("batchPredictionJobs",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=o0(f),h=new uh;return Object.assign(h,p),h})}else{const c=s0(e);return l=L("batches",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=r0(f),h=new uh;return Object.assign(h,p),h})}}async delete(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=FC(this.apiClient,e);return l=L("batchPredictionJobs/{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>qC(f))}else{const c=UC(this.apiClient,e);return l=L("batches/{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>$C(f))}}}function f0(n){const e={},t=a(n,["data"]);if(t!=null&&u(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function ph(n){const e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>L0(r))),u(e,["parts"],i)}const s=a(n,["role"]);return s!=null&&u(e,["role"],s),e}function h0(n,e){const t={},s=a(n,["ttl"]);e!==void 0&&s!=null&&u(e,["ttl"],s);const i=a(n,["expireTime"]);e!==void 0&&i!=null&&u(e,["expireTime"],i);const r=a(n,["displayName"]);e!==void 0&&r!=null&&u(e,["displayName"],r);const o=a(n,["contents"]);if(e!==void 0&&o!=null){let f=Ft(o);Array.isArray(f)&&(f=f.map(p=>ph(p))),u(e,["contents"],f)}const l=a(n,["systemInstruction"]);e!==void 0&&l!=null&&u(e,["systemInstruction"],ph(Xe(l)));const d=a(n,["tools"]);if(e!==void 0&&d!=null){let f=d;Array.isArray(f)&&(f=f.map(p=>F0(p))),u(e,["tools"],f)}const c=a(n,["toolConfig"]);if(e!==void 0&&c!=null&&u(e,["toolConfig"],U0(c)),a(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function p0(n,e){const t={},s=a(n,["ttl"]);e!==void 0&&s!=null&&u(e,["ttl"],s);const i=a(n,["expireTime"]);e!==void 0&&i!=null&&u(e,["expireTime"],i);const r=a(n,["displayName"]);e!==void 0&&r!=null&&u(e,["displayName"],r);const o=a(n,["contents"]);if(e!==void 0&&o!=null){let p=Ft(o);Array.isArray(p)&&(p=p.map(h=>h)),u(e,["contents"],p)}const l=a(n,["systemInstruction"]);e!==void 0&&l!=null&&u(e,["systemInstruction"],Xe(l));const d=a(n,["tools"]);if(e!==void 0&&d!=null){let p=d;Array.isArray(p)&&(p=p.map(h=>$0(h))),u(e,["tools"],p)}const c=a(n,["toolConfig"]);e!==void 0&&c!=null&&u(e,["toolConfig"],c);const f=a(n,["kmsKeyName"]);return e!==void 0&&f!=null&&u(e,["encryption_spec","kmsKeyName"],f),t}function m0(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["model"],bg(n,s));const i=a(e,["config"]);return i!=null&&h0(i,t),t}function g0(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["model"],bg(n,s));const i=a(e,["config"]);return i!=null&&p0(i,t),t}function y0(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],Vn(n,s)),t}function _0(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],Vn(n,s)),t}function v0(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&u(e,["sdkHttpResponse"],t),e}function w0(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&u(e,["sdkHttpResponse"],t),e}function E0(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function S0(n){const e={},t=a(n,["id"]);t!=null&&u(e,["id"],t);const s=a(n,["args"]);s!=null&&u(e,["args"],s);const i=a(n,["name"]);if(i!=null&&u(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function T0(n){const e={},t=a(n,["mode"]);t!=null&&u(e,["mode"],t);const s=a(n,["allowedFunctionNames"]);if(s!=null&&u(e,["allowedFunctionNames"],s),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function C0(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&u(e,["description"],t);const s=a(n,["name"]);s!=null&&u(e,["name"],s);const i=a(n,["parameters"]);i!=null&&u(e,["parameters"],i);const r=a(n,["parametersJsonSchema"]);r!=null&&u(e,["parametersJsonSchema"],r);const o=a(n,["response"]);o!=null&&u(e,["response"],o);const l=a(n,["responseJsonSchema"]);return l!=null&&u(e,["responseJsonSchema"],l),e}function A0(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],Vn(n,s)),t}function b0(n,e){const t={},s=a(e,["name"]);return s!=null&&u(t,["_url","name"],Vn(n,s)),t}function I0(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&u(e,["enableWidget"],t),e}function R0(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],t),e}function P0(n,e){const t={},s=a(n,["pageSize"]);e!==void 0&&s!=null&&u(e,["_query","pageSize"],s);const i=a(n,["pageToken"]);return e!==void 0&&i!=null&&u(e,["_query","pageToken"],i),t}function x0(n,e){const t={},s=a(n,["pageSize"]);e!==void 0&&s!=null&&u(e,["_query","pageSize"],s);const i=a(n,["pageToken"]);return e!==void 0&&i!=null&&u(e,["_query","pageToken"],i),t}function M0(n){const e={},t=a(n,["config"]);return t!=null&&P0(t,e),e}function k0(n){const e={},t=a(n,["config"]);return t!=null&&x0(t,e),e}function N0(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["nextPageToken"]);s!=null&&u(e,["nextPageToken"],s);const i=a(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),u(e,["cachedContents"],r)}return e}function D0(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["nextPageToken"]);s!=null&&u(e,["nextPageToken"],s);const i=a(n,["cachedContents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),u(e,["cachedContents"],r)}return e}function L0(n){const e={},t=a(n,["mediaResolution"]);t!=null&&u(e,["mediaResolution"],t);const s=a(n,["codeExecutionResult"]);s!=null&&u(e,["codeExecutionResult"],s);const i=a(n,["executableCode"]);i!=null&&u(e,["executableCode"],i);const r=a(n,["fileData"]);r!=null&&u(e,["fileData"],E0(r));const o=a(n,["functionCall"]);o!=null&&u(e,["functionCall"],S0(o));const l=a(n,["functionResponse"]);l!=null&&u(e,["functionResponse"],l);const d=a(n,["inlineData"]);d!=null&&u(e,["inlineData"],f0(d));const c=a(n,["text"]);c!=null&&u(e,["text"],c);const f=a(n,["thought"]);f!=null&&u(e,["thought"],f);const p=a(n,["thoughtSignature"]);p!=null&&u(e,["thoughtSignature"],p);const h=a(n,["videoMetadata"]);return h!=null&&u(e,["videoMetadata"],h),e}function U0(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&u(e,["functionCallingConfig"],T0(t));const s=a(n,["retrievalConfig"]);return s!=null&&u(e,["retrievalConfig"],s),e}function F0(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),u(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=a(n,["googleSearchRetrieval"]);s!=null&&u(e,["googleSearchRetrieval"],s);const i=a(n,["computerUse"]);i!=null&&u(e,["computerUse"],i);const r=a(n,["fileSearch"]);r!=null&&u(e,["fileSearch"],r);const o=a(n,["codeExecution"]);if(o!=null&&u(e,["codeExecution"],o),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=a(n,["googleMaps"]);l!=null&&u(e,["googleMaps"],I0(l));const d=a(n,["googleSearch"]);d!=null&&u(e,["googleSearch"],R0(d));const c=a(n,["urlContext"]);return c!=null&&u(e,["urlContext"],c),e}function $0(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(h=>C0(h))),u(e,["functionDeclarations"],p)}const s=a(n,["retrieval"]);s!=null&&u(e,["retrieval"],s);const i=a(n,["googleSearchRetrieval"]);i!=null&&u(e,["googleSearchRetrieval"],i);const r=a(n,["computerUse"]);if(r!=null&&u(e,["computerUse"],r),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=a(n,["codeExecution"]);o!=null&&u(e,["codeExecution"],o);const l=a(n,["enterpriseWebSearch"]);l!=null&&u(e,["enterpriseWebSearch"],l);const d=a(n,["googleMaps"]);d!=null&&u(e,["googleMaps"],d);const c=a(n,["googleSearch"]);c!=null&&u(e,["googleSearch"],c);const f=a(n,["urlContext"]);return f!=null&&u(e,["urlContext"],f),e}function q0(n,e){const t={},s=a(n,["ttl"]);e!==void 0&&s!=null&&u(e,["ttl"],s);const i=a(n,["expireTime"]);return e!==void 0&&i!=null&&u(e,["expireTime"],i),t}function B0(n,e){const t={},s=a(n,["ttl"]);e!==void 0&&s!=null&&u(e,["ttl"],s);const i=a(n,["expireTime"]);return e!==void 0&&i!=null&&u(e,["expireTime"],i),t}function G0(n,e){const t={},s=a(e,["name"]);s!=null&&u(t,["_url","name"],Vn(n,s));const i=a(e,["config"]);return i!=null&&q0(i,t),t}function V0(n,e){const t={},s=a(e,["name"]);s!=null&&u(t,["_url","name"],Vn(n,s));const i=a(e,["config"]);return i!=null&&B0(i,t),t}class H0 extends Gn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Os(Fn.PAGED_ITEM_CACHED_CONTENTS,s=>this.listInternal(s),await this.listInternal(t),t)}async create(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=g0(this.apiClient,e);return l=L("cachedContents",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>f)}else{const c=m0(this.apiClient,e);return l=L("cachedContents",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async get(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=b0(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>f)}else{const c=A0(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async delete(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=_0(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=w0(f),h=new ah;return Object.assign(h,p),h})}else{const c=y0(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=v0(f),h=new ah;return Object.assign(h,p),h})}}async update(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=V0(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>f)}else{const c=G0(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>f)}}async listInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=k0(e);return l=L("cachedContents",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=D0(f),h=new lh;return Object.assign(h,p),h})}else{const c=M0(e);return l=L("cachedContents",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=N0(f),h=new lh;return Object.assign(h,p),h})}}}function da(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t}function mh(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],s=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&s>=n.length&&(n=void 0),{value:n&&n[s++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function W(n){return this instanceof W?(this.v=n,this):new W(n)}function Qt(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=t.apply(n,e||[]),i,r=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),l("next"),l("throw"),l("return",o),i[Symbol.asyncIterator]=function(){return this},i;function o(m){return function(g){return Promise.resolve(g).then(m,p)}}function l(m,g){s[m]&&(i[m]=function(v){return new Promise(function(_,w){r.push([m,v,_,w])>1||d(m,v)})},g&&(i[m]=g(i[m])))}function d(m,g){try{c(s[m](g))}catch(v){h(r[0][3],v)}}function c(m){m.value instanceof W?Promise.resolve(m.value.v).then(f,p):h(r[0][2],m)}function f(m){d("next",m)}function p(m){d("throw",m)}function h(m,g){m(g),r.shift(),r.length&&d(r[0][0],r[0][1])}}function Zt(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof mh=="function"?mh(n):n[Symbol.iterator](),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=n[r]&&function(o){return new Promise(function(l,d){o=n[r](o),i(l,d,o.done,o.value)})}}function i(r,o,l,d){Promise.resolve(d).then(function(c){r({value:c,done:l})},o)}}function O0(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:qg(t)}function qg(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function J0(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function gh(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let s=0;for(;s<t;)if(n[s].role==="user")e.push(n[s]),s++;else{const i=[];let r=!0;for(;s<t&&n[s].role==="model";)i.push(n[s]),r&&!qg(n[s])&&(r=!1),s++;r?e.push(...i):e.pop()}return e}class W0{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new z0(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class z0{constructor(e,t,s,i={},r=[]){this.apiClient=e,this.modelsModule=t,this.model=s,this.config=i,this.history=r,this.sendPromise=Promise.resolve(),J0(r)}async sendMessage(e){var t;await this.sendPromise;const s=Xe(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var r,o,l;const d=await i,c=(o=(r=d.candidates)===null||r===void 0?void 0:r[0])===null||o===void 0?void 0:o.content,f=d.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let h=[];f!=null&&(h=(l=f.slice(p))!==null&&l!==void 0?l:[]);const m=c?[c]:[];this.recordHistory(s,m,h)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;const s=Xe(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(s),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const r=await i;return this.processStreamResponse(r,s)}getHistory(e=!1){const t=e?gh(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return Qt(this,arguments,function*(){var i,r,o,l,d,c;const f=[];try{for(var p=!0,h=Zt(e),m;m=yield W(h.next()),i=m.done,!i;p=!0){l=m.value,p=!1;const g=l;if(O0(g)){const v=(c=(d=g.candidates)===null||d===void 0?void 0:d[0])===null||c===void 0?void 0:c.content;v!==void 0&&f.push(v)}yield yield W(g)}}catch(g){r={error:g}}finally{try{!p&&!i&&(o=h.return)&&(yield W(o.call(h)))}finally{if(r)throw r.error}}this.recordHistory(t,f)})}recordHistory(e,t,s){let i=[];t.length>0&&t.every(r=>r.role!==void 0)?i=t:i.push({role:"model",parts:[]}),s&&s.length>0?this.history.push(...gh(s)):this.history.push(e),this.history.push(...i)}}class Fa extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Fa.prototype)}}function K0(n){const e={},t=a(n,["file"]);return t!=null&&u(e,["file"],t),e}function Y0(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&u(e,["sdkHttpResponse"],t),e}function X0(n){const e={},t=a(n,["name"]);return t!=null&&u(e,["_url","file"],kg(t)),e}function Q0(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&u(e,["sdkHttpResponse"],t),e}function Z0(n){const e={},t=a(n,["name"]);return t!=null&&u(e,["_url","file"],kg(t)),e}function j0(n,e){const t={},s=a(n,["pageSize"]);e!==void 0&&s!=null&&u(e,["_query","pageSize"],s);const i=a(n,["pageToken"]);return e!==void 0&&i!=null&&u(e,["_query","pageToken"],i),t}function eA(n){const e={},t=a(n,["config"]);return t!=null&&j0(t,e),e}function tA(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["nextPageToken"]);s!=null&&u(e,["nextPageToken"],s);const i=a(n,["files"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),u(e,["files"],r)}return e}class nA extends Gn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Os(Fn.PAGED_ITEM_FILES,s=>this.listInternal(s),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=eA(e);return r=L("files",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=tA(d),f=new oC;return Object.assign(f,c),f})}}async createInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=K0(e);return r=L("upload/v1beta/files",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Y0(d),f=new aC;return Object.assign(f,c),f})}}async get(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=Z0(e);return r=L("files/{file}",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=X0(e);return r=L("files/{file}",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=Q0(d),f=new lC;return Object.assign(f,c),f})}}}function Ko(n){const e={},t=a(n,["data"]);if(t!=null&&u(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function sA(n){const e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>vA(r))),u(e,["parts"],i)}const s=a(n,["role"]);return s!=null&&u(e,["role"],s),e}function iA(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function rA(n){const e={},t=a(n,["id"]);t!=null&&u(e,["id"],t);const s=a(n,["args"]);s!=null&&u(e,["args"],s);const i=a(n,["name"]);if(i!=null&&u(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function oA(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&u(e,["description"],t);const s=a(n,["name"]);s!=null&&u(e,["name"],s);const i=a(n,["parameters"]);i!=null&&u(e,["parameters"],i);const r=a(n,["parametersJsonSchema"]);r!=null&&u(e,["parametersJsonSchema"],r);const o=a(n,["response"]);o!=null&&u(e,["response"],o);const l=a(n,["responseJsonSchema"]);return l!=null&&u(e,["responseJsonSchema"],l),e}function aA(n){const e={},t=a(n,["modelSelectionConfig"]);t!=null&&u(e,["modelConfig"],t);const s=a(n,["responseJsonSchema"]);s!=null&&u(e,["responseJsonSchema"],s);const i=a(n,["audioTimestamp"]);i!=null&&u(e,["audioTimestamp"],i);const r=a(n,["candidateCount"]);r!=null&&u(e,["candidateCount"],r);const o=a(n,["enableAffectiveDialog"]);o!=null&&u(e,["enableAffectiveDialog"],o);const l=a(n,["frequencyPenalty"]);l!=null&&u(e,["frequencyPenalty"],l);const d=a(n,["logprobs"]);d!=null&&u(e,["logprobs"],d);const c=a(n,["maxOutputTokens"]);c!=null&&u(e,["maxOutputTokens"],c);const f=a(n,["mediaResolution"]);f!=null&&u(e,["mediaResolution"],f);const p=a(n,["presencePenalty"]);p!=null&&u(e,["presencePenalty"],p);const h=a(n,["responseLogprobs"]);h!=null&&u(e,["responseLogprobs"],h);const m=a(n,["responseMimeType"]);m!=null&&u(e,["responseMimeType"],m);const g=a(n,["responseModalities"]);g!=null&&u(e,["responseModalities"],g);const v=a(n,["responseSchema"]);v!=null&&u(e,["responseSchema"],v);const _=a(n,["routingConfig"]);_!=null&&u(e,["routingConfig"],_);const w=a(n,["seed"]);w!=null&&u(e,["seed"],w);const E=a(n,["speechConfig"]);E!=null&&u(e,["speechConfig"],E);const S=a(n,["stopSequences"]);S!=null&&u(e,["stopSequences"],S);const T=a(n,["temperature"]);T!=null&&u(e,["temperature"],T);const R=a(n,["thinkingConfig"]);R!=null&&u(e,["thinkingConfig"],R);const M=a(n,["topK"]);M!=null&&u(e,["topK"],M);const x=a(n,["topP"]);if(x!=null&&u(e,["topP"],x),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function lA(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&u(e,["enableWidget"],t),e}function uA(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],t),e}function cA(n,e){const t={},s=a(n,["generationConfig"]);e!==void 0&&s!=null&&u(e,["setup","generationConfig"],s);const i=a(n,["responseModalities"]);e!==void 0&&i!=null&&u(e,["setup","generationConfig","responseModalities"],i);const r=a(n,["temperature"]);e!==void 0&&r!=null&&u(e,["setup","generationConfig","temperature"],r);const o=a(n,["topP"]);e!==void 0&&o!=null&&u(e,["setup","generationConfig","topP"],o);const l=a(n,["topK"]);e!==void 0&&l!=null&&u(e,["setup","generationConfig","topK"],l);const d=a(n,["maxOutputTokens"]);e!==void 0&&d!=null&&u(e,["setup","generationConfig","maxOutputTokens"],d);const c=a(n,["mediaResolution"]);e!==void 0&&c!=null&&u(e,["setup","generationConfig","mediaResolution"],c);const f=a(n,["seed"]);e!==void 0&&f!=null&&u(e,["setup","generationConfig","seed"],f);const p=a(n,["speechConfig"]);e!==void 0&&p!=null&&u(e,["setup","generationConfig","speechConfig"],Ic(p));const h=a(n,["thinkingConfig"]);e!==void 0&&h!=null&&u(e,["setup","generationConfig","thinkingConfig"],h);const m=a(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&u(e,["setup","generationConfig","enableAffectiveDialog"],m);const g=a(n,["systemInstruction"]);e!==void 0&&g!=null&&u(e,["setup","systemInstruction"],sA(Xe(g)));const v=a(n,["tools"]);if(e!==void 0&&v!=null){let M=Fi(v);Array.isArray(M)&&(M=M.map(x=>EA(Ui(x)))),u(e,["setup","tools"],M)}const _=a(n,["sessionResumption"]);e!==void 0&&_!=null&&u(e,["setup","sessionResumption"],wA(_));const w=a(n,["inputAudioTranscription"]);e!==void 0&&w!=null&&u(e,["setup","inputAudioTranscription"],w);const E=a(n,["outputAudioTranscription"]);e!==void 0&&E!=null&&u(e,["setup","outputAudioTranscription"],E);const S=a(n,["realtimeInputConfig"]);e!==void 0&&S!=null&&u(e,["setup","realtimeInputConfig"],S);const T=a(n,["contextWindowCompression"]);e!==void 0&&T!=null&&u(e,["setup","contextWindowCompression"],T);const R=a(n,["proactivity"]);if(e!==void 0&&R!=null&&u(e,["setup","proactivity"],R),a(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function dA(n,e){const t={},s=a(n,["generationConfig"]);e!==void 0&&s!=null&&u(e,["setup","generationConfig"],aA(s));const i=a(n,["responseModalities"]);e!==void 0&&i!=null&&u(e,["setup","generationConfig","responseModalities"],i);const r=a(n,["temperature"]);e!==void 0&&r!=null&&u(e,["setup","generationConfig","temperature"],r);const o=a(n,["topP"]);e!==void 0&&o!=null&&u(e,["setup","generationConfig","topP"],o);const l=a(n,["topK"]);e!==void 0&&l!=null&&u(e,["setup","generationConfig","topK"],l);const d=a(n,["maxOutputTokens"]);e!==void 0&&d!=null&&u(e,["setup","generationConfig","maxOutputTokens"],d);const c=a(n,["mediaResolution"]);e!==void 0&&c!=null&&u(e,["setup","generationConfig","mediaResolution"],c);const f=a(n,["seed"]);e!==void 0&&f!=null&&u(e,["setup","generationConfig","seed"],f);const p=a(n,["speechConfig"]);e!==void 0&&p!=null&&u(e,["setup","generationConfig","speechConfig"],Ic(p));const h=a(n,["thinkingConfig"]);e!==void 0&&h!=null&&u(e,["setup","generationConfig","thinkingConfig"],h);const m=a(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&u(e,["setup","generationConfig","enableAffectiveDialog"],m);const g=a(n,["systemInstruction"]);e!==void 0&&g!=null&&u(e,["setup","systemInstruction"],Xe(g));const v=a(n,["tools"]);if(e!==void 0&&v!=null){let x=Fi(v);Array.isArray(x)&&(x=x.map(k=>SA(Ui(k)))),u(e,["setup","tools"],x)}const _=a(n,["sessionResumption"]);e!==void 0&&_!=null&&u(e,["setup","sessionResumption"],_);const w=a(n,["inputAudioTranscription"]);e!==void 0&&w!=null&&u(e,["setup","inputAudioTranscription"],w);const E=a(n,["outputAudioTranscription"]);e!==void 0&&E!=null&&u(e,["setup","outputAudioTranscription"],E);const S=a(n,["realtimeInputConfig"]);e!==void 0&&S!=null&&u(e,["setup","realtimeInputConfig"],S);const T=a(n,["contextWindowCompression"]);e!==void 0&&T!=null&&u(e,["setup","contextWindowCompression"],T);const R=a(n,["proactivity"]);e!==void 0&&R!=null&&u(e,["setup","proactivity"],R);const M=a(n,["explicitVadSignal"]);return e!==void 0&&M!=null&&u(e,["setup","explicitVadSignal"],M),t}function fA(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["setup","model"],ne(n,s));const i=a(e,["config"]);return i!=null&&u(t,["config"],cA(i,t)),t}function hA(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["setup","model"],ne(n,s));const i=a(e,["config"]);return i!=null&&u(t,["config"],dA(i,t)),t}function pA(n){const e={},t=a(n,["musicGenerationConfig"]);return t!=null&&u(e,["musicGenerationConfig"],t),e}function mA(n){const e={},t=a(n,["weightedPrompts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>i)),u(e,["weightedPrompts"],s)}return e}function gA(n){const e={},t=a(n,["media"]);if(t!=null){let c=Ig(t);Array.isArray(c)&&(c=c.map(f=>Ko(f))),u(e,["mediaChunks"],c)}const s=a(n,["audio"]);s!=null&&u(e,["audio"],Ko(Pg(s)));const i=a(n,["audioStreamEnd"]);i!=null&&u(e,["audioStreamEnd"],i);const r=a(n,["video"]);r!=null&&u(e,["video"],Ko(Rg(r)));const o=a(n,["text"]);o!=null&&u(e,["text"],o);const l=a(n,["activityStart"]);l!=null&&u(e,["activityStart"],l);const d=a(n,["activityEnd"]);return d!=null&&u(e,["activityEnd"],d),e}function yA(n){const e={},t=a(n,["media"]);if(t!=null){let c=Ig(t);Array.isArray(c)&&(c=c.map(f=>f)),u(e,["mediaChunks"],c)}const s=a(n,["audio"]);s!=null&&u(e,["audio"],Pg(s));const i=a(n,["audioStreamEnd"]);i!=null&&u(e,["audioStreamEnd"],i);const r=a(n,["video"]);r!=null&&u(e,["video"],Rg(r));const o=a(n,["text"]);o!=null&&u(e,["text"],o);const l=a(n,["activityStart"]);l!=null&&u(e,["activityStart"],l);const d=a(n,["activityEnd"]);return d!=null&&u(e,["activityEnd"],d),e}function _A(n){const e={},t=a(n,["setupComplete"]);t!=null&&u(e,["setupComplete"],t);const s=a(n,["serverContent"]);s!=null&&u(e,["serverContent"],s);const i=a(n,["toolCall"]);i!=null&&u(e,["toolCall"],i);const r=a(n,["toolCallCancellation"]);r!=null&&u(e,["toolCallCancellation"],r);const o=a(n,["usageMetadata"]);o!=null&&u(e,["usageMetadata"],TA(o));const l=a(n,["goAway"]);l!=null&&u(e,["goAway"],l);const d=a(n,["sessionResumptionUpdate"]);d!=null&&u(e,["sessionResumptionUpdate"],d);const c=a(n,["voiceActivityDetectionSignal"]);return c!=null&&u(e,["voiceActivityDetectionSignal"],c),e}function vA(n){const e={},t=a(n,["mediaResolution"]);t!=null&&u(e,["mediaResolution"],t);const s=a(n,["codeExecutionResult"]);s!=null&&u(e,["codeExecutionResult"],s);const i=a(n,["executableCode"]);i!=null&&u(e,["executableCode"],i);const r=a(n,["fileData"]);r!=null&&u(e,["fileData"],iA(r));const o=a(n,["functionCall"]);o!=null&&u(e,["functionCall"],rA(o));const l=a(n,["functionResponse"]);l!=null&&u(e,["functionResponse"],l);const d=a(n,["inlineData"]);d!=null&&u(e,["inlineData"],Ko(d));const c=a(n,["text"]);c!=null&&u(e,["text"],c);const f=a(n,["thought"]);f!=null&&u(e,["thought"],f);const p=a(n,["thoughtSignature"]);p!=null&&u(e,["thoughtSignature"],p);const h=a(n,["videoMetadata"]);return h!=null&&u(e,["videoMetadata"],h),e}function wA(n){const e={},t=a(n,["handle"]);if(t!=null&&u(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function EA(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),u(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=a(n,["googleSearchRetrieval"]);s!=null&&u(e,["googleSearchRetrieval"],s);const i=a(n,["computerUse"]);i!=null&&u(e,["computerUse"],i);const r=a(n,["fileSearch"]);r!=null&&u(e,["fileSearch"],r);const o=a(n,["codeExecution"]);if(o!=null&&u(e,["codeExecution"],o),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=a(n,["googleMaps"]);l!=null&&u(e,["googleMaps"],lA(l));const d=a(n,["googleSearch"]);d!=null&&u(e,["googleSearch"],uA(d));const c=a(n,["urlContext"]);return c!=null&&u(e,["urlContext"],c),e}function SA(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(h=>oA(h))),u(e,["functionDeclarations"],p)}const s=a(n,["retrieval"]);s!=null&&u(e,["retrieval"],s);const i=a(n,["googleSearchRetrieval"]);i!=null&&u(e,["googleSearchRetrieval"],i);const r=a(n,["computerUse"]);if(r!=null&&u(e,["computerUse"],r),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=a(n,["codeExecution"]);o!=null&&u(e,["codeExecution"],o);const l=a(n,["enterpriseWebSearch"]);l!=null&&u(e,["enterpriseWebSearch"],l);const d=a(n,["googleMaps"]);d!=null&&u(e,["googleMaps"],d);const c=a(n,["googleSearch"]);c!=null&&u(e,["googleSearch"],c);const f=a(n,["urlContext"]);return f!=null&&u(e,["urlContext"],f),e}function TA(n){const e={},t=a(n,["promptTokenCount"]);t!=null&&u(e,["promptTokenCount"],t);const s=a(n,["cachedContentTokenCount"]);s!=null&&u(e,["cachedContentTokenCount"],s);const i=a(n,["candidatesTokenCount"]);i!=null&&u(e,["responseTokenCount"],i);const r=a(n,["toolUsePromptTokenCount"]);r!=null&&u(e,["toolUsePromptTokenCount"],r);const o=a(n,["thoughtsTokenCount"]);o!=null&&u(e,["thoughtsTokenCount"],o);const l=a(n,["totalTokenCount"]);l!=null&&u(e,["totalTokenCount"],l);const d=a(n,["promptTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(g=>g)),u(e,["promptTokensDetails"],m)}const c=a(n,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(g=>g)),u(e,["cacheTokensDetails"],m)}const f=a(n,["candidatesTokensDetails"]);if(f!=null){let m=f;Array.isArray(m)&&(m=m.map(g=>g)),u(e,["responseTokensDetails"],m)}const p=a(n,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(g=>g)),u(e,["toolUsePromptTokensDetails"],m)}const h=a(n,["trafficType"]);return h!=null&&u(e,["trafficType"],h),e}function CA(n){const e={},t=a(n,["data"]);if(t!=null&&u(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function AA(n){const e={},t=a(n,["content"]);t!=null&&u(e,["content"],t);const s=a(n,["citationMetadata"]);s!=null&&u(e,["citationMetadata"],bA(s));const i=a(n,["tokenCount"]);i!=null&&u(e,["tokenCount"],i);const r=a(n,["finishReason"]);r!=null&&u(e,["finishReason"],r);const o=a(n,["avgLogprobs"]);o!=null&&u(e,["avgLogprobs"],o);const l=a(n,["groundingMetadata"]);l!=null&&u(e,["groundingMetadata"],l);const d=a(n,["index"]);d!=null&&u(e,["index"],d);const c=a(n,["logprobsResult"]);c!=null&&u(e,["logprobsResult"],c);const f=a(n,["safetyRatings"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(m=>m)),u(e,["safetyRatings"],h)}const p=a(n,["urlContextMetadata"]);return p!=null&&u(e,["urlContextMetadata"],p),e}function bA(n){const e={},t=a(n,["citationSources"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>i)),u(e,["citations"],s)}return e}function IA(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["contents"]);if(i!=null){let r=Ft(i);Array.isArray(r)&&(r=r.map(o=>o)),u(t,["contents"],r)}return t}function RA(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["tokensInfo"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),u(e,["tokensInfo"],i)}return e}function PA(n){const e={},t=a(n,["values"]);t!=null&&u(e,["values"],t);const s=a(n,["statistics"]);return s!=null&&u(e,["statistics"],xA(s)),e}function xA(n){const e={},t=a(n,["truncated"]);t!=null&&u(e,["truncated"],t);const s=a(n,["token_count"]);return s!=null&&u(e,["tokenCount"],s),e}function $a(n){const e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>qb(r))),u(e,["parts"],i)}const s=a(n,["role"]);return s!=null&&u(e,["role"],s),e}function MA(n){const e={},t=a(n,["controlType"]);t!=null&&u(e,["controlType"],t);const s=a(n,["enableControlImageComputation"]);return s!=null&&u(e,["computeControl"],s),e}function kA(n){const e={};if(a(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(a(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(a(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function NA(n,e){const t={},s=a(n,["systemInstruction"]);e!==void 0&&s!=null&&u(e,["systemInstruction"],Xe(s));const i=a(n,["tools"]);if(e!==void 0&&i!=null){let o=i;Array.isArray(o)&&(o=o.map(l=>Hg(l))),u(e,["tools"],o)}const r=a(n,["generationConfig"]);return e!==void 0&&r!=null&&u(e,["generationConfig"],Cb(r)),t}function DA(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["contents"]);if(i!=null){let o=Ft(i);Array.isArray(o)&&(o=o.map(l=>$a(l))),u(t,["contents"],o)}const r=a(e,["config"]);return r!=null&&kA(r),t}function LA(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["contents"]);if(i!=null){let o=Ft(i);Array.isArray(o)&&(o=o.map(l=>l)),u(t,["contents"],o)}const r=a(e,["config"]);return r!=null&&NA(r,t),t}function UA(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["totalTokens"]);s!=null&&u(e,["totalTokens"],s);const i=a(n,["cachedContentTokenCount"]);return i!=null&&u(e,["cachedContentTokenCount"],i),e}function FA(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["totalTokens"]);return s!=null&&u(e,["totalTokens"],s),e}function $A(n,e){const t={},s=a(e,["model"]);return s!=null&&u(t,["_url","name"],ne(n,s)),t}function qA(n,e){const t={},s=a(e,["model"]);return s!=null&&u(t,["_url","name"],ne(n,s)),t}function BA(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&u(e,["sdkHttpResponse"],t),e}function GA(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&u(e,["sdkHttpResponse"],t),e}function VA(n,e){const t={},s=a(n,["outputGcsUri"]);e!==void 0&&s!=null&&u(e,["parameters","storageUri"],s);const i=a(n,["negativePrompt"]);e!==void 0&&i!=null&&u(e,["parameters","negativePrompt"],i);const r=a(n,["numberOfImages"]);e!==void 0&&r!=null&&u(e,["parameters","sampleCount"],r);const o=a(n,["aspectRatio"]);e!==void 0&&o!=null&&u(e,["parameters","aspectRatio"],o);const l=a(n,["guidanceScale"]);e!==void 0&&l!=null&&u(e,["parameters","guidanceScale"],l);const d=a(n,["seed"]);e!==void 0&&d!=null&&u(e,["parameters","seed"],d);const c=a(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&u(e,["parameters","safetySetting"],c);const f=a(n,["personGeneration"]);e!==void 0&&f!=null&&u(e,["parameters","personGeneration"],f);const p=a(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&u(e,["parameters","includeSafetyAttributes"],p);const h=a(n,["includeRaiReason"]);e!==void 0&&h!=null&&u(e,["parameters","includeRaiReason"],h);const m=a(n,["language"]);e!==void 0&&m!=null&&u(e,["parameters","language"],m);const g=a(n,["outputMimeType"]);e!==void 0&&g!=null&&u(e,["parameters","outputOptions","mimeType"],g);const v=a(n,["outputCompressionQuality"]);e!==void 0&&v!=null&&u(e,["parameters","outputOptions","compressionQuality"],v);const _=a(n,["addWatermark"]);e!==void 0&&_!=null&&u(e,["parameters","addWatermark"],_);const w=a(n,["labels"]);e!==void 0&&w!=null&&u(e,["labels"],w);const E=a(n,["editMode"]);e!==void 0&&E!=null&&u(e,["parameters","editMode"],E);const S=a(n,["baseSteps"]);return e!==void 0&&S!=null&&u(e,["parameters","editConfig","baseSteps"],S),t}function HA(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["prompt"]);i!=null&&u(t,["instances[0]","prompt"],i);const r=a(e,["referenceImages"]);if(r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>Jb(d))),u(t,["instances[0]","referenceImages"],l)}const o=a(e,["config"]);return o!=null&&VA(o,t),t}function OA(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>qa(r))),u(e,["generatedImages"],i)}return e}function JA(n,e){const t={},s=a(n,["taskType"]);e!==void 0&&s!=null&&u(e,["requests[]","taskType"],s);const i=a(n,["title"]);e!==void 0&&i!=null&&u(e,["requests[]","title"],i);const r=a(n,["outputDimensionality"]);if(e!==void 0&&r!=null&&u(e,["requests[]","outputDimensionality"],r),a(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(a(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function WA(n,e){const t={},s=a(n,["taskType"]);e!==void 0&&s!=null&&u(e,["instances[]","task_type"],s);const i=a(n,["title"]);e!==void 0&&i!=null&&u(e,["instances[]","title"],i);const r=a(n,["outputDimensionality"]);e!==void 0&&r!=null&&u(e,["parameters","outputDimensionality"],r);const o=a(n,["mimeType"]);e!==void 0&&o!=null&&u(e,["instances[]","mimeType"],o);const l=a(n,["autoTruncate"]);return e!==void 0&&l!=null&&u(e,["parameters","autoTruncate"],l),t}function zA(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["contents"]);if(i!=null){let l=Cc(n,i);Array.isArray(l)&&(l=l.map(d=>d)),u(t,["requests[]","content"],l)}const r=a(e,["config"]);r!=null&&JA(r,t);const o=a(e,["model"]);return o!==void 0&&u(t,["requests[]","model"],ne(n,o)),t}function KA(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["contents"]);if(i!=null){let o=Cc(n,i);Array.isArray(o)&&(o=o.map(l=>l)),u(t,["instances[]","content"],o)}const r=a(e,["config"]);return r!=null&&WA(r,t),t}function YA(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),u(e,["embeddings"],r)}const i=a(n,["metadata"]);return i!=null&&u(e,["metadata"],i),e}function XA(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["predictions[]","embeddings"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>PA(o))),u(e,["embeddings"],r)}const i=a(n,["metadata"]);return i!=null&&u(e,["metadata"],i),e}function QA(n){const e={},t=a(n,["endpoint"]);t!=null&&u(e,["name"],t);const s=a(n,["deployedModelId"]);return s!=null&&u(e,["deployedModelId"],s),e}function ZA(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function jA(n){const e={},t=a(n,["id"]);t!=null&&u(e,["id"],t);const s=a(n,["args"]);s!=null&&u(e,["args"],s);const i=a(n,["name"]);if(i!=null&&u(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function eb(n){const e={},t=a(n,["mode"]);t!=null&&u(e,["mode"],t);const s=a(n,["allowedFunctionNames"]);if(s!=null&&u(e,["allowedFunctionNames"],s),a(n,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function tb(n){const e={};if(a(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=a(n,["description"]);t!=null&&u(e,["description"],t);const s=a(n,["name"]);s!=null&&u(e,["name"],s);const i=a(n,["parameters"]);i!=null&&u(e,["parameters"],i);const r=a(n,["parametersJsonSchema"]);r!=null&&u(e,["parametersJsonSchema"],r);const o=a(n,["response"]);o!=null&&u(e,["response"],o);const l=a(n,["responseJsonSchema"]);return l!=null&&u(e,["responseJsonSchema"],l),e}function nb(n,e,t){const s={},i=a(e,["systemInstruction"]);t!==void 0&&i!=null&&u(t,["systemInstruction"],$a(Xe(i)));const r=a(e,["temperature"]);r!=null&&u(s,["temperature"],r);const o=a(e,["topP"]);o!=null&&u(s,["topP"],o);const l=a(e,["topK"]);l!=null&&u(s,["topK"],l);const d=a(e,["candidateCount"]);d!=null&&u(s,["candidateCount"],d);const c=a(e,["maxOutputTokens"]);c!=null&&u(s,["maxOutputTokens"],c);const f=a(e,["stopSequences"]);f!=null&&u(s,["stopSequences"],f);const p=a(e,["responseLogprobs"]);p!=null&&u(s,["responseLogprobs"],p);const h=a(e,["logprobs"]);h!=null&&u(s,["logprobs"],h);const m=a(e,["presencePenalty"]);m!=null&&u(s,["presencePenalty"],m);const g=a(e,["frequencyPenalty"]);g!=null&&u(s,["frequencyPenalty"],g);const v=a(e,["seed"]);v!=null&&u(s,["seed"],v);const _=a(e,["responseMimeType"]);_!=null&&u(s,["responseMimeType"],_);const w=a(e,["responseSchema"]);w!=null&&u(s,["responseSchema"],Ac(w));const E=a(e,["responseJsonSchema"]);if(E!=null&&u(s,["responseJsonSchema"],E),a(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(a(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const S=a(e,["safetySettings"]);if(t!==void 0&&S!=null){let Z=S;Array.isArray(Z)&&(Z=Z.map(X=>Wb(X))),u(t,["safetySettings"],Z)}const T=a(e,["tools"]);if(t!==void 0&&T!=null){let Z=Fi(T);Array.isArray(Z)&&(Z=Z.map(X=>jb(Ui(X)))),u(t,["tools"],Z)}const R=a(e,["toolConfig"]);if(t!==void 0&&R!=null&&u(t,["toolConfig"],Zb(R)),a(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const M=a(e,["cachedContent"]);t!==void 0&&M!=null&&u(t,["cachedContent"],Vn(n,M));const x=a(e,["responseModalities"]);x!=null&&u(s,["responseModalities"],x);const k=a(e,["mediaResolution"]);k!=null&&u(s,["mediaResolution"],k);const I=a(e,["speechConfig"]);if(I!=null&&u(s,["speechConfig"],bc(I)),a(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const N=a(e,["thinkingConfig"]);N!=null&&u(s,["thinkingConfig"],N);const F=a(e,["imageConfig"]);F!=null&&u(s,["imageConfig"],Pb(F));const oe=a(e,["enableEnhancedCivicAnswers"]);return oe!=null&&u(s,["enableEnhancedCivicAnswers"],oe),s}function sb(n,e,t){const s={},i=a(e,["systemInstruction"]);t!==void 0&&i!=null&&u(t,["systemInstruction"],Xe(i));const r=a(e,["temperature"]);r!=null&&u(s,["temperature"],r);const o=a(e,["topP"]);o!=null&&u(s,["topP"],o);const l=a(e,["topK"]);l!=null&&u(s,["topK"],l);const d=a(e,["candidateCount"]);d!=null&&u(s,["candidateCount"],d);const c=a(e,["maxOutputTokens"]);c!=null&&u(s,["maxOutputTokens"],c);const f=a(e,["stopSequences"]);f!=null&&u(s,["stopSequences"],f);const p=a(e,["responseLogprobs"]);p!=null&&u(s,["responseLogprobs"],p);const h=a(e,["logprobs"]);h!=null&&u(s,["logprobs"],h);const m=a(e,["presencePenalty"]);m!=null&&u(s,["presencePenalty"],m);const g=a(e,["frequencyPenalty"]);g!=null&&u(s,["frequencyPenalty"],g);const v=a(e,["seed"]);v!=null&&u(s,["seed"],v);const _=a(e,["responseMimeType"]);_!=null&&u(s,["responseMimeType"],_);const w=a(e,["responseSchema"]);w!=null&&u(s,["responseSchema"],Ac(w));const E=a(e,["responseJsonSchema"]);E!=null&&u(s,["responseJsonSchema"],E);const S=a(e,["routingConfig"]);S!=null&&u(s,["routingConfig"],S);const T=a(e,["modelSelectionConfig"]);T!=null&&u(s,["modelConfig"],T);const R=a(e,["safetySettings"]);if(t!==void 0&&R!=null){let ae=R;Array.isArray(ae)&&(ae=ae.map(Se=>Se)),u(t,["safetySettings"],ae)}const M=a(e,["tools"]);if(t!==void 0&&M!=null){let ae=Fi(M);Array.isArray(ae)&&(ae=ae.map(Se=>Hg(Ui(Se)))),u(t,["tools"],ae)}const x=a(e,["toolConfig"]);t!==void 0&&x!=null&&u(t,["toolConfig"],x);const k=a(e,["labels"]);t!==void 0&&k!=null&&u(t,["labels"],k);const I=a(e,["cachedContent"]);t!==void 0&&I!=null&&u(t,["cachedContent"],Vn(n,I));const N=a(e,["responseModalities"]);N!=null&&u(s,["responseModalities"],N);const F=a(e,["mediaResolution"]);F!=null&&u(s,["mediaResolution"],F);const oe=a(e,["speechConfig"]);oe!=null&&u(s,["speechConfig"],bc(oe));const Z=a(e,["audioTimestamp"]);Z!=null&&u(s,["audioTimestamp"],Z);const X=a(e,["thinkingConfig"]);X!=null&&u(s,["thinkingConfig"],X);const fe=a(e,["imageConfig"]);if(fe!=null&&u(s,["imageConfig"],xb(fe)),a(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return s}function yh(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["contents"]);if(i!=null){let o=Ft(i);Array.isArray(o)&&(o=o.map(l=>$a(l))),u(t,["contents"],o)}const r=a(e,["config"]);return r!=null&&u(t,["generationConfig"],nb(n,r,t)),t}function _h(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["contents"]);if(i!=null){let o=Ft(i);Array.isArray(o)&&(o=o.map(l=>l)),u(t,["contents"],o)}const r=a(e,["config"]);return r!=null&&u(t,["generationConfig"],sb(n,r,t)),t}function vh(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["candidates"]);if(s!=null){let d=s;Array.isArray(d)&&(d=d.map(c=>AA(c))),u(e,["candidates"],d)}const i=a(n,["modelVersion"]);i!=null&&u(e,["modelVersion"],i);const r=a(n,["promptFeedback"]);r!=null&&u(e,["promptFeedback"],r);const o=a(n,["responseId"]);o!=null&&u(e,["responseId"],o);const l=a(n,["usageMetadata"]);return l!=null&&u(e,["usageMetadata"],l),e}function wh(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["candidates"]);if(s!=null){let c=s;Array.isArray(c)&&(c=c.map(f=>f)),u(e,["candidates"],c)}const i=a(n,["createTime"]);i!=null&&u(e,["createTime"],i);const r=a(n,["modelVersion"]);r!=null&&u(e,["modelVersion"],r);const o=a(n,["promptFeedback"]);o!=null&&u(e,["promptFeedback"],o);const l=a(n,["responseId"]);l!=null&&u(e,["responseId"],l);const d=a(n,["usageMetadata"]);return d!=null&&u(e,["usageMetadata"],d),e}function ib(n,e){const t={};if(a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=a(n,["numberOfImages"]);e!==void 0&&s!=null&&u(e,["parameters","sampleCount"],s);const i=a(n,["aspectRatio"]);e!==void 0&&i!=null&&u(e,["parameters","aspectRatio"],i);const r=a(n,["guidanceScale"]);if(e!==void 0&&r!=null&&u(e,["parameters","guidanceScale"],r),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const o=a(n,["safetyFilterLevel"]);e!==void 0&&o!=null&&u(e,["parameters","safetySetting"],o);const l=a(n,["personGeneration"]);e!==void 0&&l!=null&&u(e,["parameters","personGeneration"],l);const d=a(n,["includeSafetyAttributes"]);e!==void 0&&d!=null&&u(e,["parameters","includeSafetyAttributes"],d);const c=a(n,["includeRaiReason"]);e!==void 0&&c!=null&&u(e,["parameters","includeRaiReason"],c);const f=a(n,["language"]);e!==void 0&&f!=null&&u(e,["parameters","language"],f);const p=a(n,["outputMimeType"]);e!==void 0&&p!=null&&u(e,["parameters","outputOptions","mimeType"],p);const h=a(n,["outputCompressionQuality"]);if(e!==void 0&&h!=null&&u(e,["parameters","outputOptions","compressionQuality"],h),a(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const m=a(n,["imageSize"]);if(e!==void 0&&m!=null&&u(e,["parameters","sampleImageSize"],m),a(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function rb(n,e){const t={},s=a(n,["outputGcsUri"]);e!==void 0&&s!=null&&u(e,["parameters","storageUri"],s);const i=a(n,["negativePrompt"]);e!==void 0&&i!=null&&u(e,["parameters","negativePrompt"],i);const r=a(n,["numberOfImages"]);e!==void 0&&r!=null&&u(e,["parameters","sampleCount"],r);const o=a(n,["aspectRatio"]);e!==void 0&&o!=null&&u(e,["parameters","aspectRatio"],o);const l=a(n,["guidanceScale"]);e!==void 0&&l!=null&&u(e,["parameters","guidanceScale"],l);const d=a(n,["seed"]);e!==void 0&&d!=null&&u(e,["parameters","seed"],d);const c=a(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&u(e,["parameters","safetySetting"],c);const f=a(n,["personGeneration"]);e!==void 0&&f!=null&&u(e,["parameters","personGeneration"],f);const p=a(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&u(e,["parameters","includeSafetyAttributes"],p);const h=a(n,["includeRaiReason"]);e!==void 0&&h!=null&&u(e,["parameters","includeRaiReason"],h);const m=a(n,["language"]);e!==void 0&&m!=null&&u(e,["parameters","language"],m);const g=a(n,["outputMimeType"]);e!==void 0&&g!=null&&u(e,["parameters","outputOptions","mimeType"],g);const v=a(n,["outputCompressionQuality"]);e!==void 0&&v!=null&&u(e,["parameters","outputOptions","compressionQuality"],v);const _=a(n,["addWatermark"]);e!==void 0&&_!=null&&u(e,["parameters","addWatermark"],_);const w=a(n,["labels"]);e!==void 0&&w!=null&&u(e,["labels"],w);const E=a(n,["imageSize"]);e!==void 0&&E!=null&&u(e,["parameters","sampleImageSize"],E);const S=a(n,["enhancePrompt"]);return e!==void 0&&S!=null&&u(e,["parameters","enhancePrompt"],S),t}function ob(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["prompt"]);i!=null&&u(t,["instances[0]","prompt"],i);const r=a(e,["config"]);return r!=null&&ib(r,t),t}function ab(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["prompt"]);i!=null&&u(t,["instances[0]","prompt"],i);const r=a(e,["config"]);return r!=null&&rb(r,t),t}function lb(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>wb(o))),u(e,["generatedImages"],r)}const i=a(n,["positivePromptSafetyAttributes"]);return i!=null&&u(e,["positivePromptSafetyAttributes"],Gg(i)),e}function ub(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["predictions"]);if(s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>qa(o))),u(e,["generatedImages"],r)}const i=a(n,["positivePromptSafetyAttributes"]);return i!=null&&u(e,["positivePromptSafetyAttributes"],Vg(i)),e}function cb(n,e){const t={},s=a(n,["numberOfVideos"]);if(e!==void 0&&s!=null&&u(e,["parameters","sampleCount"],s),a(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(a(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=a(n,["durationSeconds"]);if(e!==void 0&&i!=null&&u(e,["parameters","durationSeconds"],i),a(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const r=a(n,["aspectRatio"]);e!==void 0&&r!=null&&u(e,["parameters","aspectRatio"],r);const o=a(n,["resolution"]);e!==void 0&&o!=null&&u(e,["parameters","resolution"],o);const l=a(n,["personGeneration"]);if(e!==void 0&&l!=null&&u(e,["parameters","personGeneration"],l),a(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const d=a(n,["negativePrompt"]);e!==void 0&&d!=null&&u(e,["parameters","negativePrompt"],d);const c=a(n,["enhancePrompt"]);if(e!==void 0&&c!=null&&u(e,["parameters","enhancePrompt"],c),a(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const f=a(n,["lastFrame"]);e!==void 0&&f!=null&&u(e,["instances[0]","lastFrame"],Ba(f));const p=a(n,["referenceImages"]);if(e!==void 0&&p!=null){let h=p;Array.isArray(h)&&(h=h.map(m=>fI(m))),u(e,["instances[0]","referenceImages"],h)}if(a(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(a(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function db(n,e){const t={},s=a(n,["numberOfVideos"]);e!==void 0&&s!=null&&u(e,["parameters","sampleCount"],s);const i=a(n,["outputGcsUri"]);e!==void 0&&i!=null&&u(e,["parameters","storageUri"],i);const r=a(n,["fps"]);e!==void 0&&r!=null&&u(e,["parameters","fps"],r);const o=a(n,["durationSeconds"]);e!==void 0&&o!=null&&u(e,["parameters","durationSeconds"],o);const l=a(n,["seed"]);e!==void 0&&l!=null&&u(e,["parameters","seed"],l);const d=a(n,["aspectRatio"]);e!==void 0&&d!=null&&u(e,["parameters","aspectRatio"],d);const c=a(n,["resolution"]);e!==void 0&&c!=null&&u(e,["parameters","resolution"],c);const f=a(n,["personGeneration"]);e!==void 0&&f!=null&&u(e,["parameters","personGeneration"],f);const p=a(n,["pubsubTopic"]);e!==void 0&&p!=null&&u(e,["parameters","pubsubTopic"],p);const h=a(n,["negativePrompt"]);e!==void 0&&h!=null&&u(e,["parameters","negativePrompt"],h);const m=a(n,["enhancePrompt"]);e!==void 0&&m!=null&&u(e,["parameters","enhancePrompt"],m);const g=a(n,["generateAudio"]);e!==void 0&&g!=null&&u(e,["parameters","generateAudio"],g);const v=a(n,["lastFrame"]);e!==void 0&&v!=null&&u(e,["instances[0]","lastFrame"],sn(v));const _=a(n,["referenceImages"]);if(e!==void 0&&_!=null){let S=_;Array.isArray(S)&&(S=S.map(T=>hI(T))),u(e,["instances[0]","referenceImages"],S)}const w=a(n,["mask"]);e!==void 0&&w!=null&&u(e,["instances[0]","mask"],dI(w));const E=a(n,["compressionQuality"]);return e!==void 0&&E!=null&&u(e,["parameters","compressionQuality"],E),t}function fb(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["metadata"]);s!=null&&u(e,["metadata"],s);const i=a(n,["done"]);i!=null&&u(e,["done"],i);const r=a(n,["error"]);r!=null&&u(e,["error"],r);const o=a(n,["response","generateVideoResponse"]);return o!=null&&u(e,["response"],gb(o)),e}function hb(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["metadata"]);s!=null&&u(e,["metadata"],s);const i=a(n,["done"]);i!=null&&u(e,["done"],i);const r=a(n,["error"]);r!=null&&u(e,["error"],r);const o=a(n,["response"]);return o!=null&&u(e,["response"],yb(o)),e}function pb(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["prompt"]);i!=null&&u(t,["instances[0]","prompt"],i);const r=a(e,["image"]);r!=null&&u(t,["instances[0]","image"],Ba(r));const o=a(e,["video"]);o!=null&&u(t,["instances[0]","video"],Og(o));const l=a(e,["source"]);l!=null&&_b(l,t);const d=a(e,["config"]);return d!=null&&cb(d,t),t}function mb(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["prompt"]);i!=null&&u(t,["instances[0]","prompt"],i);const r=a(e,["image"]);r!=null&&u(t,["instances[0]","image"],sn(r));const o=a(e,["video"]);o!=null&&u(t,["instances[0]","video"],Jg(o));const l=a(e,["source"]);l!=null&&vb(l,t);const d=a(e,["config"]);return d!=null&&db(d,t),t}function gb(n){const e={},t=a(n,["generatedSamples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Sb(o))),u(e,["generatedVideos"],r)}const s=a(n,["raiMediaFilteredCount"]);s!=null&&u(e,["raiMediaFilteredCount"],s);const i=a(n,["raiMediaFilteredReasons"]);return i!=null&&u(e,["raiMediaFilteredReasons"],i),e}function yb(n){const e={},t=a(n,["videos"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(o=>Tb(o))),u(e,["generatedVideos"],r)}const s=a(n,["raiMediaFilteredCount"]);s!=null&&u(e,["raiMediaFilteredCount"],s);const i=a(n,["raiMediaFilteredReasons"]);return i!=null&&u(e,["raiMediaFilteredReasons"],i),e}function _b(n,e){const t={},s=a(n,["prompt"]);e!==void 0&&s!=null&&u(e,["instances[0]","prompt"],s);const i=a(n,["image"]);e!==void 0&&i!=null&&u(e,["instances[0]","image"],Ba(i));const r=a(n,["video"]);return e!==void 0&&r!=null&&u(e,["instances[0]","video"],Og(r)),t}function vb(n,e){const t={},s=a(n,["prompt"]);e!==void 0&&s!=null&&u(e,["instances[0]","prompt"],s);const i=a(n,["image"]);e!==void 0&&i!=null&&u(e,["instances[0]","image"],sn(i));const r=a(n,["video"]);return e!==void 0&&r!=null&&u(e,["instances[0]","video"],Jg(r)),t}function wb(n){const e={},t=a(n,["_self"]);t!=null&&u(e,["image"],Mb(t));const s=a(n,["raiFilteredReason"]);s!=null&&u(e,["raiFilteredReason"],s);const i=a(n,["_self"]);return i!=null&&u(e,["safetyAttributes"],Gg(i)),e}function qa(n){const e={},t=a(n,["_self"]);t!=null&&u(e,["image"],Bg(t));const s=a(n,["raiFilteredReason"]);s!=null&&u(e,["raiFilteredReason"],s);const i=a(n,["_self"]);i!=null&&u(e,["safetyAttributes"],Vg(i));const r=a(n,["prompt"]);return r!=null&&u(e,["enhancedPrompt"],r),e}function Eb(n){const e={},t=a(n,["_self"]);t!=null&&u(e,["mask"],Bg(t));const s=a(n,["labels"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),u(e,["labels"],i)}return e}function Sb(n){const e={},t=a(n,["video"]);return t!=null&&u(e,["video"],uI(t)),e}function Tb(n){const e={},t=a(n,["_self"]);return t!=null&&u(e,["video"],cI(t)),e}function Cb(n){const e={},t=a(n,["modelSelectionConfig"]);t!=null&&u(e,["modelConfig"],t);const s=a(n,["responseJsonSchema"]);s!=null&&u(e,["responseJsonSchema"],s);const i=a(n,["audioTimestamp"]);i!=null&&u(e,["audioTimestamp"],i);const r=a(n,["candidateCount"]);r!=null&&u(e,["candidateCount"],r);const o=a(n,["enableAffectiveDialog"]);o!=null&&u(e,["enableAffectiveDialog"],o);const l=a(n,["frequencyPenalty"]);l!=null&&u(e,["frequencyPenalty"],l);const d=a(n,["logprobs"]);d!=null&&u(e,["logprobs"],d);const c=a(n,["maxOutputTokens"]);c!=null&&u(e,["maxOutputTokens"],c);const f=a(n,["mediaResolution"]);f!=null&&u(e,["mediaResolution"],f);const p=a(n,["presencePenalty"]);p!=null&&u(e,["presencePenalty"],p);const h=a(n,["responseLogprobs"]);h!=null&&u(e,["responseLogprobs"],h);const m=a(n,["responseMimeType"]);m!=null&&u(e,["responseMimeType"],m);const g=a(n,["responseModalities"]);g!=null&&u(e,["responseModalities"],g);const v=a(n,["responseSchema"]);v!=null&&u(e,["responseSchema"],v);const _=a(n,["routingConfig"]);_!=null&&u(e,["routingConfig"],_);const w=a(n,["seed"]);w!=null&&u(e,["seed"],w);const E=a(n,["speechConfig"]);E!=null&&u(e,["speechConfig"],E);const S=a(n,["stopSequences"]);S!=null&&u(e,["stopSequences"],S);const T=a(n,["temperature"]);T!=null&&u(e,["temperature"],T);const R=a(n,["thinkingConfig"]);R!=null&&u(e,["thinkingConfig"],R);const M=a(n,["topK"]);M!=null&&u(e,["topK"],M);const x=a(n,["topP"]);if(x!=null&&u(e,["topP"],x),a(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Ab(n,e){const t={},s=a(e,["model"]);return s!=null&&u(t,["_url","name"],ne(n,s)),t}function bb(n,e){const t={},s=a(e,["model"]);return s!=null&&u(t,["_url","name"],ne(n,s)),t}function Ib(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&u(e,["enableWidget"],t),e}function Rb(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],t),e}function Pb(n){const e={},t=a(n,["aspectRatio"]);t!=null&&u(e,["aspectRatio"],t);const s=a(n,["imageSize"]);if(s!=null&&u(e,["imageSize"],s),a(n,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(a(n,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function xb(n){const e={},t=a(n,["aspectRatio"]);t!=null&&u(e,["aspectRatio"],t);const s=a(n,["imageSize"]);s!=null&&u(e,["imageSize"],s);const i=a(n,["outputMimeType"]);i!=null&&u(e,["imageOutputOptions","mimeType"],i);const r=a(n,["outputCompressionQuality"]);return r!=null&&u(e,["imageOutputOptions","compressionQuality"],r),e}function Mb(n){const e={},t=a(n,["bytesBase64Encoded"]);t!=null&&u(e,["imageBytes"],hs(t));const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function Bg(n){const e={},t=a(n,["gcsUri"]);t!=null&&u(e,["gcsUri"],t);const s=a(n,["bytesBase64Encoded"]);s!=null&&u(e,["imageBytes"],hs(s));const i=a(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function Ba(n){const e={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=a(n,["imageBytes"]);t!=null&&u(e,["bytesBase64Encoded"],hs(t));const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function sn(n){const e={},t=a(n,["gcsUri"]);t!=null&&u(e,["gcsUri"],t);const s=a(n,["imageBytes"]);s!=null&&u(e,["bytesBase64Encoded"],hs(s));const i=a(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function kb(n,e,t){const s={},i=a(e,["pageSize"]);t!==void 0&&i!=null&&u(t,["_query","pageSize"],i);const r=a(e,["pageToken"]);t!==void 0&&r!=null&&u(t,["_query","pageToken"],r);const o=a(e,["filter"]);t!==void 0&&o!=null&&u(t,["_query","filter"],o);const l=a(e,["queryBase"]);return t!==void 0&&l!=null&&u(t,["_url","models_url"],Ng(n,l)),s}function Nb(n,e,t){const s={},i=a(e,["pageSize"]);t!==void 0&&i!=null&&u(t,["_query","pageSize"],i);const r=a(e,["pageToken"]);t!==void 0&&r!=null&&u(t,["_query","pageToken"],r);const o=a(e,["filter"]);t!==void 0&&o!=null&&u(t,["_query","filter"],o);const l=a(e,["queryBase"]);return t!==void 0&&l!=null&&u(t,["_url","models_url"],Ng(n,l)),s}function Db(n,e){const t={},s=a(e,["config"]);return s!=null&&kb(n,s,t),t}function Lb(n,e){const t={},s=a(e,["config"]);return s!=null&&Nb(n,s,t),t}function Ub(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["nextPageToken"]);s!=null&&u(e,["nextPageToken"],s);const i=a(n,["_self"]);if(i!=null){let r=Dg(i);Array.isArray(r)&&(r=r.map(o=>lu(o))),u(e,["models"],r)}return e}function Fb(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["nextPageToken"]);s!=null&&u(e,["nextPageToken"],s);const i=a(n,["_self"]);if(i!=null){let r=Dg(i);Array.isArray(r)&&(r=r.map(o=>uu(o))),u(e,["models"],r)}return e}function $b(n){const e={},t=a(n,["maskMode"]);t!=null&&u(e,["maskMode"],t);const s=a(n,["segmentationClasses"]);s!=null&&u(e,["maskClasses"],s);const i=a(n,["maskDilation"]);return i!=null&&u(e,["dilation"],i),e}function lu(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["displayName"]);s!=null&&u(e,["displayName"],s);const i=a(n,["description"]);i!=null&&u(e,["description"],i);const r=a(n,["version"]);r!=null&&u(e,["version"],r);const o=a(n,["_self"]);o!=null&&u(e,["tunedModelInfo"],eI(o));const l=a(n,["inputTokenLimit"]);l!=null&&u(e,["inputTokenLimit"],l);const d=a(n,["outputTokenLimit"]);d!=null&&u(e,["outputTokenLimit"],d);const c=a(n,["supportedGenerationMethods"]);c!=null&&u(e,["supportedActions"],c);const f=a(n,["temperature"]);f!=null&&u(e,["temperature"],f);const p=a(n,["maxTemperature"]);p!=null&&u(e,["maxTemperature"],p);const h=a(n,["topP"]);h!=null&&u(e,["topP"],h);const m=a(n,["topK"]);m!=null&&u(e,["topK"],m);const g=a(n,["thinking"]);return g!=null&&u(e,["thinking"],g),e}function uu(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["displayName"]);s!=null&&u(e,["displayName"],s);const i=a(n,["description"]);i!=null&&u(e,["description"],i);const r=a(n,["versionId"]);r!=null&&u(e,["version"],r);const o=a(n,["deployedModels"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(h=>QA(h))),u(e,["endpoints"],p)}const l=a(n,["labels"]);l!=null&&u(e,["labels"],l);const d=a(n,["_self"]);d!=null&&u(e,["tunedModelInfo"],tI(d));const c=a(n,["defaultCheckpointId"]);c!=null&&u(e,["defaultCheckpointId"],c);const f=a(n,["checkpoints"]);if(f!=null){let p=f;Array.isArray(p)&&(p=p.map(h=>h)),u(e,["checkpoints"],p)}return e}function qb(n){const e={},t=a(n,["mediaResolution"]);t!=null&&u(e,["mediaResolution"],t);const s=a(n,["codeExecutionResult"]);s!=null&&u(e,["codeExecutionResult"],s);const i=a(n,["executableCode"]);i!=null&&u(e,["executableCode"],i);const r=a(n,["fileData"]);r!=null&&u(e,["fileData"],ZA(r));const o=a(n,["functionCall"]);o!=null&&u(e,["functionCall"],jA(o));const l=a(n,["functionResponse"]);l!=null&&u(e,["functionResponse"],l);const d=a(n,["inlineData"]);d!=null&&u(e,["inlineData"],CA(d));const c=a(n,["text"]);c!=null&&u(e,["text"],c);const f=a(n,["thought"]);f!=null&&u(e,["thought"],f);const p=a(n,["thoughtSignature"]);p!=null&&u(e,["thoughtSignature"],p);const h=a(n,["videoMetadata"]);return h!=null&&u(e,["videoMetadata"],h),e}function Bb(n){const e={},t=a(n,["productImage"]);return t!=null&&u(e,["image"],sn(t)),e}function Gb(n,e){const t={},s=a(n,["numberOfImages"]);e!==void 0&&s!=null&&u(e,["parameters","sampleCount"],s);const i=a(n,["baseSteps"]);e!==void 0&&i!=null&&u(e,["parameters","baseSteps"],i);const r=a(n,["outputGcsUri"]);e!==void 0&&r!=null&&u(e,["parameters","storageUri"],r);const o=a(n,["seed"]);e!==void 0&&o!=null&&u(e,["parameters","seed"],o);const l=a(n,["safetyFilterLevel"]);e!==void 0&&l!=null&&u(e,["parameters","safetySetting"],l);const d=a(n,["personGeneration"]);e!==void 0&&d!=null&&u(e,["parameters","personGeneration"],d);const c=a(n,["addWatermark"]);e!==void 0&&c!=null&&u(e,["parameters","addWatermark"],c);const f=a(n,["outputMimeType"]);e!==void 0&&f!=null&&u(e,["parameters","outputOptions","mimeType"],f);const p=a(n,["outputCompressionQuality"]);e!==void 0&&p!=null&&u(e,["parameters","outputOptions","compressionQuality"],p);const h=a(n,["enhancePrompt"]);e!==void 0&&h!=null&&u(e,["parameters","enhancePrompt"],h);const m=a(n,["labels"]);return e!==void 0&&m!=null&&u(e,["labels"],m),t}function Vb(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["source"]);i!=null&&Ob(i,t);const r=a(e,["config"]);return r!=null&&Gb(r,t),t}function Hb(n){const e={},t=a(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>qa(i))),u(e,["generatedImages"],s)}return e}function Ob(n,e){const t={},s=a(n,["prompt"]);e!==void 0&&s!=null&&u(e,["instances[0]","prompt"],s);const i=a(n,["personImage"]);e!==void 0&&i!=null&&u(e,["instances[0]","personImage","image"],sn(i));const r=a(n,["productImages"]);if(e!==void 0&&r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>Bb(l))),u(e,["instances[0]","productImages"],o)}return t}function Jb(n){const e={},t=a(n,["referenceImage"]);t!=null&&u(e,["referenceImage"],sn(t));const s=a(n,["referenceId"]);s!=null&&u(e,["referenceId"],s);const i=a(n,["referenceType"]);i!=null&&u(e,["referenceType"],i);const r=a(n,["maskImageConfig"]);r!=null&&u(e,["maskImageConfig"],$b(r));const o=a(n,["controlImageConfig"]);o!=null&&u(e,["controlImageConfig"],MA(o));const l=a(n,["styleImageConfig"]);l!=null&&u(e,["styleImageConfig"],l);const d=a(n,["subjectImageConfig"]);return d!=null&&u(e,["subjectImageConfig"],d),e}function Gg(n){const e={},t=a(n,["safetyAttributes","categories"]);t!=null&&u(e,["categories"],t);const s=a(n,["safetyAttributes","scores"]);s!=null&&u(e,["scores"],s);const i=a(n,["contentType"]);return i!=null&&u(e,["contentType"],i),e}function Vg(n){const e={},t=a(n,["safetyAttributes","categories"]);t!=null&&u(e,["categories"],t);const s=a(n,["safetyAttributes","scores"]);s!=null&&u(e,["scores"],s);const i=a(n,["contentType"]);return i!=null&&u(e,["contentType"],i),e}function Wb(n){const e={},t=a(n,["category"]);if(t!=null&&u(e,["category"],t),a(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=a(n,["threshold"]);return s!=null&&u(e,["threshold"],s),e}function zb(n){const e={},t=a(n,["image"]);return t!=null&&u(e,["image"],sn(t)),e}function Kb(n,e){const t={},s=a(n,["mode"]);e!==void 0&&s!=null&&u(e,["parameters","mode"],s);const i=a(n,["maxPredictions"]);e!==void 0&&i!=null&&u(e,["parameters","maxPredictions"],i);const r=a(n,["confidenceThreshold"]);e!==void 0&&r!=null&&u(e,["parameters","confidenceThreshold"],r);const o=a(n,["maskDilation"]);e!==void 0&&o!=null&&u(e,["parameters","maskDilation"],o);const l=a(n,["binaryColorThreshold"]);e!==void 0&&l!=null&&u(e,["parameters","binaryColorThreshold"],l);const d=a(n,["labels"]);return e!==void 0&&d!=null&&u(e,["labels"],d),t}function Yb(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["source"]);i!=null&&Qb(i,t);const r=a(e,["config"]);return r!=null&&Kb(r,t),t}function Xb(n){const e={},t=a(n,["predictions"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(i=>Eb(i))),u(e,["generatedMasks"],s)}return e}function Qb(n,e){const t={},s=a(n,["prompt"]);e!==void 0&&s!=null&&u(e,["instances[0]","prompt"],s);const i=a(n,["image"]);e!==void 0&&i!=null&&u(e,["instances[0]","image"],sn(i));const r=a(n,["scribbleImage"]);return e!==void 0&&r!=null&&u(e,["instances[0]","scribble"],zb(r)),t}function Zb(n){const e={},t=a(n,["functionCallingConfig"]);t!=null&&u(e,["functionCallingConfig"],eb(t));const s=a(n,["retrievalConfig"]);return s!=null&&u(e,["retrievalConfig"],s),e}function jb(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),u(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=a(n,["googleSearchRetrieval"]);s!=null&&u(e,["googleSearchRetrieval"],s);const i=a(n,["computerUse"]);i!=null&&u(e,["computerUse"],i);const r=a(n,["fileSearch"]);r!=null&&u(e,["fileSearch"],r);const o=a(n,["codeExecution"]);if(o!=null&&u(e,["codeExecution"],o),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=a(n,["googleMaps"]);l!=null&&u(e,["googleMaps"],Ib(l));const d=a(n,["googleSearch"]);d!=null&&u(e,["googleSearch"],Rb(d));const c=a(n,["urlContext"]);return c!=null&&u(e,["urlContext"],c),e}function Hg(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(h=>tb(h))),u(e,["functionDeclarations"],p)}const s=a(n,["retrieval"]);s!=null&&u(e,["retrieval"],s);const i=a(n,["googleSearchRetrieval"]);i!=null&&u(e,["googleSearchRetrieval"],i);const r=a(n,["computerUse"]);if(r!=null&&u(e,["computerUse"],r),a(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=a(n,["codeExecution"]);o!=null&&u(e,["codeExecution"],o);const l=a(n,["enterpriseWebSearch"]);l!=null&&u(e,["enterpriseWebSearch"],l);const d=a(n,["googleMaps"]);d!=null&&u(e,["googleMaps"],d);const c=a(n,["googleSearch"]);c!=null&&u(e,["googleSearch"],c);const f=a(n,["urlContext"]);return f!=null&&u(e,["urlContext"],f),e}function eI(n){const e={},t=a(n,["baseModel"]);t!=null&&u(e,["baseModel"],t);const s=a(n,["createTime"]);s!=null&&u(e,["createTime"],s);const i=a(n,["updateTime"]);return i!=null&&u(e,["updateTime"],i),e}function tI(n){const e={},t=a(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&u(e,["baseModel"],t);const s=a(n,["createTime"]);s!=null&&u(e,["createTime"],s);const i=a(n,["updateTime"]);return i!=null&&u(e,["updateTime"],i),e}function nI(n,e){const t={},s=a(n,["displayName"]);e!==void 0&&s!=null&&u(e,["displayName"],s);const i=a(n,["description"]);e!==void 0&&i!=null&&u(e,["description"],i);const r=a(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&u(e,["defaultCheckpointId"],r),t}function sI(n,e){const t={},s=a(n,["displayName"]);e!==void 0&&s!=null&&u(e,["displayName"],s);const i=a(n,["description"]);e!==void 0&&i!=null&&u(e,["description"],i);const r=a(n,["defaultCheckpointId"]);return e!==void 0&&r!=null&&u(e,["defaultCheckpointId"],r),t}function iI(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","name"],ne(n,s));const i=a(e,["config"]);return i!=null&&nI(i,t),t}function rI(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["config"]);return i!=null&&sI(i,t),t}function oI(n,e){const t={},s=a(n,["outputGcsUri"]);e!==void 0&&s!=null&&u(e,["parameters","storageUri"],s);const i=a(n,["safetyFilterLevel"]);e!==void 0&&i!=null&&u(e,["parameters","safetySetting"],i);const r=a(n,["personGeneration"]);e!==void 0&&r!=null&&u(e,["parameters","personGeneration"],r);const o=a(n,["includeRaiReason"]);e!==void 0&&o!=null&&u(e,["parameters","includeRaiReason"],o);const l=a(n,["outputMimeType"]);e!==void 0&&l!=null&&u(e,["parameters","outputOptions","mimeType"],l);const d=a(n,["outputCompressionQuality"]);e!==void 0&&d!=null&&u(e,["parameters","outputOptions","compressionQuality"],d);const c=a(n,["enhanceInputImage"]);e!==void 0&&c!=null&&u(e,["parameters","upscaleConfig","enhanceInputImage"],c);const f=a(n,["imagePreservationFactor"]);e!==void 0&&f!=null&&u(e,["parameters","upscaleConfig","imagePreservationFactor"],f);const p=a(n,["labels"]);e!==void 0&&p!=null&&u(e,["labels"],p);const h=a(n,["numberOfImages"]);e!==void 0&&h!=null&&u(e,["parameters","sampleCount"],h);const m=a(n,["mode"]);return e!==void 0&&m!=null&&u(e,["parameters","mode"],m),t}function aI(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["_url","model"],ne(n,s));const i=a(e,["image"]);i!=null&&u(t,["instances[0]","image"],sn(i));const r=a(e,["upscaleFactor"]);r!=null&&u(t,["parameters","upscaleConfig","upscaleFactor"],r);const o=a(e,["config"]);return o!=null&&oI(o,t),t}function lI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["predictions"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>qa(r))),u(e,["generatedImages"],i)}return e}function uI(n){const e={},t=a(n,["uri"]);t!=null&&u(e,["uri"],t);const s=a(n,["encodedVideo"]);s!=null&&u(e,["videoBytes"],hs(s));const i=a(n,["encoding"]);return i!=null&&u(e,["mimeType"],i),e}function cI(n){const e={},t=a(n,["gcsUri"]);t!=null&&u(e,["uri"],t);const s=a(n,["bytesBase64Encoded"]);s!=null&&u(e,["videoBytes"],hs(s));const i=a(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function dI(n){const e={},t=a(n,["image"]);t!=null&&u(e,["_self"],sn(t));const s=a(n,["maskMode"]);return s!=null&&u(e,["maskMode"],s),e}function fI(n){const e={},t=a(n,["image"]);t!=null&&u(e,["image"],Ba(t));const s=a(n,["referenceType"]);return s!=null&&u(e,["referenceType"],s),e}function hI(n){const e={},t=a(n,["image"]);t!=null&&u(e,["image"],sn(t));const s=a(n,["referenceType"]);return s!=null&&u(e,["referenceType"],s),e}function Og(n){const e={},t=a(n,["uri"]);t!=null&&u(e,["uri"],t);const s=a(n,["videoBytes"]);s!=null&&u(e,["encodedVideo"],hs(s));const i=a(n,["mimeType"]);return i!=null&&u(e,["encoding"],i),e}function Jg(n){const e={},t=a(n,["uri"]);t!=null&&u(e,["gcsUri"],t);const s=a(n,["videoBytes"]);s!=null&&u(e,["bytesBase64Encoded"],hs(s));const i=a(n,["mimeType"]);return i!=null&&u(e,["mimeType"],i),e}function pI(n,e){const t={},s=a(n,["displayName"]);return e!==void 0&&s!=null&&u(e,["displayName"],s),t}function mI(n){const e={},t=a(n,["config"]);return t!=null&&pI(t,e),e}function gI(n,e){const t={},s=a(n,["force"]);return e!==void 0&&s!=null&&u(e,["_query","force"],s),t}function yI(n){const e={},t=a(n,["name"]);t!=null&&u(e,["_url","name"],t);const s=a(n,["config"]);return s!=null&&gI(s,e),e}function _I(n){const e={},t=a(n,["name"]);return t!=null&&u(e,["_url","name"],t),e}function vI(n,e){const t={},s=a(n,["customMetadata"]);if(e!==void 0&&s!=null){let r=s;Array.isArray(r)&&(r=r.map(o=>o)),u(e,["customMetadata"],r)}const i=a(n,["chunkingConfig"]);return e!==void 0&&i!=null&&u(e,["chunkingConfig"],i),t}function wI(n){const e={},t=a(n,["name"]);t!=null&&u(e,["name"],t);const s=a(n,["metadata"]);s!=null&&u(e,["metadata"],s);const i=a(n,["done"]);i!=null&&u(e,["done"],i);const r=a(n,["error"]);r!=null&&u(e,["error"],r);const o=a(n,["response"]);return o!=null&&u(e,["response"],SI(o)),e}function EI(n){const e={},t=a(n,["fileSearchStoreName"]);t!=null&&u(e,["_url","file_search_store_name"],t);const s=a(n,["fileName"]);s!=null&&u(e,["fileName"],s);const i=a(n,["config"]);return i!=null&&vI(i,e),e}function SI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["parent"]);s!=null&&u(e,["parent"],s);const i=a(n,["documentName"]);return i!=null&&u(e,["documentName"],i),e}function TI(n,e){const t={},s=a(n,["pageSize"]);e!==void 0&&s!=null&&u(e,["_query","pageSize"],s);const i=a(n,["pageToken"]);return e!==void 0&&i!=null&&u(e,["_query","pageToken"],i),t}function CI(n){const e={},t=a(n,["config"]);return t!=null&&TI(t,e),e}function AI(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["nextPageToken"]);s!=null&&u(e,["nextPageToken"],s);const i=a(n,["fileSearchStores"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),u(e,["fileSearchStores"],r)}return e}function Wg(n,e){const t={},s=a(n,["mimeType"]);e!==void 0&&s!=null&&u(e,["mimeType"],s);const i=a(n,["displayName"]);e!==void 0&&i!=null&&u(e,["displayName"],i);const r=a(n,["customMetadata"]);if(e!==void 0&&r!=null){let l=r;Array.isArray(l)&&(l=l.map(d=>d)),u(e,["customMetadata"],l)}const o=a(n,["chunkingConfig"]);return e!==void 0&&o!=null&&u(e,["chunkingConfig"],o),t}function bI(n){const e={},t=a(n,["fileSearchStoreName"]);t!=null&&u(e,["_url","file_search_store_name"],t);const s=a(n,["config"]);return s!=null&&Wg(s,e),e}function II(n){const e={},t=a(n,["sdkHttpResponse"]);return t!=null&&u(e,["sdkHttpResponse"],t),e}const RI="Content-Type",PI="X-Server-Timeout",xI="User-Agent",cu="x-goog-api-client",MI="1.34.0",kI=`google-genai-sdk/${MI}`,NI="v1beta1",DI="v1beta";class LI{constructor(e){var t,s;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:NI,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:DI,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const s=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&s.push(e.apiVersion),s.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,s){const i=[this.getRequestUrlInternal(t)];return s&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,s);if(e.queryParams)for(const[o,l]of Object.entries(e.queryParams))i.searchParams.append(o,String(l));let r={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else r.body=e.body;return r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.unaryApiCall(i,r,e.httpMethod)}patchHttpOptions(e,t){const s=JSON.parse(JSON.stringify(e));for(const[i,r]of Object.entries(t))typeof r=="object"?s[i]=Object.assign(Object.assign({},s[i]),r):r!==void 0&&(s[i]=r);return s}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const s=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,s);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let r={};return r.body=e.body,r=await this.includeExtraHttpOptionsToRequestInit(r,t,i.toString(),e.abortSignal),this.streamApiCall(i,r,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,s,i){if(t&&t.timeout||i){const r=new AbortController,o=r.signal;if(t.timeout&&t?.timeout>0){const l=setTimeout(()=>r.abort(),t.timeout);l&&typeof l.unref=="function"&&l.unref()}i&&i.addEventListener("abort",()=>{r.abort()}),e.signal=o}return t&&t.extraBody!==null&&UI(e,t.extraBody),e.headers=await this.getHeadersInternal(t,s),e}async unaryApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async i=>(await Eh(i),new ru(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,s){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:s})).then(async i=>(await Eh(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){return Qt(this,arguments,function*(){var s;const i=(s=e?.body)===null||s===void 0?void 0:s.getReader(),r=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let o="";const l="data:",d=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:c,value:f}=yield W(i.read());if(c){if(o.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const p=r.decode(f,{stream:!0});try{const g=JSON.parse(p);if("error"in g){const v=JSON.parse(JSON.stringify(g.error)),_=v.status,w=v.code,E=`got status: ${_}. ${JSON.stringify(g)}`;if(w>=400&&w<600)throw new Fa({message:E,status:w})}}catch(g){if(g.name==="ApiError")throw g}o+=p;let h=-1,m=0;for(;;){h=-1,m=0;for(const _ of d){const w=o.indexOf(_);w!==-1&&(h===-1||w<h)&&(h=w,m=_.length)}if(h===-1)break;const g=o.substring(0,h);o=o.substring(h+m);const v=g.trim();if(v.startsWith(l)){const _=v.substring(l.length).trim();try{const w=new Response(_,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield W(new ru(w))}catch(w){throw new Error(`exception parsing stream chunk ${_}. ${w}`)}}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(s=>{throw new Error(`exception ${s} sending request`)})}getDefaultHeaders(){const e={},t=kI+" "+this.clientOptions.userAgentExtra;return e[xI]=t,e[cu]=t,e[RI]="application/json",e}async getHeadersInternal(e,t){const s=new Headers;if(e&&e.headers){for(const[i,r]of Object.entries(e.headers))s.append(i,r);e.timeout&&e.timeout>0&&s.append(PI,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(s,t),s}getFileName(e){var t;let s="";return typeof e=="string"&&(s=e.replace(/[/\\]+$/,""),s=(t=s.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),s}async uploadFile(e,t){var s;const i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const r=this.clientOptions.uploader,o=await r.stat(e);i.sizeBytes=String(o.size);const l=(s=t?.mimeType)!==null&&s!==void 0?s:o.type;if(l===void 0||l==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=l;const d={file:i},c=this.getFileName(e),f=L("upload/v1beta/files",d._url),p=await this.fetchUploadUrl(f,i.sizeBytes,i.mimeType,c,d,t?.httpOptions);return r.upload(e,p,this)}async uploadFileToFileSearchStore(e,t,s){var i;const r=this.clientOptions.uploader,o=await r.stat(t),l=String(o.size),d=(i=s?.mimeType)!==null&&i!==void 0?i:o.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const c=`upload/v1beta/${e}:uploadToFileSearchStore`,f=this.getFileName(t),p={};s!=null&&Wg(s,p);const h=await this.fetchUploadUrl(c,l,d,f,p,s?.httpOptions);return r.uploadToFileSearchStore(t,h,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,s,i,r,o){var l;let d={};o?d=o:d={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${s}`},i?{"X-Goog-Upload-File-Name":i}:{})};const c=await this.request({path:e,body:JSON.stringify(r),httpMethod:"POST",httpOptions:d});if(!c||!c?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const f=(l=c?.headers)===null||l===void 0?void 0:l["x-goog-upload-url"];if(f===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return f}}async function Eh(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let s;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?s=await n.json():s={error:{message:await n.text(),code:n.status,status:n.statusText}};const i=JSON.stringify(s);throw t>=400&&t<600?new Fa({message:i,status:t}):new Error(i)}}function UI(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const r=JSON.parse(n.body);if(typeof r=="object"&&r!==null&&!Array.isArray(r))t=r;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function s(r,o){const l=Object.assign({},r);for(const d in o)if(Object.prototype.hasOwnProperty.call(o,d)){const c=o[d],f=l[d];c&&typeof c=="object"&&!Array.isArray(c)&&f&&typeof f=="object"&&!Array.isArray(f)?l[d]=s(f,c):(f&&c&&typeof f!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${d}". Original type: ${typeof f}, New type: ${typeof c}. Overwriting.`),l[d]=c)}return l}const i=s(t,e);n.body=JSON.stringify(i)}const FI="mcp_used/unknown";let $I=!1;function zg(n){for(const e of n)if(qI(e)||typeof e=="object"&&"inputSchema"in e)return!0;return $I}function Kg(n){var e;const t=(e=n[cu])!==null&&e!==void 0?e:"";n[cu]=(t+` ${FI}`).trimStart()}function qI(n){return n!==null&&typeof n=="object"&&n instanceof Rc}function BI(n){return Qt(this,arguments,function*(t,s=100){let i,r=0;for(;r<s;){const o=yield W(t.listTools({cursor:i}));for(const l of o.tools)yield yield W(l),r++;if(!o.nextCursor)break;i=o.nextCursor}})}class Rc{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new Rc(e,t)}async initialize(){var e,t,s,i;if(this.mcpTools.length>0)return;const r={},o=[];for(const f of this.mcpClients)try{for(var l=!0,d=(t=void 0,Zt(BI(f))),c;c=await d.next(),e=c.done,!e;l=!0){i=c.value,l=!1;const p=i;o.push(p);const h=p.name;if(r[h])throw new Error(`Duplicate function name ${h} found in MCP tools. Please ensure function names are unique.`);r[h]=f}}catch(p){t={error:p}}finally{try{!l&&!e&&(s=d.return)&&await s.call(d)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=r}async tool(){return await this.initialize(),_C(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const s of e)if(s.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[s.name];let r;this.config.timeout&&(r={timeout:this.config.timeout});const o=await i.callTool({name:s.name,arguments:s.args},void 0,r);t.push({functionResponse:{name:s.name,response:o.isError?{error:o}:o}})}return t}}async function GI(n,e,t){const s=new cC;let i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),Object.assign(s,i),e(s)}class VI{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s}async connect(e){var t,s;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion(),o=JI(this.apiClient.getDefaultHeaders()),l=this.apiClient.getApiKey(),d=`${i}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateMusic?key=${l}`;let c=()=>{};const f=new Promise(S=>{c=S}),p=e.callbacks,h=function(){c({})},m=this.apiClient,g={onopen:h,onmessage:S=>{GI(m,p.onmessage,S)},onerror:(t=p?.onerror)!==null&&t!==void 0?t:function(S){},onclose:(s=p?.onclose)!==null&&s!==void 0?s:function(S){}},v=this.webSocketFactory.create(d,OI(o),g);v.connect(),await f;const E={setup:{model:ne(this.apiClient,e.model)}};return v.send(JSON.stringify(E)),new HI(v,this.apiClient)}}class HI{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=mA(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=pA(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(pi.PLAY)}pause(){this.sendPlaybackControl(pi.PAUSE)}stop(){this.sendPlaybackControl(pi.STOP)}resetContext(){this.sendPlaybackControl(pi.RESET_CONTEXT)}close(){this.conn.close()}}function OI(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function JI(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}const WI="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function zI(n,e,t){const s=new uC;let i;t.data instanceof Blob?i=await t.data.text():t.data instanceof ArrayBuffer?i=new TextDecoder().decode(t.data):i=t.data;const r=JSON.parse(i);if(n.isVertexAI()){const o=_A(r);Object.assign(s,o)}else Object.assign(s,r);e(s)}class KI{constructor(e,t,s){this.apiClient=e,this.auth=t,this.webSocketFactory=s,this.music=new VI(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,s,i,r,o,l;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const d=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let f;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&zg(e.config.tools)&&Kg(p);const h=ZI(p);if(this.apiClient.isVertexAI())f=`${d}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(h,f);else{const I=this.apiClient.getApiKey();let N="BidiGenerateContent",F="key";I?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),c!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),N="BidiGenerateContentConstrained",F="access_token"),f=`${d}/ws/google.ai.generativelanguage.${c}.GenerativeService.${N}?${F}=${I}`}let m=()=>{};const g=new Promise(I=>{m=I}),v=e.callbacks,_=function(){var I;(I=v?.onopen)===null||I===void 0||I.call(v),m({})},w=this.apiClient,E={onopen:_,onmessage:I=>{zI(w,v.onmessage,I)},onerror:(t=v?.onerror)!==null&&t!==void 0?t:function(I){},onclose:(s=v?.onclose)!==null&&s!==void 0?s:function(I){}},S=this.webSocketFactory.create(f,QI(h),E);S.connect(),await g;let T=ne(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&T.startsWith("publishers/")){const I=this.apiClient.getProject(),N=this.apiClient.getLocation();T=`projects/${I}/locations/${N}/`+T}let R={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[la.AUDIO]}:e.config.responseModalities=[la.AUDIO]),!((r=e.config)===null||r===void 0)&&r.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const M=(l=(o=e.config)===null||o===void 0?void 0:o.tools)!==null&&l!==void 0?l:[],x=[];for(const I of M)if(this.isCallableTool(I)){const N=I;x.push(await N.tool())}else x.push(I);x.length>0&&(e.config.tools=x);const k={model:T,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?R=hA(this.apiClient,k):R=fA(this.apiClient,k),delete R.config,S.send(JSON.stringify(R)),new XI(S,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const YI={turnComplete:!0};class XI{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let s=[];try{s=Ft(t.turns),e.isVertexAI()||(s=s.map(i=>$a(i)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:s,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let s=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?s=t.functionResponses:s=[t.functionResponses],s.length===0)throw new Error("functionResponses is required.");for(const r of s){if(typeof r!="object"||r===null||!("name"in r)||!("response"in r))throw new Error(`Could not parse function response, type '${typeof r}'.`);if(!e.isVertexAI()&&!("id"in r))throw new Error(WI)}return{toolResponse:{functionResponses:s}}}sendClientContent(e){e=Object.assign(Object.assign({},YI),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:yA(e)}:t={realtimeInput:gA(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function QI(n){const e={};return n.forEach((t,s)=>{e[s]=t}),e}function ZI(n){const e=new Headers;for(const[t,s]of Object.entries(n))e.append(t,s);return e}const Sh=10;function Th(n){var e,t,s;if(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const o of(t=n?.tools)!==null&&t!==void 0?t:[])if(Ti(o)){i=!0;break}if(!i)return!0;const r=(s=n?.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls;return r&&(r<0||!Number.isInteger(r))||r==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",r),!0):!1}function Ti(n){return"callTool"in n&&typeof n.callTool=="function"}function jI(n){var e,t,s;return(s=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>Ti(i)))!==null&&s!==void 0?s:!1}function Ch(n){var e;const t=[];return!((e=n?.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((s,i)=>{if(Ti(s))return;const r=s;r.functionDeclarations&&r.functionDeclarations.length>0&&t.push(i)}),t}function Ah(n){var e;return!(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}class eR extends Gn{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var s,i,r,o,l;const d=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!jI(t)||Th(t.config))return await this.generateContentInternal(d);const c=Ch(t);if(c.length>0){const v=c.map(_=>`tools[${_}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${v}.`)}let f,p;const h=Ft(d.contents),m=(r=(i=(s=d.config)===null||s===void 0?void 0:s.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&r!==void 0?r:Sh;let g=0;for(;g<m&&(f=await this.generateContentInternal(d),!(!f.functionCalls||f.functionCalls.length===0));){const v=f.candidates[0].content,_=[];for(const w of(l=(o=t.config)===null||o===void 0?void 0:o.tools)!==null&&l!==void 0?l:[])if(Ti(w)){const S=await w.callTool(f.functionCalls);_.push(...S)}g++,p={role:"user",parts:_},d.contents=Ft(d.contents),d.contents.push(v),d.contents.push(p),Ah(d.config)&&(h.push(v),h.push(p))}return Ah(d.config)&&(f.automaticFunctionCallingHistory=h),f},this.generateContentStream=async t=>{var s,i,r,o,l;if(this.maybeMoveToResponseJsonSchem(t),Th(t.config)){const p=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(p)}const d=Ch(t);if(d.length>0){const p=d.map(h=>`tools[${h}]`).join(", ");throw new Error(`Incompatible tools found at ${p}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const c=(r=(i=(s=t?.config)===null||s===void 0?void 0:s.toolConfig)===null||i===void 0?void 0:i.functionCallingConfig)===null||r===void 0?void 0:r.streamFunctionCallArguments,f=(l=(o=t?.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||l===void 0?void 0:l.disable;if(c&&!f)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(s=>{var i;let r;const o=[];if(s?.generatedImages)for(const d of s.generatedImages)d&&d?.safetyAttributes&&((i=d?.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?r=d?.safetyAttributes:o.push(d);let l;return r?l={generatedImages:o,positivePromptSafetyAttributes:r,sdkHttpResponse:s.sdkHttpResponse}:l={generatedImages:o,sdkHttpResponse:s.sdkHttpResponse},l}),this.list=async t=>{var s;const o={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!o.config.queryBase){if(!((s=o.config)===null||s===void 0)&&s.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");o.config.filter="labels.tune-type:*"}return new Os(Fn.PAGED_ITEM_MODELS,l=>this.listInternal(l),await this.listInternal(o),o)},this.editImage=async t=>{const s={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(s.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(s)},this.upscaleImage=async t=>{let s={numberOfImages:1,mode:"upscale"};t.config&&(s=Object.assign(Object.assign({},s),t.config));const i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:s};return await this.upscaleImageInternal(i)},this.generateVideos=async t=>{var s,i,r,o,l,d;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((s=t.video)===null||s===void 0)&&s.uri&&(!((i=t.video)===null||i===void 0)&&i.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((o=(r=t.source)===null||r===void 0?void 0:r.video)===null||o===void 0)&&o.uri&&(!((d=(l=t.source)===null||l===void 0?void 0:l.video)===null||d===void 0)&&d.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,s,i;const r=(t=e.config)===null||t===void 0?void 0:t.tools;if(!r)return e;const o=await Promise.all(r.map(async d=>Ti(d)?await d.tool():d)),l={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(l.config.tools=o,e.config&&e.config.tools&&zg(e.config.tools)){const d=(i=(s=e.config.httpOptions)===null||s===void 0?void 0:s.headers)!==null&&i!==void 0?i:{};let c=Object.assign({},d);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),Kg(c),l.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return l}async initAfcToolsMap(e){var t,s,i;const r=new Map;for(const o of(s=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&s!==void 0?s:[])if(Ti(o)){const l=o,d=await l.tool();for(const c of(i=d.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(r.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);r.set(c.name,l)}}return r}async processAfcStream(e){var t,s,i;const r=(i=(s=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&i!==void 0?i:Sh;let o=!1,l=0;const d=await this.initAfcToolsMap(e);return(function(c,f,p){return Qt(this,arguments,function*(){for(var h,m,g,v,_,w;l<r;){o&&(l++,o=!1);const R=yield W(c.processParamsMaybeAddMcpUsage(p)),M=yield W(c.generateContentStreamInternal(R)),x=[],k=[];try{for(var E=!0,S=(m=void 0,Zt(M)),T;T=yield W(S.next()),h=T.done,!h;E=!0){v=T.value,E=!1;const I=v;if(yield yield W(I),I.candidates&&(!((_=I.candidates[0])===null||_===void 0)&&_.content)){k.push(I.candidates[0].content);for(const N of(w=I.candidates[0].content.parts)!==null&&w!==void 0?w:[])if(l<r&&N.functionCall){if(!N.functionCall.name)throw new Error("Function call name was not returned by the model.");if(f.has(N.functionCall.name)){const F=yield W(f.get(N.functionCall.name).callTool([N.functionCall]));x.push(...F)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${f.keys()}, mising tool: ${N.functionCall.name}`)}}}}catch(I){m={error:I}}finally{try{!E&&!h&&(g=S.return)&&(yield W(g.call(S)))}finally{if(m)throw m.error}}if(x.length>0){o=!0;const I=new ur;I.candidates=[{content:{role:"user",parts:x}}],yield yield W(I);const N=[];N.push(...k),N.push({role:"user",parts:x});const F=Ft(p.contents).concat(N);p.contents=F}else break}})})(this,d,e)}async generateContentInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=_h(this.apiClient,e);return l=L("{model}:generateContent",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=wh(f),h=new ur;return Object.assign(h,p),h})}else{const c=yh(this.apiClient,e);return l=L("{model}:generateContent",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=vh(f),h=new ur;return Object.assign(h,p),h})}}async generateContentStreamInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=_h(this.apiClient,e);return l=L("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}),o.then(function(p){return Qt(this,arguments,function*(){var h,m,g,v;try{for(var _=!0,w=Zt(p),E;E=yield W(w.next()),h=E.done,!h;_=!0){v=E.value,_=!1;const S=v,T=wh(yield W(S.json()));T.sdkHttpResponse={headers:S.headers};const R=new ur;Object.assign(R,T),yield yield W(R)}}catch(S){m={error:S}}finally{try{!_&&!h&&(g=w.return)&&(yield W(g.call(w)))}finally{if(m)throw m.error}}})})}else{const c=yh(this.apiClient,e);return l=L("{model}:streamGenerateContent?alt=sse",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.requestStream({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),o.then(function(p){return Qt(this,arguments,function*(){var h,m,g,v;try{for(var _=!0,w=Zt(p),E;E=yield W(w.next()),h=E.done,!h;_=!0){v=E.value,_=!1;const S=v,T=vh(yield W(S.json()));T.sdkHttpResponse={headers:S.headers};const R=new ur;Object.assign(R,T),yield yield W(R)}}catch(S){m={error:S}}finally{try{!_&&!h&&(g=w.return)&&(yield W(g.call(w)))}finally{if(m)throw m.error}}})})}}async embedContent(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=KA(this.apiClient,e);return l=L("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=XA(f),h=new eh;return Object.assign(h,p),h})}else{const c=zA(this.apiClient,e);return l=L("{model}:batchEmbedContents",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=YA(f),h=new eh;return Object.assign(h,p),h})}}async generateImagesInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=ab(this.apiClient,e);return l=L("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=ub(f),h=new th;return Object.assign(h,p),h})}else{const c=ob(this.apiClient,e);return l=L("{model}:predict",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=lb(f),h=new th;return Object.assign(h,p),h})}}async editImageInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const l=HA(this.apiClient,e);return r=L("{model}:predict",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=OA(d),f=new ZT;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const l=aI(this.apiClient,e);return r=L("{model}:predict",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=lI(d),f=new jT;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const l=Vb(this.apiClient,e);return r=L("{model}:predict",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Hb(d),f=new eC;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const l=Yb(this.apiClient,e);return r=L("{model}:predict",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=Xb(d),f=new tC;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=bb(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>uu(f))}else{const c=Ab(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>lu(f))}}async listInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=Lb(this.apiClient,e);return l=L("{models_url}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=Fb(f),h=new nh;return Object.assign(h,p),h})}else{const c=Db(this.apiClient,e);return l=L("{models_url}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=Ub(f),h=new nh;return Object.assign(h,p),h})}}async update(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=rI(this.apiClient,e);return l=L("{model}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>uu(f))}else{const c=iI(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>lu(f))}}async delete(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=qA(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=GA(f),h=new sh;return Object.assign(h,p),h})}else{const c=$A(this.apiClient,e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=BA(f),h=new sh;return Object.assign(h,p),h})}}async countTokens(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=LA(this.apiClient,e);return l=L("{model}:countTokens",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=FA(f),h=new ih;return Object.assign(h,p),h})}else{const c=DA(this.apiClient,e);return l=L("{model}:countTokens",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=UA(f),h=new ih;return Object.assign(h,p),h})}}async computeTokens(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const l=IA(this.apiClient,e);return r=L("{model}:computeTokens",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>{const c=RA(d),f=new nC;return Object.assign(f,c),f})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=mb(this.apiClient,e);return l=L("{model}:predictLongRunning",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o.then(f=>{const p=hb(f),h=new ua;return Object.assign(h,p),h})}else{const c=pb(this.apiClient,e);return l=L("{model}:predictLongRunning",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o.then(f=>{const p=fb(f),h=new ua;return Object.assign(h,p),h})}}}class tR extends Gn{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async get(e){const t=e.operation,s=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let r;s&&"httpOptions"in s&&(r=s.httpOptions);const o=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:r}});return t._fromAPIResponse({apiResponse:o,_isVertexAI:!0})}else{const i=await this.getVideosOperationInternal({operationName:t.name,config:s});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=WT(e);return l=L("{operationName}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json()),o}else{const c=JT(e);return l=L("{operationName}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json()),o}}async fetchPredictVideosOperationInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const l=$T(e);return r=L("{resourceName}:fetchPredictOperation",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i}else throw new Error("This method is only supported by the Vertex AI.")}}function nR(n){const e={},t=a(n,["data"]);if(t!=null&&u(e,["data"],t),a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function sR(n){const e={},t=a(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(r=>fR(r))),u(e,["parts"],i)}const s=a(n,["role"]);return s!=null&&u(e,["role"],s),e}function iR(n,e,t){const s={},i=a(e,["expireTime"]);t!==void 0&&i!=null&&u(t,["expireTime"],i);const r=a(e,["newSessionExpireTime"]);t!==void 0&&r!=null&&u(t,["newSessionExpireTime"],r);const o=a(e,["uses"]);t!==void 0&&o!=null&&u(t,["uses"],o);const l=a(e,["liveConnectConstraints"]);t!==void 0&&l!=null&&u(t,["bidiGenerateContentSetup"],dR(n,l));const d=a(e,["lockAdditionalFields"]);return t!==void 0&&d!=null&&u(t,["fieldMask"],d),s}function rR(n,e){const t={},s=a(e,["config"]);return s!=null&&u(t,["config"],iR(n,s,t)),t}function oR(n){const e={};if(a(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=a(n,["fileUri"]);t!=null&&u(e,["fileUri"],t);const s=a(n,["mimeType"]);return s!=null&&u(e,["mimeType"],s),e}function aR(n){const e={},t=a(n,["id"]);t!=null&&u(e,["id"],t);const s=a(n,["args"]);s!=null&&u(e,["args"],s);const i=a(n,["name"]);if(i!=null&&u(e,["name"],i),a(n,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(a(n,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function lR(n){const e={};if(a(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=a(n,["enableWidget"]);return t!=null&&u(e,["enableWidget"],t),e}function uR(n){const e={};if(a(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(a(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=a(n,["timeRangeFilter"]);return t!=null&&u(e,["timeRangeFilter"],t),e}function cR(n,e){const t={},s=a(n,["generationConfig"]);e!==void 0&&s!=null&&u(e,["setup","generationConfig"],s);const i=a(n,["responseModalities"]);e!==void 0&&i!=null&&u(e,["setup","generationConfig","responseModalities"],i);const r=a(n,["temperature"]);e!==void 0&&r!=null&&u(e,["setup","generationConfig","temperature"],r);const o=a(n,["topP"]);e!==void 0&&o!=null&&u(e,["setup","generationConfig","topP"],o);const l=a(n,["topK"]);e!==void 0&&l!=null&&u(e,["setup","generationConfig","topK"],l);const d=a(n,["maxOutputTokens"]);e!==void 0&&d!=null&&u(e,["setup","generationConfig","maxOutputTokens"],d);const c=a(n,["mediaResolution"]);e!==void 0&&c!=null&&u(e,["setup","generationConfig","mediaResolution"],c);const f=a(n,["seed"]);e!==void 0&&f!=null&&u(e,["setup","generationConfig","seed"],f);const p=a(n,["speechConfig"]);e!==void 0&&p!=null&&u(e,["setup","generationConfig","speechConfig"],Ic(p));const h=a(n,["thinkingConfig"]);e!==void 0&&h!=null&&u(e,["setup","generationConfig","thinkingConfig"],h);const m=a(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&u(e,["setup","generationConfig","enableAffectiveDialog"],m);const g=a(n,["systemInstruction"]);e!==void 0&&g!=null&&u(e,["setup","systemInstruction"],sR(Xe(g)));const v=a(n,["tools"]);if(e!==void 0&&v!=null){let M=Fi(v);Array.isArray(M)&&(M=M.map(x=>pR(Ui(x)))),u(e,["setup","tools"],M)}const _=a(n,["sessionResumption"]);e!==void 0&&_!=null&&u(e,["setup","sessionResumption"],hR(_));const w=a(n,["inputAudioTranscription"]);e!==void 0&&w!=null&&u(e,["setup","inputAudioTranscription"],w);const E=a(n,["outputAudioTranscription"]);e!==void 0&&E!=null&&u(e,["setup","outputAudioTranscription"],E);const S=a(n,["realtimeInputConfig"]);e!==void 0&&S!=null&&u(e,["setup","realtimeInputConfig"],S);const T=a(n,["contextWindowCompression"]);e!==void 0&&T!=null&&u(e,["setup","contextWindowCompression"],T);const R=a(n,["proactivity"]);if(e!==void 0&&R!=null&&u(e,["setup","proactivity"],R),a(n,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function dR(n,e){const t={},s=a(e,["model"]);s!=null&&u(t,["setup","model"],ne(n,s));const i=a(e,["config"]);return i!=null&&u(t,["config"],cR(i,t)),t}function fR(n){const e={},t=a(n,["mediaResolution"]);t!=null&&u(e,["mediaResolution"],t);const s=a(n,["codeExecutionResult"]);s!=null&&u(e,["codeExecutionResult"],s);const i=a(n,["executableCode"]);i!=null&&u(e,["executableCode"],i);const r=a(n,["fileData"]);r!=null&&u(e,["fileData"],oR(r));const o=a(n,["functionCall"]);o!=null&&u(e,["functionCall"],aR(o));const l=a(n,["functionResponse"]);l!=null&&u(e,["functionResponse"],l);const d=a(n,["inlineData"]);d!=null&&u(e,["inlineData"],nR(d));const c=a(n,["text"]);c!=null&&u(e,["text"],c);const f=a(n,["thought"]);f!=null&&u(e,["thought"],f);const p=a(n,["thoughtSignature"]);p!=null&&u(e,["thoughtSignature"],p);const h=a(n,["videoMetadata"]);return h!=null&&u(e,["videoMetadata"],h),e}function hR(n){const e={},t=a(n,["handle"]);if(t!=null&&u(e,["handle"],t),a(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function pR(n){const e={},t=a(n,["functionDeclarations"]);if(t!=null){let f=t;Array.isArray(f)&&(f=f.map(p=>p)),u(e,["functionDeclarations"],f)}if(a(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const s=a(n,["googleSearchRetrieval"]);s!=null&&u(e,["googleSearchRetrieval"],s);const i=a(n,["computerUse"]);i!=null&&u(e,["computerUse"],i);const r=a(n,["fileSearch"]);r!=null&&u(e,["fileSearch"],r);const o=a(n,["codeExecution"]);if(o!=null&&u(e,["codeExecution"],o),a(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=a(n,["googleMaps"]);l!=null&&u(e,["googleMaps"],lR(l));const d=a(n,["googleSearch"]);d!=null&&u(e,["googleSearch"],uR(d));const c=a(n,["urlContext"]);return c!=null&&u(e,["urlContext"],c),e}function mR(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const s=n[t];if(typeof s=="object"&&s!=null&&Object.keys(s).length>0){const i=Object.keys(s).map(r=>`${t}.${r}`);e.push(...i)}else e.push(t)}return e.join(",")}function gR(n,e){let t=null;const s=n.bidiGenerateContentSetup;if(typeof s=="object"&&s!==null&&"setup"in s){const r=s.setup;typeof r=="object"&&r!==null?(n.bidiGenerateContentSetup=r,t=r):delete n.bidiGenerateContentSetup}else s!==void 0&&delete n.bidiGenerateContentSetup;const i=n.fieldMask;if(t){const r=mR(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)r?n.fieldMask=r:delete n.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const o=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let l=[];i.length>0&&(l=i.map(c=>o.includes(c)?`generationConfig.${c}`:c));const d=[];r&&d.push(r),l.length>0&&d.push(...l),d.length>0?n.fieldMask=d.join(","):delete n.fieldMask}else delete n.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?n.fieldMask=i.join(","):delete n.fieldMask;return n}class yR extends Gn{constructor(e){super(),this.apiClient=e}async create(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const l=rR(this.apiClient,e);r=L("auth_tokens",l._url),o=l._query,delete l.config,delete l._url,delete l._query;const d=gR(l,e.config);return i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(c=>c.json()),i.then(c=>c)}}}function _R(n,e){const t={},s=a(n,["force"]);return e!==void 0&&s!=null&&u(e,["_query","force"],s),t}function vR(n){const e={},t=a(n,["name"]);t!=null&&u(e,["_url","name"],t);const s=a(n,["config"]);return s!=null&&_R(s,e),e}function wR(n){const e={},t=a(n,["name"]);return t!=null&&u(e,["_url","name"],t),e}function ER(n,e){const t={},s=a(n,["pageSize"]);e!==void 0&&s!=null&&u(e,["_query","pageSize"],s);const i=a(n,["pageToken"]);return e!==void 0&&i!=null&&u(e,["_query","pageToken"],i),t}function SR(n){const e={},t=a(n,["parent"]);t!=null&&u(e,["_url","parent"],t);const s=a(n,["config"]);return s!=null&&ER(s,e),e}function TR(n){const e={},t=a(n,["sdkHttpResponse"]);t!=null&&u(e,["sdkHttpResponse"],t);const s=a(n,["nextPageToken"]);s!=null&&u(e,["nextPageToken"],s);const i=a(n,["documents"]);if(i!=null){let r=i;Array.isArray(r)&&(r=r.map(o=>o)),u(e,["documents"],r)}return e}class CR extends Gn{constructor(e){super(),this.apiClient=e,this.list=async t=>new Os(Fn.PAGED_ITEM_DOCUMENTS,s=>this.listInternal({parent:t.parent,config:s.config}),await this.listInternal(t),t)}async get(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=wR(e);return r=L("{name}",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var t,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=vR(e);i=L("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=SR(e);return r=L("{parent}/documents",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=TR(d),f=new sC;return Object.assign(f,c),f})}}}class AR extends Gn{constructor(e,t=new CR(e)){super(),this.apiClient=e,this.documents=t,this.list=async(s={})=>new Os(Fn.PAGED_ITEM_FILE_SEARCH_STORES,i=>this.listInternal(i),await this.listInternal(s),s)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=mI(e);return r=L("fileSearchStores",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async get(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=_I(e);return r=L("{name}",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>d)}}async delete(e){var t,s;let i="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=yI(e);i=L("{name}",o._url),r=o._query,delete o._url,delete o._query,await this.apiClient.request({path:i,queryParams:r,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal})}}async listInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=CI(e);return r=L("fileSearchStores",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=AI(d),f=new iC;return Object.assign(f,c),f})}}async uploadToFileSearchStoreInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=bI(e);return r=L("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=II(d),f=new rC;return Object.assign(f,c),f})}}async importFile(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=EI(e);return r=L("{file_search_store_name}:importFile",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json()),i.then(d=>{const c=wI(d),f=new Sc;return Object.assign(f,c),f})}}}let Yg=function(){const{crypto:n}=globalThis;if(n?.randomUUID)return Yg=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^t()&15>>+s/4).toString(16))};const bR=()=>Yg();function du(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const fu=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class qt extends Error{}class it extends qt{constructor(e,t,s,i){super(`${it.makeMessage(e,t,s)}`),this.status=e,this.headers=i,this.error=t}static makeMessage(e,t,s){const i=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,s,i){if(!e||!i)return new Ga({message:s,cause:fu(t)});const r=t;return e===400?new Qg(e,r,s,i):e===401?new Zg(e,r,s,i):e===403?new jg(e,r,s,i):e===404?new ey(e,r,s,i):e===409?new ty(e,r,s,i):e===422?new ny(e,r,s,i):e===429?new sy(e,r,s,i):e>=500?new iy(e,r,s,i):new it(e,r,s,i)}}class hu extends it{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class Ga extends it{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class Xg extends Ga{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Qg extends it{}class Zg extends it{}class jg extends it{}class ey extends it{}class ty extends it{}class ny extends it{}class sy extends it{}class iy extends it{}const IR=/^[a-z][a-z0-9+.-]*:/i,RR=n=>IR.test(n);let pu=n=>(pu=Array.isArray,pu(n));const PR=pu;let xR=PR;const bh=xR;function MR(n){if(!n)return!0;for(const e in n)return!1;return!0}function kR(n,e){return Object.prototype.hasOwnProperty.call(n,e)}const NR=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new qt(`${n} must be an integer`);if(e<0)throw new qt(`${n} must be a positive integer`);return e},DR=n=>{try{return JSON.parse(n)}catch{return}};const LR=n=>new Promise(e=>setTimeout(e,n));const di="0.0.1";function UR(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const FR=()=>{var n,e,t,s,i;const r=UR();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":Rh(Deno.build.os),"X-Stainless-Arch":Ih(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(n=Deno.version)===null||n===void 0?void 0:n.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":Rh((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":Ih((s=globalThis.process.arch)!==null&&s!==void 0?s:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(i=globalThis.process.version)!==null&&i!==void 0?i:"unknown"};const o=$R();return o?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${o.browser}`,"X-Stainless-Runtime-Version":o.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":di,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function $R(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const s=t.exec(navigator.userAgent);if(s){const i=s[1]||0,r=s[2]||0,o=s[3]||0;return{browser:e,version:`${i}.${r}.${o}`}}}return null}const Ih=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",Rh=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Mo;const qR=()=>Mo??(Mo=FR());function BR(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function ry(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function GR(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return ry({start(){},async pull(t){const{done:s,value:i}=await e.next();s?t.close():t.enqueue(i)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function oy(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function VR(n){var e,t;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((t=(e=n[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}const s=n.getReader(),i=s.cancel();s.releaseLock(),await i}const HR=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});const ay=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e?.versions)===null||n===void 0?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function yl(n,e,t){return ay(),new File(n,e??"unknown_file",t)}function OR(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const JR=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function";const ly=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",WR=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&ly(n),zR=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function KR(n,e,t){if(ay(),n=await n,WR(n))return n instanceof File?n:yl([await n.arrayBuffer()],n.name);if(zR(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),yl(await mu(i),e,t)}const s=await mu(n);if(e||(e=OR(n)),!t?.type){const i=s.find(r=>typeof r=="object"&&"type"in r&&r.type);typeof i=="string"&&(t=Object.assign(Object.assign({},t),{type:i}))}return yl(s,e,t)}async function mu(n){var e,t,s,i,r;let o=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)o.push(n);else if(ly(n))o.push(n instanceof Blob?n:await n.arrayBuffer());else if(JR(n))try{for(var l=!0,d=Zt(n),c;c=await d.next(),e=c.done,!e;l=!0){i=c.value,l=!1;const f=i;o.push(...await mu(f))}}catch(f){t={error:f}}finally{try{!l&&!e&&(s=d.return)&&await s.call(d)}finally{if(t)throw t.error}}else{const f=(r=n?.constructor)===null||r===void 0?void 0:r.name;throw new Error(`Unexpected data type: ${typeof n}${f?`; constructor: ${f}`:""}${YR(n)}`)}return o}function YR(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}class uy{constructor(e){this._client=e}}uy._key=[];function cy(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Ph=Object.freeze(Object.create(null)),XR=(n=cy)=>(function(t,...s){if(t.length===1)return t[0];let i=!1;const r=[],o=t.reduce((f,p,h)=>{var m,g,v;/[?#]/.test(p)&&(i=!0);const _=s[h];let w=(i?encodeURIComponent:n)(""+_);return h!==s.length&&(_==null||typeof _=="object"&&_.toString===((v=Object.getPrototypeOf((g=Object.getPrototypeOf((m=_.hasOwnProperty)!==null&&m!==void 0?m:Ph))!==null&&g!==void 0?g:Ph))===null||v===void 0?void 0:v.toString))&&(w=_+"",r.push({start:f.length+p.length,length:w.length,error:`Value of type ${Object.prototype.toString.call(_).slice(8,-1)} is not a valid path parameter`})),f+p+(h===s.length?"":w)},""),l=o.split(/[?#]/,1)[0],d=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=d.exec(l))!==null;)r.push({start:c.index,length:c[0].length,error:`Value "${c[0]}" can't be safely passed as a path parameter`});if(r.sort((f,p)=>f.start-p.start),r.length>0){let f=0;const p=r.reduce((h,m)=>{const g=" ".repeat(m.start-f),v="^".repeat(m.length);return f=m.start+m.length,h+g+v},"");throw new qt(`Path parameters result in path with invalid segments:
${r.map(h=>h.error).join(`
`)}
${o}
${p}`)}return o}),ko=XR(cy);class dy extends uy{create(e,t){var s;const{api_version:i=this._client.apiVersion}=e,r=da(e,["api_version"]);if("model"in r&&"agent_config"in r)throw new qt("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in r&&"generation_config"in r)throw new qt("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post(ko`/${i}/interactions`,Object.assign(Object.assign({body:r},t),{stream:(s=e.stream)!==null&&s!==void 0?s:!1}))}delete(e,t={},s){const{api_version:i=this._client.apiVersion}=t??{};return this._client.delete(ko`/${i}/interactions/${e}`,s)}cancel(e,t={},s){const{api_version:i=this._client.apiVersion}=t??{};return this._client.post(ko`/${i}/interactions/${e}/cancel`,s)}get(e,t={},s){var i;const r=t??{},{api_version:o=this._client.apiVersion}=r,l=da(r,["api_version"]);return this._client.get(ko`/${o}/interactions/${e}`,Object.assign(Object.assign({query:l},s),{stream:(i=t?.stream)!==null&&i!==void 0?i:!1}))}}dy._key=Object.freeze(["interactions"]);class fy extends dy{}function QR(n){let e=0;for(const i of n)e+=i.length;const t=new Uint8Array(e);let s=0;for(const i of n)t.set(i,s),s+=i.length;return t}let No;function Pc(n){let e;return(No??(e=new globalThis.TextEncoder,No=e.encode.bind(e)))(n)}let Do;function xh(n){let e;return(Do??(e=new globalThis.TextDecoder,Do=e.decode.bind(e)))(n)}class Va{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?Pc(e):e;this.buffer=QR([this.buffer,t]);const s=[];let i;for(;(i=ZR(this.buffer,this.carriageReturnIndex))!=null;){if(i.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=i.index;continue}if(this.carriageReturnIndex!=null&&(i.index!==this.carriageReturnIndex+1||i.carriage)){s.push(xh(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const r=this.carriageReturnIndex!==null?i.preceding-1:i.preceding,o=xh(this.buffer.subarray(0,r));s.push(o),this.buffer=this.buffer.subarray(i.index),this.carriageReturnIndex=null}return s}flush(){return this.buffer.length?this.decode(`
`):[]}}Va.NEWLINE_CHARS=new Set([`
`,"\r"]);Va.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function ZR(n,e){for(let i=e??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function jR(n){for(let s=0;s<n.length-1;s++){if(n[s]===10&&n[s+1]===10||n[s]===13&&n[s+1]===13)return s+2;if(n[s]===13&&n[s+1]===10&&s+3<n.length&&n[s+2]===13&&n[s+3]===10)return s+4}return-1}const fa={off:0,error:200,warn:300,info:400,debug:500},Mh=(n,e,t)=>{if(n){if(kR(fa,n))return n;nt(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(fa))}`)}};function Tr(){}function Lo(n,e,t){return!e||fa[n]>fa[t]?Tr:e[n].bind(e)}const eP={error:Tr,warn:Tr,info:Tr,debug:Tr};let kh=new WeakMap;function nt(n){var e;const t=n.logger,s=(e=n.logLevel)!==null&&e!==void 0?e:"off";if(!t)return eP;const i=kh.get(t);if(i&&i[0]===s)return i[1];const r={error:Lo("error",t,s),warn:Lo("warn",t,s),info:Lo("info",t,s),debug:Lo("debug",t,s)};return kh.set(t,[s,r]),r}const Cs=n=>(n.options&&(n.options=Object.assign({},n.options),delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);class mi{constructor(e,t,s){this.iterator=e,this.controller=t,this.client=s}static fromSSEResponse(e,t,s){let i=!1;const r=s?nt(s):console;function o(){return Qt(this,arguments,function*(){var d,c,f,p;if(i)throw new qt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let h=!1;try{try{for(var m=!0,g=Zt(tP(e,t)),v;v=yield W(g.next()),d=v.done,!d;m=!0){p=v.value,m=!1;const _=p;if(!h)if(_.data.startsWith("[DONE]")){h=!0;continue}else try{yield yield W(JSON.parse(_.data))}catch(w){throw r.error("Could not parse message into JSON:",_.data),r.error("From chunk:",_.raw),w}}}catch(_){c={error:_}}finally{try{!m&&!d&&(f=g.return)&&(yield W(f.call(g)))}finally{if(c)throw c.error}}h=!0}catch(_){if(du(_))return yield W(void 0);throw _}finally{h||t.abort()}})}return new mi(o,t,s)}static fromReadableStream(e,t,s){let i=!1;function r(){return Qt(this,arguments,function*(){var d,c,f,p;const h=new Va,m=oy(e);try{for(var g=!0,v=Zt(m),_;_=yield W(v.next()),d=_.done,!d;g=!0){p=_.value,g=!1;const w=p;for(const E of h.decode(w))yield yield W(E)}}catch(w){c={error:w}}finally{try{!g&&!d&&(f=v.return)&&(yield W(f.call(v)))}finally{if(c)throw c.error}}for(const w of h.flush())yield yield W(w)})}function o(){return Qt(this,arguments,function*(){var d,c,f,p;if(i)throw new qt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");i=!0;let h=!1;try{try{for(var m=!0,g=Zt(r()),v;v=yield W(g.next()),d=v.done,!d;m=!0){p=v.value,m=!1;const _=p;h||_&&(yield yield W(JSON.parse(_)))}}catch(_){c={error:_}}finally{try{!m&&!d&&(f=g.return)&&(yield W(f.call(g)))}finally{if(c)throw c.error}}h=!0}catch(_){if(du(_))return yield W(void 0);throw _}finally{h||t.abort()}})}return new mi(o,t,s)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),i=r=>({next:()=>{if(r.length===0){const o=s.next();e.push(o),t.push(o)}return r.shift()}});return[new mi(()=>i(e),this.controller,this.client),new mi(()=>i(t),this.controller,this.client)]}toReadableStream(){const e=this;let t;return ry({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{const{value:i,done:r}=await t.next();if(r)return s.close();const o=Pc(JSON.stringify(i)+`
`);s.enqueue(o)}catch(i){s.error(i)}},async cancel(){var s;await((s=t.return)===null||s===void 0?void 0:s.call(t))}})}}function tP(n,e){return Qt(this,arguments,function*(){var s,i,r,o;if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new qt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new qt("Attempted to iterate over a response with no body");const l=new sP,d=new Va,c=oy(n.body);try{for(var f=!0,p=Zt(nP(c)),h;h=yield W(p.next()),s=h.done,!s;f=!0){o=h.value,f=!1;const m=o;for(const g of d.decode(m)){const v=l.decode(g);v&&(yield yield W(v))}}}catch(m){i={error:m}}finally{try{!f&&!s&&(r=p.return)&&(yield W(r.call(p)))}finally{if(i)throw i.error}}for(const m of d.flush()){const g=l.decode(m);g&&(yield yield W(g))}})}function nP(n){return Qt(this,arguments,function*(){var t,s,i,r;let o=new Uint8Array;try{for(var l=!0,d=Zt(n),c;c=yield W(d.next()),t=c.done,!t;l=!0){r=c.value,l=!1;const f=r;if(f==null)continue;const p=f instanceof ArrayBuffer?new Uint8Array(f):typeof f=="string"?Pc(f):f;let h=new Uint8Array(o.length+p.length);h.set(o),h.set(p,o.length),o=h;let m;for(;(m=jR(o))!==-1;)yield yield W(o.slice(0,m)),o=o.slice(m)}}catch(f){s={error:f}}finally{try{!l&&!t&&(i=d.return)&&(yield W(i.call(d)))}finally{if(s)throw s.error}}o.length>0&&(yield yield W(o))})}class sP{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const r={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],r}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,i]=iP(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}}function iP(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function rP(n,e){const{response:t,requestLogID:s,retryOfRequestLogID:i,startTime:r}=e,o=await(async()=>{var l;if(e.options.stream)return nt(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,n):mi.fromSSEResponse(t,e.controller,n);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const d=t.headers.get("content-type"),c=(l=d?.split(";")[0])===null||l===void 0?void 0:l.trim();return c?.includes("application/json")||c?.endsWith("+json")?await t.json():await t.text()})();return nt(n).debug(`[${s}] response parsed`,Cs({retryOfRequestLogID:i,url:t.url,status:t.status,body:o,durationMs:Date.now()-r})),o}class xc extends Promise{constructor(e,t,s=rP){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=s,this.client=e}_thenUnwrap(e){return new xc(this.client,this.responsePromise,async(t,s)=>e(await this.parseResponse(t,s),s))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}const hy=Symbol("brand.privateNullableHeaders");function*oP(n){if(!n)return;if(hy in n){const{values:s,nulls:i}=n;yield*s.entries();for(const r of i)yield[r,null];return}let e=!1,t;n instanceof Headers?t=n.entries():bh(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let s of t){const i=s[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const r=bh(s[1])?s[1]:[s[1]];let o=!1;for(const l of r)l!==void 0&&(e&&!o&&(o=!0,yield[i,null]),yield[i,l])}}const cr=n=>{const e=new Headers,t=new Set;for(const s of n){const i=new Set;for(const[r,o]of oP(s)){const l=r.toLowerCase();i.has(l)||(e.delete(r),i.add(l)),o===null?(e.delete(r),t.add(l)):(e.append(r,o),t.delete(l))}}return{[hy]:!0,values:e,nulls:t}};const _l=n=>{var e,t,s,i,r,o;if(typeof globalThis.process<"u")return(s=(t=(e=globalThis.process.env)===null||e===void 0?void 0:e[n])===null||t===void 0?void 0:t.trim())!==null&&s!==void 0?s:void 0;if(typeof globalThis.Deno<"u")return(o=(r=(i=globalThis.Deno.env)===null||i===void 0?void 0:i.get)===null||r===void 0?void 0:r.call(i,n))===null||o===void 0?void 0:o.trim()};var py;class Ha{constructor(e){var t,s,i,r,o,l,d,{baseURL:c=_l("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:f=(t=_l("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:p="v1beta"}=e,h=da(e,["baseURL","apiKey","apiVersion"]);const m=Object.assign(Object.assign({apiKey:f,apiVersion:p},h),{baseURL:c||"https://generativelanguage.googleapis.com"});this.baseURL=m.baseURL,this.timeout=(s=m.timeout)!==null&&s!==void 0?s:Ha.DEFAULT_TIMEOUT,this.logger=(i=m.logger)!==null&&i!==void 0?i:console;const g="warn";this.logLevel=g,this.logLevel=(o=(r=Mh(m.logLevel,"ClientOptions.logLevel",this))!==null&&r!==void 0?r:Mh(_l("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&o!==void 0?o:g,this.fetchOptions=m.fetchOptions,this.maxRetries=(l=m.maxRetries)!==null&&l!==void 0?l:2,this.fetch=(d=m.fetch)!==null&&d!==void 0?d:BR(),this.encoder=HR,this._options=m,this.apiKey=f,this.apiVersion=p,this.clientAdapter=m.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const t=cr([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return cr([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return cr([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,s])=>typeof s<"u").map(([t,s])=>{if(typeof s=="string"||typeof s=="number"||typeof s=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(s)}`;if(s===null)return`${encodeURIComponent(t)}=`;throw new qt(`Cannot stringify type ${typeof s}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${di}`}defaultIdempotencyKey(){return`stainless-node-retry-${bR()}`}makeStatusError(e,t,s,i){return it.generate(e,t,s,i)}buildURL(e,t,s){const i=!this.baseURLOverridden()&&s||this.baseURL,r=RR(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),o=this.defaultQuery();return MR(o)||(t=Object.assign(Object.assign({},o),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(i=>Object.assign({method:e,path:t},i)))}request(e,t=null){return new xc(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){var i,r,o;const l=await e,d=(i=l.maxRetries)!==null&&i!==void 0?i:this.maxRetries;t==null&&(t=d),await this.prepareOptions(l);const{req:c,url:f,timeout:p}=await this.buildRequest(l,{retryCount:d-t});await this.prepareRequest(c,{url:f,options:l});const h="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),m=s===void 0?"":`, retryOf: ${s}`,g=Date.now();if(nt(this).debug(`[${h}] sending request`,Cs({retryOfRequestLogID:s,method:l.method,url:f,options:l,headers:c.headers})),!((r=l.signal)===null||r===void 0)&&r.aborted)throw new hu;const v=new AbortController,_=await this.fetchWithTimeout(f,c,p,v).catch(fu),w=Date.now();if(_ instanceof globalThis.Error){const S=`retrying, ${t} attempts remaining`;if(!((o=l.signal)===null||o===void 0)&&o.aborted)throw new hu;const T=du(_)||/timed? ?out/i.test(String(_)+("cause"in _?String(_.cause):""));if(t)return nt(this).info(`[${h}] connection ${T?"timed out":"failed"} - ${S}`),nt(this).debug(`[${h}] connection ${T?"timed out":"failed"} (${S})`,Cs({retryOfRequestLogID:s,url:f,durationMs:w-g,message:_.message})),this.retryRequest(l,t,s??h);throw nt(this).info(`[${h}] connection ${T?"timed out":"failed"} - error; no more retries left`),nt(this).debug(`[${h}] connection ${T?"timed out":"failed"} (error; no more retries left)`,Cs({retryOfRequestLogID:s,url:f,durationMs:w-g,message:_.message})),T?new Xg:new Ga({cause:_})}const E=`[${h}${m}] ${c.method} ${f} ${_.ok?"succeeded":"failed"} with status ${_.status} in ${w-g}ms`;if(!_.ok){const S=await this.shouldRetry(_);if(t&&S){const I=`retrying, ${t} attempts remaining`;return await VR(_.body),nt(this).info(`${E} - ${I}`),nt(this).debug(`[${h}] response error (${I})`,Cs({retryOfRequestLogID:s,url:_.url,status:_.status,headers:_.headers,durationMs:w-g})),this.retryRequest(l,t,s??h,_.headers)}const T=S?"error; no more retries left":"error; not retryable";nt(this).info(`${E} - ${T}`);const R=await _.text().catch(I=>fu(I).message),M=DR(R),x=M?void 0:R;throw nt(this).debug(`[${h}] response error (${T})`,Cs({retryOfRequestLogID:s,url:_.url,status:_.status,headers:_.headers,message:x,durationMs:Date.now()-g})),this.makeStatusError(_.status,M,x,_.headers)}return nt(this).info(E),nt(this).debug(`[${h}] response start`,Cs({retryOfRequestLogID:s,url:_.url,status:_.status,headers:_.headers,durationMs:w-g})),{response:_,options:l,controller:v,requestLogID:h,retryOfRequestLogID:s,startTime:g}}async fetchWithTimeout(e,t,s,i){const r=t||{},{signal:o,method:l}=r,d=da(r,["signal","method"]);o&&o.addEventListener("abort",()=>i.abort());const c=setTimeout(()=>i.abort(),s),f=globalThis.ReadableStream&&d.body instanceof globalThis.ReadableStream||typeof d.body=="object"&&d.body!==null&&Symbol.asyncIterator in d.body,p=Object.assign(Object.assign(Object.assign({signal:i.signal},f?{duplex:"half"}:{}),{method:"GET"}),d);l&&(p.method=l.toUpperCase());try{return await this.fetch.call(void 0,e,p)}finally{clearTimeout(c)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s,i){var r;let o;const l=i?.get("retry-after-ms");if(l){const c=parseFloat(l);Number.isNaN(c)||(o=c)}const d=i?.get("retry-after");if(d&&!o){const c=parseFloat(d);Number.isNaN(c)?o=Date.parse(d)-Date.now():o=c*1e3}if(!(o&&0<=o&&o<60*1e3)){const c=(r=e.maxRetries)!==null&&r!==void 0?r:this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,c)}return await LR(o),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){const r=t-e,o=Math.min(.5*Math.pow(2,r),8),l=1-Math.random()*.25;return o*l*1e3}async buildRequest(e,{retryCount:t=0}={}){var s,i,r;const o=Object.assign({},e),{method:l,path:d,query:c,defaultBaseURL:f}=o,p=this.buildURL(d,c,f);"timeout"in o&&NR("timeout",o.timeout),o.timeout=(s=o.timeout)!==null&&s!==void 0?s:this.timeout;const{bodyHeaders:h,body:m}=this.buildBody({options:o}),g=await this.buildHeaders({options:e,method:l,bodyHeaders:h,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:l,headers:g},o.signal&&{signal:o.signal}),globalThis.ReadableStream&&m instanceof globalThis.ReadableStream&&{duplex:"half"}),m&&{body:m}),(i=this.fetchOptions)!==null&&i!==void 0?i:{}),(r=o.fetchOptions)!==null&&r!==void 0?r:{}),url:p,timeout:o.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:i}){let r={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);const o=await this.authHeaders(e);let l=cr([r,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),qR()),this._options.defaultHeaders,s,e.headers,o]);return this.validateHeaders(l),l.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const s=cr([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:GR(e)}:this.encoder({body:e,headers:s})}}Ha.DEFAULT_TIMEOUT=6e4;class qe extends Ha{constructor(){super(...arguments),this.interactions=new fy(this)}}py=qe;qe.GeminiNextGenAPIClient=py;qe.GeminiNextGenAPIClientError=qt;qe.APIError=it;qe.APIConnectionError=Ga;qe.APIConnectionTimeoutError=Xg;qe.APIUserAbortError=hu;qe.NotFoundError=ey;qe.ConflictError=ty;qe.RateLimitError=sy;qe.BadRequestError=Qg;qe.AuthenticationError=Zg;qe.InternalServerError=iy;qe.PermissionDeniedError=jg;qe.UnprocessableEntityError=ny;qe.toFile=KR;qe.Interactions=fy;function aP(n,e){const t={},s=a(n,["name"]);return s!=null&&u(t,["_url","name"],s),t}function lP(n,e){const t={},s=a(n,["name"]);return s!=null&&u(t,["_url","name"],s),t}function uP(n,e){const t={},s=a(n,["sdkHttpResponse"]);return s!=null&&u(t,["sdkHttpResponse"],s),t}function cP(n,e){const t={},s=a(n,["sdkHttpResponse"]);return s!=null&&u(t,["sdkHttpResponse"],s),t}function dP(n,e,t){const s={};if(a(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const i=a(n,["tunedModelDisplayName"]);if(e!==void 0&&i!=null&&u(e,["displayName"],i),a(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const r=a(n,["epochCount"]);e!==void 0&&r!=null&&u(e,["tuningTask","hyperparameters","epochCount"],r);const o=a(n,["learningRateMultiplier"]);if(o!=null&&u(s,["tuningTask","hyperparameters","learningRateMultiplier"],o),a(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(a(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(a(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const l=a(n,["batchSize"]);e!==void 0&&l!=null&&u(e,["tuningTask","hyperparameters","batchSize"],l);const d=a(n,["learningRate"]);if(e!==void 0&&d!=null&&u(e,["tuningTask","hyperparameters","learningRate"],d),a(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(a(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return s}function fP(n,e,t){const s={};let i=a(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const m=a(n,["validationDataset"]);e!==void 0&&m!=null&&u(e,["supervisedTuningSpec"],Nh(m))}else if(i==="PREFERENCE_TUNING"){const m=a(n,["validationDataset"]);e!==void 0&&m!=null&&u(e,["preferenceOptimizationSpec"],Nh(m))}const r=a(n,["tunedModelDisplayName"]);e!==void 0&&r!=null&&u(e,["tunedModelDisplayName"],r);const o=a(n,["description"]);e!==void 0&&o!=null&&u(e,["description"],o);let l=a(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const m=a(n,["epochCount"]);e!==void 0&&m!=null&&u(e,["supervisedTuningSpec","hyperParameters","epochCount"],m)}else if(l==="PREFERENCE_TUNING"){const m=a(n,["epochCount"]);e!==void 0&&m!=null&&u(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],m)}let d=a(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const m=a(n,["learningRateMultiplier"]);e!==void 0&&m!=null&&u(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],m)}else if(d==="PREFERENCE_TUNING"){const m=a(n,["learningRateMultiplier"]);e!==void 0&&m!=null&&u(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],m)}let c=a(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const m=a(n,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&u(e,["supervisedTuningSpec","exportLastCheckpointOnly"],m)}else if(c==="PREFERENCE_TUNING"){const m=a(n,["exportLastCheckpointOnly"]);e!==void 0&&m!=null&&u(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],m)}let f=a(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const m=a(n,["adapterSize"]);e!==void 0&&m!=null&&u(e,["supervisedTuningSpec","hyperParameters","adapterSize"],m)}else if(f==="PREFERENCE_TUNING"){const m=a(n,["adapterSize"]);e!==void 0&&m!=null&&u(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],m)}if(a(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(a(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=a(n,["labels"]);e!==void 0&&p!=null&&u(e,["labels"],p);const h=a(n,["beta"]);return e!==void 0&&h!=null&&u(e,["preferenceOptimizationSpec","hyperParameters","beta"],h),s}function hP(n,e){const t={},s=a(n,["baseModel"]);s!=null&&u(t,["baseModel"],s);const i=a(n,["preTunedModel"]);i!=null&&u(t,["preTunedModel"],i);const r=a(n,["trainingDataset"]);r!=null&&CP(r);const o=a(n,["config"]);return o!=null&&dP(o,t),t}function pP(n,e){const t={},s=a(n,["baseModel"]);s!=null&&u(t,["baseModel"],s);const i=a(n,["preTunedModel"]);i!=null&&u(t,["preTunedModel"],i);const r=a(n,["trainingDataset"]);r!=null&&AP(r,t,e);const o=a(n,["config"]);return o!=null&&fP(o,t,e),t}function mP(n,e){const t={},s=a(n,["name"]);return s!=null&&u(t,["_url","name"],s),t}function gP(n,e){const t={},s=a(n,["name"]);return s!=null&&u(t,["_url","name"],s),t}function yP(n,e,t){const s={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&u(e,["_query","pageSize"],i);const r=a(n,["pageToken"]);e!==void 0&&r!=null&&u(e,["_query","pageToken"],r);const o=a(n,["filter"]);return e!==void 0&&o!=null&&u(e,["_query","filter"],o),s}function _P(n,e,t){const s={},i=a(n,["pageSize"]);e!==void 0&&i!=null&&u(e,["_query","pageSize"],i);const r=a(n,["pageToken"]);e!==void 0&&r!=null&&u(e,["_query","pageToken"],r);const o=a(n,["filter"]);return e!==void 0&&o!=null&&u(e,["_query","filter"],o),s}function vP(n,e){const t={},s=a(n,["config"]);return s!=null&&yP(s,t),t}function wP(n,e){const t={},s=a(n,["config"]);return s!=null&&_P(s,t),t}function EP(n,e){const t={},s=a(n,["sdkHttpResponse"]);s!=null&&u(t,["sdkHttpResponse"],s);const i=a(n,["nextPageToken"]);i!=null&&u(t,["nextPageToken"],i);const r=a(n,["tunedModels"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>my(l))),u(t,["tuningJobs"],o)}return t}function SP(n,e){const t={},s=a(n,["sdkHttpResponse"]);s!=null&&u(t,["sdkHttpResponse"],s);const i=a(n,["nextPageToken"]);i!=null&&u(t,["nextPageToken"],i);const r=a(n,["tuningJobs"]);if(r!=null){let o=r;Array.isArray(o)&&(o=o.map(l=>gu(l))),u(t,["tuningJobs"],o)}return t}function TP(n,e){const t={},s=a(n,["name"]);s!=null&&u(t,["model"],s);const i=a(n,["name"]);return i!=null&&u(t,["endpoint"],i),t}function CP(n,e){const t={};if(a(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(a(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const s=a(n,["examples"]);if(s!=null){let i=s;Array.isArray(i)&&(i=i.map(r=>r)),u(t,["examples","examples"],i)}return t}function AP(n,e,t){const s={};let i=a(t,["config","method"]);if(i===void 0&&(i="SUPERVISED_FINE_TUNING"),i==="SUPERVISED_FINE_TUNING"){const o=a(n,["gcsUri"]);e!==void 0&&o!=null&&u(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(i==="PREFERENCE_TUNING"){const o=a(n,["gcsUri"]);e!==void 0&&o!=null&&u(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}let r=a(t,["config","method"]);if(r===void 0&&(r="SUPERVISED_FINE_TUNING"),r==="SUPERVISED_FINE_TUNING"){const o=a(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&u(e,["supervisedTuningSpec","trainingDatasetUri"],o)}else if(r==="PREFERENCE_TUNING"){const o=a(n,["vertexDatasetResource"]);e!==void 0&&o!=null&&u(e,["preferenceOptimizationSpec","trainingDatasetUri"],o)}if(a(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return s}function my(n,e){const t={},s=a(n,["sdkHttpResponse"]);s!=null&&u(t,["sdkHttpResponse"],s);const i=a(n,["name"]);i!=null&&u(t,["name"],i);const r=a(n,["state"]);r!=null&&u(t,["state"],Mg(r));const o=a(n,["createTime"]);o!=null&&u(t,["createTime"],o);const l=a(n,["tuningTask","startTime"]);l!=null&&u(t,["startTime"],l);const d=a(n,["tuningTask","completeTime"]);d!=null&&u(t,["endTime"],d);const c=a(n,["updateTime"]);c!=null&&u(t,["updateTime"],c);const f=a(n,["description"]);f!=null&&u(t,["description"],f);const p=a(n,["baseModel"]);p!=null&&u(t,["baseModel"],p);const h=a(n,["_self"]);return h!=null&&u(t,["tunedModel"],TP(h)),t}function gu(n,e){const t={},s=a(n,["sdkHttpResponse"]);s!=null&&u(t,["sdkHttpResponse"],s);const i=a(n,["name"]);i!=null&&u(t,["name"],i);const r=a(n,["state"]);r!=null&&u(t,["state"],Mg(r));const o=a(n,["createTime"]);o!=null&&u(t,["createTime"],o);const l=a(n,["startTime"]);l!=null&&u(t,["startTime"],l);const d=a(n,["endTime"]);d!=null&&u(t,["endTime"],d);const c=a(n,["updateTime"]);c!=null&&u(t,["updateTime"],c);const f=a(n,["error"]);f!=null&&u(t,["error"],f);const p=a(n,["description"]);p!=null&&u(t,["description"],p);const h=a(n,["baseModel"]);h!=null&&u(t,["baseModel"],h);const m=a(n,["tunedModel"]);m!=null&&u(t,["tunedModel"],m);const g=a(n,["preTunedModel"]);g!=null&&u(t,["preTunedModel"],g);const v=a(n,["supervisedTuningSpec"]);v!=null&&u(t,["supervisedTuningSpec"],v);const _=a(n,["preferenceOptimizationSpec"]);_!=null&&u(t,["preferenceOptimizationSpec"],_);const w=a(n,["tuningDataStats"]);w!=null&&u(t,["tuningDataStats"],w);const E=a(n,["encryptionSpec"]);E!=null&&u(t,["encryptionSpec"],E);const S=a(n,["partnerModelTuningSpec"]);S!=null&&u(t,["partnerModelTuningSpec"],S);const T=a(n,["customBaseModel"]);T!=null&&u(t,["customBaseModel"],T);const R=a(n,["experiment"]);R!=null&&u(t,["experiment"],R);const M=a(n,["labels"]);M!=null&&u(t,["labels"],M);const x=a(n,["outputUri"]);x!=null&&u(t,["outputUri"],x);const k=a(n,["pipelineJob"]);k!=null&&u(t,["pipelineJob"],k);const I=a(n,["serviceAccount"]);I!=null&&u(t,["serviceAccount"],I);const N=a(n,["tunedModelDisplayName"]);N!=null&&u(t,["tunedModelDisplayName"],N);const F=a(n,["veoTuningSpec"]);return F!=null&&u(t,["veoTuningSpec"],F),t}function bP(n,e){const t={},s=a(n,["sdkHttpResponse"]);s!=null&&u(t,["sdkHttpResponse"],s);const i=a(n,["name"]);i!=null&&u(t,["name"],i);const r=a(n,["metadata"]);r!=null&&u(t,["metadata"],r);const o=a(n,["done"]);o!=null&&u(t,["done"],o);const l=a(n,["error"]);return l!=null&&u(t,["error"],l),t}function Nh(n,e){const t={},s=a(n,["gcsUri"]);s!=null&&u(t,["validationDatasetUri"],s);const i=a(n,["vertexDatasetResource"]);return i!=null&&u(t,["validationDatasetUri"],i),t}class IP extends Gn{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Os(Fn.PAGED_ITEM_TUNING_JOBS,s=>this.listInternal(s),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var s;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const i={tunedModelName:t.baseModel};!((s=t.config)===null||s===void 0)&&s.preTunedModelCheckpointId&&(i.checkpointId=t.config.preTunedModelCheckpointId);const r=Object.assign(Object.assign({},t),{preTunedModel:i});return r.baseModel=void 0,await this.tuneInternal(r)}else{const i=Object.assign({},t);return await this.tuneInternal(i)}else{const i=Object.assign({},t),r=await this.tuneMldevInternal(i);let o="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?o=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(o=r.name.split("/operations/")[0]),{name:o,state:iu.JOB_STATE_QUEUED}}}}async getInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=gP(e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>gu(f))}else{const c=mP(e);return l=L("{name}",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>my(f))}}async listInternal(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=wP(e);return l=L("tuningJobs",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=SP(f),h=new rh;return Object.assign(h,p),h})}else{const c=vP(e);return l=L("tunedModels",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=EP(f),h=new rh;return Object.assign(h,p),h})}}async cancel(e){var t,s,i,r;let o,l="",d={};if(this.apiClient.isVertexAI()){const c=lP(e);return l=L("{name}:cancel",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=cP(f),h=new oh;return Object.assign(h,p),h})}else{const c=aP(e);return l=L("{name}:cancel",c._url),d=c._query,delete c._url,delete c._query,o=this.apiClient.request({path:l,queryParams:d,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(f=>f.json().then(p=>{const h=p;return h.sdkHttpResponse={headers:f.headers},h})),o.then(f=>{const p=uP(f),h=new oh;return Object.assign(h,p),h})}}async tuneInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI()){const l=pP(e,e);return r=L("tuningJobs",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>gu(d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,s;let i,r="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=hP(e);return r=L("tunedModels",l._url),o=l._query,delete l._url,delete l._query,i=this.apiClient.request({path:r,queryParams:o,body:JSON.stringify(l),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(s=e.config)===null||s===void 0?void 0:s.abortSignal}).then(d=>d.json().then(c=>{const f=c;return f.sdkHttpResponse={headers:d.headers},f})),i.then(d=>bP(d))}}}class RP{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const PP=1024*1024*8,xP=3,MP=1e3,kP=2,ha="x-goog-upload-status";async function NP(n,e,t){var s;const i=await gy(n,e,t),r=await i?.json();if(((s=i?.headers)===null||s===void 0?void 0:s[ha])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return r.file}async function DP(n,e,t){var s;const i=await gy(n,e,t),r=await i?.json();if(((s=i?.headers)===null||s===void 0?void 0:s[ha])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const o=Ag(r),l=new Tc;return Object.assign(l,o),l}async function gy(n,e,t){var s,i;let r=0,o=0,l=new ru(new Response),d="upload";for(r=n.size;o<r;){const c=Math.min(PP,r-o),f=n.slice(o,o+c);o+c>=r&&(d+=", finalize");let p=0,h=MP;for(;p<xP&&(l=await t.request({path:"",body:f,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(o),"Content-Length":String(c)}}}),!(!((s=l?.headers)===null||s===void 0)&&s[ha]));)p++,await UP(h),h=h*kP;if(o+=c,((i=l?.headers)===null||i===void 0?void 0:i[ha])!=="active")break;if(r<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return l}async function LP(n){return{size:n.size,type:n.type}}function UP(n){return new Promise(e=>setTimeout(e,n))}class FP{async upload(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await NP(e,t,s)}async uploadToFileSearchStore(e,t,s){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await DP(e,t,s)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await LP(e)}}class $P{create(e,t,s){return new qP(e,t,s)}}class qP{constructor(e,t,s){this.url=e,this.headers=t,this.callbacks=s}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}const Dh="x-goog-api-key";class BP{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(Dh)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(Dh,this.apiKey)}}}const GP="gl-node/";class VP{get interactions(){if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const e=this.httpOptions;e?.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const t=new qe({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:e?.timeout});return this._interactions=t.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const s=UT(e.httpOptions,e.vertexai,void 0,void 0);s&&(e.httpOptions?e.httpOptions.baseUrl=s:e.httpOptions={baseUrl:s}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const i=new BP(this.apiKey);this.apiClient=new LI({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:GP+"web",uploader:new FP,downloader:new RP}),this.models=new eR(this.apiClient),this.live=new KI(this.apiClient,i,new $P),this.batches=new d0(this.apiClient),this.chats=new W0(this.models,this.apiClient),this.caches=new H0(this.apiClient),this.files=new nA(this.apiClient),this.operations=new tR(this.apiClient),this.authTokens=new yR(this.apiClient),this.tunings=new IP(this.apiClient),this.fileSearchStores=new AR(this.apiClient)}}const ye=class ye extends bt{constructor(e){super(e);const t=e.baseUrl?ye.normalizeBaseUrl(e.baseUrl):void 0;this.client=new VP({apiKey:e.apiKey??"",httpOptions:t?{baseUrl:t}:void 0}),this.apiKey=e.apiKey??""}async generateResponse(e,t,s){if(e.providerType!=="gemini")throw new Error("Model is not a Gemini model");if(!this.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);const i=t.messages.filter(o=>o.role==="system"),r=i.length>0?i.map(o=>o.content).join(`
`):void 0;try{const o={maxOutputTokens:t.max_tokens??void 0,temperature:t.temperature??void 0};if(e.thinking?.enabled){const g=e.thinking.thinking_budget;o.thinkingConfig={thinkingBudget:g,includeThoughts:!0}}const l=this.prepareTools(t,e,s),d=t.messages.map(g=>ye.parseRequestMessage(g)).filter(g=>ye.isGeminiContent(g)),c=(l?.length??0)>0||Object.values(o).some(g=>g!==void 0),f={model:t.model,contents:d,...c?{config:{...o,...l?{tools:l}:{}}}:{},...r?{systemInstruction:r}:{}},p=this.applyCustomModelParameters(e,f),h=await this.client.models.generateContent(p),m=crypto.randomUUID();return ye.parseNonStreamingResponse(h,t.model,m)}catch(o){const l=ye.getErrorMessage(o);throw l?.includes("API_KEY_INVALID")||l?.includes("API key not valid")?new Nn(`Provider ${this.provider.id} API key is invalid. Please update it in settings menu.`,ye.toError(o)):ye.toError(o)}}async streamResponse(e,t,s){if(e.providerType!=="gemini")throw new Error("Model is not a Gemini model");if(!this.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);const i=t.messages.filter(o=>o.role==="system"),r=i.length>0?i.map(o=>o.content).join(`
`):void 0;try{const o={maxOutputTokens:t.max_tokens??void 0,temperature:t.temperature??void 0};if(e.thinking?.enabled){const g=e.thinking.thinking_budget;o.thinkingConfig={thinkingBudget:g,includeThoughts:!0}}const l=this.prepareTools(t,e,s),d=t.messages.map(g=>ye.parseRequestMessage(g)).filter(g=>ye.isGeminiContent(g)),c=(l?.length??0)>0||Object.values(o).some(g=>g!==void 0),f={model:t.model,contents:d,...c?{config:{...o,...l?{tools:l}:{}}}:{},...r?{systemInstruction:r}:{}},p=this.applyCustomModelParameters(e,f),h=await this.client.models.generateContentStream(p),m=crypto.randomUUID();return this.streamResponseGenerator(h,t.model,m)}catch(o){const l=ye.getErrorMessage(o);if(l?.includes("API_KEY_INVALID")||l?.includes("API key not valid"))throw new Nn("Gemini API key is invalid. Please update it in settings menu.",ye.toError(o));if(l?/protocol error|unexpected EOF/i.test(l):!1){const f=await this.generateResponse(e,ye.toNonStreamingRequest(t),s);return async function*(h){const m={id:h.id,created:h.created,model:h.model,object:"chat.completion.chunk",choices:[{finish_reason:h.choices[0]?.finish_reason??null,delta:{content:h.choices[0]?.message?.content??"",reasoning:h.choices[0]?.message?.reasoning??void 0,tool_calls:void 0}}],usage:h.usage};await Promise.resolve(),yield m}(f)}throw ye.toError(o)}}async*streamResponseGenerator(e,t,s){for await(const i of e)yield ye.parseStreamingResponseChunk(i,t,s)}static parseRequestMessage(e){switch(e.role){case"system":return null;case"user":return{role:"user",parts:Array.isArray(e.content)?e.content.flatMap(s=>{if(s.type==="text")return[{text:s.text}];if(s.type==="image_url"){const{mimeType:i,base64Data:r}=rm(s.image_url.url);return ye.validateImageType(i),[{inlineData:{data:r,mimeType:i}}]}return[]}):[{text:e.content}]};case"assistant":{const t=[];if(typeof e.content=="string"&&e.content!==""&&t.push({text:e.content}),e.tool_calls)for(const s of e.tool_calls){const i=ye.safeParseJsonObject(s.arguments??"{}");t.push({functionCall:{name:s.name,args:i}})}return t.length===0?null:{role:"model",parts:t}}case"tool":return{role:"user",parts:[{functionResponse:{name:e.tool_call.name,response:{result:e.content}}}]}}}static parseNonStreamingResponse(e,t,s){const r=(e.candidates?.[0]?.content?.parts??[]).filter(c=>!!c?.thought&&typeof c?.text=="string").map(c=>c.text),o=r.length>0?r.join(""):void 0,l=e.functionCalls?.map(c=>ye.mapFunctionCall(c)).filter(c=>c!==null),d=l&&l.length>0?l:void 0;return{id:s,choices:[{finish_reason:e.candidates?.[0]?.finishReason??null,message:{content:e.text??"",reasoning:o??null,role:"assistant",tool_calls:d}}],created:Date.now(),model:t,object:"chat.completion",usage:e.usageMetadata?{prompt_tokens:e.usageMetadata.promptTokenCount??0,completion_tokens:e.usageMetadata.candidatesTokenCount??0,total_tokens:e.usageMetadata.totalTokenCount??0}:void 0}}static isGeminiContent(e){return e!==null}static safeParseJsonObject(e){try{const t=JSON.parse(e);if(t&&typeof t=="object")return t}catch{}return{}}static mapFunctionCall(e){if(!e?.name)return null;const t=e.args&&typeof e.args=="object"?e.args:{};return{id:e.id??crypto.randomUUID(),type:"function",function:{name:e.name,arguments:JSON.stringify(t)}}}static mapFunctionCallDelta(e,t){const s=this.mapFunctionCall(e);return s?{index:t,id:s.id,type:s.type,function:s.function}:null}static getErrorMessage(e){return typeof e=="string"?e:typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"?e.message:null}static toError(e){if(e instanceof Error)return e;const t=ye.getErrorMessage(e)??"Unexpected error";return new Error(t)}static toNonStreamingRequest(e){const{stream:t,...s}=e;return{...s,stream:!1}}static parseStreamingResponseChunk(e,t,s){let i="",r="";const o=e.candidates?.[0]?.content?.parts??[];if(Array.isArray(o)&&o.length>0)for(const c of o)typeof c?.text=="string"&&(c.thought?r+=c.text:i+=c.text);const l=e.functionCalls?.map((c,f)=>ye.mapFunctionCallDelta(c,f)).filter(c=>c!==null)??[],d=l.length>0?l:void 0;return{id:s,choices:[{finish_reason:e.candidates?.[0]?.finishReason??null,delta:{content:i||e.text||"",reasoning:r||void 0,tool_calls:d}}],created:Date.now(),model:t,object:"chat.completion.chunk",usage:e.usageMetadata?{prompt_tokens:e.usageMetadata.promptTokenCount??0,completion_tokens:e.usageMetadata.candidatesTokenCount??0,total_tokens:e.usageMetadata.totalTokenCount??0}:void 0}}static validateImageType(e){if(!ye.SUPPORTED_IMAGE_TYPES.includes(e))throw new Error(`Gemini does not support image type ${e}. Supported types: ${ye.SUPPORTED_IMAGE_TYPES.join(", ")}`)}prepareTools(e,t,s){const i=[];if(t.providerType==="gemini"&&s?.geminiTools){const r=s.geminiTools;r.useWebSearch&&i.push({googleSearch:{}}),r.useUrlContext&&i.push({urlContext:{}})}return e.tools&&e.tools.length>0&&i.push(...e.tools.map(r=>ye.parseRequestTool(r))),i.length>0?i:void 0}static removeAdditionalProperties(e){if(typeof e!="object"||e===null)return e;if(Array.isArray(e))return e.map(s=>this.removeAdditionalProperties(s));const t={...e};return delete t.additionalProperties,Object.fromEntries(Object.entries(t).map(([s,i])=>[s,this.removeAdditionalProperties(i)]))}static parseRequestTool(e){const t=this.removeAdditionalProperties(e.function.parameters);return{functionDeclarations:[{name:e.function.name,description:e.function.description,parametersJsonSchema:t}]}}static normalizeBaseUrl(e){const t=e.replace(/\/+$/,"");try{const s=new URL(t);return s.pathname=s.pathname.replace(/\/?(v1beta|v1alpha1|v1)(\/)?$/,""),s.toString().replace(/\/+$/,"")}catch{return t.replace(/\/?(v1beta|v1alpha1|v1)(\/)?$/,"")}}};ye.SUPPORTED_IMAGE_TYPES=["image/png","image/jpeg","image/webp","image/heic","image/heif"];let yu=ye;class HP extends bt{constructor(e){super(e),this.adapter=new nn,this.client=new H({apiKey:e.apiKey??"",baseURL:e.baseUrl?e.baseUrl?.replace(/\/+$/,""):"https://api.groq.com/openai/v1",dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="groq")throw new Error("Model is not a Groq model");const i=this.applyCustomModelParameters(e,t);return this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="groq")throw new Error("Model is not a Groq model");const i=this.applyCustomModelParameters(e,t);return this.adapter.streamResponse(this.client,i,s)}}class OP extends bt{constructor(e){super(e),this.adapter=new nn,this.client=new H({apiKey:e.apiKey??"",baseURL:`${e.baseUrl?e.baseUrl.replace(/\/+$/,""):"http://127.0.0.1:1234"}/v1`,dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="lm-studio")throw new Error("Model is not an LM Studio model");const i=this.applyCustomModelParameters(e,t);return this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="lm-studio")throw new Error("Model is not an LM Studio model");const i=this.applyCustomModelParameters(e,t);return this.adapter.streamResponse(this.client,i,s)}}class JP extends nn{buildChatCompletionCreateParams({request:e,stream:t}){return{model:e.model,tools:e.tools,tool_choice:e.tool_choice,reasoning_effort:e.reasoning_effort,web_search_options:e.web_search_options,messages:e.messages.map(s=>this.parseRequestMessage(s)),max_tokens:e.max_tokens,temperature:e.temperature,top_p:e.top_p,frequency_penalty:e.frequency_penalty,presence_penalty:e.presence_penalty,logit_bias:e.logit_bias,prediction:e.prediction,...t&&{stream:!0}}}}const WP=n=>{if(!n)return n;const e=t=>!t.toLowerCase().startsWith("x-stainless");if(n instanceof Headers){const t=new Headers;return n.forEach((s,i)=>{e(i)&&t.append(i,s)}),t}return Array.isArray(n)?n.filter(([t])=>e(t)):Object.fromEntries(Object.entries(n).filter(([t])=>e(t)))};class Zr extends H{buildRequest(e,{retryCount:t=0}={}){const s=super.buildRequest(e,{retryCount:t});if(s.req.headers=WP(s.req.headers),s.req.body&&typeof s.req.body=="string")try{const i=JSON.parse(s.req.body);if(i&&typeof i=="object"&&"tools"in i&&Array.isArray(i.tools)){const r=i;(r.tools??[]).some(l=>typeof l=="object"&&l!==null&&("googleSearch"in l||"urlContext"in l))&&(s.req.body=JSON.stringify(r))}}catch(i){console.debug("[Vibe Kanban] Failed to inspect request body while stripping Stainless headers.",i)}return s}}class zP extends bt{constructor(e){super(e),this.adapter=new JP,this.client=new Zr({apiKey:e.apiKey??"",baseURL:e.baseUrl?e.baseUrl.replace(/\/+$/,""):"https://api.mistral.ai/v1",dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="mistral")throw new Error("Model is not a Mistral model");const i=this.applyCustomModelParameters(e,t);return this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="mistral")throw new Error("Model is not a Mistral model");const i=this.applyCustomModelParameters(e,t);return this.adapter.streamResponse(this.client,i,s)}}class KP extends bt{constructor(e){super(e),this.adapter=new nn,this.client=new Zr({baseURL:`${e.baseUrl?e.baseUrl.replace(/\/+$/,""):"https://api.morphllm.com"}/v1`,apiKey:e.apiKey??"",dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="morph")throw new Error("Model is not an morph model");let i={...t,prediction:void 0};return i=this.applyCustomModelParameters(e,i),this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="morph")throw new Error("Model is not an morph model");let i={...t,prediction:void 0};return i=this.applyCustomModelParameters(e,i),this.adapter.streamResponse(this.client,i,s)}}class YP extends bt{constructor(e){super(e),this.adapter=new nn,this.client=new Zr({baseURL:`${e.baseUrl?e.baseUrl.replace(/\/+$/,""):"http://127.0.0.1:11434"}/v1`,apiKey:e.apiKey??"",dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="ollama")throw new Error("Model is not an Ollama model");const i=this.applyCustomModelParameters(e,t);return this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="ollama")throw new Error("Model is not an Ollama model");const i=this.applyCustomModelParameters(e,t);return this.adapter.streamResponse(this.client,i,s)}}class XP extends bt{constructor(e){super(e),this.client=new H({apiKey:e.apiKey??"",baseURL:e.baseUrl?e.baseUrl.replace(/\/+$/,""):void 0,dangerouslyAllowBrowser:!0}),this.adapter=new nn}async generateResponse(e,t,s){if(e.providerType!=="openai")throw new Error("Model is not an OpenAI model");if(!this.client.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);try{let i={...t,reasoning_effort:e.reasoning?.enabled?e.reasoning.reasoning_effort:void 0};i=this.applyCustomModelParameters(e,i);const r=await this.adapter.generateResponse(this.client,i,s);if(!r.choices||r.choices.length===0)throw console.error("No response choices available"),new Error("No response choices available");const o=r.choices[0];if(!o.message||o.message.content===null||o.message.content===void 0)throw console.error("No content in the first response choice"),new Error("No content in the first response choice");return r}catch(i){throw console.error("Error in generateResponse:",i),i instanceof H.AuthenticationError?new Nn("OpenAI API key is invalid. Please update it in settings menu.",i):i}}async streamResponse(e,t,s){if(e.providerType!=="openai")throw new Error("Model is not an OpenAI model");if(!this.client.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);try{let i={...t,reasoning_effort:e.reasoning?.enabled?e.reasoning.reasoning_effort:void 0};return i=this.applyCustomModelParameters(e,i),await this.adapter.streamResponse(this.client,i,s)}catch(i){throw console.error("Error in streamResponse:",i),i instanceof H.AuthenticationError?new Nn("OpenAI API key is invalid. Please update it in settings menu.",i):i}}}class QP extends bt{constructor(e){super(e),this.adapter=new nn,this.client=new(e.additionalSettings?.noStainless?Zr:H)({apiKey:e.apiKey??"",baseURL:e.baseUrl?e.baseUrl?.replace(/\/+$/,""):"",dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="openai-compatible")throw new Error("Model is not an OpenAI Compatible model");if(!this.provider.baseUrl)throw new Nl(`Provider ${this.provider.id} base URL is missing. Please set it in settings menu.`);let i={...t,messages:Pi(t.messages)};const r=s?.geminiTools;if(e.toolType==="gemini"&&r){const o=[];r.useWebSearch&&o.push({type:"function",function:{name:"googleSearch",description:"Search the web using Google Search",parameters:{type:"object",properties:{query:{type:"string",description:"The search query"}}}}}),r.useUrlContext&&o.push({type:"function",function:{name:"urlContext",description:"Get context from a URL",parameters:{type:"object",properties:{url:{type:"string",description:"The URL to get context from"}}}}}),o.length>0&&(i.tools=o)}else e.toolType==="gemini"&&delete i.tools;if(e.thinking?.enabled){const o=e.thinking.thinking_budget;i.thinking_config={thinking_budget:o,include_thoughts:!0},i.thinkingConfig={thinkingBudget:o,includeThoughts:!0}}if(e.reasoning?.enabled){const o=e.reasoning.reasoning_effort;o&&(i.reasoning_effort=o,i.reasoning={effort:o})}return i=this.applyCustomModelParameters(e,i),this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="openai-compatible")throw new Error("Model is not an OpenAI Compatible model");if(!this.provider.baseUrl)throw new Nl(`Provider ${this.provider.id} base URL is missing. Please set it in settings menu.`);let i={...t,messages:Pi(t.messages)};const r=s?.geminiTools;if(e.toolType==="gemini"&&r){const o=[];r.useWebSearch&&o.push({type:"function",function:{name:"googleSearch",description:"Search the web using Google Search",parameters:{type:"object",properties:{query:{type:"string",description:"The search query"}}}}}),r.useUrlContext&&o.push({type:"function",function:{name:"urlContext",description:"Get context from a URL",parameters:{type:"object",properties:{url:{type:"string",description:"The URL to get context from"}}}}}),o.length>0&&(i.tools=o)}if(e.toolType==="gemini"&&!s?.geminiTools&&delete i.tools,e.thinking?.enabled){const o=e.thinking.thinking_budget;i.thinking_config={thinking_budget:o,include_thoughts:!0},i.thinkingConfig={thinkingBudget:o,includeThoughts:!0}}if(e.reasoning?.enabled){const o=e.reasoning.reasoning_effort;o&&(i.reasoning_effort=o,i.reasoning={effort:o})}return i=this.applyCustomModelParameters(e,i),this.adapter.streamResponse(this.client,i,s)}}class ZP extends bt{constructor(e){super(e),this.adapter=new nn,this.client=new H({apiKey:e.apiKey??"",baseURL:e.baseUrl?e.baseUrl?.replace(/\/+$/,""):"https://openrouter.ai/api/v1",dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="openrouter")throw new Error("Model is not an OpenRouter model");const i=this.applyCustomModelParameters(e,t);return this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="openrouter")throw new Error("Model is not an OpenRouter model");const i=this.applyCustomModelParameters(e,t);return this.adapter.streamResponse(this.client,i,s)}}class jP extends nn{parseNonStreamingResponse(e){const t=e.citations?.map(s=>({type:"url_citation",url_citation:{url:s}}));return{id:e.id,choices:e.choices.map(s=>({finish_reason:s.finish_reason,message:{content:s.message.content,role:s.message.role,annotations:t,tool_calls:s.message.tool_calls}})),created:e.created,model:e.model,object:"chat.completion",system_fingerprint:e.system_fingerprint,usage:e.usage}}parseStreamingResponseChunk(e){const t=e.citations?.map(s=>({type:"url_citation",url_citation:{url:s}}));return{id:e.id,choices:e.choices.map(s=>({finish_reason:s.finish_reason??null,delta:{content:s.delta.content??null,role:s.delta.role,annotations:t,tool_calls:s.delta.tool_calls}})),created:e.created,model:e.model,object:"chat.completion.chunk",system_fingerprint:e.system_fingerprint,usage:e.usage??void 0}}}class ex extends bt{constructor(e){super(e),this.adapter=new jP,this.client=new Zr({apiKey:e.apiKey??"",baseURL:e.baseUrl?e.baseUrl.replace(/\/+$/,""):"https://api.perplexity.ai",dangerouslyAllowBrowser:!0})}async generateResponse(e,t,s){if(e.providerType!=="perplexity")throw new Error("Model is not a Perplexity model");if(!this.client.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);let i={...t,messages:Pi(t.messages),web_search_options:e.web_search_options};return i=this.applyCustomModelParameters(e,i),this.adapter.generateResponse(this.client,i,s)}async streamResponse(e,t,s){if(e.providerType!=="perplexity")throw new Error("Model is not a Perplexity model");if(!this.client.apiKey)throw new en(`Provider ${this.provider.id} API key is missing. Please set it in settings menu.`);let i={...t,messages:Pi(t.messages),web_search_options:e.web_search_options};return i=this.applyCustomModelParameters(e,i),this.adapter.streamResponse(this.client,i,s)}}function tx({settings:n,providerId:e}){const t=n.providers.find(s=>s.id===e);if(!t)throw new kE(`Provider ${e} not found`);switch(t.type){case"openai":return new XP(t);case"anthropic":return new Vl(t);case"gemini":return new yu(t);case"groq":return new HP(t);case"openrouter":return new ZP(t);case"ollama":return new YP(t);case"lm-studio":return new OP(t);case"deepseek":return new kT(t);case"perplexity":return new ex(t);case"mistral":return new zP(t);case"morph":return new KP(t);case"azure-openai":return new PT(t);case"openai-compatible":return new QP(t)}}function Lh({settings:n,modelId:e}){const t=n.chatModels.find(i=>i.id===e);if(!t)throw new ME(`Chat model ${e} not found`);return{providerClient:tx({settings:n,providerId:t.providerId}),model:t}}function nx(n,e){const t=Math.max(e,0)*4;if(t===0)return{trimmedMessages:n,trimmed:!1};let s=0;const i=[];for(let l=n.length-1;l>=0;l-=1){const d=n[l],c=d.content.length;if(s+c>t&&i.length>0)break;i.push(d),s+=c}const r=i.reverse(),o=r.length!==n.length;return{trimmedMessages:r,trimmed:o}}class sx{get plugin(){return wn.getPlugin()}async testModel(e){try{const{providerClient:t,model:s}=Lh({settings:this.plugin.settings,modelId:e});return await t.generateResponse(s,{model:s.model,messages:[{role:"user",content:"test"}],max_tokens:10,stream:!1}),{success:!0,message:"Ê®°ÂûãËøûÊé•ÊàêÂäü"}}catch(t){return{success:!1,message:`Ê®°ÂûãËøûÊé•Â§±Ë¥•Ôºö${this.formatError(t)}`}}}async testProvider(e){if(!this.plugin.settings.providers.find(i=>i.id===e))return{success:!1,message:`‰æõÂ∫îÂïÜ ${e} ‰∏çÂ≠òÂú®`};const s=this.plugin.settings.chatModels.find(i=>i.providerId===e);return s?this.testModel(s.id):{success:!1,message:`‰æõÂ∫îÂïÜ ${e} Ê≤°ÊúâÈÖçÁΩÆÊ®°Âûã`}}async requestChat(e){const t=e.modelId??this.plugin.settings.defaultChatModelId,s=this.getChatModel(t);if(!s)return this.notify("Êú™ÊâæÂà∞ÂèØÁî®Ê®°ÂûãÔºåËØ∑Âú®ËÆæÁΩÆ‰∏≠ÈÖçÁΩÆÈªòËÆ§ÊñáÊú¨Ê®°Âûã"),"";if(e.messages.length===0)return this.notify("Ê≤°ÊúâÂèØÂèëÈÄÅÁöÑÊ∂àÊÅØ"),"";try{const{providerClient:i,model:r}=Lh({settings:this.plugin.settings,modelId:s.id}),o=128e3,{trimmedMessages:l,trimmed:d}=nx(e.messages,o);d&&this.plugin.settings.warnOnContextTrim&&this.notify("‰∏ä‰∏ãÊñáËøáÈïøÔºåÂ∑≤Êà™Êñ≠ËæÉÊó©ÁöÑÊ∂àÊÅØ");const c=l.map(f=>({role:f.role,content:f.content}));return e.stream?await this.handleStreamingRequest(i,r,c,e):await this.handleNonStreamingRequest(i,r,c,e)}catch(i){throw this.handleError(i,t),i}}async handleNonStreamingRequest(e,t,s,i){const r=await e.generateResponse(t,{model:t.model,messages:s,max_tokens:i.maxTokens,stream:!1}),o=r.choices[0]?.message?.content??"",l=r.choices[0]?.message?.reasoning??"";return l&&i.onToken&&(i.onToken(l,"",!1),i.onToken("",o,!0)),this.plugin.debugLogger.log(`chat:${t.id} success len=${o.length}`),o}async handleStreamingRequest(e,t,s,i){const r=await e.streamResponse(t,{model:t.model,messages:s,max_tokens:i.maxTokens,stream:!0});let o="",l=!1,d=!1;for await(const c of r){if(i.signal?.aborted)break;const f=c.choices[0]?.delta;if(!f)continue;const p=f.reasoning??"";p&&(l=!0,i.onToken?.(p,"",!1));const h=f.content??"";h&&(l&&!d&&(d=!0),o+=h,i.onToken?.("",h,d))}return this.plugin.debugLogger.log(`chat:${t.id} success len=${o.length}`),o}getChatModel(e){return this.plugin.settings.chatModels.find(t=>t.id===e)??null}getProvider(e){return this.plugin.settings.providers.find(t=>t.id===e)??null}handleError(e,t){let s;e instanceof en?s="API ÂØÜÈí•Êú™ËÆæÁΩÆÔºåËØ∑Âú®ËÆæÁΩÆ‰∏≠ÈÖçÁΩÆ":e instanceof Nn?s="API ÂØÜÈí•Êó†ÊïàÔºåËØ∑Ê£ÄÊü•ËÆæÁΩÆ":e instanceof Nl?s="API Âú∞ÂùÄÊú™ËÆæÁΩÆÔºåËØ∑Âú®ËÆæÁΩÆ‰∏≠ÈÖçÁΩÆ":s=this.formatError(e),this.notify(`AI ËØ∑Ê±ÇÂ§±Ë¥•Ôºö${s}`),this.plugin.debugLogger.error(`chat:${t} failed: ${s}`)}notify(e){new Pe.Notice(e)}formatError(e){return e instanceof Error?e.stack?`${e.message}
${e.stack}`:e.message:"Êú™Áü•ÈîôËØØ"}getAvailableChatModels(){return this.plugin.settings.chatModels.filter(e=>e.enable)}getProviders(){return this.plugin.settings.providers}getProviderModels(e){return this.plugin.settings.chatModels.filter(t=>t.providerId===e)}}function ix(n,e){const t=new Set,s=new Set;if(!n||!Array.isArray(n.edges)||!Array.isArray(n.nodes))return{nodeIds:t,edgeIds:s};const i=new Map,r=new Map;n.edges.forEach(l=>{if(l?.toNode&&l?.fromNode&&l.id){const d=i.get(l.toNode)??[];d.push(l.id),i.set(l.toNode,d),r.set(l.id,{fromNode:l.fromNode,toNode:l.toNode})}});const o=l=>{if(t.has(l))return;t.add(l);const d=i.get(l);d&&d.forEach(c=>{s.add(c);const f=r.get(c);f&&o(f.fromNode)})};return o(e),{nodeIds:t,edgeIds:s}}function rx(n,e){const t=document.styleSheets;for(let s of t)try{for(let i of s.cssRules)if(i.selectorText===`.${n}`){i.style.setProperty("--canvas-color",e);break}}catch(i){console.error(i)}}class ox{constructor(){this.highlightedNodeIds=new Set,this.highlightedEdgeIds=new Set,setTimeout(()=>{rx("cai-lineage-highlight",this.getAccentColor()??"")},1e3)}getAccentColor(){const e=getComputedStyle(document.body),t=e.getPropertyValue("--accent-h").trim(),s=e.getPropertyValue("--accent-s").trim();if(!t||!s)return e.getPropertyValue("--interactive-accent").trim()||null;const i="85%",r=document.createElement("canvas");r.width=r.height=1;const o=r.getContext("2d");o.fillStyle=`hsl(${t}, ${s}, ${i})`,o.fillRect(0,0,1,1);const[l,d,c]=o?.getImageData(0,0,1,1).data??[0,0,0];return`${l},${d},${c}`}highlightLineage(e,t){this.clearHighlight(e,t),t.nodeIds.forEach(s=>{const i=e.nodes.get(s);i&&Un(i)&&(i?.nodeEl?.classList.add("cai-lineage-highlight"),this.highlightedNodeIds.add(s))}),t.edgeIds.forEach(s=>{const i=e.edges?.get(s);if(!i)return;const r=i.from?.node;!r||!Un(r)||(i?.lineGroupEl?.classList.add("cai-lineage-highlight"),this.highlightedEdgeIds.add(s))}),e.requestFrame?.()}clearHighlight(e,t){this.highlightedNodeIds.forEach(s=>{if(t?.nodeIds?.has(s))return;const i=e?.nodes?.get(s);i&&i?.nodeEl?.classList.remove("cai-lineage-highlight"),this.highlightedNodeIds.delete(s)}),this.highlightedEdgeIds.forEach(s=>{if(t?.edgeIds?.has(s))return;const i=e?.edges?.get(s);i&&i?.lineGroupEl?.classList.remove("cai-lineage-highlight"),this.highlightedEdgeIds.delete(s)}),e?.requestFrame?.()}}function yy(n,e){const t=Object.keys(e).map(s=>ax(n,s,e[s]));return t.length===1?t[0]:function(){t.forEach(s=>s())}}function ax(n,e,t){const s=n[e],i=n.hasOwnProperty(e),r=i?s:function(){return Object.getPrototypeOf(n)[e].apply(this,arguments)};let o=t(r);return s&&Object.setPrototypeOf(o,s),Object.setPrototypeOf(l,o),n[e]=l,d;function l(...c){return o===r&&n[e]===l&&d(),o.apply(this,c)}function d(){n[e]===l&&(i?n[e]=r:delete n[e]),o!==r&&(o=r,Object.setPrototypeOf(l,s||Function))}}function lx(n,e,t){if(n.querySelectorAll(".vibe-addon").forEach(o=>o.remove()),!e)return;const s=t.filter(o=>o.showInMainMenu),i=t.filter(o=>!o.showInMainMenu);let r=!0;s.forEach(o=>{const l=_y(o,e);r&&(l.classList.add("vibe-addon-first"),r=!1),n.appendChild(l)}),i.length>0&&ux(n,i,e)}function _y(n,e){const t=document.createElement("button");return t.className="clickable-icon vibe-addon",n.isActive?.(e)&&t.classList.add("is-active"),Pe.setIcon(t,n.icon),Pe.setTooltip(t,n.tooltip,{placement:"top"}),n.dataset&&Object.entries(n.dataset).forEach(([s,i])=>{t.dataset[s]=i}),t.addEventListener("click",s=>{s.preventDefault(),s.stopPropagation(),n.onClick(e)}),t}function ux(n,e,t){const s=document.createElement("div");s.className="vibe-addon-wrapper vibe-addon",n.appendChild(s);const i=document.createElement("button");i.className="clickable-icon",Pe.setIcon(i,"more-horizontal"),Pe.setTooltip(i,"Êõ¥Â§öÊìç‰Ωú",{placement:"top"}),s.appendChild(i);const r=document.createElement("div");r.className="vibe-canvas-menu-panel",r.style.display="none",s.appendChild(r);const o=l=>{l.preventDefault(),l.stopPropagation();const d=r.style.display==="none";if(document.querySelectorAll(".vibe-canvas-menu-panel").forEach(c=>{c!==r&&(c.style.display="none")}),d){cx(r,e,t),r.style.display="flex";const c=f=>{!r.contains(f.target)&&f.target!==i&&(r.style.display="none",document.removeEventListener("click",c))};setTimeout(()=>document.addEventListener("click",c),0)}else r.style.display="none"};i.addEventListener("click",o)}function cx(n,e,t){n.replaceChildren();const s=document.createElement("div");if(s.className="vibe-canvas-action-grid",e.forEach(i=>{const r=_y(i,t);s.appendChild(r)}),s.hasChildNodes())n.appendChild(s);else{const i=document.createElement("div");i.className="vibe-canvas-empty-state",i.textContent="Êó†Êõ¥Â§öÊìç‰Ωú",n.appendChild(i)}}function dx(n,e){return yy(n.menu.constructor.prototype,{render(t){return async function(...s){const i=await t.call(this,...s);return e(this.menuEl,this.canvas),i}}})}function fx(n,e){return yy(n.constructor.prototype,{selectOnly(t){return async function(...s){await t.call(this,...s),e(s[0])}}})}function hx(n){document.querySelectorAll("button[data-role]").forEach(t=>{const s=t;s.dataset.role===n?s.classList.add("is-active"):s.classList.remove("is-active")})}const px={verticalGap:50,levelGap:100};function mx(n,e){if(!n||!Array.isArray(n.edges)||!Array.isArray(n.nodes))return null;const t=new Map;n.edges.forEach(i=>{if(i?.fromNode&&i?.toNode){const r=t.get(i.fromNode)??[],o=i.fromSide==="bottom"?"bottom":"right";r.push({toNode:i.toNode,direction:o}),t.set(i.fromNode,r)}});const s=(i,r,o)=>{if(r.has(i))return null;r.add(i);const l=t.get(i)??[],d=[];return l.forEach(({toNode:c,direction:f})=>{const p=s(c,r,f);p&&d.push(p)}),{id:i,children:d,direction:o}};return s(e,new Set)}const gx=160,yx=280;function vy(n){return{width:n?.width??yx,height:n?.height??gx}}function wy(n){return n.maxX-n.minX}function Ey(n){return n.maxY-n.minY}function pa(n,e,t,s){const i=s.get(n.id);if(i)return i;const r=e.get(n.id),{width:o,height:l}=vy(r);let d={minX:0,maxX:o,minY:0,maxY:l};if(n.children.length===0)return s.set(n.id,d),d;const c=n.children.filter(h=>h.direction!=="bottom"),f=n.children.filter(h=>h.direction==="bottom");let p=l;if(c.length>0){const h=c.map(E=>pa(E,e,t,s)),m=h.map(Ey),g=m.reduce((E,S)=>E+S,0)+t.verticalGap*(m.length-1);let _=l/2-g/2;const w=o+t.levelGap;c.forEach((E,S)=>{const T=h[S],R=w-T.minX,M=_-T.minY,x=R+T.minX,k=R+T.maxX,I=M+T.minY,N=M+T.maxY;d.minX=Math.min(d.minX,x),d.maxX=Math.max(d.maxX,k),d.minY=Math.min(d.minY,I),d.maxY=Math.max(d.maxY,N),p=Math.max(p,N),_+=m[S]+t.verticalGap})}if(f.length>0){const h=f.map(E=>pa(E,e,t,s)),m=h.map(wy),g=m.reduce((E,S)=>E+S,0)+t.verticalGap*(m.length-1),v=Math.max(l+t.levelGap,p+t.verticalGap);let w=o/2-g/2;f.forEach((E,S)=>{const T=h[S],R=w-T.minX,M=v-T.minY,x=R+T.minX,k=R+T.maxX,I=M+T.minY,N=M+T.maxY;d.minX=Math.min(d.minX,x),d.maxX=Math.max(d.maxX,k),d.minY=Math.min(d.minY,I),d.maxY=Math.max(d.maxY,N),w+=m[S]+t.verticalGap})}return s.set(n.id,d),d}function _u(n,e,t,s,i,r,o){const l=e.get(n.id),{width:d,height:c}=vy(l);if(n.children.length===0)return r.set(n.id,{x:t,y:s}),{minX:t,maxX:t+d,minY:s,maxY:s+c};const f=n.children.filter(g=>g.direction!=="bottom"),p=n.children.filter(g=>g.direction==="bottom");r.set(n.id,{x:t,y:s});let h={minX:t,maxX:t+d,minY:s,maxY:s+c},m=s+c;if(f.length>0){const g=f.map(T=>pa(T,e,i,o)),v=g.map(Ey),_=v.reduce((T,R)=>T+R,0)+i.verticalGap*(v.length-1);let E=s+c/2-_/2;const S=t+d+i.levelGap;f.forEach((T,R)=>{const M=g[R],x=S-M.minX,k=E-M.minY,I=_u(T,e,x,k,i,r,o);h.minY=Math.min(h.minY,I.minY),h.maxY=Math.max(h.maxY,I.maxY),h.maxX=Math.max(h.maxX,I.maxX),h.minX=Math.min(h.minX,I.minX),m=Math.max(m,I.maxY),E+=v[R]+i.verticalGap})}if(p.length>0){const g=p.map(T=>pa(T,e,i,o)),v=g.map(wy),_=v.reduce((T,R)=>T+R,0)+i.verticalGap*(v.length-1),w=Math.max(s+c+i.levelGap,m+i.verticalGap);let S=t+d/2-_/2;p.forEach((T,R)=>{const M=g[R],x=S-M.minX,k=w-M.minY,I=_u(T,e,x,k,i,r,o);h.minX=Math.min(h.minX,I.minX),h.maxX=Math.max(h.maxX,I.maxX),h.maxY=Math.max(h.maxY,I.maxY),h.minY=Math.min(h.minY,I.minY),S+=v[R]+i.verticalGap})}return h}function _x(n,e,t,s,i,r){_u(n,e,t,s,i,r,new Map)}function vx(n,e,t){if(!n||!e||typeof n.getData!="function")return!1;const s=n.getData();if(!s)return!1;const i={...px,...t},r=mx(s,e.id);if(!r)return!1;const o=new Map,l=new Set,d=m=>{l.add(m.id),m.children.forEach(d)};d(r),l.forEach(m=>{const g=n.nodes?.get(m);g&&o.set(m,g)}),o.has(e.id)||o.set(e.id,e);const c=new Map,f=e.x??0,p=e.y??0;_x(r,o,f,p,i,c);let h=!1;return c.forEach((m,g)=>{const v=o.get(g);if(!v)return;const _=v.x??0,w=v.y??0;if(Math.abs(_-m.x)>.1||Math.abs(w-m.y)>.1){const E=v.getData();v.setData({...E,x:m.x,y:m.y}),h=!0}}),h&&(n.requestFrame?.(),n.requestSave?.()),h}async function Cr(n,e=new Set){const t=qr();if(!n||typeof n!="string")return n;const s=/\[\[([^\]]+)\]\]/g,i=[];let r;for(;(r=s.exec(n))!==null;)i.push(r);if(i.length===0)return n;let o=n;const l=[];for(const d of i){const c=d[1],[f,p]=wx(c),h=await Ex(f);if(!h)continue;const m=h.path.toLowerCase();if(!e.has(m))try{let g=null;if(p&&(g=await Sx(h,p)),g||(g=await t.vault.cachedRead(h)),g){new Set(e).add(m);const _=Tx(h.path,p,g);l.push(_)}}catch(g){console.error(`Â±ïÂºÄÂºïÁî®Â§±Ë¥•: ${h.path}`,g)}}return l.length>0&&(o+=`

`+l.join(`

`)),o}function wx(n){const e=n.indexOf("#");if(e===-1)return[n.trim(),void 0];const t=n.substring(0,e).trim(),s=n.substring(e+1).trim();return[t,s||void 0]}async function Ex(n){const e=qr();let t=e.vault.getFileByPath(n);if(t)return t;if(!n.includes(".")){const r=n+".md";if(t=e.vault.getFileByPath(r),t)return t}const i=e.vault.getFiles().find(r=>r.name===n||r.name===n+".md");return i||null}async function Sx(n,e){const t=qr();try{if(!e.includes("^")&&!e.includes("-")){const i=(await t.vault.cachedRead(n)).split(`
`),r=e.trim();let o=!1,l=0;const d=[];for(const c of i){const f=c.match(/^#+\s+(.+)$/);if(f&&f[1].trim()===r){o=!0,l=f[0].match(/#/g)?.length??0,d.push(c);continue}if(o){const p=c.match(/^#+\s+/);if(p&&(p[0].match(/#/g)?.length??0)<=l)break;d.push(c)}}if(d.length>0)return d.join(`
`)}return null}catch(s){return console.error(`ËØªÂèñÂùóÂÜÖÂÆπÂ§±Ë¥•: ${n.path}#${e}`,s),null}}function Tx(n,e,t){return`${e?`---
ÂºïÁî®: ${n}#${e}
---`:`---
ÂºïÁî®: ${n}
---`}
${t}`}async function Cx(n){const e=qr(),t=e.vault.getFileByPath(n);if(!t)return null;try{return await e.vault.cachedRead(t)}catch(s){return console.error(`ËØªÂèñÊñá‰ª∂Â§±Ë¥•: ${n}`,s),null}}async function Ax(n,e,t,s,i){const r=i.systemPrompt.trim(),o=await bx(n,e,i),{systemMessages:l,nonSystemMessages:d}=Rx(o);if(s==="system"&&t.trim()){let h=t;i.expandNestedRefs&&(h=await Cr(h)),l.push({role:"system",content:h})}let c=Px(r,l);i.expandNestedRefs&&c&&(c=await Cr(c));const f=[];c&&f.push({role:"system",content:c});const p=await Promise.all(d.map(async h=>i.expandNestedRefs?{...h,content:await Cr(h.content)}:h));if(f.push(...p),s!=="system"){let h=t;i.expandNestedRefs&&(h=await Cr(h)),f.push({role:s,content:h})}return f}async function bx(n,e,t){if(!n||typeof n!="object")return[];const s=Array.isArray(n.nodes)?n.nodes:[],i=Array.isArray(n.edges)?n.edges:[];if(s.length===0||i.length===0)return[];const r=new Map;i.forEach(p=>{if(p&&p.fromNode&&p.toNode){const h=r.get(p.toNode)??[];h.push(p.fromNode),r.set(p.toNode,h)}});const o=new Set,l=p=>{if(o.has(p))return[];o.add(p);const h=r.get(p);if(!h||h.length===0)return[p];let m=[];return h.forEach(g=>{const v=l(g);v.length>m.length&&(m=v)}),[...m,p]},d=l(e);if(d.length===0)return[];const c=d.slice(0,-1).map(p=>s.find(h=>h.id===p)).filter(p=>p!==void 0),f=[];for(const p of c){const h=Ix(p);if(!h)continue;let m=null;if(p.type==="text")m=typeof p.text=="string"?p.text:null;else if(p.type==="file"){const g=await Cx(p.file);g&&(m=`${p.file}
${g}`)}if(m&&m.trim().length>0){let g=m;t.expandNestedRefs&&(g=await Cr(m)),f.push({role:h,content:g})}}return f}function Ix(n){const e=n.unknownData?._cai_role??n._cai_role;return e==="user"||e==="assistant"||e==="system"?e:null}function Rx(n){const e=[],t=[];for(const s of n)s.role==="system"?e.push(s):t.push(s);return{systemMessages:e,nonSystemMessages:t}}function Px(n,e){const t=[];n&&t.push(n);for(const s of e){const i=s.content.trim();i&&t.push(i)}return t.join(`
`)}class xx{get plugin(){return wn.getPlugin()}async handle(e){const{canvas:t,node:s}=e;if(!t||!s){new Pe.Notice("Êú™ÊâæÂà∞ Canvas ÈÄâ‰∏≠ËäÇÁÇπ");return}const i=Kv(s).trim();if(!i){new Pe.Notice("ÂΩìÂâçËäÇÁÇπÊ≤°ÊúâÂèØÁî®ÊñáÊú¨");return}const o=Ml(s)||this.plugin.settings.defaultChatModelId,l=this.plugin.settings.chatModels.find(_=>_.id===o);if(!l){new Pe.Notice("Êú™ÊâæÂà∞ÊñáÊú¨Ê®°ÂûãÔºåËØ∑Âú®ËÆæÁΩÆ‰∏≠ÈÖçÁΩÆ");return}const d=typeof t.getData=="function"?t.getData():null,c=ew(s),f=await Ax(d,s.id,i,c,this.plugin.settings),p=Yv(t,s,this.plugin.settings.nodeSize),h=p.node;h&&(this.plugin.quickActions?.applyRoleToNode(h,t,"assistant"),sw(h,l.model,t),jv(t,s,h,p.fromSide,p.toSide));let m="",g="",v=!1;try{const w=await this.plugin.aiService.requestChat({modelId:l.id,messages:f,stream:!0,onToken:h!==null?(M,x,k)=>{M&&(m+=M),x&&(g+=x),k&&(v=!0);const I=id(m,g,v);sd(h,I,t)}:void 0}),E=m,S=w||g,T=E.trim().length>0,R=id(E,S,T);h?sd(h,R,t):R?new Pe.Notice(`AI ÁîüÊàêÂÆåÊàêÔºà${R.length} Â≠óÔºâ`):new Pe.Notice("AI Ê≤°ÊúâËøîÂõûÂÜÖÂÆπ")}catch(_){console.error("Canvas AI ËØ∑Ê±ÇÂ§±Ë¥•",_)}}}const ma=new Map;function vl(n,e){const t=ma.get(n);t&&t(),ma.set(n,e),wn.getPlugin().register(e)}function Mx(){for(const n of ma.values())n();ma.clear()}class kx{constructor(){this.lineageHighlighter=new ox,this.roleBadgeProvider=Ep(),this.canvasAIExecutor=new xx,this.modelBadgeProvider=Ov(),this.badgeProviders=[this.roleBadgeProvider,this.modelBadgeProvider]}get plugin(){return wn.getPlugin()}start(){this.registerCanvasEvents(),this.tryPatchActiveCanvasMenu(),this.tryPatchCanvasSelectOnly(),nd(this.getActiveCanvas(),this.badgeProviders)}destroy(){Mx(),this.lineageHighlighter.clearHighlight()}getActiveCanvas(){return this.plugin.app.workspace.getMostRecentLeaf()?.view?.canvas??null}getContext(e){const t=e??this.getActiveCanvas();if(!t?.selection)return null;const s=t.selection;if(s.size!==1)return null;const i=s.values().next().value;return{canvas:t,node:i}}applyRoleToNode(e,t,s){e&&(tw(e,s,t,this.plugin.settings.nodeSize),Fo(e,this.modelBadgeProvider),t?.requestSave?.(),hx(s))}arrangeNodeLayout(e){const t=e??this.getContext();if(!t)return!1;const{node:s,canvas:i}=t;return vx(i,s)}registerCanvasEvents(){const e=this.plugin.app.workspace,t=()=>{this.getActiveCanvas()&&(this.tryPatchActiveCanvasMenu(),this.tryPatchCanvasSelectOnly(),this.tryPatchCanvasClick(),nd(this.getActiveCanvas(),this.badgeProviders))};this.plugin.registerEvent(e.on("active-leaf-change",t)),this.plugin.registerEvent(e.on("layout-change",t))}tryPatchActiveCanvasMenu(){const e=this.getActiveCanvas();if(!e?.menu)return;const s=dx(e,(i,r)=>{r.selection.size!==1||Wv(r.selection.values().next().value)||this.injectMenuButtons(i,r)});vl("menu",s)}tryPatchCanvasSelectOnly(){const e=this.getActiveCanvas();if(!e)return;const t=fx(e,s=>{});vl("selectOnly",t)}tryPatchCanvasClick(){const e=this.getActiveCanvas();if(!e?.wrapperEl)return;const t=()=>{this.refreshLineageHighlight()};e.wrapperEl.addEventListener("click",t),vl("canvasClick",()=>{e.wrapperEl.removeEventListener("click",t)})}injectMenuButtons(e,t){const s=this.getContext(t);if(!s)return;const i=this.buildMenuActions();lx(e,s,i),Fo(s.node,this.roleBadgeProvider),Fo(s.node,this.modelBadgeProvider)}buildMenuActions(){const e=this.plugin.settings.quickActions,t=[];return kl.forEach(i=>{if(!i.isRole){if(i.id==="ai"){t.push({id:i.id,icon:i.icon,tooltip:i.tooltip,showInMainMenu:e[i.id],onClick:async r=>{await this.handleAI(r)}});return}if(i.id==="arrangeLayout"){t.push({id:i.id,icon:i.icon,tooltip:i.tooltip,showInMainMenu:e[i.id],onClick:r=>{this.arrangeNodeLayout(r)}});return}}}),["user","assistant","system"].forEach(i=>{const r=kl.find(o=>o.id===i);r&&t.push({id:r.id,icon:r.icon,tooltip:ow(r,i),showInMainMenu:e[i],isActive:o=>Un(o.node)===i,onClick:o=>{this.setRole(o,i)},dataset:{role:i}})}),t}async handleAI(e){return Un(e.node)||this.setRole(e,"user"),new Promise(s=>{setTimeout(async()=>{await this.canvasAIExecutor.handle(e),s()},100)})}setRole(e,t){const{node:s,canvas:i}=e;this.applyRoleToNode(s,i,t)}refreshLineageHighlight(e){const t=e??this.getActiveCanvas(),s=t&&this.getContext(t);if(!t||!s||!Un(s.node)){this.lineageHighlighter.clearHighlight(t??void 0);return}const i=s.node,r=typeof t.getData=="function"?t.getData():null,o=ix(r,i.id);if(o.nodeIds.size===0){this.lineageHighlighter.clearHighlight(t);return}this.lineageHighlighter.highlightLineage(t,o)}}function Nx(n){const e=wn.getPlugin();e.addCommand({id:"caret-canvas-mark-assistant",name:"Ê†áËÆ∞ÈÄâ‰∏≠ËäÇÁÇπ‰∏∫ assistant",checkCallback:t=>{const s=n.getActiveCanvas(),i=n.getContext(s??void 0);return i?(t||n.applyRoleToNode(i.node,i.canvas,"assistant"),!0):!1}}),e.addCommand({id:"caret-canvas-mark-user",name:"Ê†áËÆ∞ÈÄâ‰∏≠ËäÇÁÇπ‰∏∫ user",checkCallback:t=>{const s=n.getActiveCanvas(),i=n.getContext(s??void 0);return i?(t||n.applyRoleToNode(i.node,i.canvas,"user"),!0):!1}})}const Dx="debug.log";class Lx{constructor(e){this.entries=[],this.getConfig=e}get plugin(){return wn.getPlugin()}async load(){try{const e=this.getLogPath(),t=this.plugin.app.vault.adapter;if(await t.exists(e)){const s=await t.read(e);this.entries=s.split(`
`).filter(i=>i.trim())}}catch{this.entries=[]}}debug(e){return this.append("DEBUG",e)}log(e){return this.append("INFO",e)}warn(e){return this.append("WARN",e)}error(e){return this.append("ERROR",e)}async append(e,t){const{enabled:s,limit:i}=this.getConfig();if(!s)return;const r=`${new Date().toISOString()} [${e}] ${t}`;this.entries.push(r),this.entries.length>i&&(this.entries=this.entries.slice(-i)),await this.save()}getEntries(){return[...this.entries]}async clear(){this.entries=[],await this.save()}async save(){const e=this.getLogPath();await this.plugin.app.vault.adapter.write(e,this.entries.join(`
`))}getLogPath(){return`${this.plugin.manifest.dir}/${Dx}`}}const gi=class gi extends El{static getPlugin(){return gi.pluginInstance}async onload(){await super.onload(),gi.pluginInstance=this,u_(this.app),this.debugLogger=new Lx(()=>this.settings.debugLog),await this.debugLogger.load(),this.addSettingTab(new PE),this.aiService=new sx,this.quickActions=new kx,this.quickActions.start(),Nx(this.quickActions)}onunload(){super.onunload(),this.quickActions?.destroy(),c_(),gi.pluginInstance=null}};gi.pluginInstance=null;let wn=gi;module.exports=wn;
