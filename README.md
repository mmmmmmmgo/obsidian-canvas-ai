# Obsidian Canvas AI

一个强大的 Obsidian 插件，将 AI 能力深度融入 Canvas 场景，让你在画布上进行非线性对话、快速扩展节点和生成内容。


> 感谢[caret](https://github.com/jcollingj/caret)的灵感  
> fuck flowith.io !!

## 主要特性

- **Canvas 快速操作**：选中节点时显示悬浮快捷操作条，快速访问 AI 功能
- **AI 续写**：基于对话血统自动构建上下文，在 Canvas 中生成回复节点
- **角色管理**：为节点标记 user/assistant/system 角色，清晰展示对话结构
- **血统高亮**：选中节点时自动高亮对话血统路径，直观理解节点关系
- **图像生成**：使用 AI 模型生成图片并自动插入到 Canvas
- **模型管理**：支持多个 OpenAI 兼容模型，灵活切换和管理
- **本地优先**：所有数据存储在本地，保护隐私，无需外部后端服务

---

<div style="font-size: 0.5em; color: var(--text-faint); padding: 0.5em 0;">
  以上功能是本项目目标
</div>

---

## 安装

### 通过 Obsidian BRAT 插件安装

1. 在社区插件中搜索并安装 [BRAT (Beta Reviewers Auto-update Tool)](https://github.com/TfTHacker/obsidian42-brat)
2. 启用 BRAT 插件
3. 打开 BRAT 设置，点击「Add beta plugin」
4. 在弹出框填写插件仓库地址：`mmmmmmmgo/obsidian-canvas-ai`
5. 确认添加，BRAT 会自动下载并安装 Canvas AI 插件
6. 在插件列表启用 Obsidian Canvas AI

### 手动安装

1. 从 [Releases](https://github.com/your-repo/obsidian-canvas-ai/releases) 下载最新版本
2. 将下载的文件解压到你的 Obsidian vault 的 `.obsidian/plugins/obsidian-canvas-ai/` 目录
3. 重启 Obsidian 或重新加载插件

## 使用说明

### 快速开始

![](./docs/PixPin_2025-12-20_09-10-17.gif)

1. 打开任意 Canvas 画布
2. 创建或选择一个文本节点
3. 选中节点后，会看到悬浮的快捷操作条
4. 点击 AI 按钮开始使用



### Canvas 快速操作

当你在 Canvas 中选中单个节点时，会在节点附近显示一个快捷操作条，包含以下功能：

<!-- TODO: 添加快速操作条演示 GIF -->
<!-- ![快速操作条](path/to/quick-actions-bar.gif) -->

- **AI 按钮**：基于当前节点和对话血统生成回复
- **角色切换**：为节点标记 user/assistant/system 角色
- **方向创建**：在指定方向创建新节点
- **更多操作**：访问其他扩展功能

### AI 续写功能

<!-- TODO: 添加 AI 续写演示视频 -->
<!-- ![AI 续写演示](path/to/ai-continue.mp4) -->

1. **选中节点**：在 Canvas 中选择一个文本节点
2. **点击 AI 按钮**：快捷操作条中的 AI 按钮
3. **自动构建上下文**：插件会基于节点的最长血统路径构建对话上下文
4. **生成回复**：AI 会在画布中创建新的回复节点

**上下文包含**：
- 选中节点的文本内容
- 对话血统路径上的所有节点
- 自动展开的 `[[引用]]` 链接
- 链接的 Markdown/PDF 文件内容
- 网页链接的全文内容（如果节点包含链接）

### 角色管理

<!-- TODO: 添加角色管理演示 GIF -->
<!-- ![角色管理](path/to/role-management.gif) -->

为节点设置角色可以帮助你更好地组织对话结构：

- **User**：用户消息节点
- **Assistant**：AI 回复节点
- **System**：系统提示节点

设置角色后，节点上会显示对应的角色标识，方便识别对话结构。

### 血统高亮

<!-- TODO: 添加血统高亮演示 GIF -->
<!-- ![血统高亮](path/to/lineage-highlight.gif) -->

选中节点时，插件会自动高亮该节点的最长血统路径，帮助你：
- 理解节点的对话上下文
- 追踪对话的演进路径
- 快速定位相关节点

### ~~图像生成~~

in progress...

### 模型管理

在插件设置中可以管理多个 AI 模型：

<!-- TODO: 添加模型设置界面截图 -->
<!-- ![模型设置](path/to/model-settings.png) -->

- **添加模型**：支持任何 OpenAI 兼容接口
- **配置参数**：设置 API 地址、密钥、上下文窗口等
- **能力标签**：标记模型支持的流式输出、函数调用、视觉能力
- **切换默认模型**：快速切换用于续写的默认模型

### 命令面板

插件提供了以下命令（通过 `Cmd/Ctrl + P` 打开命令面板）：

- **Canvas: 触发 AI 续写**：为选中节点生成回复
- **Canvas: 切换节点角色**：快速切换节点角色
- **Canvas: 高亮/取消高亮血统**：手动控制血统高亮

## 设置说明

### 基本设置

在 Obsidian 设置中找到「Canvas AI」标签页，可以配置：

- **默认模型**：选择用于 Canvas 续写的主要模型
- **图像生成模型**：选择用于生成图片的模型
- **系统提示词**：全局系统提示，会追加到所有续写请求中
- **展开嵌套引用**：是否自动展开 `[[引用]]` 中的嵌套引用
- **上下文裁剪警告**：当上下文超过模型窗口时是否显示警告

### 模型配置

每个模型需要配置：

- **模型 ID**：唯一标识符
- **显示名称**：在界面中显示的名称
- **API 地址**：OpenAI 兼容接口的地址
- **API 密钥**：访问接口所需的密钥
- **上下文窗口**：模型支持的最大 token 数
- **能力标签**：
  - 流式输出：支持流式响应
  - 函数调用：支持函数调用功能
  - 视觉能力：支持图像输入

### 快速操作设置

可以自定义快捷操作条的显示选项：

- 显示/隐藏 AI 按钮
- 显示/隐藏角色切换按钮
- 显示/隐藏其他扩展按钮

## 使用场景示例

### 场景 1：头脑风暴

<!-- TODO: 添加头脑风暴场景演示 -->
<!-- ![头脑风暴场景](path/to/brainstorming-scenario.gif) -->

在 Canvas 中创建一个中心节点，然后：
1. 选中节点，点击 AI 按钮生成想法
2. 为不同分支设置不同角色
3. 沿着血统路径继续扩展

### 场景 2：对话式写作

<!-- TODO: 添加对话式写作场景演示 -->
<!-- ![对话式写作](path/to/conversational-writing.gif) -->

1. 创建 user 节点作为问题
2. 使用 AI 生成 assistant 回复
3. 继续对话，构建完整的对话树

### 场景 3：知识整理

<!-- TODO: 添加知识整理场景演示 -->
<!-- ![知识整理](path/to/knowledge-organization.gif) -->

1. 在节点中引用其他笔记
2. AI 会自动展开引用内容作为上下文
3. 基于完整上下文生成相关内容


## 开源协议

本项目采用 [GNU Affero General Public License v3.0 (AGPL-3.0)](LICENSE.txt) 许可证。

AGPL-3.0 是最严格的开源协议之一，要求：
- 任何使用、修改或分发本项目的代码都必须以相同的 AGPL-3.0 协议开源
- 即使是通过网络提供服务（如 SaaS），也必须公开修改后的源代码
- 确保代码及其衍生作品始终保持开源状态

